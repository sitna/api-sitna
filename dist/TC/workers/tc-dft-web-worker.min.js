function tXml(t,e){"use strict";e=e||{};var r=0,a="<",n="<".charCodeAt(0),i=">",l=">".charCodeAt(0),u="-".charCodeAt(0),s="/".charCodeAt(0),c="!".charCodeAt(0),o="'".charCodeAt(0),f='"'.charCodeAt(0),m="[".charCodeAt(0),d="]".charCodeAt(0);function h(){for(var e=[];t[r];){if(t.charCodeAt(r)==n){if(t.charCodeAt(r+1)===s){r=t.indexOf(i,r);return e}if(t.charCodeAt(r+1)===c){var a=t.charCodeAt(r+2);if(a!=m){if(a==u){for(;-1!==r&&(t.charCodeAt(r)!==l||t.charCodeAt(r-1)!=u||t.charCodeAt(r-2)!=u||-1==r);)r=t.indexOf(i,r+1);-1===r&&(r=t.length)}else{r+=2;for(;t.charCodeAt(r)!==l;)r++}r++;continue}}var o=v();e.push(o)}else{var f=y();f.trim().length>0&&e.push(f)}r++}return e}function y(){var e=r;-2===(r=t.indexOf(a,r)-1)&&(r=t.length);return t.slice(e,r+1)}var p="\n\t>/= ";function g(){for(var e=r,a=t[r];-1===p.indexOf(a);)":"===(a=t[++r])&&(e=++r);return t.slice(e,r)}var b=["img","br","input","meta","link"];function v(){var e={};r++;if(t.charCodeAt(r)===c&&t.charCodeAt(r+1)===m){for(var a=r+8;t.charCodeAt(r)!==l||t.charCodeAt(r-1)!==d||t.charCodeAt(r-2)!==d;)r++;return t.slice(a,r-2)}e.tagName=g();var n=!1;let i;for(;t.charCodeAt(r)!==l;){var u=t.charCodeAt(r);if(u>64&&u<91||u>96&&u<123){i=g();for(var y=t.charCodeAt(r);y!==o&&y!==f&&!(y>64&&y<91||y>96&&y<123)&&y!==l;){r++;y=t.charCodeAt(r)}if(!n){e.attributes={};n=!0}let a;if(y===o||y===f)a=N();else{a=null;r--}e.attributes[i]=a}r++}if(t.charCodeAt(r-1)!==s)if("script"==e.tagName){a=r+1;r=t.indexOf("<\/script>",r);e.children=[t.slice(a,r-1)];r+=8}else if("style"==e.tagName){a=r+1;r=t.indexOf("</style>",r);e.children=[t.slice(a,r-1)];r+=7}else if(-1==b.indexOf(e.tagName)){r++;e.children=h()}return e}function N(){var e=t[r],a=++r;r=t.indexOf(e,a);return t.slice(a,r)}var x,C=null;if(void 0!==e.attrValue){e.attrName=e.attrName||"id";for(C=[];-1!==(r=(x=void 0,(x=new RegExp("\\s"+e.attrName+"\\s*=['\"]"+e.attrValue+"['\"]").exec(t))?x.index:-1));){-1!==(r=t.lastIndexOf("<",r))&&C.push(v());t=t.substr(r);r=0}}else C=h();e.filter&&(C=tXml.filter(C,e.filter));e.simplify&&(C=tXml.simplify(C));return C}tXml.simplify=function(t){var e={};if(!t||!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];t.forEach(function(t){if("object"==typeof t){e[t.tagName]||(e[t.tagName]=[]);var r=tXml.simplify(t.children);e[t.tagName].push(r);t.attributes&&(r._attributes=t.attributes)}});for(var r in e)1==e[r].length&&(e[r]=e[r][0]);return e};tXml.filter=function(t,e){var r=[];t.forEach(function(t){"object"==typeof t&&e(t)&&r.push(t);if(t.children){var a=tXml.filter(t.children,e);r=r.concat(a)}});return r};tXml.stringify=function(t){var e="";function r(t){if(t)for(var r=0;r<t.length;r++)"string"==typeof t[r]?e+=t[r].trim():a(t[r])}function a(t){e+="<"+t.tagName;for(var a in t.attributes)null===t.attributes[a]?e+=" "+a:-1===t.attributes[a].indexOf('"')?e+=" "+a+'="'+t.attributes[a].trim()+'"':e+=" "+a+"='"+t.attributes[a].trim()+"'";e+=">";r(t.children);e+="</"+t.tagName+">"}r(t);return e};tXml.toContentString=function(t){if(Array.isArray(t)){var e="";t.forEach(function(t){e=(e+=" "+tXml.toContentString(t)).trim()});return e}return"object"==typeof t?tXml.toContentString(t.children):" "+t};tXml.getElementById=function(t,e,r){var a=tXml(t,{attrValue:e,simplify:r});return r?a:a[0]};tXml.getElementsByClassName=function(t,e,r){return tXml(t,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+e+"[a-zA-Z0-9-s ]*",simplify:r})};"object"==typeof module&&(module.exports=tXml);!function(){const t=function(t){return t.substring(t.indexOf(":")+1)},e=function(t,e){for(var r in e.attributes)t.attributes[r]=e.attributes[r];t.children=t.children.concat(e.children.filter(function(t){return"element"===t.tagName||"complexType"===t.tagName||"import"===t.tagName}))},r=function(t,e){if(t.tagName===e)return[t];if(t.children){const a=t.children.filter(function(t){return t.tagName===e});return a.length>0?a:t.children.reduce(function(t,a){return t.concat(r(a,e))},[])}return[]},a=async function(t,r){var n=t.children.filter(function(t){return"include"===t.tagName});if(n.length>0)for(var i=0;i<n.length;i++){var l=n[i].attributes.schemaLocation;l=l.startsWith("http")?l:r.substring(0,r.lastIndexOf("/")+1)+l;if(!(d.indexOf(l)>=0)){var u;try{u=await s(l)}catch(e){return t}e(t,u);d.push(l);a(t,l);return t}}return t},n=async function(a,n,i){if(m[n])return m[n];if(a.children&&a.children.filter(function(e){return"element"===e.tagName&&e.attributes.name===t(n)}).length>0){n.endsWith("Type")?m[n]=await o(a,n,++i):m[n]=await c(a,n,++i);return m[n]}if(n.indexOf(":")>0){const u=n.substring(0,n.indexOf(":")),f=a.children.find(function(t){return"import"===t.tagName&&t.attributes.namespace===a.attributes[u]}).attributes.schemaLocation;var l=await s(f.startsWith("http")?f:self.location.origin+"/"+f);d.push(f);e(a,l);if(n.endsWith("Type")){let e=null;(e=1===r(n,"element").length&&r(n,"element")[0].attributes.ref?await c(a,r(n,"element")[0].attributes.ref,++i):await o(a,n,++i))&&0!==Object.keys(e).length||(e=await async function(e,a,n){let i=[];const l=new Promise(async function(l){const u=async function(e,a,c){var o=e.children.find(function(e){return"complexType"===e.tagName&&e.attributes.name===t(a)});if(o){var f=null,m=r(o,"extension")[0],d=r(o,"element")[0];m&&m.attributes.base&&(f=m.attributes.base);d&&d.attributes.ref&&(f=d.attributes.ref);if(f)if(f.indexOf(":")>0){i=[];o=await u({...e},f,n)}else l(f);else l(o)}else{i.push(c);var h=e.children.filter(function(t){return"include"===t.tagName});if(h.length>0)for(var y=0;y<h.length;y++){var p=h[y].attributes.schemaLocation;p=p.startsWith("http")?p:c.substring(0,c.lastIndexOf("/")+1)+p;if(!(i.indexOf(p)>=0)){try{e=await s(p)}catch(t){console.log(t);throw t}await u({...e},a,p)}}}};await u({...e},a,n);l(null)});return await l}(l,n,f));m[n]=e;return e}m[n]=await c(a,n,++i);return m[n]}return n},i=["gml:PointPropertyType","gml:MultiPointPropertyType","gml:LineStringPropertyType","gml:MultiLineStringPropertyType","gml:LinearRingPropertyType","gml:PolygonPropertyType","gml:MultiPolygonPropertyType","gml:MultiSurfacePropertyType","gml:GeometryPropertyType","gml:GeometryCollectionPropertyType","gml:GeometryAssociationType","gml:MultiCurvePropertyType","gml:CurvePropertyType","gml:BoxPropertyType"],l={},u={},s=async function(t){if(l[t])return l[t]instanceof Promise?await l[t]:l[t];l[t]=new Promise(function(e){u[t]=e});self.postMessage(t);return await l[t]},c=async function(e,r,n,i){if(n===h)return null;var l=(e=await a(e)).children.filter(function(e){return"element"===e.tagName&&e.attributes.name===t(r)});if(l.length>0){var u=function(e,r){var a;if(!r.children&&r.attributes.type){var n=r.attributes.type;a=e.children.filter(function(e){return"complexType"===e.tagName&&e.attributes.name===t(n)})}else if(r.children&&r.attributes.type){n=r.attributes.type;a=e.children.filter(function(e){return"complexType"===e.tagName&&e.attributes.name===t(n)})}return a.length>0?a[0]:null}(e,l[0]);m[r]=await o(e,u,n,i);return m[r]}m[r]=null;return null},o=async function(e,a,l,u){a instanceof Object||(a=e.children.find(function(e){return"complexType"===e.tagName&&e.attributes.name===t(a)}));if(!a)return null;const s=r(a,"element");for(var f={},m=0;m<s.length;m++){let b=s[m],v=b.attributes.type;if(!b.attributes.name&&b.attributes.ref){let r={},a=b.attributes.ref.substring(0,b.attributes.ref.indexOf(":"));r[t(b.attributes.ref)]={type:await c(e,b.attributes.ref,++l,a),name:b.attributes.ref};return r}let N=f[t(b.attributes.name)]={};for(var d in b.attributes)switch(d){case"minOccurs":case"maxOccurs":N[d]=parseInt(b.attributes[d],10);isNaN(N[b.attributes[d]])&&(N[d]=b.attributes[d]);break;case"nillable":N[d]="true"===b.attributes[d];break;default:N[d]=(u?u+":":"")+b.attributes[d]}if(!i.includes(v))if(v){N.type=v;v.startsWith("xsd")&&(v=t(v));if("gml:ReferenceType"===v){var h=r(b,"targetElement");h.length>0&&h[0].children.length>0&&(N.type=await n(e,h[0].children[0],l))}else v.indexOf(":")>0&&((a=e.children.find(function(e){return("complexType"===e.tagName||"element"===e.tagName)&&e.attributes.name===t(v)}))?"complexType"===a.tagName?N.type=await o(e,a,l):N.type=null:N.type=await n(e,v,l))}else{var y=b.children.find(t=>"complexType"===t.tagName),p=r(y,"extension")[0],g=r(y,"element")[0];p&&p.attributes.base&&(p.attributes.base.indexOf(":")<0?N.type=p.attributes.base:N.type=await n(e,p.attributes.base));g&&g.attributes.ref&&(N.type=await n(e,g.attributes.ref))}}return f},f=async function(t,e,r){var a=t.find(function(t){return"schema"===t.tagName});return new Promise(async function(t){await c(a,e,0);t()})};var m={},d=[],h=5;onmessage=async function(t){if(t.data.xml){var e=tXml(t.data.xml);const a=t.data.layerName instanceof Array?t.data.layerName:t.data.layerName.split(",");let n;try{for(var r=0;r<a.length;r++)await f(e,a[r]);n=!0}catch(t){n=!1}postMessage({state:n?"success":"error",DFTCollection:(t.data.layerName instanceof Array?t.data.layerName:t.data.layerName.split(",")).reduce(function(t,e){let r={};r[e]=m[e]||m[e.replace(/^\w{1,}:/,function(t){return t.toLowerCase()})];return Object.assign(t,r)},{})})}else{u[t.data.url](tXml(t.data.response)[0]);delete u[t.data.url]}}}();