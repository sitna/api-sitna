function tXml(t,e){"use strict";e=e||{};var r=0,i="<",a="<".charCodeAt(0),n=">",o=">".charCodeAt(0),l="-".charCodeAt(0),f="/".charCodeAt(0),u="!".charCodeAt(0),s="'".charCodeAt(0),c='"'.charCodeAt(0),h="[".charCodeAt(0),g="]".charCodeAt(0);function d(){for(var e=[];t[r];){if(t.charCodeAt(r)==a){if(t.charCodeAt(r+1)===f){r=t.indexOf(n,r);return e}if(t.charCodeAt(r+1)===u){var i=t.charCodeAt(r+2);if(i!=h){if(i==l){for(;-1!==r&&(t.charCodeAt(r)!==o||t.charCodeAt(r-1)!=l||t.charCodeAt(r-2)!=l||-1==r);)r=t.indexOf(n,r+1);-1===r&&(r=t.length)}else{r+=2;for(;t.charCodeAt(r)!==o;)r++}r++;continue}}var s=x();e.push(s)}else{var c=p();c.trim().length>0&&e.push(c)}r++}return e}function p(){var e=r;-2===(r=t.indexOf(i,r)-1)&&(r=t.length);return t.slice(e,r+1)}var m="\n\t>/= ";function v(){for(var e=r,i=t[r];-1===m.indexOf(i);)":"===(i=t[++r])&&(e=++r);return t.slice(e,r)}var C=["img","br","input","meta","link"];function x(){var e={};r++;if(t.charCodeAt(r)===u&&t.charCodeAt(r+1)===h){for(var i=r+8;t.charCodeAt(r)!==o||t.charCodeAt(r-1)!==g||t.charCodeAt(r-2)!==g;)r++;return t.slice(i,r-2)}e.tagName=v();for(var a=!1;t.charCodeAt(r)!==o;){var n=t.charCodeAt(r);if(n>64&&n<91||n>96&&n<123){for(var l=v(),p=t.charCodeAt(r);p!==s&&p!==c&&!(p>64&&p<91||p>96&&p<123)&&p!==o;){r++;p=t.charCodeAt(r)}if(!a){e.attributes={};a=!0}if(p===s||p===c)var m=y();else{m=null;r--}e.attributes[l]=m}r++}if(t.charCodeAt(r-1)!==f)if("script"==e.tagName){i=r+1;r=t.indexOf("<\/script>",r);e.children=[t.slice(i,r-1)];r+=8}else if("style"==e.tagName){i=r+1;r=t.indexOf("</style>",r);e.children=[t.slice(i,r-1)];r+=7}else if(-1==C.indexOf(e.tagName)){r++;e.children=d()}return e}function y(){var e=t[r],i=++r;r=t.indexOf(e,i);return t.slice(i,r)}var S,A=null;if(void 0!==e.attrValue){e.attrName=e.attrName||"id";for(A=[];-1!==(r=(void 0,(S=new RegExp("\\s"+e.attrName+"\\s*=['\"]"+e.attrValue+"['\"]").exec(t))?S.index:-1));){-1!==(r=t.lastIndexOf("<",r))&&A.push(x());t=t.substr(r);r=0}}else A=d();e.filter&&(A=tXml.filter(A,e.filter));e.simplify&&(A=tXml.simplify(A));return A}tXml.simplify=function(t){var e={};if(!t||!t.length)return"";if(1===t.length&&"string"==typeof t[0])return t[0];t.forEach(function(t){if("object"==typeof t){e[t.tagName]||(e[t.tagName]=[]);var r=tXml.simplify(t.children);e[t.tagName].push(r);t.attributes&&(r._attributes=t.attributes)}});for(var r in e)1==e[r].length&&(e[r]=e[r][0]);return e};tXml.filter=function(t,e){var r=[];t.forEach(function(t){"object"==typeof t&&e(t)&&r.push(t);if(t.children){var i=tXml.filter(t.children,e);r=r.concat(i)}});return r};tXml.stringify=function(t){var e="";function r(t){if(t)for(var r=0;r<t.length;r++)"string"==typeof t[r]?e+=t[r].trim():i(t[r])}function i(t){e+="<"+t.tagName;for(var i in t.attributes)null===t.attributes[i]?e+=" "+i:-1===t.attributes[i].indexOf('"')?e+=" "+i+'="'+t.attributes[i].trim()+'"':e+=" "+i+"='"+t.attributes[i].trim()+"'";e+=">";r(t.children);e+="</"+t.tagName+">"}r(t);return e};tXml.toContentString=function(t){if(Array.isArray(t)){var e="";t.forEach(function(t){e=(e+=" "+tXml.toContentString(t)).trim()});return e}return"object"==typeof t?tXml.toContentString(t.children):" "+t};tXml.getElementById=function(t,e,r){var i=tXml(t,{attrValue:e,simplify:r});return r?i:i[0]};tXml.getElementsByClassName=function(t,e,r){return tXml(t,{attrName:"class",attrValue:"[a-zA-Z0-9-s ]*"+e+"[a-zA-Z0-9-s ]*",simplify:r})};"object"==typeof module&&(module.exports=tXml);!function(){var t=function(t){return t.href},e=function(e,r){if(e.hasOwnProperty(r)){for(var i=e[r],a=i.length?i:[i],n=0,o=a.length;n<o;n++){var l=a[n];l.OnlineResource=t(l.OnlineResource)}e[r]=a}},r=[!1,!0],i=function(t){return t.split(" ").map(function(t){return parseFloat(t)})},a=function(t){for(var e=t.length?t:[t],r=new Array(e.length),i=0,a=e.length;i<a;i++){var n=e[i];if(!n.Constraint.length){n.Constraint=[n.Constraint];for(var o=0,l=n.Constraint.length;o<l;o++){var f=n.Constraint[o].AllowedValues;"string"==typeof f.Value&&(f.Value=[f.Value])}}r[i]={Constraint:n.Constraint,href:n.href}}return r},n=function(i){var a=i.WMS_Capabilities||i["?xml"]&&(i["?xml"].WMS_Capabilities||i["?xml"].WMT_MS_Capabilities);if(a){!function i(a,n){a.hasOwnProperty("queryable")&&(a.queryable=r[a.queryable]);var o;if(a.hasOwnProperty("EX_GeographicBoundingBox")){o=a.EX_GeographicBoundingBox;a.EX_GeographicBoundingBox=[parseFloat(o.westBoundLongitude),parseFloat(o.southBoundLatitude),parseFloat(o.eastBoundLongitude),parseFloat(o.northBoundLatitude)]}if(a.hasOwnProperty("BoundingBox")){o=a.BoundingBox;o=a.BoundingBox.length?a.BoundingBox:[a.BoundingBox];a.BoundingBox=o.map(function(t){return{crs:t.CRS,extent:[parseFloat(t.minx),parseFloat(t.miny),parseFloat(t.maxx),parseFloat(t.maxy)],res:new Array(2)}})}a.hasOwnProperty("Attribution")&&a.Attribution.OnlineResource&&(a.Attribution.OnlineResource=t(a.Attribution.OnlineResource));e(a,"AuthorityURL");e(a,"MetadataURL");if(a.Style){a.Style.length||(a.Style=[a.Style]);for(var l=0,f=a.Style.length;l<f;l++)e(a.Style[l],"LegendURL")}var u="string"==typeof a.CRS?[a.CRS]:a.CRS;n&&a.CRS&&(a.CRS=u.concat(n));if(a.Layer){var s=a.Layer[1]?a.Layer:[a.Layer];a.Layer=s;for(l=0,f=s.length;l<f;l++)i(s[l],u)}}(a.Capability.Layer);var n=a.Capability.Request;!function(e){if(e){for(var r=e.DCPType.length?e.DCPType:[e.DCPType],i=0,a=r.length;i<a;i++){var n=r[i];for(var o in n){var l=n[o];for(var f in l){var u=l[f];u.OnlineResource=t(u.OnlineResource)}}}e.DCPType=r}}(n.GetMap);n.GetFeatureInfo&&(n.GetFeatureInfo.Format="string"==typeof n.GetFeatureInfo.Format?[n.GetFeatureInfo.Format]:n.GetFeatureInfo.Format)}return a},o=function(t){var e=t["?xml"]&&t["?xml"].Capabilities;if(e){!function(t){t.Layer.length||(t.Layer=[t.Layer]);for(var e=t.Layer,r=0,a=e.length;r<a;r++){var n=e[r];"string"==typeof n.Format&&(n.Format=[n.Format]);n.ResourceURL&&!n.ResourceURL.length&&(n.ResourceURL=[n.ResourceURL]);n.Style.length||(n.Style=[n.Style]);n.TileMatrixSetLink.length||(n.TileMatrixSetLink=[n.TileMatrixSetLink]);for(var o=0,l=n.TileMatrixSetLink.length;o<l;o++){var f=n.TileMatrixSetLink[o];if(f.TileMatrixSetLimits){f.TileMatrixSetLimits=f.TileMatrixSetLimits.TileMatrixLimits;for(var u=0,s=f.TileMatrixSetLimits.length;u<s;u++){var c=f.TileMatrixSetLimits[u];c.MaxTileCol=parseInt(c.MaxTileCol);c.MaxTileRow=parseInt(c.MaxTileRow);c.MinTileCol=parseInt(c.MinTileCol);c.MinTileRow=parseInt(c.MinTileRow)}}else f.TileMatrixSetLimits=[]}if(n.WGS84BoundingBox){var h=i(n.WGS84BoundingBox.LowerCorner),g=i(n.WGS84BoundingBox.UpperCorner);n.WGS84BoundingBox=[h[0],h[1],g[0],g[1]]}}}(e.Contents);!function(t){t.TileMatrixSet.length||(t.TileMatrixSet=[t.TileMatrixSet]);for(var e=t.TileMatrixSet,r=0,a=e.length;r<a;r++)for(var n=e[r],o=0,l=n.TileMatrix.length;o<l;o++){var f=n.TileMatrix[o];f.MatrixHeight=parseInt(f.MatrixHeight);f.MatrixWidth=parseInt(f.MatrixWidth);f.TileHeight=parseInt(f.TileHeight);f.TileWidth=parseInt(f.TileWidth);f.ScaleDenominator=parseFloat(f.ScaleDenominator);f.TopLeftCorner=i(f.TopLeftCorner)}}(e.Contents);!function(t){for(var e=t.Operation.length?t.Operation:[t.Operation],r=0,i=e.length;r<i;r++){var n=e[r];for(var o in n.DCP){var l=n.DCP[o];for(var f in l)l[f]=a(l[f])}t[n.name]={DCP:n.DCP}}delete t.Operation}(e.OperationsMetadata)}return e};onmessage=function(t){var e=function t(e,r){var i={};if(!(e&&e.length||r))return"";if(1===(e=e||[]).length&&"string"==typeof e[0])return e[0];e.forEach(function(e){if("object"==typeof e){var r=e.tagName.indexOf("ows:"),a=r<0?e.tagName:e.tagName.substr(r+4);i[a]||(i[a]=[]);var n=t(e.children,e.attributes);i[a].push(n);if(e.attributes)for(var o in e.attributes)n[o]=e.attributes[o]}});for(var a in i)1==i[a].length&&(i[a]=i[a][0]);return i}(tXml(t.data.text)),r="WMTS"===t.data.type?o(e):n(e);postMessage({state:r?"success":"error",capabilities:r})}}();