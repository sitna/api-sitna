window.OpenLayers||TC.syncLoadJS(TC.url.ol);!function(){OpenLayers._getScriptLocation=function(){var e=OpenLayers._getScriptLocation();e||(e=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/")+1));return function(){return e}}();OpenLayers.CustomTheme=TC.apiLocation+"OpenLayers/theme/tcsa/style.css";OpenLayers.Util.extend(OpenLayers.Feature.Vector.style.default,{fillColor:TC.Cfg.styles.polygon.fillColor,fillOpacity:TC.Cfg.styles.polygon.fillOpacity,strokeColor:TC.Cfg.styles.line.strokeColor,strokeWidth:TC.Cfg.styles.line.strokeWidth});OpenLayers.Format.XML.prototype._write=OpenLayers.Format.XML.prototype.write;OpenLayers.Format.XML.prototype.write=function(){var e=OpenLayers.Format.XML.prototype._write.apply(this,arguments);return e=e.replace(new RegExp('xmlns:NS\\d+="" NS\\d+:',"g"),"")};OpenLayers.Control.PanZoom.prototype.onButtonClick=function(e){switch(e.buttonElement.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToExtent(this.map.options.extent)}};OpenLayers.Control.OverviewMap.prototype._updateOverview=OpenLayers.Control.OverviewMap.prototype.updateOverview;OpenLayers.Control.OverviewMap.prototype.updateOverview=function(){(this.active||null===this.active)&&this._updateOverview()};OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var r=e.documentElement;if(r){var a=this["read_"+r.nodeName];t=a?a.call(this,r):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],r=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(r)for(var a=0,n=r.length;a<n;++a){var o=r[a],i=o.nodeName;o.prefix&&(i=i.split(":")[1]);i=i.replace(this.layerIdentifier,"");var s=this.getSiblingNodesByTagCriteria(o,this.featureIdentifier);if(s)for(var p=0;p<s.length;p++){var l=s[p],u=this.parseGeometry(l),y=this.parseAttributes(l),c=new OpenLayers.Feature.Vector(u.geometry,y,null);c.bounds=u.bounds;c.type=i;t.push(c)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"*","FIELDS"),a=0,n=r.length;a<n;a++){var o,i=r[a],s={},p=i.attributes.length;if(p>0)for(o=0;o<p;o++){var l=i.attributes[o];s[l.nodeName]=l.nodeValue}else{var u=i.childNodes;for(o=0,p=u.length;o<p;++o){var y=u[o];3!=y.nodeType&&(s[y.getAttribute("name")]=y.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(null,s,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var r,a,n,o,i,s=[];if(e&&e.hasChildNodes()){n=(r=e.childNodes).length;for(var p=0;p<n;p++){i=r[p];for(;i&&1!=i.nodeType;){i=i.nextSibling;p++}(a=i?i.nodeName:"").length>0&&a.indexOf(t)>-1?s.push(i):(o=this.getSiblingNodesByTagCriteria(i,t)).length>0&&(0==s.length?s=o:s.push(o))}}return s},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var r=e.childNodes,a=r.length,n=0;n<a;++n){var o=r[n];if(1==o.nodeType){var i=o.childNodes,s=o.prefix?o.nodeName.split(":")[1]:o.nodeName;if(0==i.length)t[s]=null;else if(1==i.length){var p=i[0];if(3==p.nodeType||4==p.nodeType){var l=p.nodeValue.replace(this.regExes.trimSpace,"");t[s]=l}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,r=this.gmlFormat.parseFeature(e),a=null;if(r){t=r.geometry&&r.geometry.clone();a=r.bounds&&r.bounds.clone();r.destroy()}return{geometry:t,bounds:a}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Format.GML.prototype._oldParseFeature=OpenLayers.Format.GML.prototype.parseFeature;OpenLayers.Format.GML.prototype.parseFeature=function(e){this.externalProjection=null;for(var t,r,a=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],n=0;n<a.length;++n){t=a[n];if((r=this.getElementsByTagNameNS(e,this.gmlns,t)).length>0){var o=r[0].getAttribute("srsName");if(o){TC.loadProjDef({crs:o,sync:!0});this.externalProjection=new OpenLayers.Projection("EPSG:"+o.substr(o.lastIndexOf("#")+1))}break}}return this._oldParseFeature(e)};OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){(e=e||{}).handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));!0===this.drillDown&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,r=this.layers||this.map.layers,a=[],n=r.length-1;n>=0;--n)if((e=r[n])instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;!1!==this.drillDown||this.url||(this.url=t);(!0===this.drillDown||this.urlMatches(t))&&a.push(e)}return a},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var r=0,a=this.layerUrls.length;r<a;++r)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[r],e)){t=!0;break}return t},buildWMSOptions:function(e,t,r,a){for(var n=[],o=[],i=0,s=t.length;i<s;i++)if(null!=t[i].params.LAYERS){n=n.concat(t[i].params.LAYERS);o=o.concat(this.getStyleNames(t[i]))}var p=t[0],l=this.map.getProjection(),u=p.projection;u&&u.equals(this.map.getProjectionObject())&&(l=u.getCode());var y=OpenLayers.Util.extend({service:"WMS",version:p.params.VERSION,request:"GetFeatureInfo",exceptions:p.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,p.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:a,info_format:p.params.INFO_FORMAT||this.infoFormat},parseFloat(p.params.VERSION)>=1.3?{crs:l,i:parseInt(r.x),j:parseInt(r.y)}:{srs:l,x:parseInt(r.x),y:parseInt(r.y)});0!=n.length&&(y=OpenLayers.Util.extend({layers:n,query_layers:n,styles:o},y));OpenLayers.Util.applyDefaults(y,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(y),callback:function(t){this.handleResponse(r,t,e)},scope:this}},getStyleNames:function(e){return e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"")},request:function(e,t){if(0!=(n=this.findLayers()).length){t=t||{};if(!1===this.drillDown){var r=this.buildWMSOptions(this.url,n,e,n[0].params.FORMAT),a=OpenLayers.Request.GET(r);!0===t.hover&&(this.hoverRequest=a)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var n,o={},i=0,s=n.length;i<s;i++){var p=n[i];if((l=OpenLayers.Util.isArray(p.url)?p.url[0]:p.url)in o)o[l].push(p);else{this._numRequests++;o[l]=[p]}}for(var l in o){n=o[l];r=this.buildWMSOptions(l,n,e,n[0].params.FORMAT);OpenLayers.Request.GET(r)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,r){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:r,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,r){var a=t.responseXML;a&&a.documentElement||(a=t.responseText);var n=this.format.read(a);if(!1===this.drillDown)this.triggerGetFeatureInfo(t,e,n);else{this._requestCount++;"object"===this.output?this._features=(this._features||[]).concat({url:r,features:n}):this._features=(this._features||[]).concat(n);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse=OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse;OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"]=function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"http://www.esri.com/wms","FeatureInfoCollection"),a=0;a<r.length;a++)for(var n=r[a],o=this.getElementsByTagNameNS(n,"http://www.esri.com/wms","FeatureInfo"),i=0;i<o.length;i++){for(var s=o[i],p=this.getElementsByTagNameNS(s,"http://www.esri.com/wms","FieldName"),l=this.getElementsByTagNameNS(s,"http://www.esri.com/wms","FieldValue"),u={},y=0;y<p.length;y++){var c=p[y],f=l[y],h=void 0===c.textContent?"text":"textContent";u[c[h]]=f[h]}var g=new OpenLayers.Feature.Vector(null,u,null);g.type=n.getAttribute("layername");t.push(g)}return t};OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse=function(e){return"http://www.esri.com/wms"===e.namespaceURI?OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"].call(this,e):OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse.call(this,e)};!function(){var e=!!window.controllers,t=window.document.all&&!window.opera;t&&window.navigator.userAgent.match(/MSIE 7.0/);function r(e){OpenLayers.Request.XMLHttpRequest.onreadystatechange&&OpenLayers.Request.XMLHttpRequest.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function a(e){try{e.responseText=e._object.responseText}catch(e){}try{e.responseXML=fGetDocument(e._object)}catch(e){}try{e.status=e._object.status}catch(e){}try{e.statusText=e._object.statusText}catch(e){}}function n(e){e._object.onreadystatechange=new window.Function}OpenLayers.Request.XMLHttpRequest.prototype.open=function(o,i,s,p,l){(function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(this.URL_SPLIT_REGEX);if(r){var a=window.location;t=r[1]==a.protocol&&r[3]==a.hostname;var n=r[4],o=a.port;(80!=n&&""!=n||"80"!=o&&""!=o)&&(t=t&&n==o)}return t})(i)||"withCredentials"in this._object||!window.XDomainRequest||(this._object=new window.XDomainRequest);delete this._headers;arguments.length<3&&(s=!0);this._async=s;var u,y=this,c=this.readyState;if(t&&s){u=function(){if(c!=OpenLayers.Request.XMLHttpRequest.DONE){n(y);y.abort()}};window.attachEvent("onunload",u)}OpenLayers.Request.XMLHttpRequest.onopen&&OpenLayers.Request.XMLHttpRequest.onopen.apply(this,arguments);arguments.length>4?this._object.open(o,i,s,p,l):arguments.length>3?this._object.open(o,i,s,p):this._object.open(o,i,s);this.readyState=OpenLayers.Request.XMLHttpRequest.OPENED;r(this);"withCredentials"in this._object||"onreadystatechange"in this._object?this._object.onreadystatechange=function(){if(!e||s){y.readyState=y._object.readyState;a(y);if(y._aborted)y.readyState=OpenLayers.Request.XMLHttpRequest.UNSENT;else{if(y.readyState==OpenLayers.Request.XMLHttpRequest.DONE){delete y._data;n(y);t&&s&&window.detachEvent("onunload",u)}c!=y.readyState&&r(y);c=y.readyState}}}:this._object.onload=function(){if(!e||s){y.readyState=OpenLayers.Request.XMLHttpRequest.DONE;y._object.status=200;y._object.statusText="OK";a(y);delete y._data;t&&s&&window.detachEvent("onunload",u);y.onreadystatechange()}}};OpenLayers.Request.XMLHttpRequest.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return"setRequestHeader"in this._object?this._object.setRequestHeader(e,t):void this._object}}();OpenLayers.Format.KML.prototype._getNodeText=function(e){var t="";void 0!==e.textContent?t=e.textContent:void 0!==e.innerHTML?t=e.innerHTML:void 0!==e.text&&(t=e.text);return t};OpenLayers.Format.KML.prototype._getFolderHierarchy=function(e){var t=[],r=e;if(r.parentNode)do{if("folder"==(r=r.parentNode).nodeName.toLowerCase()){var a;r.childNodes&&r.childNodes.length&&r.childNodes.length>0&&("name"==r.childNodes[0].nodeName?a=this._getNodeText(r.childNodes[0]):r.childNodes.length>1&&(a=this._getNodeText(r.childNodes[1])));a&&t.push(a)}}while(null!==r.parentNode&&"document"!==r.parentNode.nodeName.toLowerCase());t.reverse();this._folderTree||(this._folderTree={children:[]});TC.Util.addArrayToTree(t,this._folderTree);return t};OpenLayers.Format.KML.prototype.parserTimeout=0;OpenLayers.Format.KML.prototype.parseFeatures=function(e,t){for(var r,a,n=[],o=new Date,i=0,s=e.length;i<s;i++){if(this.parserTimeout>0&&i%10==0&&i>0){r=new Date;if((a=parseInt(r.getTime()-o.getTime()))>this.parserTimeout)throw"El archivo KML es demasiado complejo para este navegador."+a+"ms, "+i+" features"}var p=e[i],l=this.parseFeature.apply(this,[p]);if(!l)throw"Bad Placemark: "+i;this.extractStyles&&l.attributes&&l.attributes.styleUrl&&(l.style=this.getStyle(l.attributes.styleUrl,t));if(this.extractStyles){var u=this.getElementsByTagNameNS(p,"*","Style")[0];if(u){var y=this.parseStyle(u);y&&(l.style=OpenLayers.Util.extend(l.style,y))}}this.parseFolders&&(l._folders=this._getFolderHierarchy(p));if(this.extractTracks){var c=this.getElementsByTagNameNS(p,this.namespaces.gx,"Track");if(c&&c.length>0){var f=c[0],h={features:[],feature:l};this.readNode(f,h);h.features.length>0&&n.push.apply(n,h.features)}}else n.push(l)}this.features=this.features.concat(n)};OpenLayers.Format.KML.prototype._read=OpenLayers.Format.KML.prototype.read;OpenLayers.Format.KML.prototype.read=function(e){var t=this.getChildEl(e.documentElement,"Document");if(t){var r=this.getChildEl(t,"name");r&&(this._documentName=this._getNodeText(r))}return this._read.call(this,e)};OpenLayers.Popup.Anchored.prototype.calculateRelativePosition=function(){return"tr"};OpenLayers.Control.PanZoomBar.prototype._draw=OpenLayers.Control.PanZoomBar.prototype.draw;OpenLayers.Control.PanZoomBar.prototype.draw=function(e){var t=OpenLayers.Control.PanZoomBar.prototype._draw.call(this,e);$(this.div).removeAttr("style").addClass("tc-ctl-nav");var r=$(this.buttons[0]),a=r.height();r.removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomin");r.height();var n=$(this.zoombarDiv);a=n.css("height");n.removeAttr("style").addClass("tc-ctl-nav-bar").css("height",a);var o=$(this.slider);a=o.css("height");o.removeAttr("style").addClass("tc-ctl-nav-slider").css("height",a);$(this.buttons[1]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomout");$(this.buttons[2]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-home");return t};TC.wrap.Map.prototype.setMap=function(){var e,t=this,r=t.parent.options;r.proxy&&(OpenLayers.ProxyHost=r.proxy);t.map=new OpenLayers.Map(t.parent.div,{projection:r.crs,extent:r.initialExtent,maxExtent:r.maxExtent,restrictedExtent:r.maxExtent,controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0},pinchZoomOptions:{autoActivate:!0},zoomWheelEnabled:r.mouseWheelZoom})],theme:OpenLayers.CustomTheme});t.map.events.register("zoomstart",t.parent,function(){t.parent.$events.trigger($.Event(TC.Consts.event.BEFOREZOOM))});t.map.events.register("zoomend",t.parent,function(){t.parent.$events.trigger($.Event(TC.Consts.event.ZOOM))});t.map.events.register("featureclick",t.parent,function(e){e.feature&&e.feature._wrap&&t.parent.$events.trigger($.Event(TC.Consts.event.FEATURECLICK,{feature:e.feature._wrap.parent}))});t.map.events.register("nofeatureclick",t.parent,function(e){for(var r=0;r<t.parent.workLayers.length;r++){var a=t.parent.workLayers[r];a.wrap.layer===e.layer&&t.parent.$events.trigger($.Event(TC.Consts.event.NOFEATURECLICK,{layer:a}))}});$(t.parent.div).on("resize",function(){clearTimeout(e);e=setTimeout(function(){t.map.updateSize()},200)});t.mapDeferred.resolve(t.map)};TC.wrap.Map.prototype.getMetersPerUnit=function(){TC.error("TC.wrap.Map.prototype.getMetersPerUnit no est\xe1 soportada con OpenLayers 2")};TC.wrap.Map.prototype.setProjection=function(e){TC.error("TC.wrap.Map.prototype.setProjection no est\xe1 soportada con OpenLayers 2")};TC.wrap.Map.prototype.insertLayer=function(e,t){for(var r=!1,a=0;a<this.map.layers.length;a++)if(this.map.layers[a]===e){r=!0;break}r||this.map.addLayer(e);this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getNumLayers()};TC.wrap.Map.prototype.indexOfFirstVector=function(){for(var e=-1,t=0,r=this.map.layers.length;t<r;t++)if(this.map.layers[t]instanceof OpenLayers.Layer.Vector){e=t;break}return e};TC.wrap.Map.prototype.getLayerIndex=function(e){return this.map.getLayerIndex(e)};TC.wrap.Map.prototype.setLayerIndex=function(e,t){this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.setBaseLayer=function(e){var t=new $.Deferred;this.map.addLayer(e);this.map.setBaseLayer(e);this.parent.baseLayer&&this.map.removeLayer(this.parent.baseLayer.wrap.getLayer());t.resolve();return t};TC.wrap.Map.prototype.setExtent=function(e){this.map.updateSize();this.map.zoomToExtent(e)};TC.wrap.Map.prototype.getExtent=function(){var e=null,t=this.map.getExtent();t&&(e=[t.left,t.bottom,t.right,t.top]);return e};TC.wrap.Map.prototype.setCenter=function(e){this.map.panTo(e)};TC.wrap.Map.prototype.getResolution=function(){return this.map.getResolution()};TC.wrap.Map.prototype.setResolution=function(e){$.when(this.getMap()).then(function(t){t.zoomTo(t.getZoomForResolution(e))})};TC.wrap.Map.prototype.getResolutions=function(){var e=[];if(this.map.resolutions)e=this.map.resolutions;else{this.map.baseLayer&&(e=this.map.baseLayer.resolutions);if(!e)for(var t=0;t<this.map.layers.length&&!e;t++)e=this.map.layers[t].resolutions}return e};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){var t=this.map.getLonLatFromPixel({x:e[0],y:e[1]});return[t.lon,t.lat]};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){var t=this.map.getPixelFromLonLat({lon:e[0],lat:e[1]});return[t.x,t.y]};TC.wrap.Map.prototype.getViewport=function(e){if((e||{}).synchronous)t=this.map.getViewport();else{var t=new $.Deferred;$.when(this.getMap()).then(function(e){t.resolve(e.getViewport())})}return t};TC.wrap.Map.prototype.isNative=function(e){return e instanceof OpenLayers.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this.map.getProjectionObject();null===e&&(e=new OpenLayers.Projection(this.map.projection));var t=e.getUnits();return"degrees"===t||!t};TC.wrap.Map.prototype.addPopup=function(e){e.$popupDiv=$("<div>")};TC.wrap.Map.prototype.hidePopup=function(e){var t=this.parent;e&&$.when(t.wrap.getMap()).then(function(r){if(e.wrap.popup&&t.popup===e){r.removePopup(e.wrap.popup);e.wrap.popup.destroy();delete e.wrap.popup;t.popup=null}})};TC.wrap.Map.prototype.exportFeatures=function(e,t){TC.error("TC.wrap.Map.prototype.exportFeatures no implementado en OpenLayers 2")};TC.wrap.Map.prototype.enableDragAndDrop=function(e){TC.error("TC.wrap.Map.prototype.enableDragAndDrop no implementado en OpenLayers 2")};TC.wrap.Map.prototype.loadFiles=function(e){TC.error("TC.wrap.Map.prototype.loadFiles no implementado en OpenLayers 2")};TC.wrap.Layer.prototype.getVisibility=function(){var e=!1;this.layer&&(e=this.layer.getVisibility());return e};TC.wrap.Layer.prototype.setVisibility=function(e){$.when(this.getLayer()).then(function(t){t.setVisibility(e)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof OpenLayers.Layer};TC.wrap.Layer.prototype.setProjection=function(e){};TC.wrap.Layer.prototype.WmsParser=OpenLayers.Format.WMSCapabilities;TC.wrap.Layer.prototype.WmtsParser=OpenLayers.Format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.events.register("loadstart",t.parent.map,function(){t.parent.state=TC.Layer.state.LOADING;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:t.parent}))});e.events.register("loadend",t.parent.map,function(){t.parent.state=TC.Layer.state.IDLE;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:t.parent}))});e.events.register("visibilitychanged",t.parent.map,function(){t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent}))})};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null;switch(this.getServiceType()){case TC.Consts.layerType.WMS:e=this.parent.capabilities.capability.request.getmap.href;break;case TC.Consts.layerType.WMTS:e=this.parent.capabilities.operationsMetadata.GetTile.dcp.http.get[0].url}return e};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request.getfeatureinfo&&(e=t.capability.request.getfeatureinfo.formats);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/vnd.ogc.gml","application/json","application/vnd.esri.wms_featureinfo_xml","application/vnd.esri.wms_raw_xml","application/vnd.ogc.wms_xml","text/xml","text/html","text/plain"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this.parent.capabilities;if(t&&t.contents)for(var r=0;r<t.contents.layers.length;r++)for(var a=t.contents.layers[r],n=0;n<a.tileMatrixSetLinks.length;n++)if(this.parent.options.matrixSet===a.tileMatrixSetLinks[n].tileMatrixSet){e=a;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,r=this.parent.capabilities;r&&r.contents&&r.contents.tileMatrixSets[e]&&(t=_layer.capabilities.contents.tileMatrixSets[_layer.options.matrixSet].matrixIds);return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[];e.scaleDenominator?t=[e.scaleDenominator,e.scaleDenominator]:(e.minScale||e.maxScale)&&(t=[e.minScale,e.maxScale]);if(!t.length&&!this.getName(e)){for(var r=this.getLayerNodes(e),a=-1/0,n=1/0,o=0,i=r.length;o<i;o++){var s=this.getScaleDenominators(r[o]);s[0]>a&&(a=s[0]);s[1]<n&&(n=s[1])}a>-1/0&&n<1/0&&(t=[a,n])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(e){var t={};if(e)if(e.serviceProvider){t.name=e.serviceProvider.providerName.trim();t.site=e.serviceProvider.providerSite;t.site.href&&(t.site=t.site.href)}else e.serviceIdentification?t.name=e.serviceIdentification.title.trim():t.name=e.service.title.trim();return t};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t={},r=this.parent.capabilities;if(r&&r.capability)for(var a=function(e,t){var r=e.prefix.length&&0!==t.indexOf(e.prefix)?e.prefix+":"+t:t;return e.name===r},n=0;n<r.capability.layers.length;n++){var o=r.capability.layers[n];if(a(o,e)){o.title&&(t.title=o.title);o.abstract&&(t.abstract=o.abstract);o.styles.length&&(t.legend=o.styles[0].legend.href);if(o.metadataURLs.length){t.metadata=[];for(var i=0;i<o.metadataURLs.length;i++){var s=o.metadataURLs[i];t.metadata.push({format:s.format,type:s.type,url:s.href})}}t.queryable=o.queryable;break}}return t};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request&&t.capability.request.getmap?e=TC.Consts.layerType.WMS:t.operationsMetadata&&t.operationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.capability&&t.service?e=t.service.title:t.serviceIdentification&&(e=t.serviceIdentification.title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e;this.getServiceType()===TC.Consts.layerType.WMS&&(e=this.parent.capabilities.capability.nestedLayers[0]);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var r=e.name;if(r&&t){var a=r.indexOf(":");a>=0&&(r=r.substr(a+1))}return r};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.nestedLayers;$.isArray(t)||(t=[]);return t};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){e.Layer=e.nestedLayers;if(e.Layer)for(var t=0;t<e.Layer.length;t++)TC.wrap.layer.Raster.prototype.normalizeLayerNode(e.Layer[t]);e.Title=e.title;e.Abstract=e.abstract;return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return{Capability:{Exception:cap.capability.exception,Layer:cap.capability.nestedLayers[0]},Service:cap.service,version:cap.version}};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this.parent.capabilities;switch(this.getServiceType()){case TC.Consts.layerType.WMS:return e.capability.layers;case TC.Consts.layerType.WMTS:return e.contents.layers;default:return[]}};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},r=e.styles;if(r&&r.length){var a=r[0].legend||{};t.src=a.href}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=!1,r=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.capability&&r.capabilities.capability.layers)if(0===r.names.length)t=!0;else for(var a=r.names.slice(0),n=0;n<r.capabilities.capability.layers.length;n++){var o=r.capabilities.capability.layers[n],i=$.inArray(this.getName(o),a);if(i>=0){a.splice(i,1);if(!(t=o.srs[e])||!a.length)break}}break;case TC.Consts.layerType.WMTS:var s=r.capabilities&&r.capabilities.contents&&r.capabilities.contents.tileMatrixSets[r.options.matrixSet]&&r.capabilities.contents.tileMatrixSets[r.options.matrixSet].supportedCRS,p=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");t=s&&(p.test(s)||s===e)}return t};TC.wrap.layer.Raster.prototype.getCompatibleCRS=function(){return[]};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=[],r=this.parent;switch(this.getServiceType()){case TC.Consts.layerType.WMS:if(r.capabilities&&r.capabilities.capability&&r.capabilities.capability.layers)for(var a=0;a<r.capabilities.capability.layers.length;a++){var n=r.capabilities.capability.layers[a],o=this.getName(n);n.srs[e]&&o&&(t[t.length]=o)}break;case TC.Consts.layerType.WMTS:var i=r.capabilities&&r.capabilities.contents&&r.capabilities.contents.tileMatrixSets;if(i){var s=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");for(var p in i){var l=i[p].supportedCRS;l&&(s.test(l)||l===e)&&(t[t.length]=p)}}}return t};TC.wrap.layer.Raster.prototype.createWMSLayer=function(e,t,r){var a=new OpenLayers.Layer.WMS(r&&r.id?r.id:t.LAYERS,e,t,{isBaseLayer:1==(r&&r.isBase),singleTile:!0,transitionEffect:"resize",projection:this.parent.crs,units:"m",ratio:TC.Cfg.imageRatio});a._wrap=this;t.LAYERS.length||a.setVisibility(!1);this.addCommonEvents(a);a._originalGetURL=a.getURL;a._noGetURL=function(){return TC.Consts.BLANK_IMAGE};a.getURL=a.params.LAYERS.length>0?a._originalGetURL:a._noGetURL;return a};TC.wrap.layer.Raster.prototype.createWMTSLayer=function(e){var t=(new OpenLayers.Format.WMTSCapabilities).createLayer(this.parent.capabilities,{isBaseLayer:1==(e&&e.isBase),name:e&&e.id?e.id:TC.Consts.layerType.WMTS,matrixSet:e.matrixSet,layer:e.layerNames,requestEncoding:e.encoding===TC.Consts.WMTSEncoding.RESTFUL?"REST":"KVP"});t._wrap=self;this.addCommonEvents(t);return t};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.params};TC.wrap.layer.Raster.prototype.setParams=function(e){this.layer.getURL=e.LAYERS.length>0?this.layer._originalGetURL:this.layer._noGetURL;this.layer.mergeNewParams(e)};TC.wrap.layer.Raster.prototype.setMatrixSet=function(e){};TC.wrap.layer.Raster.prototype.getResolutions=function(){return[]};TC.wrap.layer.Raster.prototype.getCompatibleMatrixSets=function(){return[]};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){};TC.wrap.Geometry={getNearest:function(e,t){var r=new OpenLayers.Geometry.LineString($.map(t,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])})).distanceTo(new OpenLayers.Geometry.Point(e[0],e[1]),{details:!0});return[r.x0,r.y0]}};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=this,t=null,r=$.extend({},TC.Cfg,e.parent.options),a=OpenLayers.Feature.Vector.style.default,n=function(e,t){var n=OpenLayers.Style.prototype.getSymbolizerPrefix(t.geometry).toLowerCase();return r.styles[n]&&r.styles[n][e]||a[e]},o={strokeColor:"${getStrokeColor}",strokeWidth:"${getStrokeWidth}",strokeOpacity:"${getStrokeOpacity}",fillColor:"${getFillColor}",fillOpacity:"${getFillOpacity}",strokeLinecap:"${getStrokeLinecap}",strokeDashstyle:"${getStrokeDashstyle}"},i={getStrokeColor:function(e){return n("strokeColor",e)},getStrokeWidth:function(e){return n("strokeWidth",e)},getStrokeOpacity:function(e){return n("strokeOpacity",e)},getStrokeLinecap:function(e){return n("strokeLinecap",e)},getStrokeDashstyle:function(e){return n("strokeDashstyle",e)},getFillColor:function(e){return n("fillColor",e)},getFillOpacity:function(e){return n("fillOpacity",e)}},s=function(e){var t=e;if($.isFunction(e)){var r="f"+TC.getUID();i[r]=e;t="${"+r+"}"}return t};if(r.styles.point){o.pointRadius=s(r.styles.point.radius);o.graphic=r.styles.point.graphic;o.label=s(r.styles.point.label);o.fontColor=s(r.styles.point.fontColor);o.fontSize=s(r.styles.point.fontSize);o.fontWeight=s(r.styles.point.fontWeight);o.angle=s(r.styles.point.angle)}var p={styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style($.extend({},a,o),{context:i})}),projection:TC.Cfg.crs};r.isLabeling&&(p.renderers=[OpenLayers.Class(OpenLayers.Renderer.SVG,{drawText:function(e,t,r){var a=!!t.labelOutlineWidth;if(a){var n=OpenLayers.Util.extend({},t);n.fontColor=s(n.labelOutlineColor);n.fontStrokeColor=s(n.labelOutlineColor);n.fontStrokeWidth=s(t.labelOutlineWidth);t.labelOutlineOpacity&&(n.fontOpacity=s(t.labelOutlineOpacity));delete n.labelOutlineWidth;this.drawText(e,n,r)}var o=this.getResolution(),i=(r.x-this.featureDx)/o+this.left,p=r.y/o-this.top,l=a?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+l,"text");u.setAttributeNS(null,"x",i);u.setAttributeNS(null,"y",-p);if(t.angle||0==t.angle){var y="rotate(-"+t.angle+","+i+","+-p+")";u.setAttributeNS(null,"transform",y)}t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle);if(!0===t.labelSelect){u.setAttributeNS(null,"pointer-events","visible");u._featureId=e}else u.setAttributeNS(null,"pointer-events","none");var c=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[0]]||"middle");!0===OpenLayers.IS_GECKO&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[c[1]]||"central");for(var f=t.label.split("\n"),h=f.length;u.childNodes.length>h;)u.removeChild(u.lastChild);for(var g=0;g<h;g++){var d=this.nodeFactory(e+l+"_tspan_"+g,"tspan");if(!0===t.labelSelect){d._featureId=e;d._geometry=r;d._geometryClass=r.CLASS_NAME}!1===OpenLayers.IS_GECKO&&d.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[c[1]]||"-35%");d.setAttribute("x",i);if(0==g){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[c[1]];null==m&&(m=-.5);d.setAttribute("dy",m*(h-1)+"em")}else d.setAttribute("dy","1em");d.textContent=""===f[g]?" ":f[g];d.parentNode||u.appendChild(d)}u.parentNode||this.textRoot.appendChild(u)},CLASS_NAME:"OpenLayers.Control.CustomSVG"})]);var l=new OpenLayers.Strategy.Fixed;if(e.parent.type===TC.Consts.layerType.KML){p.strategies=[l];p.protocol=new OpenLayers.Protocol.HTTP({url:TC.proxify(r.url),format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,parseFolders:!0,internalProjection:new OpenLayers.Projection(TC.Cfg.crs),externalProjection:new OpenLayers.Projection("EPSG:4326")})})}else if(r.type===TC.Consts.layerType.WFS){var u={};if(r.properties)for(var y=0;y<r.properties.length;y++){var c=r.properties[y];c.name&&c.type?u[c.name]={value:c.value||"",type:c.type,ignoreHyphens:c.ignoreHyphens}:u[c]=""}p.strategies=[l];p.protocol=new OpenLayers.Protocol.WFS({url:r.url,version:r.version,featureType:r.featureType,geometryName:r.geometryName,featurePrefix:r.namespace,outputFormat:r.outputFormat,srsName:TC.Cfg.crs});p.filter=function(e){var t,r=[];for(var a in e){var n,o,i,s=e[a];if(s.type){n=s.type;o=s.value;var p=new OpenLayers.Filter.Comparison({type:n,property:a,value:o});if(s.ignoreHyphens){p=[p,new OpenLayers.Filter.Comparison({type:n,property:a,value:o.replace(/-/g,"")})];i=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:p})}else i=p}else{n=OpenLayers.Filter.Comparison.EQUAL_TO;o=s;i=new OpenLayers.Filter.Comparison({type:n,property:a,value:o})}r.push(i)}switch(r.length){case 0:t=null;break;case 1:t=r[0];break;default:t=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:r})}return t}(u)}if(r.cluster){$.isArray(p.strategies)||(p.strategies=[]);p.strategies.push(new OpenLayers.Strategy.Cluster({distance:r.cluster.distance}))}(t=new OpenLayers.Layer.Vector("Vectors",p))._wrap=e;this.addCommonEvents(t);t.events.register("beforefeaturesadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.BEFOREFEATURESADD,{layer:e.parent}))});t.events.register("featuresadded",null,function(t){for(var r=[],a=[],n=[],o=0;o<t.features.length;o++){var i=t.features[o];i._wrap||(i.geometry instanceof OpenLayers.Geometry.Point?r[r.length]=i:i.geometry instanceof OpenLayers.Geometry.LineString||i.geometry instanceof OpenLayers.Geometry.MultiLineString?a[a.length]=i:(i.geometry instanceof OpenLayers.Geometry.Polygon||i.geometry instanceof OpenLayers.Geometry.MultiPolygon)&&(n[n.length]=i))}var s=[];r.length>0&&s.push(e.parent.addMarkers(r));a.length>0&&s.push(e.parent.addPolylines(a));n.length>0&&s.push(e.parent.addPolygons(n));$.when.apply(e,s).then(function(){var t=[];if(arguments.length)for(var r=0;r<arguments[0].length;r++){var a=t[r]=arguments[0][r];$.isArray(a.wrap.feature.cluster)&&(a.features=$.map(a.wrap.feature.cluster,function(e){return new a.constructor(e)}))}e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:e.parent,features:t}))})});t.events.register("featureremoved",null,function(t){var r=t.feature;if(r._wrap){var a=$.inArray(r._wrap.parent,e.parent.features);if(a>-1){e.parent.features.splice(a,1);e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:e.parent,feature:r._wrap.parent}))}}});$(e.parent.map);t.events.register("featuresadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});t.events.register("featuresremoved",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});if(e.parent.type===TC.Consts.layerType.KML){t.events.register("added",null,function(){l.activate()});if(!e.parent.options.title){t.events.register("loadend",null,function r(){t.protocol.format._documentName&&(e.parent.title=t.protocol.format._documentName);t.events.unregister("loadend",null,r)})}}return t};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return null};TC.wrap.layer.Vector.prototype.import=function(e){TC.error("TC.wrap.layer.Vector.prototype.import no est\xe1 soportada con OpenLayers 2")};TC.wrap.layer.Vector.prototype.addFeatures=function(e){$.when(this.getLayer()).then(function(t){t.addFeatures(e)})};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();if(e instanceof OpenLayers.Layer){if(e.strategies)for(var t=0;t<e.strategies.length;t++){var r=e.strategies[t];r instanceof OpenLayers.Strategy.Filter&&r.setFilter(r.filter)}return e.features}return[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.getLayer();if(t instanceof OpenLayers.Layer){if(t.strategies)for(var r=0;r<t.strategies.length;r++){var a=t.strategies[r];a instanceof OpenLayers.Strategy.Filter&&a.setFilter(a.filter)}return t.getFeatureById(e)}return null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){$.when(this.getLayer()).then(function(t){t.removeFeatures([e.wrap.feature])})};TC.wrap.layer.Vector.prototype.clearFeatures=function(){$.when(this.getLayer()).then(function(e){e.removeAllFeatures()})};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var r=this;if($.inArray(e,r.parent.features)>=0){t?delete e.wrap.feature.style.display:e.wrap.feature.style.display="none";r._redrawTimeout&&clearTimeout(r._redrawTimeout);r._redrawTimeout=setTimeout(function(){$.when(r.getLayer()).then(function(e){e.redraw();r.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:r.parent}))});delete r._redrawTimeout},100)}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){var r=[0,0,0,1];if("string"==typeof e){var a=4===e.length?1:2;r[0]=parseInt(e.substr(1,a),16);r[1]=parseInt(e.substr(1+a,a),16);r[2]=parseInt(e.substr(1+2*a,a),16);if(1===a){r[0]=17*r[0];r[1]=17*r[1];r[2]=17*r[2]}void 0!==t&&(r[3]=t)}return r};TC.wrap.layer.Vector.prototype.findFeature=function(e){$.when(this.getLayer()).then(function(t){var r=t.filter;if(r){if(r.filters&&r.filters.length<=e.length)for(var a=0;a<r.filters.length;a++){var n=r.filters[a];if(n.type===OpenLayers.Filter.Logical.OR){n.filters[0].value=e[a];n.filters[1].value=e[a].replace("-","")}else n.value=e[a]}else r.value=e[0];t.removeAllFeatures();t.setVisibility(!0);t.strategies[0].active||t.strategies[0].activate();t.refresh()}})};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,t,r){var a=$.Deferred();TC.error('"sendTransaction" no est\xe1 soportado por la versi\xf3n OpenLayers 2 de la API SITNA');a.reject();return a};TC.wrap.layer.Vector.prototype.setDraggable=function(e,t,r){var a=this;$.when(a.parent.map.wrap.getMap(),a.getLayer()).then(function(n,o){if(e){if(!a._ctl){var i={};$.isFunction(t)&&(i.onComplete=function(e,r){t.call(this,e._wrap.parent,[r.x,r.y])});$.isFunction(r)&&(i.onStart=function(e,t){r.call(this,e._wrap.parent,[t.x,t.y])});a._ctl=new OpenLayers.Control.DragFeature(o,i);n.addControl(a._ctl)}a._ctl.activate()}else a._ctl&&a._ctl.deactivate()})};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._ctl=new OpenLayers.Control;$.when(e.wrap.getMap()).then(function(r){t._ctl.handler=new OpenLayers.Handler.Click(this,{click:function(e){var a=r.getLonLatFromPixel(e.xy);t.parent.callback([a.lon,a.lat],[e.xy.x,e.xy.y])}},{single:!0,double:!1,pixelTolerance:e.options.pixelTolerance,stopSingle:!1,stopDouble:!1});r.addControl(t._ctl)})};TC.wrap.control.Click.prototype.activate=function(){this._ctl.activate()};TC.wrap.control.Click.prototype.deactivate=function(){this._ctl.deactivate()};TC.wrap.control.ScaleBar.prototype.render=function(){this.ctl?this.ctl.draw():this.ctl=new OpenLayers.Control.ScaleLine({div:this.parent.div,bottomInUnits:"",bottomOutUnits:""})};TC.wrap.control.NavBar.prototype.register=function(e){var t=this;$.when(e.wrap.getMap()).then(function(e){t.zsCtl=new OpenLayers.Control.PanZoomBar({panIcons:!1,zoomWorldIcon:!0});e.addControl(t.zsCtl);e.events.register("changebaselayer",null,function(){t.zsCtl.moveZoomBar()})})};TC.wrap.control.NavBar.prototype.refresh=function(){};TC.wrap.control.Coordinates.prototype.register=function(e){var t=this,r=new $.Deferred;$.when(e.wrap.getMap()).then(function(a){var n=a.getProjectionObject();null===n&&(n=new OpenLayers.Projection(a.projection));t.parent.crs=n.getCode();t.parent.units=n.getUnits();t.parent.isGeo=e.wrap.isGeo();r.resolve()});return r};TC.wrap.control.Coordinates.prototype.onMouseMove=function(e){var t=this;$.when(t.parent.map.wrap.getMap()).then(function(r){var a=r.getLonLatFromPixel(r.events.getMousePosition(e.originalEvent));if(a){t.parent.isGeo?t.parent.latLon=[a.lat,a.lon]:t.parent.xy=[a.lon,a.lat];t.parent.update.apply(t.parent,arguments)}})};TC.wrap.control.Geolocation.prototype.register=function(e){};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[];if(this.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");t=$.map(this.parser.read(e),function(e){return new TC.Feature(null,{id:e.fid,data:e.data})})}return t};TC.wrap.parser={WFS:function(e){this.parser=new OpenLayers.Format.GML(e)},JSON:function(e){this.parser=new OpenLayers.Format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.Search.prototype.addEvents=function(){var e=this;$.when(e.parent.layer.wrap.getLayer()).then(function(t){var r=e.parent.layer.map,a=r.wrap.isGeo()?r.options.pointBoundsRadius/TC.Util.getMetersPerDegree(r.getExtent()):r.options.pointBoundsRadius;t.events.register("featuresadded",t,function(t){for(var r=t.features[0].geometry.getBounds(),n=1;n<t.features.length;n++)r.extend(t.features[n].geometry.getBounds());if(r.left===r.right){r.left-=a;r.right+=a}if(r.top===r.bottom){r.bottom-=a;r.top+=a}e.parent.layer.map.setExtent(r)})})};TC.wrap.control.NavBar.prototype.setInitialExtent=function(e){};TC.wrap.control.OverviewMap.prototype.register=function(e){var t=this,r=function(){var e=new OpenLayers.Size(t.parent._$div.width(),t.parent._$div.height());0===e.w&&(e.w=100);0===e.h&&(e.h=100);return e},a=r();$.when(t.parent.layer.wrap.getLayer()).then(function(n){t.ovMap=new OpenLayers.Control.OverviewMap({div:t.parent.div,size:a,layers:[n],minRatio:24,maxRatio:48,autoPan:!0,theme:OpenLayers.CustomTheme,mapOptions:{projection:e.crs,displayProjection:e.crs,baseLayer:n,maxExtent:e.maxExtent,minRatio:24,maxRatio:48,minRectSize:30,theme:OpenLayers.CustomTheme},maximized:!0});var o=$(t.parent.div).find("."+t.parent.CLASS+"-load");n.events.register("loadstart",t.parent.layer,function(){o.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)});n.events.register("loadend",t.parent.layer,function(){o.removeClass(TC.Consts.classes.VISIBLE).addClass(TC.Consts.classes.HIDDEN)});$.when(e.wrap.getMap()).then(function(e){e.addControl(t.ovMap);t.parent.isLoaded=!0;t.parent.$events.trigger($.Event(TC.Consts.event.MAPLOAD));e.events.register("updatesize",t.parent,function(){r();if(t.ovMap.ovmap){$ovmap=$(t.ovMap.ovmap.div);$ovmap.css("width",t.parent._$div.css("width")).css("height",t.parent._$div.css("height"));t.ovMap.ovmap.updateSize();t.ovMap.updateRectToMap()}})})})};TC.wrap.control.OverviewMap.prototype.reset=function(){TC.error("TC.wrap.control.OverviewMap.prototype.reset no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){TC.error("TC.wrap.control.OverviewMap.prototype.get3DCameraLayer no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){TC.error("TC.wrap.control.OverviewMap.prototype.draw3DCamera no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.enable=function(){this.ovMap.activate();this.ovMap.update()};TC.wrap.control.OverviewMap.prototype.disable=function(){this.ovMap.deactivate()};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;t._map=e;$.when(e.wrap.getMap()).then(function(r){TC.wrap.control.Click.prototype.register.call(t,e);for(var a=[],n=function(e){var t=!1;e instanceof TC.layer.Raster&&!e.isBase&&e.wrap.getInfoFormats()&&(t=!0);return t},o=0;o<e.workLayers.length;o++){var i=e.workLayers[o];n(i)&&a.push(i.wrap.layer)}t._gfi=new OpenLayers.Control.WMSGetFeatureInfo({layers:a,autoActivate:!1,drillDown:!0,maxFeatures:1e3,queryVisible:!0,output:"object",formatOptions:{internalProjection:r.projection}});e.options.pixelTolerance&&(t._gfi.vendorParams={radius:e.options.pixelTolerance,buffer:e.options.pixelTolerance});r.addControl(t._gfi);e.on(TC.Consts.event.LAYERADD,function(e){n(e.layer)&&t._gfi.layers.push(e.layer.wrap.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){var r=$.inArray(e.layer.wrap.layer,t._gfi.layers);r>=0&&t._gfi.layers.splice(r,1)});var s={};t._gfi.events.register("beforegetfeatureinfo",t.parent,function(r){for(var a=0;a<r.object.layers.length;a++)for(var n=0;n<e.workLayers.length;n++)e.workLayers[n].wrap.layer===r.object.layers[a]&&(s[r.object.layers[a].url]=e.workLayers[n]);e.wrap.map.getLonLatFromPixel(r.xy);t.parent.beforeRequest({xy:[r.xy.x,r.xy.y]})});t._gfi.events.register("getfeatureinfo",t.parent,function(r){for(var a,n=0,o=[],i=[],p=[],l=0;l<r.features.length;l++){var u=r.features[l];a={layers:[],text:r.text};var y=s[u.url];if(y){a.mapLayer=y;delete s[u.url]}for(var c=0;c<u.features.length;c++){for(var f=u.features[c],h=f.fid?f.fid.substr(0,f.fid.lastIndexOf(".")):f.type||"",g=a.mapLayer?a.mapLayer.wrap.getInfo(h).title||h:"[Sin t\xedtulo]",d=null,m=0;m<a.layers.length;m++)if(a.layers[m].name===h){d=a.layers[m];break}if(!d){d={name:h,title:g,features:[]};a.layers.push(d)}o.push(TC.wrap.Feature.createFeature(f));i.push(d.features);n+=1}if(!u.features.length){contentType=r.request.getResponseHeader("Content-Type");if(0===contentType.indexOf("text/")){d={name:h,title:g,features:[]};a.layers.push(d);d.features.push({rawUrl:r.request._object.responseURL,rawContent:r.text});n+=1}}p.push(a)}$.when.apply(this,o).then(function(){if(arguments.length)for(var a=0;a<arguments.length;a++){var o=arguments[a];o.attributes=[];for(var s in o.data)o.attributes.push({name:s,value:o.data[s]});i[a].push(o)}var l=e.wrap.map.getLonLatFromPixel(r.xy);t.parent.responseCallback({coords:[l.lon,l.lat],resolution:t._gfi._resolution,services:p,featureCount:n})})});t._gfi.events.register("exception",t.parent,function(e){t.parent.responseError({status:e.request.status,message:e.request.responseText})})})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e,t){if(this._map&&this._gfi.layers.length>0){var r=map.wrap.map.getPixelFromLonLat({lon:e[0],lat:e[1]});this._gfi._resolution=t;this._gfi.getInfoForClick({xy:{x:r[0],y:r[1]}})}};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.wrap.control.Popup.prototype.fitToView=function(){var e=this;setTimeout(function(){e.popup.updateSize()},100)};TC.wrap.control.Popup.prototype.setDragged=function(e){};TC.wrap.Feature.prototype.getLegend=function(){var e={},t=this.feature.style;if(t.externalGraphic){e.src=t.externalGraphic;e.width=t.graphicWidth;e.height=t.graphicHeight}else{t.strokeColor&&(e.strokeColor=t.strokeColor);t.strokeWidth&&(e.strokeWidth=t.strokeWidth);t.fillColor&&(e.fillColor=t.fillColor);t.pointRadius&&(e.height=e.width=2*t.pointRadius)}return e};TC.wrap.Feature.prototype.createPoint=function(e,t){if($.isArray(e)){var r={pointRadius:t.radius||(t.height+t.width)/4};if(t.fillColor){r.fillColor=t.fillColor;r.fillOpacity=t.fillOpacity}else r.fill=!1;if(t.strokeColor){r.strokeColor=t.strokeColor;r.strokeWidth=t.strokeWidth}else r.stroke=!1;this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,r)}else if(this.isNative(e)){this.feature=e;this.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){this.parent.options.radius=e.style.pointRadius;this.parent.options.fillColor=e.style.fillColor;this.parent.options.fillOpacity=e.style.fillOpacity;this.parent.options.strokeColor=e.style.strokeColor}}t&&t.id&&(this.feature.id=t.id);this.feature._wrap=this};TC.wrap.Feature.prototype.createMarker=function(e,t){if(TC.Util.getPointIconUrl(t)){if($.isArray(e)){var r={externalGraphic:TC.Util.getPointIconUrl(t),graphicWidth:t.width,graphicHeight:t.height,graphicXOffset:-Math.round(t.anchor[0]*t.width),graphicYOffset:-Math.round(t.anchor[1]*t.height)};this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,r)}else if(this.isNative(e)){this.feature=e;this.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){this.parent.options.url=e.style.externalGraphic;this.parent.options.width=e.style.graphicWidth;this.parent.options.height=e.style.graphicHeight;this.parent.options.anchor=[-e.style.graphicXOffset/e.style.graphicWidth,-e.style.graphicYOffset/e.style.graphicHeight]}}t&&t.id&&(this.feature.id=t.id);this.feature._wrap=this}else this.createPoint(e,t)};TC.wrap.Feature.prototype.createPolyline=function(e,t){if($.isArray(e)){var r=$.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])});this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(r),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth})}else if(this.isNative(e)){this.feature=e;for(var a=this.parent.geometry=e.geometry.getVertices(),n=0;n<a.length;n++)a[n]=[a[n].x,a[n].y];if(e.style){this.parent.options.strokeColor=e.style.strokeColor;this.parent.options.strokeWidth=e.style.strokeWidth}}this.feature._wrap=this};TC.wrap.Feature.prototype.createPolygon=function(e,t){if($.isArray(e)){var r,a=function(e){return new OpenLayers.Geometry.LinearRing($.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])}))};if(e.length>0&&$.isArray(e[0])&&e[0].length>0&&$.isArray(e[0][0])){r=new Array(e.length);for(var n=0,o=e.length;n<o;n++)r[n]=a(e[n])}else r=[a(e)];this.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(r),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,fillColor:t.fillColor,fillOpacity:t.fillOpacity})}else if(this.isNative(e)){this.feature=e;if(e.geometry){var i=this.parent.geometry=e.geometry.getVertices();for(n=0;n<i.length;n++)i[n]=[i[n].x,i[n].y]}if(e.style){this.parent.options.strokeColor=e.style.strokeColor;this.parent.options.strokeWidth=e.style.strokeWidth;this.parent.options.fillColor=e.style.fillColor;this.parent.options.fillOpacity=e.style.fillOpacity}}this.feature._wrap=this};TC.wrap.Feature.prototype.createCircle=function(e,t){};TC.wrap.Feature.createFeature=function(e){var t=new $.Deferred,r={id:e.fid,data:e.attributes};e.geometry instanceof OpenLayers.Geometry.Point?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t.resolve(new TC.feature.Point(e,r))}):e.geometry instanceof OpenLayers.Geometry.LineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polyline,[TC.apiLocation+"TC/feature/Polyline"],function(){t.resolve(new TC.feature.Polyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiLineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolyline,[TC.apiLocation+"TC/feature/MultiPolyline"],function(){t.resolve(new TC.feature.MultiPolyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.Polygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polygon,[TC.apiLocation+"TC/feature/Polygon"],function(){t.resolve(new TC.feature.Polygon(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiPolygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolygon,[TC.apiLocation+"TC/feature/MultiPolygon"],function(){t.resolve(new TC.feature.MultiPolygon(e,r))}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){t.resolve(new TC.Feature(e,r))});return t};TC.wrap.Feature.prototype.cloneFeature=function(){return new this.feature.constructor(this.feature.geometry.clone(),this.feature.attributes,this.feature.style)};TC.wrap.Feature.prototype.getStyle=function(){var e=this.feature.style,t={};if(e.fillColor){t.fillColor=e.fillColor;t.fillOpacity=e.fillOpacity}if(e.strokeColor){t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth}if(e.externalGraphic){t.url=e.externalGraphic;t.anchor=[e.graphicXOffset/e.graphicWidth,e.graphicYOffset/e.graphicHeight]}if(e.label){t.label=e.label;t.labelOffset=[e.labelXOffset,e.labelYOffset];t.fontColor=e.fontColor;t.labelOutlineColor=e.labelOutlineColor;t.labelOutlineWidth=e.labelOutlineWidth;t.fontSize=e.fontSize}return t};TC.wrap.Feature.prototype.getGeometry=function(){var e;if(this.feature&&this.feature.geometry){var t=function(e){return[e.x,e.y]},r=function(e){for(var r=e.getVertices(),a=0,n=r.length;a<n;a++)r[a]=t(r[a]);return r},a=function(e){for(var t=new Array(e.components.length),a=0,n=e.components.length;a<n;a++)t[a]=r(e.components[a]);return t},n=this.feature.geometry;n instanceof OpenLayers.Geometry.Point?e=t(n):n instanceof OpenLayers.Geometry.LineString?e=r(n):n instanceof OpenLayers.Geometry.MultiLineString?e=r(n.components[0]):n instanceof OpenLayers.Geometry.Polygon?e=a(n):n instanceof OpenLayers.Geometry.MultiPolygon&&(e=a(n.components[0]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){var t=!1;if(this.feature&&this.feature.geometry){var r=this.feature.geometry;if(r instanceof OpenLayers.Geometry.Point&&$.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]){r.move(e[0]-r.x,e[1]-r.y);t=!0}}return t};TC.wrap.Feature.prototype.getId=function(){var e;this.feature&&(e=this.feature.fid);return e};TC.wrap.Feature.prototype.setId=function(e){this.feature&&(this.feature.fid=e)};const e=function(e){return e.map(function(e){return{x:e[0],y:e[1]}})},t=function(e){return e.map(function(e){return[e.x,e.y]})};TC.wrap.Feature.prototype.getLength=function(r){const a=this;r=r||{};const n=a.feature.geometry;var o;if(n instanceof OpenLayers.Geometry.Polygon){o=t(n.getVertices());r.crs&&(o=TC.Util.reproject(o,a.parent.map.crs,r.crs));return new OpenLayers.Geometry.LinearRing(e(o)).getLength()}if(n instanceof OpenLayers.Geometry.LineString){o=t(n.getVertices());r.crs&&(o=TC.Util.reproject(o,a.parent.map.crs,r.crs));return new OpenLayers.Geometry.LineString(e(o)).getLength()}};TC.wrap.Feature.prototype.getArea=function(r){const a=this;r=r||{};const n=a.feature.geometry;var o;if(n instanceof OpenLayers.Geometry.Polygon){o=t(n.getVertices());r.crs&&(o=TC.Util.reproject(o,a.parent.map.crs,r.crs));return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing(e(o))]).getArea()}};TC.wrap.Feature.prototype.setStyle=function(e){var t=this.feature.style||new OpenLayers.Style;e instanceof OpenLayers.Style||(e=new OpenLayers.Style(e));e=e.createLiterals(OpenLayers.Util.extend({},e.defaultStyle),this.feature);if(this.feature.geometry instanceof OpenLayers.Geometry.Point){t.externalGraphic=e.url;t.graphicWidth=e.width;t.graphicHeight=e.height;e.anchor&&e.width&&(t.graphicXOffset=-Math.round(e.anchor[0]*e.width));e.anchor&&e.height&&(t.graphicYOffset=-Math.round(e.anchor[1]*e.height));t.graphic=e.graphic;e.label&&(t.label=e.label.toCamelCase());e.angle&&(t.angle=e.angle);t.fontColor=e.fontColor;t.labelOutlineColor=e.labelOutlineColor;t.labelOutlineWidth=e.labelOutlineWidth}else if(this.feature.geometry.components&&this.feature.geometry.components instanceof Array&&this.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.LineString).CLASS_NAME||!this.feature.geometry.components&&this.feature.geometry instanceof new OpenLayers.Geometry.LineString){t.stroke=!0;t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth}else if(this.feature.geometry.components&&this.feature.geometry.components instanceof Array&&this.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.Polygon).CLASS_NAME||!this.feature.geometry.components&&this.feature.geometry instanceof new OpenLayers.Geometry.Polygon){t.stroke=!0;t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth;t.fillColor=e.fillColor;t.fillOpacity=e.fillOpacity}this.feature.layer&&this.feature.layer.drawFeature(this.feature,t)};TC.wrap.Feature.prototype.getInnerPoint=function(e){var t=this.feature,r=t.geometry.getCentroid(!0);if(!result.intersects(t.geometry)){var a=t.geometry.distanceTo(result,{details:!0});r=new OpenLayers.Geometry.Point(a.x0,a.y0)}return[r.x,r.y]};TC.wrap.Feature.prototype.showPopup=function(e){var t=this;t.feature;Modernizr.canvas&&-1===OpenLayers.Popup.Anchored.prototype.displayClass.indexOf(TC.control.Popup.prototype.CLASS)&&(OpenLayers.Popup.Anchored.prototype.displayClass=OpenLayers.Popup.Anchored.prototype.displayClass+" "+TC.control.Popup.prototype.CLASS+" "+TC.Consts.classes.VISIBLE);var r=Modernizr.canvas?OpenLayers.Popup.Anchored:OpenLayers.Popup.FramedCloud;t._innerCentroid||(t._innerCentroid=t.getInnerPoint());e.currentFeature=t.parent;var a=e.map;a&&$.when(a.wrap.getMap()).then(function(n){if(a.popup){n.removePopup(a.popup.wrap.popup);a.popup.wrap.popup.destroy();delete a.popup.wrap.popup;a.popup=null}var o=t.parent.getInfo();if(o){var i=t.parent.options,s=null;Modernizr.canvas&&i.anchor&&i.height&&(s={size:new OpenLayers.Size(0,i.height),offset:new OpenLayers.Pixel(0,-i.height*i.anchor[1])});var p=new r(null,new OpenLayers.LonLat(t._innerCentroid[0],t._innerCentroid[1]),null,o,s,e.options.closeButton,function(t){this.hide();OpenLayers.Event.stop(t);a.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:e}))});p.autoSize=!0;p.panMapIfOutOfView=!0;p.keepInMap=!0;p.maxSize=new OpenLayers.Size(n.size.w/2,n.size.h/2);e.$popupDiv=$(p.div);e.wrap.popup=p;a.popup=e;n.addPopup(p);if(Modernizr.canvas){e.$popupDiv.css("overflow","").css("border","").css("width","").css("height","");var l=$(p.contentDiv).css("position","");p.updateSize();l.css("width","");var u=$(p.groupDiv).find(".olPopupCloseBox").attr("style","").addClass(e.CLASS+"-close").attr("title",e.getLocaleString("close"));u.length&&l.css("margin-right",u.width())}}})};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof OpenLayers.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[];this.feature&&this.feature._folders&&(e=this.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null;if(this.feature&&this.feature.geometry){var t=this.feature.geometry.getBounds();e=[t.left,t.bottom,t.right,t.top]}return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null;this.feature.style&&(e=this.feature.style.balloonStyle)&&(e=e.replace(/\$\{(\w+)\}/g,"$$[$1]"));return e};TC.wrap.Feature.prototype.getData=function(){var e=$.extend({},this.feature.attributes);for(var t in e)e[t].value&&(e[t]=e[t].value);return e};TC.wrap.control.Draw.prototype.activate=function(e){var t=this,r=e===TC.Consts.geom.POLYGON?OpenLayers.Handler.Polygon:OpenLayers.Handler.Path;t.parent.map&&$.when(t.parent.map.wrap.getMap()).then(function(a){if(t.control){t.control.deactivate();a.removeControl(t.control)}if(e){var n=function(e){var r="measurepartial"===e.type?TC.Consts.event.MEASUREPARTIAL:TC.Consts.event.MEASURE,a={units:e.units};if(1===e.order)a.length=e.measure;else if(2===e.order){a.area=e.measure;a.perimeter=t.control.getLength(e.geometry,e.units)}t.parent.measure&&t.parent.$events.trigger($.Event(r,a));t.parent.$events.trigger($.Event(TC.Consts.event.DRAWEND,{feature:new TC.feature.Polygon(e.geometry.components)}))};t.control=new OpenLayers.Control.Measure(r,{geodesic:!0,persist:!0,immediate:!0});t.control.handler.callbacks.point=function(e){t.parent.$events.trigger($.Event(TC.Consts.event.POINT,{point:[e.x,e.y]}))};t.parent.measure?t.control.events.on({measure:n,measurepartial:n}):t.control.events.on({measure:n});a.addControl(t.control);t.control.activate()}})};TC.wrap.control.Draw.prototype.deactivate=function(){this.control&&this.control.deactivate()};TC.wrap.control.Draw.prototype.undo=function(){var e=!1;this.control&&this.control.handler&&(e=this.control.handler.undo());return e};TC.wrap.control.Draw.prototype.redo=function(){var e=!1;this.control&&this.control.handler&&(e=this.control.handler.redo());return e};TC.wrap.control.Draw.prototype.end=function(){if(this.control&&this.control.handler){this.control.handler.finishGeometry();this.control.handler.layer&&this.control.handler.layer.redraw()}};TC.wrap.control.Draw.prototype.setStyle=function(){TC.error("TC.wrap.control.Draw.prototype.setStyle no implementado en OpenLayers 2")};TC.wrap.control.CacheBuilder.prototype.getRequestSchema=function(e){return{}};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){return""}}();