{"version":3,"sources":["control/Edit.js"],"names":["TC","control","Control","syncLoadJS","apiLocation","Edit","apply","this","arguments","_classSelector","CLASS","_selectors","MODE_RADIO_BUTTON","id","wrap","layer","callback","Util","isFunction","options","cancelActionConfirmTxt","cancelText","eraseText","styles","layersEditData","pointDrawControl","lineDrawControl","polygonDrawControl","modifyControl","snapping","inherit","mode","MODIFY","ADDPOINT","ADDLINE","ADDPOLYGON","CUT","OTHER","ctlProto","prototype","template","compiler","main","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","useData","1","blockParams","depths","stack1","fn","program","inverse","2","4","noop","5","6","8","invokePartial","decorators","10","11","12","13","15","16","18","19","21","22","24","25","26","27","28","29","30","31","32","33","34","35","36","37","39","41","43","44","46","48","50","hooks","blockHelperMissing","4_d","props","args","useDecorators","usePartial","useDepths","indent","register","map","self","Promise","resolve","reject","then","_pointDrawCtlPromise","addControl","getUID","div","querySelector","Consts","geom","POINT","_lineDrawCtlPromise","POLYLINE","_polygonDrawCtlPromise","POLYGON","_modifyCtlPromise","all","controls","drawendHandler","e","feature","setStyle","trigger","event","DRAWEND","drawcancelHandler","cancel","on","DRAWCANCEL","FEATUREMODIFY","FEATUREADD","FEATUREREMOVE","displayAttributes","selectedFeatures","getSelectedFeatures","length","_editAttrBtn","classList","add","classes","ACTIVE","attributes","getLayerEditData","attrArray","keys","k","jfa","_joinedFeatureAttributes","getData","forEach","attributeObj","value","readOnly","availableValues","jfaObj","val","undefined","push","sort","a","b","getRenderedHtml","html","_attributesSection","contentDiv","getAttributeDisplayTarget","remove","HIDDEN","innerHTML","inputs","querySelectorAll","selects","elm","addEventListener","input","target","i","len","select","matches","getAttribute","CLICK","_onAttrOK","passive","closeAttributes","that","type","parseInt","Number","isNaN","parseFloat","Date","setData","Array","isArray","modes","setMode","loaded","setLayer","RESULTSPANELCLOSE","featureImportPanel","featuresToImport","getHighlightsLayer","l","clearFeatures","LAYERREMOVE","FEATURESCLEAR","contains","hlLayer","fti","original","splice","removeFeature","li","getInfoContainer","ii","lli","fli","children","LAYERUPDATE","layerObj","getAvailableFeaturesToImport","filter","list","insertAdjacentHTML","FEATURESADD","features","f","isFeatureAllowed","displayLayerToImport","title","render","_set1stRenderPromise","renderData","controlId","m","indexOf","label","parentElement","removeChild","radio","newMode","showFeatureImportPanel","getDownloadDialog","dialog","getLocaleString","fileName","toLowerCase","replace","getFormattedDate","toString","elevation","downloadElevation","open","getGeometryType","geometryType","MULTIPOLYGON","MULTIPOLYLINE","RECTANGLE","getLayer","describeFeatureType","layerEditData","key","attr","geometryName","substr","catch","err","c","getModifyControl","getPointDrawControl","getLineDrawControl","getPolygonDrawControl","ctl","state","r","disabled","active","hiddenList","activateDraw","draw","activate","activeControl","deactivate","checked","hidden","constrainModes","selector","join","rb","Point","Polyline","MultiPolyline","isMultiple","Polygon","MultiPolygon","setComplexGeometry","optionalLayer","checkedOut","onFeatureClick","isExclusive","show","activateCtl","_previousActiveControl","previousActiveControl","setSelectedFeatures","renderPromise","getFeatureImportPanel","_featureImportPanelPromise","titles","panel","_highlightsLayerPromise","addLayer","layerType","VECTOR","stealth","selection","Cfg","highlightsLayer","highlightFeatures","featuresToHighlight","concat","slice","addFeatures","some","newFeature","clone","toggleSelectedStyle","workLayers","isRaster","getFeatureFromImportList","cb","dataset","layerId","getFeatureById","importFeatures","failure","result","featureOptions","geometry","addFeature","toast","msgType","WARNING","handleCheck","checkbox","idx","_addImportLayerEvents","ccb","_addImportFeatureEvents","highlightListener","layers","close","layerElementSelector","newLi"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\n(function () {\r\n\r\n    const setEditState = function (ctl, state) {\r\n        ctl.div.querySelectorAll(ctl._selectors.MODE_RADIO_BUTTON).forEach(r => r.disabled = !state);\r\n    }\r\n\r\n    /* Creamos el constructor, llamando al constructor del padre */\r\n    TC.control.Edit = function () {\r\n        const self = this;\r\n\r\n        TC.Control.apply(this, arguments);\r\n\r\n        self._classSelector = '.' + self.CLASS;\r\n\r\n        self._selectors = {\r\n            MODE_RADIO_BUTTON: `input[type=radio][name=\"${self.id}-mode\"]`\r\n        };\r\n\r\n\r\n        self.wrap = new TC.wrap.control.Edit(self);\r\n        self.layer = null;\r\n        //self.feature = self.options.feature ? self.options.feature : null;\r\n        self.callback = TC.Util.isFunction(arguments[2]) ? arguments[2] : (self.options.callback ? self.options.callback : null);\r\n        self.cancelActionConfirmTxt = self.options.cancelText ? self.options.eraseText : \"Si continua todos los cambios se perdern. Desea continuar?\";\r\n        self.styles = self.options.styles;\r\n        self.layersEditData = {};\r\n        self.pointDrawControl = null;\r\n        self.lineDrawControl = null;\r\n        self.polygonDrawControl = null;\r\n        //self.cutDrawControl = null;\r\n        self.modifyControl = null;\r\n        self.snapping = (typeof self.options.snapping === 'boolean') ? self.options.snapping : true;\r\n\r\n\r\n            //.on(TC.Consts.event.EDITIONSAVE, function (e) {\r\n            //    if (self.callback)\r\n            //        self.callback(e.added, e.removed, e.modified);\r\n            //});\r\n    };\r\n\r\n    TC.inherit(TC.control.Edit, TC.Control);\r\n\r\n    TC.control.Edit.mode = {\r\n        MODIFY: 'modify',\r\n        ADDPOINT: 'addpoint',\r\n        ADDLINE: 'addline',\r\n        ADDPOLYGON: 'addpolygon',\r\n        CUT: 'cut',\r\n        OTHER: 'other'\r\n    }\r\n\r\n    const ctlProto = TC.control.Edit.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-edit';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-edit.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-attr'] = TC.apiLocation + \"TC/templates/tc-ctl-edit-attr.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-import'] = TC.apiLocation + \"TC/templates/tc-ctl-edit-import.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-import-layer'] = TC.apiLocation + \"TC/templates/tc-ctl-edit-import-layer.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-import-feature'] = TC.apiLocation + \"TC/templates/tc-ctl-edit-import-feature.hbs\";\r\n\r\n    /* Extendemos el mtodo register. \r\n       La lgica del control suele definirse aqu. */\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n\r\n            TC.Control.prototype.register.call(self, map).then(function () {\r\n\r\n                const DRAW = 'draw';\r\n                self._pointDrawCtlPromise = map.addControl(DRAW, {\r\n                    id: self.getUID(),\r\n                    div: self.div.querySelector(`.${self.CLASS}-point`),\r\n                    mode: TC.Consts.geom.POINT,\r\n                    layer: false\r\n                });\r\n                self._lineDrawCtlPromise = map.addControl(DRAW, {\r\n                    id: self.getUID(),\r\n                    div: self.div.querySelector(`.${self.CLASS}-line`),\r\n                    mode: TC.Consts.geom.POLYLINE,\r\n                    layer: false\r\n                });\r\n                self._polygonDrawCtlPromise = map.addControl(DRAW, {\r\n                    id: self.getUID(),\r\n                    div: self.div.querySelector(`.${self.CLASS}-polygon`),\r\n                    mode: TC.Consts.geom.POLYGON,\r\n                    layer: false\r\n                });\r\n                //self._cutDrawCtlPromise = map.addControl(DRAW, {\r\n                //    id: self.getUID(),\r\n                //    div: self.div.querySelector(`.${self.CLASS}-cut`),\r\n                //    mode: TC.Consts.geom.POLYLINE,\r\n                //    snapping: true,\r\n                //    styles: {\r\n                //        line: {\r\n                //            lineDash: [5, 5]\r\n                //        }\r\n                //    },\r\n                //    layer: false\r\n                //});\r\n                self._modifyCtlPromise = map.addControl('modify', {\r\n                    id: self.getUID(),\r\n                    div: self.div.querySelector(`.${self.CLASS}-modify`),\r\n                    snapping: self.snapping\r\n                });\r\n                Promise.all([\r\n                    self._pointDrawCtlPromise,\r\n                    self._lineDrawCtlPromise,\r\n                    self._polygonDrawCtlPromise,\r\n                    //self._cutDrawCtlPromise,\r\n                    self._modifyCtlPromise\r\n                ]).then(function (controls) {\r\n                    self.pointDrawControl = controls[0];\r\n                    self.lineDrawControl = controls[1];\r\n                    self.polygonDrawControl = controls[2];\r\n                    //self.cutDrawControl = controls[3];\r\n                    self.modifyControl = controls[3];\r\n\r\n                    const drawendHandler = function (e) {\r\n                        e.feature.setStyle(null); // Por defecto, Draw aade estilo a todo lo que dibuja. No nos conviene cuando est dentro de Edit.\r\n                        self.trigger(TC.Consts.event.DRAWEND, { feature: e.feature });\r\n                    };\r\n                    const drawcancelHandler = function () {\r\n                        self.cancel();\r\n                    };\r\n                    self.pointDrawControl\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    self.lineDrawControl\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    self.polygonDrawControl\r\n                        .on(TC.Consts.event.DRAWEND, drawendHandler)\r\n                        .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    //self.cutDrawControl\r\n                    //    .on(TC.Consts.event.DRAWEND, function (e) {\r\n                    //        //TC.loadJS(\r\n                    //        //    !window.turf && !turf.lineSplit,\r\n                    //        //    [TC.apiLocation + 'lib/turf/line-split'],\r\n                    //        //    function () {\r\n\r\n                    //        //    }\r\n                    //        //);\r\n\r\n                    //        //self.layer.features.filter(f => f)\r\n                    //    })\r\n                    //    .on(TC.Consts.event.DRAWCANCEL, drawcancelHandler);\r\n                    self.modifyControl\r\n                        .on(TC.Consts.event.FEATUREMODIFY, function (e) {\r\n                            self.trigger(TC.Consts.event.FEATUREMODIFY, { feature: e.feature, layer: e.layer });\r\n                        })\r\n                        .on(TC.Consts.event.FEATUREADD, function (e) {\r\n                            self.trigger(TC.Consts.event.FEATUREADD, { feature: e.feature, layer: e.layer });\r\n                        })\r\n                        .on(TC.Consts.event.FEATUREREMOVE, function (e) {\r\n                            self.trigger(TC.Consts.event.FEATUREREMOVE, { feature: e.feature, layer: e.layer });\r\n                        });\r\n\r\n                    self.modifyControl.displayAttributes = function () {\r\n                        const selectedFeatures = self.getSelectedFeatures();\r\n                        const feature = selectedFeatures[selectedFeatures.length - 1];\r\n                        if (feature) {\r\n                            self.modifyControl._editAttrBtn.classList.add(TC.Consts.classes.ACTIVE);\r\n                            const attributes = self.getLayerEditData(feature.layer).attributes;\r\n                            const attrArray = Object.keys(attributes).map(k => attributes[k]);\r\n                            const jfa = self._joinedFeatureAttributes || [];\r\n                            const data = feature.getData() || {};\r\n\r\n                            attrArray.forEach(function (attributeObj) {\r\n                                attributeObj.value = data[attributeObj.name];\r\n                                if (attributeObj.name === 'id') {\r\n                                    attributeObj.readOnly = true;\r\n                                }\r\n                                attributeObj.availableValues = [];\r\n                                jfa.forEach(function (jfaObj) {\r\n                                    const val = jfaObj[attributeObj.name];\r\n                                    if (val !== undefined && val !== '') {\r\n                                        attributeObj.availableValues.push(val);\r\n                                    }\r\n                                });\r\n                            });\r\n\r\n                            attrArray.sort(function (a, b) {\r\n                                if (a.readOnly ? !b.readOnly : b.readOnly) { //XOR\r\n                                    return !a.readOnly - !b.readOnly; // Primero readOnly\r\n                                }\r\n                                if (a.name > b.name) {\r\n                                    return 1;\r\n                                }\r\n                                if (a.name < b.name) {\r\n                                    return -1;\r\n                                }\r\n                                return 0;\r\n                            });\r\n                            self.getRenderedHtml(self.CLASS + '-attr', { data: attrArray }, function (html) {\r\n                                self.modifyControl._attributesSection;\r\n                                const contentDiv = self.getAttributeDisplayTarget();\r\n                                contentDiv.classList.remove(TC.Consts.classes.HIDDEN);\r\n                                contentDiv.innerHTML = html;\r\n                                const inputs = contentDiv.querySelectorAll('input');\r\n                                const selects = contentDiv.querySelectorAll('select');\r\n                                inputs.forEach(function (elm) {\r\n                                    elm.addEventListener('input', function (e) {\r\n                                        const input = e.target;\r\n                                        for (var i = 0, len = selects.length; i < len; i++) {\r\n                                            const select = selects[i];\r\n                                            if (select.matches(`[name=${e.target.getAttribute('name')}]`) && select.value !== input.value) {\r\n                                                select.value = '';\r\n                                                break;\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                });\r\n                                selects.forEach(function (elm) {\r\n                                    elm.addEventListener('change', function (e) {\r\n                                        const select = e.target;\r\n                                        for (var i = 0, len = inputs.length; i < len; i++) {\r\n                                            const input = inputs[i];\r\n                                            if (input.matches(`[name=${e.target.getAttribute('name')}]`)) {\r\n                                                input.value = select.value;\r\n                                                break;\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                });\r\n\r\n                                contentDiv.querySelector(`.${self.modifyControl.CLASS}-btn-attr-ok`).addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                                    self.modifyControl._onAttrOK();\r\n                                }, { passive: true });\r\n\r\n                                contentDiv.querySelector(`.${self.modifyControl.CLASS}-btn-attr-cancel`).addEventListener(TC.Consts.event.CLICK, function () {\r\n                                    self.modifyControl.closeAttributes();\r\n                                }, { passive: true });\r\n                            });\r\n                        }\r\n                    };\r\n\r\n                    self.modifyControl._onAttrOK = function () {\r\n                        const that = this;\r\n                        const feature = that.getSelectedFeatures()[0];\r\n                        if (feature) {\r\n                            const data = {};\r\n                            const attributes = self.getLayerEditData(feature.layer).attributes;\r\n                            const inputs = that.getAttributeDisplayTarget().querySelectorAll('input');\r\n                            inputs.forEach(function (input) {\r\n                                var name = input.getAttribute('name');\r\n                                var value = input.value;\r\n                                switch (attributes[name].type) {\r\n                                    case 'int':\r\n                                    case 'integer':\r\n                                    case 'byte':\r\n                                    case 'long':\r\n                                    case 'negativeInteger':\r\n                                    case 'nonNegativeInteger':\r\n                                    case 'nonPositiveInteger':\r\n                                    case 'positiveInteger':\r\n                                    case 'short':\r\n                                    case 'unsignedLong':\r\n                                    case 'unsignedInt':\r\n                                    case 'unsignedShort':\r\n                                    case 'unsignedByte':\r\n                                        value = parseInt(value);\r\n                                        if (!Number.isNaN(value)) {\r\n                                            data[name] = value;\r\n                                        }\r\n                                        break;\r\n                                    case 'double':\r\n                                    case 'float':\r\n                                    case 'decimal':\r\n                                        value = parseFloat(value);\r\n                                        if (!Number.isNaN(value)) {\r\n                                            data[name] = value;\r\n                                        }\r\n                                        break;\r\n                                    case 'date':\r\n                                    case 'time':\r\n                                    case 'dateTime':\r\n                                        data[name] = new Date(value);\r\n                                        break;\r\n                                    case 'boolean':\r\n                                        data[name] = !!value;\r\n                                        break;\r\n                                    case undefined:\r\n                                        break;\r\n                                    default:\r\n                                        data[name] = value;\r\n                                        break;\r\n                                }\r\n                            });\r\n                            feature.setData(data);\r\n                            that.trigger(TC.Consts.event.FEATUREMODIFY, { feature: feature, layer: that.layer });\r\n                            that.closeAttributes();\r\n                        }\r\n                    };\r\n\r\n                    if (Array.isArray(self.options.modes) && self.options.modes.length == 1) {\r\n                        self.setMode(self.options.modes[0], null);\r\n                    }\r\n\r\n                    resolve(self);\r\n\r\n                    map.loaded(function () {\r\n                        self.setLayer(self.options.layer);\r\n                    });\r\n\r\n                    map\r\n                        .on(TC.Consts.event.RESULTSPANELCLOSE, function (e) {\r\n                            if (e.control === self.featureImportPanel) {\r\n                                self.featuresToImport = [];\r\n                                self.getHighlightsLayer().then(l => l.clearFeatures());\r\n                            }\r\n                        })\r\n                        .on(TC.Consts.event.LAYERREMOVE + ' ' + TC.Consts.event.FEATURESCLEAR, function (e) {\r\n                            if (self.featureImportPanel && !self.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                                self.getHighlightsLayer().then(function (hlLayer) {\r\n                                    for (let i = self.featuresToImport.length - 1; i >= 0; i--) {\r\n                                        const fti = self.featuresToImport[i];\r\n                                        if (fti.layer === e.layer || (fti.original && fti.original.layer === e.layer)) {\r\n                                            self.featuresToImport.splice(i, 1);\r\n                                            hlLayer.removeFeature(fti);\r\n                                        }\r\n                                    }\r\n                                    const li = self.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id=\"${e.layer.id}\"]`);\r\n                                    if (li) {\r\n                                        li.remove();\r\n                                    }\r\n                                });\r\n                            }\r\n                        })\r\n                        .on(TC.Consts.event.FEATUREREMOVE, function (e) {\r\n                            if (self.featureImportPanel && !self.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                                self.getHighlightsLayer().then(function (hlLayer) {\r\n                                    for (let i = 0, ii = self.featuresToImport.length; i < ii; i++) {\r\n                                        const fti = self.featuresToImport[i];\r\n                                        if (fti === e.feature || fti.original === e.feature) {\r\n                                            self.featuresToImport.splice(i, 1);\r\n                                            hlLayer.removeFeature(fti);\r\n                                            const lli = self.featureImportPanel.getInfoContainer().querySelector(`li[data-layer-id=\"${e.layer.id}\"]`);\r\n                                            if (lli) {\r\n                                                const fli = lli.querySelector(`#tc-ctl-edit-import-list-cb-${e.layer.id}-${e.feature.id}`);\r\n                                                if (fli) {\r\n                                                    fli.remove();\r\n                                                }\r\n                                                if (!lli.children.length) {\r\n                                                    lli.remove();\r\n                                                }\r\n                                            }\r\n                                            break;\r\n                                        }\r\n                                    }\r\n                                });\r\n                            }\r\n                        })\r\n                        .on(TC.Consts.event.LAYERUPDATE, function (e) { // TODO: Actualizar cuando la capa ya existe en la lista\r\n                            if (self.featureImportPanel && !self.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                                const layerObj = self.getAvailableFeaturesToImport().filter(l => l.id === e.layer.id)[0];\r\n                                if (layerObj) {\r\n                                    self.getRenderedHtml(self.CLASS + '-import-layer', layerObj, function (html) {\r\n                                        const list = self\r\n                                            .featureImportPanel\r\n                                            .getInfoContainer()\r\n                                            .querySelector(`.${self.CLASS}-import-list .tc-layers`);\r\n                                        if (!list.querySelector(`li[data-layer-id=\"${e.layer.id}\"]`)) {\r\n                                            list.insertAdjacentHTML('beforeend', html);\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        })\r\n                        .on(TC.Consts.event.FEATUREADD + ' ' + TC.Consts.event.FEATURESADD, function (e) {\r\n                            if (self.featureImportPanel && !self.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                                const layer = e.layer;\r\n                                const features = (e.feature ? [e.feature] : e.features).filter(f => self.isFeatureAllowed(f));\r\n                                if (features.length) {\r\n                                    self.displayLayerToImport({\r\n                                        id: layer.id,\r\n                                        title: layer.title,\r\n                                        features: features\r\n                                    });\r\n                                }\r\n                            }\r\n                        });\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self._set1stRenderPromise(TC.Control.prototype.renderData.call(self, { controlId: self.id}, function () {\r\n\r\n            //control de renderizado enfuncin del modo de edicion\r\n            if (Array.isArray(self.options.modes) && self.options.modes.length > 0) {\r\n                for (var m in TC.control.Edit.mode)\r\n                    if (typeof m === 'string' && self.options.modes.indexOf(TC.control.Edit.mode[m]) < 0) {\r\n                        const label = self.div.querySelector(`label${self._classSelector}-btn-${TC.control.Edit.mode[m]}`);\r\n                        label.parentElement.removeChild(label);\r\n                        const div = self.div.querySelector(`div${self._classSelector}-${TC.control.Edit.mode[m]}`);\r\n                        div.parentElement.removeChild(div);\r\n                    }\r\n                if (self.options.modes.length === 1) {\r\n                    var mode = self.options.modes[0];\r\n                    const label = self.div.querySelector(`label${self._classSelector}-btn-${mode}`);\r\n                    label.parentElement.removeChild(label);\r\n                }\r\n            }\r\n\r\n            self.div.querySelectorAll(self._selectors.MODE_RADIO_BUTTON).forEach(function (radio) {\r\n                radio.addEventListener('change', function () {\r\n                    var newMode = this.value;\r\n                    var mode = self.mode === newMode ? undefined : newMode;\r\n                    self.setMode(mode);\r\n                });\r\n            });\r\n\r\n            self.div.querySelector(self._classSelector + '-btn-import').addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                self.showFeatureImportPanel();\r\n            }, { passive: true });\r\n\r\n            self.div.querySelector(self._classSelector + '-btn-dl').addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                self.getDownloadDialog().then(function (dialog) {\r\n                    const options = {\r\n                        title: self.getLocaleString('download'),\r\n                        fileName: self.layer.id.toLowerCase().replace(' ', '_') + '_' + TC.Util.getFormattedDate(new Date().toString(), true),\r\n                        elevation: self.options.downloadElevation\r\n                    };\r\n                    dialog.open(self.layer.features, options);\r\n                });\r\n            }, { passive: true });\r\n\r\n            if (TC.Util.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        }));\r\n    };\r\n\r\n    ctlProto.getGeometryType = function (geometryType) {\r\n        switch (geometryType) {\r\n            case 'gml:LinearRingPropertyType':\r\n            case 'gml:PolygonPropertyType':\r\n            case 'LinearRingPropertyType':\r\n            case 'PolygonPropertyType':\r\n                return TC.Consts.geom.POLYGON;\r\n            case 'gml:MultiPolygonPropertyType':\r\n            case 'gml:MultiSurfacePropertyType':\r\n            case 'MultiPolygonPropertyType':\r\n            case 'MultiSurfacePropertyType':\r\n                return TC.Consts.geom.MULTIPOLYGON;\r\n            case 'gml:LineStringPropertyType':\r\n            case 'gml:CurvePropertyType':\r\n            case 'LineStringPropertyType':\r\n            case 'CurvePropertyType':\r\n                return TC.Consts.geom.POLYLINE;\r\n            case 'gml:MultiLineStringPropertyType':\r\n            case 'gml:MultiCurvePropertyType':\r\n            case 'MultiLineStringPropertyType':\r\n            case 'MultiCurvePropertyType':\r\n                return TC.Consts.geom.MULTIPOLYLINE;\r\n            case 'gml:PointPropertyType':\r\n            case 'gml:MultiPointPropertyType':\r\n            case 'PointPropertyType':\r\n            case 'MultiPointPropertyType':\r\n                return TC.Consts.geom.POINT;\r\n            case 'gml:BoxPropertyType':\r\n            case 'BoxPropertyType':\r\n                return TC.Consts.geom.RECTANGLE;\r\n            case 'gml:GeometryCollectionPropertyType':\r\n            case 'gml:GeometryAssociationType':\r\n            case 'gml:GeometryPropertyType':\r\n            case 'GeometryCollectionPropertyType':\r\n            case 'GeometryAssociationType':\r\n            case 'GeometryPropertyType':\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n\r\n    };\r\n\r\n    ctlProto.setLayer = function (layer) {\r\n        const self = this;\r\n        self.layer = self.map.getLayer(layer);\r\n        if (self.layer) {\r\n            layer.describeFeatureType()\r\n                .then(function (attributes) {\r\n                    const layerEditData = {\r\n                        attributes: {}\r\n                    };\r\n                    // recogemos los atributos no geomtricos y definimos la geometra\r\n                    for (var key in attributes) {\r\n                        const attr = attributes[key];\r\n                        const geometryType = self.getGeometryType(attr.type);\r\n                        if (geometryType) {\r\n                            layerEditData.geometryName = attr.name;\r\n                            layerEditData.geometryType = typeof geometryType === 'boolean' ? null : geometryType;\r\n                        }\r\n                        else {\r\n                            layerEditData.attributes[key] = attr;\r\n                        }\r\n                    }\r\n                    for (var key in layerEditData.attributes) {\r\n                        const attr = layerEditData.attributes[key];\r\n                        attr.type = attr.type.substr(attr.type.indexOf(':') + 1);\r\n                    }\r\n                    self.layersEditData[layer.id] = layerEditData;\r\n                })\r\n                .catch(function (err) {\r\n                    self.layersEditData[layer.id] = {\r\n                        geometryType: null,\r\n                        attributes: {}\r\n                    };\r\n                });\r\n        }\r\n        const setLayer = c => c.setLayer(self.layer);\r\n        self.getModifyControl().then(setLayer);\r\n        self.getPointDrawControl().then(setLayer);\r\n        self.getLineDrawControl().then(setLayer);\r\n        self.getPolygonDrawControl().then(setLayer);\r\n        //self.getCutDrawControl().then(setLayer);\r\n        self.setMode(self.layer ? TC.control.Edit.mode.MODIFY : null);\r\n        setEditState(self, self.layer);\r\n    };\r\n\r\n    ctlProto.setMode = function (mode) {\r\n        var self = this;\r\n        self.mode = mode;\r\n        //setFeatureSelectReadyState(self);\r\n\r\n        var activateDraw = function (draw) {\r\n            if (draw) {\r\n                if (self.snapping) {\r\n                    draw.snapping = self.layer;\r\n                }\r\n                draw.activate();\r\n            }\r\n        };\r\n\r\n        var active;\r\n        var hiddenList;\r\n        Promise.all([\r\n            self._pointDrawCtlPromise,\r\n            self._lineDrawCtlPromise,\r\n            self._polygonDrawCtlPromise,\r\n            //self._cutDrawCtlPromise,\r\n            self._modifyCtlPromise\r\n        ]).then(function (controls) {\r\n            const pointDrawControl = controls[0];\r\n            const lineDrawControl = controls[1];\r\n            const polygonDrawControl = controls[2];\r\n            //const cutDrawControl = controls[3];\r\n            const modifyControl = controls[3];\r\n            switch (mode) {\r\n                case TC.control.Edit.mode.MODIFY:\r\n                    active = self.div.querySelector(self._classSelector + '-modify');\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-polygon,' + self._classSelector + '-other');\r\n                    modifyControl.activate();\r\n                    break;\r\n                case TC.control.Edit.mode.ADDPOINT:\r\n                    active = self.div.querySelector(self._classSelector + '-point');\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-modify,' + self._classSelector + '-line,' + self._classSelector + '-polygon,' + self._classSelector + '-other');\r\n                    activateDraw(pointDrawControl);\r\n                    break;\r\n                case TC.control.Edit.mode.ADDLINE:\r\n                    active = self.div.querySelector(self._classSelector + '-line');\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-modify,' + self._classSelector + '-point,' + self._classSelector + '-polygon,' + self._classSelector + '-other');\r\n                    activateDraw(lineDrawControl);\r\n                    break;\r\n                case TC.control.Edit.mode.ADDPOLYGON:\r\n                    active = self.div.querySelector(self._classSelector + '-polygon');\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-modify,' + self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-other');\r\n                    activateDraw(polygonDrawControl);\r\n                    break;\r\n                case TC.control.Edit.mode.OTHER:\r\n                    active = self.div.querySelector(self._classSelector + '-other');\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-modify,' + self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-polygon');\r\n                    if (controls.indexOf(self.map.activeControl) >= 0) {\r\n                        self.map.activeControl.deactivate();\r\n                    }\r\n                    break;\r\n                default:\r\n                    active = null;\r\n                    hiddenList = self.div.querySelectorAll(self._classSelector + '-modify,' + self._classSelector + '-point,' + self._classSelector + '-line,' + self._classSelector + '-polygon,' + self._classSelector + '-other');\r\n                    if (controls.indexOf(self.map.activeControl) >= 0) {\r\n                        self.map.activeControl.deactivate();\r\n                    }\r\n                    //if (cutDrawControl.isActive) {\r\n                    //    cutDrawControl.deactivate();\r\n                    //}\r\n                    break;\r\n            }\r\n\r\n            if (mode) {\r\n                const radio = self.div.querySelector(`${self._selectors.MODE_RADIO_BUTTON}[value=${mode}]`);\r\n                radio.checked = true;\r\n            }\r\n            else {\r\n                self.div.querySelectorAll(self._selectors.MODE_RADIO_BUTTON).forEach(function (radio) {\r\n                    radio.checked = false;\r\n                });\r\n            }\r\n            if (active) {\r\n                active.classList.remove(TC.Consts.classes.HIDDEN);\r\n            }\r\n            hiddenList.forEach(function (hidden) {\r\n                hidden.classList.add(TC.Consts.classes.HIDDEN);\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.constrainModes = function (modes) {\r\n        const self = this;\r\n        if (!Array.isArray(modes)) {\r\n            modes = [];\r\n        }\r\n        self.modes = modes\r\n            .filter(function (m) {\r\n                // Quitamos los valores que no sean modos de edicin\r\n                for (var key in TC.control.Edit.mode) {\r\n                    if (TC.control.Edit.mode[key] === m) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            })\r\n            .filter(function (m) {\r\n                // Quitamos los modos de edicin que no se definieron en la configuracin\r\n                if (!Array.isArray(self.options.modes)) {\r\n                    return true;\r\n                }\r\n                return self.options.modes.indexOf(m) >= 0;\r\n            });\r\n        if (self.modes.indexOf(self.mode) < 0) {\r\n            self.setMode(null);\r\n        }\r\n        const selector = self.modes.map(m => `[value=${m}]`).join() || '[value]';\r\n        self.div.querySelectorAll(self._selectors.MODE_RADIO_BUTTON).forEach(function (rb) {\r\n            rb.disabled = !rb.matches(selector);\r\n        });\r\n    };\r\n\r\n    ctlProto.isFeatureAllowed = function (feature) {\r\n        const self = this;\r\n        switch (true) {\r\n            case TC.feature.Point && feature instanceof TC.feature.Point:\r\n                return self.modes.indexOf(TC.control.Edit.mode.ADDPOINT) >= 0;\r\n            case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                return self.modes.indexOf(TC.control.Edit.mode.ADDLINE) >= 0;\r\n            case TC.feature.MultiPolyline && feature instanceof TC.feature.MultiPolyline:\r\n                return self.modes.indexOf(TC.control.Edit.mode.ADDLINE) >= 0 && self.isMultiple;\r\n            case TC.feature.Polygon && feature instanceof TC.feature.Polygon:\r\n                return self.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON) >= 0;\r\n            case TC.feature.MultiPolygon && feature instanceof TC.feature.MultiPolygon:\r\n                return self.modes.indexOf(TC.control.Edit.mode.ADDPOLYGON) >= 0 && self.isMultiple;\r\n            default:\r\n                return true;\r\n        }\r\n    };\r\n\r\n    ctlProto.setComplexGeometry = function (isMultiple) {\r\n        const self = this;\r\n        self.isMultiple = isMultiple;\r\n        //self.getPointDrawControl().then(c => c.setMode(isMultiple ? TC.Consts.geom.MULTIPOINT : TC.Consts.geom.POINT));\r\n        self.getLineDrawControl().then(c => c.setMode(isMultiple ? TC.Consts.geom.MULTIPOLYLINE : TC.Consts.geom.POLYLINE));\r\n        self.getPolygonDrawControl().then(c => c.setMode(isMultiple ? TC.Consts.geom.MULTIPOLYGON : TC.Consts.geom.POLYGON));\r\n    };\r\n\r\n    ctlProto.getLayerEditData = function (optionalLayer) {\r\n        const self = this;\r\n        const layer = optionalLayer || self.layer;\r\n        if (!layer) {\r\n            return null;\r\n        }\r\n        return self.layersEditData[layer.id] = self.layersEditData[layer.id] || {\r\n            checkedOut: false\r\n        };\r\n    };\r\n\r\n    ctlProto.cancel = function () {\r\n        var self = this;\r\n        if (Array.isArray(self.options.modes) && self.options.modes.length == 1) {\r\n            self.setMode(self.options.modes[0], null);\r\n        }\r\n        else {\r\n            self.setMode(null, false);\r\n        }\r\n        self.wrap.cancel(true, self.cancelActionConfirmTxt);\r\n    };\r\n\r\n    ctlProto.onFeatureClick = function (e) {\r\n        if (!self.activeControl || !self.activeControl.isExclusive()) {\r\n            e.feature.show();\r\n        }\r\n    };\r\n    \r\n    ctlProto.activate = function (options) {\r\n        const self = this;\r\n        options = options || {};\r\n        const activateCtl = function (ctl) {\r\n            if (ctl !== self.map.activeControl) {\r\n                self._previousActiveControl = self.map.activeControl;\r\n            }\r\n        };\r\n        switch (options.mode) {\r\n            case TC.control.Edit.mode.ADDPOINT:\r\n                self.getPointDrawControl().then(activateCtl);\r\n                break;\r\n            case TC.control.Edit.mode.ADDLINE:\r\n                self.getLineDrawControl().then(activateCtl);\r\n                break;\r\n            case TC.control.Edit.mode.ADDPOLYGON:\r\n                self.getPolygonDrawControl().then(activateCtl);\r\n                break;\r\n            default:\r\n                self.getModifyControl().then(activateCtl);\r\n                break;\r\n        }\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        const self = this;\r\n        if (self._previousActiveControl) {\r\n            self.map.previousActiveControl = self._previousActiveControl;\r\n            switch (self.map.activeControl) {\r\n                case self.pointDrawControl:\r\n                    self.pointDrawControl.deactivate();\r\n                    break;\r\n                case self.lineDrawControl:\r\n                    self.lineDrawControl.deactivate();\r\n                    break;\r\n                case self.polygonDrawControl:\r\n                    self.polygonDrawControl.deactivate();\r\n                    break;\r\n                case self.modifyControl:\r\n                    self.modifyControl.deactivate();\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n        self.modifyControl && self.modifyControl.closeAttributes();\r\n    };\r\n\r\n    ctlProto.isExclusive = function () {\r\n        return true;\r\n    };\r\n\r\n    ctlProto.getAttributeDisplayTarget = function () {\r\n        return this.modifyControl._attributesSection;\r\n    };\r\n\r\n    //ctlProto.joinFeatures = function (features) {\r\n    //    var self = this;\r\n    //    if (self.geometryType === TC.Consts.geom.MULTIPOLYLINE ||\r\n    //        self.geometryType === TC.Consts.geom.MULTIPOLYGON ||\r\n    //        self.geometryType === TC.Consts.geom.MULTIPOINT) {\r\n    //        self._joinedFeatureAttributes = [];\r\n    //        if (features.length > 1) {\r\n    //            var geometries = features.map(function (elm) {\r\n    //                self._joinedFeatureAttributes.push(elm.getData());\r\n    //                return elm.geometry;\r\n    //            });\r\n    //            var newGeometry = geometries.reduce(function (a, b) {\r\n    //                return a.concat(b);\r\n    //            });\r\n    //            var newFeature = new features[0].constructor(newGeometry);\r\n    //            for (var i = 0, len = features.length; i < len; i++) {\r\n    //                var feature = features[i];\r\n    //                self.layer.removeFeature(feature);\r\n    //                self.trigger(TC.Consts.event.FEATUREREMOVE, { feature: feature });\r\n    //            }\r\n    //            self.layer.addFeature(newFeature).then(function (feat) {\r\n    //                self.setSelectedFeatures([newFeature]);\r\n    //                self.trigger(TC.Consts.event.FEATUREADD, { feature: feat });\r\n    //                feat.showPopup(self.attributeEditor);\r\n    //            });\r\n    //        }\r\n    //        setFeatureSelectedState(self, [newFeature]);\r\n    //    }\r\n    //};\r\n\r\n    //ctlProto.splitFeatures = function (features) {\r\n    //    var self = this;\r\n    //    var complexFeatures = features.filter(complexGeometryFilter);\r\n    //    var geometries = complexFeatures.map(function (elm) {\r\n    //        return elm.geometry;\r\n    //    });\r\n    //    var newFeatures = [];\r\n    //    for (var i = 0, ii = complexFeatures.length; i < ii; i++) {\r\n    //        var feature = complexFeatures[i];\r\n    //        var data = feature.getData();\r\n    //        var geometry = geometries[i];\r\n    //        for (var j = 0, jj = geometry.length; j < jj; j++) {\r\n    //            newFeatures.push(new feature.constructor([geometry[j]], { data: data }));\r\n    //        }\r\n    //    }\r\n    //    for (var i = 0, len = complexFeatures.length; i < len; i++) {\r\n    //        var feature = complexFeatures[i];\r\n    //        self.layer.removeFeature(feature);\r\n    //        self.trigger(TC.Consts.event.FEATUREREMOVE, { feature: feature });\r\n    //    }\r\n    //    var newFeatPromises = new Array(newFeatures.length);\r\n    //    for (var i = 0, len = newFeatures.length; i < len; i++) {\r\n    //        const promise = newFeatPromises[i] = self.layer.addFeature(newFeatures[i]);\r\n    //        promise.then(function (feat) {\r\n    //            self.trigger(TC.Consts.event.FEATUREADD, { feature: feat });\r\n    //        });\r\n    //    }\r\n    //    Promise.all(newFeatPromises).then(function() {\r\n    //        self.setSelectedFeatures(newFeatures);\r\n    //    });\r\n    //    setFeatureSelectedState(self, newFeatures);\r\n    //};\r\n\r\n    //ctlProto.deleteFeatures = function (features) {\r\n    //    var self = this;\r\n    //    self.wrap.deleteFeatures(features);\r\n    //    if (self.layer.features.length === 0) {\r\n    //        self._deleteBtn.disabled = true;\r\n    //    }\r\n    //};\r\n\r\n    ctlProto.getSelectedFeatures = function () {\r\n        return this.modifyControl.getSelectedFeatures();\r\n    };\r\n\r\n    ctlProto.setSelectedFeatures = function (features) {\r\n        return this.modifyControl.setSelectedFeatures(features);\r\n    };\r\n\r\n    ctlProto.getLayer = function () {\r\n        var self = this;\r\n        return self.layer;\r\n    };\r\n\r\n    ctlProto.getModifyControl = function () {\r\n        const self = this;\r\n        return self._modifyCtlPromise || new Promise(function (resolve, reject) {\r\n            self.renderPromise().then(() => resolve(self.modifyControl));\r\n        });\r\n    };\r\n\r\n    ctlProto.getPointDrawControl = function () {\r\n        const self = this;\r\n        return self._pointDrawCtlPromise || new Promise(function (resolve, reject) {\r\n            self.renderPromise().then(() => resolve(self.pointDrawControl));\r\n        });\r\n    };\r\n\r\n    ctlProto.getLineDrawControl = function () {\r\n        const self = this;\r\n        return self._lineDrawCtlPromise || new Promise(function (resolve, reject) {\r\n            self.renderPromise().then(() => resolve(self.lineDrawControl));\r\n        });\r\n    };\r\n\r\n    ctlProto.getPolygonDrawControl = function () {\r\n        const self = this;\r\n        return self._polygonDrawCtlPromise || new Promise(function (resolve, reject) {\r\n            self.renderPromise().then(() => resolve(self.polygonDrawControl));\r\n        });\r\n    };\r\n\r\n    //ctlProto.getCutDrawControl = function () {\r\n    //    const self = this;\r\n    //    return self._cutDrawCtlPromise || new Promise(function (resolve, reject) {\r\n    //        self.renderPromise().then(() => resolve(self.cutDrawControl));\r\n    //    });\r\n    //};\r\n\r\n    ctlProto.getFeatureImportPanel = function () {\r\n        const self = this;\r\n        if (!self._featureImportPanelPromise) {\r\n            self._featureImportPanelPromise = self.map.addControl('resultsPanel', {\r\n                titles: {\r\n                    main: self.getLocaleString('importFromOtherLayer')\r\n                }\r\n            });\r\n            self._featureImportPanelPromise.then(panel => self.featureImportPanel = panel);\r\n        }\r\n        return self._featureImportPanelPromise;\r\n    };\r\n\r\n    ctlProto.getHighlightsLayer = function () {\r\n        const self = this;\r\n        if (!self._highlightsLayerPromise) {\r\n            self._highlightsLayerPromise = self.map.addLayer({\r\n                id: self.getUID(),\r\n                type: TC.Consts.layerType.VECTOR,\r\n                title: 'Highlights Layer',\r\n                stealth: true,\r\n                styles: self.map.options.styles.selection || TC.Cfg.styles.selection\r\n            });\r\n            self._highlightsLayerPromise.then(layer => self.highlightsLayer = layer);\r\n        }\r\n        return self._highlightsLayerPromise;\r\n    };\r\n\r\n    ctlProto.highlightFeatures = function (features) {\r\n        const self = this;\r\n        self.getHighlightsLayer().then(function (layer) {\r\n            const featuresToHighlight = self.featuresToImport.concat(features);\r\n            layer.features.slice().forEach(function (feature) {\r\n                if (!feature.original || featuresToHighlight.indexOf(feature.original) < 0) {\r\n                    layer.removeFeature(feature);\r\n                }\r\n            });\r\n            layer.addFeatures(featuresToHighlight\r\n                .filter(function (feature) {\r\n                    return !layer.features.some(function (f) {\r\n                        return f.original && f.original === feature;\r\n                    });\r\n                })\r\n                .map(function (feature) {\r\n                const newFeature = feature.clone();\r\n                newFeature.toggleSelectedStyle(true);\r\n                newFeature.original = feature;\r\n                return newFeature;\r\n            }));\r\n        });\r\n    };\r\n\r\n    ctlProto.getAvailableFeaturesToImport = function () {\r\n        const self = this;\r\n        return self.map.workLayers\r\n            .filter(l => !l.isRaster())\r\n            .filter(l => l !== self.layer)\r\n            .filter(l => l !== self.highlightsLayer)\r\n            .map(function (l) {\r\n                return {\r\n                    id: l.id,\r\n                    title: l.title,\r\n                    features: l.features.filter(function (f) {\r\n                        return self.isFeatureAllowed(f);\r\n                    })\r\n                };\r\n            })\r\n            .filter(l => l.features.length);\r\n    };\r\n\r\n    ctlProto.getFeatureFromImportList = function (elm) {\r\n        const self = this;\r\n        const cb = elm.querySelector('input');\r\n        const layer = self.map.getLayer(elm.parentElement.parentElement.dataset.layerId);\r\n        if (layer) {\r\n            return layer.getFeatureById(cb.value);\r\n        }\r\n        return null;\r\n    };\r\n\r\n    ctlProto.importFeatures = function (features) {\r\n        const self = this;\r\n        let failure = false;\r\n        const layerEditData = self.getLayerEditData();\r\n        const featuresToImport = (features || self.featuresToImport || [])\r\n            .filter(f => {\r\n                const result = self.isFeatureAllowed(f);\r\n                if (!result) {\r\n                    failure = true;\r\n                }\r\n                return result;\r\n            });\r\n        featuresToImport.map(function (feature) {\r\n            let newFeature;\r\n            const featureOptions = {\r\n                data: feature.data,\r\n                geometryName: layerEditData.geometryName\r\n            };\r\n            if (self.isMultiple) {\r\n                switch (true) {\r\n                    case TC.feature.Polygon && feature instanceof TC.feature.Polygon:\r\n                        newFeature = new TC.feature.MultiPolygon([feature.geometry], featureOptions);\r\n                        break;\r\n                    case TC.feature.Polyline && feature instanceof TC.feature.Polyline:\r\n                        newFeature = new TC.feature.MultiPolyline([feature.geometry], featureOptions);\r\n                        break;\r\n                    default:\r\n                        newFeature = feature.clone();\r\n                        break;\r\n                }\r\n            }\r\n            else {\r\n                switch (true) {\r\n                    case TC.feature.MultiPolygon && feature instanceof TC.feature.MultiPolygon:\r\n                        newFeature = new TC.feature.Polygon(feature.geometry[0], featureOptions);\r\n                        break;\r\n                    case TC.feature.MultiPolyline && feature instanceof TC.feature.MultiPolyline:\r\n                        newFeature = new TC.feature.Polyline(feature.geometry[0], featureOptions);\r\n                        break;\r\n                    default:\r\n                        newFeature = feature.clone();\r\n                        break;\r\n                }\r\n            }\r\n            newFeature.setStyle(null);\r\n            return newFeature;\r\n        }).forEach(function (feature) {\r\n            self.layer.addFeature(feature);\r\n            self.trigger(TC.Consts.event.FEATUREADD, { feature: feature, layer: self.layer });\r\n        });\r\n        \r\n        if (failure) {\r\n            self.map.toast(self.getLocaleString('importFromOtherLayer.warning'), { type: TC.Consts.msgType.WARNING });\r\n        }\r\n    };\r\n\r\n    const handleCheck = function (ctl, checkbox) {\r\n        const feature = ctl.getFeatureFromImportList(checkbox.parentElement);\r\n        if (checkbox.checked) {\r\n            ctl.featuresToImport.push(feature);\r\n        }\r\n        else {\r\n            const idx = ctl.featuresToImport.indexOf(feature);\r\n            if (idx >= 0) {\r\n                ctl.featuresToImport.splice(idx, 1);\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto._addImportLayerEvents = function (li) {\r\n        const self = this;\r\n        \r\n        li.querySelector('input').addEventListener('change', function (e) {\r\n            const cb = this;\r\n            cb.parentElement.querySelectorAll('li.tc-feature input').forEach(function (ccb) {\r\n                if (ccb.checked !== cb.checked) {\r\n                    ccb.checked = cb.checked;\r\n                    handleCheck(self, ccb);\r\n                }\r\n            });\r\n            self.highlightFeatures([]);\r\n        });\r\n\r\n        li.querySelectorAll('li.tc-feature').forEach(function (elm) {\r\n            self._addImportFeatureEvents(elm);\r\n        });\r\n    };\r\n\r\n    ctlProto._addImportFeatureEvents = function (li) {\r\n        const self = this;\r\n        const highlightListener = function (e) {\r\n            const feature = self.getFeatureFromImportList(this);\r\n            if (feature) {\r\n                self.highlightFeatures([feature]);\r\n            }\r\n        };\r\n        li.addEventListener(TC.Consts.event.CLICK, highlightListener, { passive: true });\r\n        li.addEventListener('mouseover', highlightListener);\r\n        li.querySelector('input').addEventListener('change', function (e) {\r\n            handleCheck(self, this);\r\n        });\r\n    };\r\n\r\n    ctlProto.showFeatureImportPanel = function () {\r\n        const self = this;\r\n\r\n        self.featuresToImport = [];\r\n\r\n        self.getFeatureImportPanel().then(function (panel) {\r\n            const container = panel.getInfoContainer();\r\n            self.getRenderedHtml(self.CLASS + '-import', { layers: self.getAvailableFeaturesToImport() }, function (html) {\r\n                panel.open(html, container);\r\n                container.querySelector('ul').addEventListener('mouseout', function (e) {\r\n                    self.highlightFeatures([]);\r\n                });\r\n                container.querySelectorAll('li.tc-layer').forEach(function (elm) {\r\n                    self._addImportLayerEvents(elm);\r\n                });\r\n                container.querySelector(`.${self.CLASS}-import-btn-ok`).addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                    self.importFeatures();\r\n                    self.featureImportPanel.close();\r\n                }, { passive: true });\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.displayLayerToImport = function (layer) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (self.featureImportPanel && !self.featureImportPanel.div.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                const container = self.featureImportPanel.getInfoContainer();\r\n                const list = container.querySelector(`.${self.CLASS}-import-list .tc-layers`);\r\n                const layerElementSelector = `li[data-layer-id=\"${layer.id}\"]`;\r\n                const li = list.querySelector(layerElementSelector);\r\n                if (li) {\r\n                    features.forEach(function (feature) {\r\n                        if (self.isFeatureAllowed(feature)) {\r\n                            self.getRenderedHtml(self.CLASS + '-import-feature', layerObj, function (html) {\r\n                                li.insertAdjacentHTML('beforeend', html);\r\n                                self._addImportFeatureEvents(li.querySelector('li:last-child'));\r\n                            });\r\n                        }\r\n                    });\r\n                    resolve(li);\r\n                }\r\n                else {\r\n                    self.getRenderedHtml(self.CLASS + '-import-layer', { id: layer.id, title: layer.title, features: layer.features }, function (html) {\r\n                        list.insertAdjacentHTML('beforeend', html);\r\n                        const newLi = list.querySelector(layerElementSelector);\r\n                        self._addImportLayerEvents(newLi);\r\n                        resolve(newLi);\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                resolve(null);\r\n            }\r\n        });\r\n    };\r\n\r\n})();"]}