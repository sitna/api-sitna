{"version":3,"sources":["control/MultiFeatureInfo.js"],"names":["TC","control","FeatureInfoCommons","syncLoadJS","apiLocation","MultiFeatureInfo","Control","apply","this","arguments","modes","options","Consts","geom","POINT","POLYGON","featureInfoControl","lineFeatureInfoControl","polygonFeatureInfoControl","featureInfoControls","lastCtrlActive","popup","exportsState","inherit","ctlProto","prototype","CLASS","template","1","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","3","5","compiler","main","stack1","fn","program","inverse","noop","useData","mergeOptions","opt1","opt2","Util","extend","register","map","self","div","querySelectorAll","forEach","input","checked","Promise","resolve","reject","ctlPromises","styles","push","addControl","displayMode","persistentHighlights","then","POLYLINE","style","polygon","on","event","LAYERADD","LAYERREMOVE","LAYERVISIBILITY","e","updateUI","CONTROLACTIVATE","CONTROLDEACTIVATE","all","activate","render","callback","renderData","controlId","id","pointSelectValue","lineSelectValue","polygonSelectValue","_set1stRenderPromise","changeEvent","value","addEventListener","querySelector","CLICK","ctl","info","_infoHistory","resultsLayer","features","slice","f","downplayFeature","filterLayer","layer","removeFeature","passive","async","downloadDialog","getDownloadDialog","title","getLocaleString","fileName","_getFileName","elevation","displayElevation","assign","open","Array","concat","FEATUREREMOVE","some","FEATUREADD","FEATURESADD","isFunction","deactivate","renderPromise","enabled","workLayers","l","type","layerType","WMS","getVisibility","disabled","isActive","c","featuresUnavailable","every","length","delFeaturesBtn","classList","toggle","classes","HIDDEN","dlFeaturesBtn","displayValue","display","removeProperty"],"mappings":"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","sourcesContent":["TC.control = TC.control || {};\r\n\r\nif (!TC.control.FeatureInfoCommons) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/FeatureInfoCommons');\r\n}\r\n(function () {\r\n    TC.control.MultiFeatureInfo = function () {\r\n        var self = this;\r\n        TC.Control.apply(self, arguments);\r\n        self.modes = self.options.modes || {};\r\n        if (typeof self.modes[TC.Consts.geom.POINT] === 'undefined') {\r\n            self.modes[TC.Consts.geom.POINT] = true;\r\n        }\r\n        if (typeof self.modes[TC.Consts.geom.POLYGON] === 'undefined') {\r\n            self.modes[TC.Consts.geom.POLYGON] = true;\r\n        }\r\n        self.featureInfoControl = null;\r\n        self.lineFeatureInfoControl = null;\r\n        self.polygonFeatureInfoControl = null;\r\n        self.featureInfoControls = [];\r\n        self.lastCtrlActive = null;\r\n        self.popup = null;\r\n        self.exportsState = false; // Los controles que exportan estado son los hijos\r\n    };\r\n\r\n    TC.inherit(TC.control.MultiFeatureInfo, TC.control.FeatureInfoCommons);\r\n\r\n    var ctlProto = TC.control.MultiFeatureInfo.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-m-finfo';\r\n\r\n    ctlProto.template = TC.apiLocation + \"TC/templates/tc-ctl-m-finfo.hbs\";\r\n\r\n    const mergeOptions = function (opt1, opt2) {\r\n        if (opt1) {\r\n            if (opt1 === true) {\r\n                opt1 = {};\r\n            }\r\n            return TC.Util.extend(true, opt1, opt2);\r\n        }\r\n        return opt1;\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n\r\n        self.div.querySelectorAll('input[type=radio]').forEach(function (input) {\r\n            input.checked = false;\r\n        });\r\n\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            const ctlPromises = [TC.Control.prototype.register.call(self, map)]\r\n            const styles = self.options.styles || {};\r\n            if (self.modes[TC.Consts.geom.POINT]) {\r\n                ctlPromises.push(map.addControl(\"featureInfo\", mergeOptions(self.modes[TC.Consts.geom.POINT],\r\n                    {\r\n                        displayMode: self.options.displayMode,\r\n                        persistentHighlights: self.options.persistentHighlights\r\n                    })).then(function (control) {\r\n                        self.featureInfoControl = control;\r\n                        self.featureInfoControls.push(control);\r\n                        return control;\r\n                    }));\r\n            }\r\n            if (self.modes[TC.Consts.geom.POLYLINE]) {\r\n                ctlPromises.push(map.addControl(\"lineFeatureInfo\", mergeOptions(self.modes[TC.Consts.geom.POLYLINE],\r\n                    {\r\n                        displayMode: self.options.displayMode,\r\n                        persistentHighlights: self.options.persistentHighlights,\r\n                        style: styles.line\r\n                    })).then(function (control) {\r\n                        self.lineFeatureInfoControl = control;\r\n                        self.featureInfoControls.push(control);\r\n                        return control;\r\n                    }));\r\n            }\r\n            if (self.modes[TC.Consts.geom.POLYGON]) {\r\n                ctlPromises.push(map.addControl(\"polygonFeatureInfo\", mergeOptions(self.modes[TC.Consts.geom.POLYGON],\r\n                    {\r\n                        displayMode: self.options.displayMode,\r\n                        persistentHighlights: self.options.persistentHighlights,\r\n                        style: styles.polygon\r\n                    })).then(function (control) {\r\n                        self.polygonFeatureInfoControl = control;\r\n                        self.featureInfoControls.push(control);\r\n                        return control;\r\n                    }));\r\n            }\r\n\r\n            map.on(`${TC.Consts.event.LAYERADD} ${TC.Consts.event.LAYERREMOVE} ${TC.Consts.event.LAYERVISIBILITY}`, function (e) {\r\n                self.updateUI();\r\n            });\r\n\r\n            map.on(`${TC.Consts.event.CONTROLACTIVATE} ${TC.Consts.event.CONTROLDEACTIVATE}`, function (e) {\r\n                if (e.control === self.featureInfoControl || e.control === self.lineFeatureInfoControl || e.control === self.polygonFeatureInfoControl) {\r\n                    self.updateUI();\r\n                }\r\n            });\r\n\r\n            Promise.all(ctlPromises).then(function () {\r\n                if (self.featureInfoControl) {\r\n                    self.featureInfoControl.activate();\r\n                    self.lastCtrlActive = self.featureInfoControl;\r\n                }\r\n                self.updateUI();\r\n                resolve(self);\r\n            });\r\n        });\r\n\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        var renderData = { controlId: self.id };\r\n        if (self.modes[TC.Consts.geom.POINT]) {\r\n            renderData.pointSelectValue = TC.Consts.geom.POINT;\r\n        }\r\n        if (self.modes[TC.Consts.geom.POLYLINE]) {\r\n            renderData.lineSelectValue = TC.Consts.geom.POLYLINE;\r\n        }\r\n        if (self.modes[TC.Consts.geom.POLYGON]) {\r\n            renderData.polygonSelectValue = TC.Consts.geom.POLYGON;\r\n        }\r\n        return self._set1stRenderPromise(self.renderData(renderData,\r\n            function () {\r\n                var changeEvent = function () {\r\n                    switch (this.value) {\r\n                        case TC.Consts.geom.POLYLINE:\r\n                            //modo lÃ­nea\r\n                            self.lineFeatureInfoControl.activate();\r\n                            self.lastCtrlActive = self.lineFeatureInfoControl;\r\n                            break;\r\n                        case TC.Consts.geom.POLYGON:\r\n                            //modo poligono\r\n                            self.polygonFeatureInfoControl.activate();\r\n                            self.lastCtrlActive = self.polygonFeatureInfoControl;\r\n                            break;\r\n                        default:\r\n                            //modo point\r\n                            self.featureInfoControl.activate();\r\n                            self.lastCtrlActive = self.featureInfoControl;\r\n                            break;\r\n                    }\r\n                };\r\n                self.div.querySelectorAll('input[type=radio]').forEach(function (input) {\r\n                    input.addEventListener('change', changeEvent);\r\n                });\r\n\r\n                //URI bind del click del boton de borrar seleccionadas\r\n                const delFeaturesBtn = self.div.querySelector(`.${self.CLASS}-btn-remove`);\r\n                delFeaturesBtn.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                    self.featureInfoControls.forEach(ctl => {\r\n                        ctl.info = null;\r\n                        ctl._infoHistory = {};\r\n                        ctl.resultsLayer.features.slice().forEach(f => ctl.downplayFeature(f));\r\n                        ctl.filterLayer.features.slice().forEach(f => f.layer.removeFeature(f));\r\n                    });\r\n                }, { passive: true });\r\n\r\n                self.div.querySelector(`.${self.CLASS}-btn-dl`).addEventListener(TC.Consts.event.CLICK, async function (e) {\r\n                    const downloadDialog = await self.getDownloadDialog();\r\n                    let options = {\r\n                        title: self.getLocaleString(\"featureInfo\") + \" - \" + self.getLocaleString(\"download\"),\r\n                        fileName: self._getFileName()\r\n                    };\r\n\r\n                    if (self.map.elevation || self.options.displayElevation) {\r\n                        options = Object.assign({}, options, {\r\n                            elevation: Object.assign({}, self.map.elevation && self.map.elevation.options, self.options.displayElevation)\r\n                        });\r\n                    }\r\n                    downloadDialog.open(Array.prototype.concat.apply([], self.featureInfoControls.map(ctl => ctl.resultsLayer.features)), options);\r\n                }, { passive: true });\r\n\r\n                self.map\r\n                    //.on(TC.Consts.event.FEATUREINFO, function () {\r\n                    //    delFeaturesBtn.disabled = false;\r\n                    //})\r\n                    //.on(TC.Consts.event.NOFEATUREINFO, function (e) {\r\n                    //    if (e.control && e.control.filterFeature) {\r\n                    //        delFeaturesBtn.disabled = false;\r\n                    //    }\r\n                    //})\r\n                    .on(TC.Consts.event.FEATUREREMOVE, function (e) {\r\n                        if (self.featureInfoControls.some(ctl => ctl.resultsLayer === e.layer || ctl.filterLayer === e.layer)) {\r\n                            self.updateUI();\r\n                        }\r\n                    })\r\n                    .on(TC.Consts.event.FEATUREADD + ' ' + TC.Consts.event.FEATURESADD, function (e) {\r\n                        if (self.featureInfoControls.some(ctl => ctl.resultsLayer === e.layer || ctl.filterLayer === e.layer)) {\r\n                            self.updateUI();\r\n                        }\r\n                    });\r\n\r\n                if (TC.Util.isFunction(callback)) {\r\n                    callback();\r\n                }\r\n            }));\r\n    };\r\n\r\n    ctlProto.activate = function () {\r\n        var self = this;\r\n        if (self.lastCtrlActive)\r\n            self.lastCtrlActive.activate();\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        var self = this;\r\n        self.lastCtrlActive.deactivate(false);\r\n    };\r\n\r\n    ctlProto.updateUI = function () {\r\n        const self = this;\r\n        self.renderPromise().then(function () {\r\n            const enabled = self.map.workLayers.some(l => l.type === TC.Consts.layerType.WMS && l.getVisibility());\r\n            self.div.querySelectorAll('input').forEach(function (input) {\r\n                input.disabled = !enabled;\r\n            });\r\n            if (self.featureInfoControl) {\r\n                const input = self.div.querySelector(`input[value=${TC.Consts.geom.POINT}]`);\r\n                if (input) {\r\n                    input.checked = self.featureInfoControl.isActive;\r\n                }\r\n            }\r\n            if (self.lineFeatureInfoControl) {\r\n                const input = self.div.querySelector(`input[value=${TC.Consts.geom.POLYLINE}]`);\r\n                if (input) {\r\n                    input.checked = self.lineFeatureInfoControl.isActive;\r\n                }\r\n            }\r\n            if (self.polygonFeatureInfoControl) {\r\n                const input = self.div.querySelector(`input[value=${TC.Consts.geom.POLYGON}]`);\r\n                if (input) {\r\n                    input.checked = self.polygonFeatureInfoControl.isActive;\r\n                }\r\n            }\r\n\r\n            const persistentHighlights = self.featureInfoControls.some(c => c.options.persistentHighlights);\r\n            const featuresUnavailable = self.featureInfoControls.every(ctl => ctl.resultsLayer && ctl.resultsLayer.features.length === 0 && ctl.filterLayer && ctl.filterLayer.features.length === 0);\r\n            const delFeaturesBtn = self.div.querySelector(`.${self.CLASS}-btn-remove`);\r\n            delFeaturesBtn.classList.toggle(TC.Consts.classes.HIDDEN, !persistentHighlights);\r\n            delFeaturesBtn.disabled = featuresUnavailable;\r\n            const dlFeaturesBtn = self.div.querySelector(`.${self.CLASS}-btn-dl`);\r\n            dlFeaturesBtn.classList.toggle(TC.Consts.classes.HIDDEN, !persistentHighlights);\r\n            dlFeaturesBtn.disabled = featuresUnavailable;\r\n\r\n            // Hack para compensar bug de Edge: no se actualiza el estilo al cambiar el estado del radio.\r\n            const displayValue = self.div.style.display;\r\n            self.div.style.display = 'none';\r\n            if (displayValue) {\r\n                self.div.style.display = displayValue;\r\n            }\r\n            else {\r\n                self.div.style.removeProperty('display');\r\n            }\r\n        });\r\n    };\r\n\r\n})();"]}