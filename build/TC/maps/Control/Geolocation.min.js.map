{"version":3,"sources":["control/Geolocation.js"],"names":["Math","hypot","y","length","arguments","i","Infinity","sqrt","lastTime","vendors","hasPerformance","window","performance","now","x","max","requestAnimationFrame","cancelAnimationFrame","callback","element","currTime","Date","getTime","timeToCall","id","setTimeout","clearTimeout","rAF","startTime","timestamp","offset","this","TC","control","Control","syncLoadJS","apiLocation","infoShare","Consts","event","DIALOG","Geolocation","options","_classSelector","CLASS","_layerPromises","Const","Classes","ACTIVE","CLOSED","SELECTEDTRACK","DRAWACTIVATED","SIMULATIONACTIVATED","Selector","SIMULATE","DRAW","EDIT","DELETE","SAVE","CANCEL","EXPORT","SHARE","STOP","PAUSE","BACKWARD","FORWARD","SPEED","LocalStorageKey","TRACKING","TRACKINGTEMP","TRACKINGSHOWADVERTISEMENT","GPSSHOWADVERTISEMENT","TEST","Message","VALIDATENAME","Event","POSITIONCHANGE","GPSPOSITIONCHANGE","GPSPOSITIONERROR","STATEUPDATED","GPSADD","TRACKSNAPPING","DRAWTRACK","CLEARTRACK","IMPORTEDTRACK","MimeMap","KML","GPX","SupportedFileExtensions","Tabs","GPS","Layers","TRACK","apply","opts","_dialogDiv","Util","getDiv","dialogDiv","$","_$dialogDiv","document","body","appendChild","_shareDialogDiv","delta","walkingSpeed","snappingTolerance","notificationConf","exportsState","storageCRS","inherit","mix","ctlProto","prototype","CHART_SIZE","MIN_HEIGHT","MAX_HEIGHT","MIN_WIDTH","MEDIUM_WIDTH","MAX_WIDTH","featuresToShare","TOOLSCLOSE","TOOLSOPEN","template","compiler","main","container","depth0","helpers","partials","data","alias1","nullContext","alias2","escapeExpression","alias3","lambda","lookupProperty","parent","propertyName","Object","hasOwnProperty","call","name","hash","loc","start","line","column","end","useData","1","3","5","7","9","11","stack1","fn","program","inverse","noop","12","14","15","17","13","16","18","onFeatureRemove","e","self","layer","feature","wrap","simulateMarker","layerTrack","clearSelection","register","map","result","_bufferFeatures","hillDeltaThreshold","elevation","addLayer","getUID","type","layerType","VECTOR","owner","stealth","title","then","layerGPS","styles","point","radius","fillColor","fillOpacity","track","renderTrack","checked","bind","strokeColor","fontColor","labelOutlineColor","labelOutlineWidth","label","getData","trim","toLowerCase","strokeOpacity","strokeWidth","lineDash","layerTracking","fontSize","on","FEATURESIMPORT","featuresImport","fileName","target","dropTarget","kmlPattern","format","gpxPattern","indexOf","clear","importedGPX","concat","features","dropFilesCounter","zoomToFeatures","li","getLoadingIndicator","removeWait","_fileDropLoadingIndicator","off","importTrack","test","forEach","Point","setStyle","Polyline","working","isFunction","PROJECTIONCHANGE","elevationChartData","coords","reproject","oldCrs","newCrs","action","caller","onShowShareDialog","onShowDownloadDialog","assign","notification","tag","vibrate","renotify","requireInteraction","getLocaleString","getElevationControl","async","elevationControl","displayElevation","displayOn","resolution","addControl","_decorateChartPanel","resultsPanel","setCurrentFeature","that","currentFeature","filter","Marker","currentSelectedTrack","getSelectedTrack","uid","dataset","getDownloadFileName","render","getRenderedHtml","html","innerHTML","getDownloadDialog","_downloadDialog","controlId","createElement","_downloadDialogExtNode","content","firstChild","renderData","FEATUREREMOVE","isDisabled","toast","msgType","WARNING","wait","addWait","importedFileName","addPromises","len","push","addFeature","Promise","all","processImportedFeatures","notReproject","layout","accordion","div","classList","contains","classes","COLLAPSED","controls","ctl","containerControl","add","remove","querySelector","click","isShared","trigger","prepareFeaturesToShare","trackUid","resolve","reject","storageData","availableTracks","saved","toString","storageFeatures","pow","DEGREE_PRECISION","ol","GeoJSON","readFeatures","promises","Array","f","idx","Feature","createFeature","tcFeatures","fObj","geom","MARKER","POINT","POLYLINE","MultiPolyline","MULTIPOLYLINE","geometry","setFeaturesToShare","elem","filename","textContent","regex","RegExp","join","replace","getFormattedDate","Element","HTMLDocument","toShare","closeModal","onCloseShareDialog","selectedTrack","shareTrack","shareDialog","showModal","openCallback","closeCallback","interpolationPanel","checkboxElevations","allFeatures","originalDialogFeatures","getFeatures","every","currentOptions","getOptions","controlOptions","getDownloadDialogOptions","open","setOptions","modalBody","divToExtensions","radioDlSource","querySelectorAll","disableOriginalsRadio","condition","originalsRadio","DISABLED","feat","noZ","c","val","interpolationPanelIsHidden","HIDDEN","setInterpolationPanelVisibility","observer","MutationObserver","mutations","m","attributeName","mutation","oldValue","disconnect","config","attributes","attributeOldValue","observe","addEventListener","toggle","item","hasChangeEvent","featuresToDownload","value","featuresFromDialog","cachedProfile","getElevationProfileFromCache","toDownload","clone","setCoords","secondaryElevationProfileChartData","getCurrentPoints","LOADING","cachedFeature","getElevationFromServiceOnCache","console","log","tool","getElevationTool","cloned","setGeometry","crs","cacheElevationFromService","ERROR","duration","setFeatures","mdtRadio","dispatchEvent","sampleNumber","visibilityTrack","sel","span","CLICK","tagName","parentElement","newFormat","option","matches","passive","activateButton","deactivateButton","trackSearch","trackImportFile","trackSave","trackAdd","trackContinue","trackRenew","trackClose","trackAdvertisementOK","trackList","trackToolPanelOpened","_showAlerMsg","trackName","trackWPT","detectMobile","matchMedia","File","FileReader","FileList","Blob","disabled","form","insertBefore","reset","insertAdjacentElement","removeChild","_layerError","LAYERERROR","clearFileInput","alert","_cleaning","loadFiles","files","activateTracking","_activateTrackingBtns","deactivateTracking","_deactivateTrackingBtns","trackSearchListener","searchTerm","lis","from","style","display","trackLis","searchIcon","visibility","r","some","_filter","saveTrack","addWaypoint","list","_edit","edit","elm","input","focus","uiSimulate","simulate","editControls","simulateControls","cnt","parentNode","hidden","EventTarget","listenerBySelector","_loadTrack","_drawTrack","listElement","index","loadingState","scrollTop","offsetHeight","_stopOtherTracks","trackLiId","listItem","btnSimulate","btnPause","setAttribute","btnDraw","trackLi","drawTrack","simulate_paused","simulateTrack","removeTrack","editTrackName","showShareDialog","export","dialog","removeAttribute","simulateTrackEnd","simulate_speed","simulate_pausedElapse","_tracking","sessionTracking","storage","setSessionLocalValue","undefined","localforage","removeItem","checkboxes","loadJS","url","LOCALFORAGE","setItem","getAttribute","setVisibility","bindTracks","getShareDialog","activate","deactivate","markerStyle","lineStyle","setFormatInfoNewPosition","newPosition","locale","getMapLocale","on3DView","geoCoords","view3D","position","toLocaleString","mdt","round","getHeightFromMDT","isGeo","z","altitude","accuracy","speed","minimumFractionDigits","maximumFractionDigits","getTrackInfoPanel","_infoPanelPromise","infoPanel","ctlPromise","resultsPanelOptions","resize","titles","collapsed","addResultsPanelInfo","controlContainer","POSITION","RIGHT","getControlsByClass","toUpperCase","substring","resultsPanelInfo","renderInfoNewPosition","d","pd","isMinimized","ResultsPanel","panel","contentType","TABLE","close","renderPromise","collidingPriority","COLLIDING_PRIORITY","IGNORE","duringTrackingToolsPanel","currentPoint","formattedToStorage","advertisement","setTracking","isSupported","wakeLock","notifications","navigator","_ctlInstance","_onWindowBlurred","_onWindowFocused","_onWindowVisibility","keepWakeLock","request","err","error","requestWakeLock","addVideoKeepScreenOn","videoScreenOn","media","WebM","MP4","sourceWebM","src","sourceMP4","play","removeVideoKeepScreenOn","pause","onWindowFocused","paused","fromStorageToSession","onWindowVisibility","prefixes","getHiddenProperty","serviceWorker","controller","SWCacheClient","getServiceWorker","state","ready","showNotification","actions","location","href","ex","Notification","addWindowEvents","fromSessionToStorage","detectSafari","browserFeatures","touch","userAgent","match","getSessionLocalValue","JSON","stringify","getItem","showAdvertisement","registeredShowAdvertisement","checkbox","_askTracking","trackingAvailable","isActive","code","DOMException","QUOTA_EXCEEDED_ERR","webkitNotifications","_notifications","permission","requestPermission","_deactivateTracking","geopositionTracking","release","removeEventListener","hasCoordinates","getStoredTracks","tracks","onResolve","toResolve","elevationProfileCache","profile","parse","keys","k","exec","key","res","rej","v","results","tracksArray","_orderTracks","catch","sort","a","b","localeCompare","setStoredTracks","t","getAvailableTracks","_isEmpty","currentSelectedTrackId","newLi","DOMParser","parseFromString","setSelectedTrack","chartProgressClear","elevCtl","removeElevationTooltip","chartSetProgress","previous","current","distance","doneTime","isVisible","dist","done","parseInt","toFixed","hasSecondaryElevationProfileChartData","isArray","elev","elevCoords","eleCoordinates","splice","ele","ele2","Geometry","getNearest","iX","getProfilePanel","chart","tooltip","show","hideElevationMarker","_getTime","timeFrom","timeTo","diff","daysDifference","floor","hoursDifference","h","minutesDifference","s","extend","slice","hasElevation","elevationProfileChartData","min","activateSnapping","drawTrackingData","elevationTrack","elevationFromServiceCache","isOnCache","a1","a2","arr_diff","isLine","resized","onResize","doVisible","renderElevationProfile","getTrackingData","GeometryLayout","XYZM","XYZ","time","XYM","originalElevation","onlyOriginalElevation","ignoreCaching","trackUID","parseFloat","findIndex","resultsPanelChart","getVisibility","getOpacity","deactivateSnapping","RESULTSPANELMIN","RESULTSPANELCLOSE","displayElevationProfile","clearFeatures","closeElevationProfile","message","_save","formatted","clean","newTrack","getHashToCompare","trackObject","toGetHash","hex_md5","HASH","sameTrackUID","savedTrack","clonedTrack","jsonFormat","precision","explodeGeometry","compactGeometry","getGeometry","getCoordinates","setCoordinates","writeFeatures","getTrackIndex","random","waypointName","heading","trackId","newName","dataId","confirm","clearSelectedTrack","selected","showFeatures","coordinates","showsPopup","first","last","addMarker","cssClass","anchor","notExport","formattedFromStorage","fileInput","loading","LoadingIndicator","onGeolocateError","errorMsg","geolocation","currentPosition","clearWatch","currentPositionTrk","watch","currentPositionWaiting","PERMISSION_DENIED","POSITION_UNAVAILABLE","TIMEOUT","obj","exportState","doZoom","clonedToShare","layerState","trackResult","importState","enable","sharedTrackResult","featureOptions"],"mappings":"AAwBIA,KAAKC,MAAQD,KAAKC,OAAS,WAIvB,IAHA,IAAIC,EAAI,EACJC,EAASC,UAAUD,OAEdE,EAAI,EAAGA,EAAIF,EAAQE,IAAK,CAC7B,GAAID,UAAUC,KAAOC,EAAAA,GAAYF,UAAUC,MAAO,EAAA,EAC9C,OAAOC,EAAAA,EAEXJ,GAAKE,UAAUC,GAAKD,UAAUC,GAElC,OAAOL,KAAKO,KAAKL,KAGzB,WAMI,IALA,IAAIM,EAAW,EACXC,EAAU,CAAC,KAAM,MAAO,SAAU,KAElCC,KAAoBC,OAAOC,cAAeD,OAAOC,YAAYC,KAExDC,EAAI,EAAGC,EAAMN,EAAQN,OAAQW,EAAIC,IAAQJ,OAAOK,sBAAuBF,GAAK,EAAG,CACpFH,OAAOK,sBAAwBL,OAAOF,EAAQK,GAAK,yBACnDH,OAAOM,qBAAuBN,OAAOF,EAAQK,GAAK,yBAC3CH,OAAOF,EAAQK,GAAK,+BAG1BH,OAAOK,wBACRL,OAAOK,sBAAwB,SAAUE,EAAUC,GAC/C,IAAIC,GAAW,IAAIC,MAAOC,UACtBC,EAAavB,KAAKe,IAAI,EAAG,IAAMK,EAAWZ,IAC1CgB,EAAKb,OAAOc,WAAW,WAAcP,EAASE,EAAWG,IACzDA,GACJf,EAAWY,EAAWG,EACtB,OAAOC,IAIVb,OAAOM,uBACRN,OAAOM,qBAAuB,SAAUO,GACpCE,aAAaF,KAKrB,IAAKd,EAAgB,CAEjB,IAAIiB,EAAMhB,OAAOK,sBACbY,GAAa,IAAIP,KAGrBV,OAAOK,sBAAwB,SAAUE,EAAUC,GAU/CQ,EARc,SAAUE,GAIpB,OAAOX,EAFqBW,EAAY,KAAQA,EAAYA,EAAYD,IAM/DT,KA9CzB,IAkDC,WAEG,GAAKR,OAAOC,aAOL,GAAID,OAAOC,cAAgBD,OAAOC,YAAYC,IAAK,CACtDF,OAAOC,YAAYkB,OAAST,KAAKR,MACjCF,OAAOC,YAAYC,IAAM,WACrB,OAAOQ,KAAKR,MAAQF,OAAOC,YAAYkB,cAT3CnB,OAAOC,YAAc,CACjBkB,OAAQT,KAAKR,MACbA,IAAK,WACD,OAAOQ,KAAKR,MAAQkB,KAAKD,SANzC,GAiBAE,GAAGC,QAAUD,GAAGC,SAAW,GAEtBD,GAAGE,SACJF,GAAGG,WAAWH,GAAGI,YAAc,cAG9BJ,GAAGC,QAAQI,WACZL,GAAGG,WAAWH,GAAGI,YAAc,wBAGnCJ,GAAGM,OAAOC,MAAMC,OAASR,GAAGM,OAAOC,MAAMC,QAAU,YAEnDR,GAAGC,QAAQQ,YAAc,SAAUC,GACpBX,KACNY,eAAiB,IADXZ,KACsBa,MADtBb,KAGNc,eAAiB,GAHXd,KAKNe,MAAQ,CACTC,QAAS,CACLC,OAAQ,4BACRC,OAAQ,SACRC,cAAe,gBACfC,cAAe,iBACfC,oBAAqB,wBAEzBC,SAAU,CACNC,SAAU,mBACVC,KAAM,WACNC,KAAM,eACNC,OAAQ,iBACRC,KAAM,eACNC,OAAQ,iBACRC,OAAQ,iBACRC,MAAO,gBACPC,KAAM,eACNC,MAAO,gBACPC,SAAU,mBACVC,QAAS,kBACTC,MAAO,iBAEXC,gBAAiB,CACbC,SAAU,MACVC,aAAc,UACdC,0BAA2B,mBAC3BC,qBAAsB,mBACtBC,KAAM,QAEVC,QAAS,CACLC,aAAc,IAElBC,MAAO,CACHC,eAAgB,gCAChBC,kBAAmB,mCACnBC,iBAAkB,+BAClBC,aAAc,8BACdC,OAAQ,wBACRC,cAAe,+BACfC,UAAW,2BACXC,WAAY,4BACZC,cAAe,gCAEnBC,QAAS,CACLC,IAAK,uCACLC,IAAK,uBAETC,wBAAyB,CACrB,OACA,QAEJC,KAAM,CACFC,IAAK,OAETC,OAAQ,CACJD,IAAK,MACLE,MAAO,QACPxB,SAAU,aAIlBpC,GAAGE,QAAQ2D,MAnEA9D,KAmEY3B,WAEvB,IAAI0F,EAAOpD,GAAW,GArEXX,KAsENgE,WAAa/D,GAAGgE,KAAKC,OAAOH,EAAKI,WAClCvF,OAAOwF,IAvEApE,KAwEFqE,YAAcD,EAxEZpE,KAwEmBgE,aAEzBD,EAAKI,WACNG,SAASC,KAAKC,YA3EPxE,KA2EwBgE,YA3ExBhE,KA8ENyE,gBAAkBxE,GAAGgE,KAAKC,OAAO,IACtCI,SAASC,KAAKC,YA/EHxE,KA+EoByE,iBA/EpBzE,KAiFN0E,MAAQ,IAjFF1E,KAkFN2E,aAAe,IAlFT3E,KAoFN4E,kBApFM5E,KAoFmBW,QAAQiE,mBAAqB,GApFhD5E,KAsFN6E,iBAAmB,GAtFb7E,KAwFN8E,cAAe,EAxFT9E,KA0FN+E,WAAa,aAGtB9E,GAAG+E,QAAQ/E,GAAGC,QAAQQ,YAAaT,GAAGE,SACtCF,GAAGgF,IAAIhF,GAAGC,QAAQQ,YAAaT,GAAGC,QAAQI,YAE1C,WACI,IAAI4E,EAAWjF,GAAGC,QAAQQ,YAAYyE,UAEtCD,EAASrE,MAAQ,qBAEjBqE,EAASE,WAAa,CAClBC,WAAY,GACZC,WAAY,IAEZC,UAAW,IACXC,aAAc,IACdC,UAAW,KAGfP,EAASQ,gBAAkB,GAE3BzF,GAAGM,OAAOC,MAAMmF,WAAa1F,GAAGM,OAAOC,MAAMmF,YAAc,gBAC3D1F,GAAGM,OAAOC,MAAMoF,UAAY3F,GAAGM,OAAOC,MAAMoF,WAAa,eAEzDV,EAASW,SAAW,GACpBX,EAASW,SAASX,EAASrE,OAAS,CAACiF,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUQ,iBAAkBC,EAAOT,EAAUU,OAAQC,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,OAAYN,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,MAAM,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,GAAGC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,wTAAsUf,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,gGAAyGM,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,YAAmBM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,uBAAuB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAc,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,uBAAuB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,KAAKC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAc,oGAA4Gf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,uBAAuB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAc,+MAA4Nf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,+BAAwCf,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,yCAAiDM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,UAAU,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,kFAAsFf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,mBAAmB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,+BAAwCf,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,0CAAkDM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,aAAa,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,weAA0ff,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,6OAA2Pf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,eAAe,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,6FAAoGf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,YAAY,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,4KAAsLf,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,yLAAwMM,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,YAAmBM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,wBAAwB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,qBAAqB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,wRAAmSf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,2FAAgGf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,4CAAiDf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,4CAAiDf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,4CAAiDf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,kBAAkB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,wTAAkUf,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,8GAAuHM,EAAOE,EAAkB,MAAVR,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,oDAA6DM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,iBAAiB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,iBAAiB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,sJAA8Jf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,2BAA2B,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,qBAAqB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,qIAA6If,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,6BAA6B,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,uBAAuB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,yPAAqQf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,oBAAoB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,4HAAkIf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,oBAAoB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,oIAA+If,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,mBAAmB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,KAAKC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,+HAAqIf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,mBAAmB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,+MAA0Nf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,iBAAiB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,qCAAuCE,SAAU,GAC98VtC,EAASW,SAASX,EAASrE,MAAQ,eAAiB,CAACiF,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAOL,EAAUU,OAAQH,EAAOP,EAAUQ,iBAAkBC,EAAiB,MAAVR,EAAiBA,EAAUD,EAAUM,aAAe,GAAKK,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,gBAAsBN,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,MAAQA,EAASA,IAAc,eAAsBM,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,OAASA,EAASA,IAAc,wDAAiEM,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,QAAUA,EAASA,IAAc,KAAWM,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,QAAUA,EAASA,IAAc,yEAAmFM,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,QAAUA,EAASA,IAAc,mDAA4DM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,eAAe,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,6DAAsEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,kBAAkB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,gEAAyEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,cAAc,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,yDAAkEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,cAAc,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,iEAA0Ef,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,eAAe,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,oEAA6Ef,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,kBAAkB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,gEAAyEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,kBAAkB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,kEAA2Ef,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,iBAAiB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,mEAA4Ef,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,OAAO,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,qEAA8Ef,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,gBAAgB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,2DAAoEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,kBAAkB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,2DAAoEf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,gBAAgB,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,4BAA8BE,SAAU,GAC/lItC,EAASW,SAASX,EAASrE,MAAQ,wBAA0B,CAAC4G,EAAI,SAASzB,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAOL,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,6BAAkCR,EAAOM,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,wBAAwB,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,YAAiBjB,EAAOL,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,qBAAsByB,EAAI,SAAS1B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAAOb,EAAUQ,iBAAiBG,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,MAAM,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAUK,EAAI,SAAS3B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,MAAO,KAAMwB,EAAI,SAAS5B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAAOb,EAAUQ,iBAAiBG,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,MAAM,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAUO,EAAI,SAAS7B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,MAAO,KAAM0B,GAAK,SAAS9B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAI2B,EAAQ1B,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKK,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAA2b,OAAlbkB,EAASpB,EAAeT,EAAQ,UAAUc,KAAKX,EAAOM,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,KAAOA,EAAQ,EAAE,CAACgB,KAAO,KAAKC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,OAAO,CAACL,KAAO,SAASC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAMK,GAAK,SAASpC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,oDAA2Db,EAAUQ,iBAAiBR,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,qBAAsBoC,GAAK,SAASrC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAI2B,EAAQ1B,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKK,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAA8b,OAArbkB,EAASpB,EAAeT,EAAQ,UAAUc,KAAKX,EAAOM,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,QAAUA,EAAQ,EAAE,CAACgB,KAAO,KAAKC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,OAAO,CAACL,KAAO,SAASC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAMO,GAAK,SAAStC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,+CAAsDb,EAAUQ,iBAAiBR,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,QAAUA,EAASA,IAAc,sBAAuBsC,GAAK,SAASvC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,YAAiBb,EAAUQ,iBAAiBR,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,cAAeH,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAI2B,EAAQ1B,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUU,OAAQD,EAAOT,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,YAAmS,OAAjRkB,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,KAAOA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,GAAGC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAkBS,EAAS,IAAS,mBAA8T,OAArSA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAGA,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAkBS,EAAS,IAAS,YAAiBtB,EAAOF,EAAkB,MAAVN,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,4BAAuU,OAArS8B,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAGA,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAkBS,EAAS,IAAS,YAAiBtB,EAAOF,EAAkB,MAAVN,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,cAAuS,OAAnR8B,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,KAAOA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,KAAkS,OAAvRA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,QAAUA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,KAA+R,OAApRA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,KAAOA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAS,SAAUP,SAAU,GACxiPtC,EAASW,SAASX,EAASrE,MAAQ,WAAa,CAACiF,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,mOAAgPN,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,UAAU,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,gMAA2Mf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,qBAAqB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAc,qFAA4Ff,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,qBAAqB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,mFAA0Ff,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,wBAAwB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,yRAAsSf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,2BAA2B,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,uJAAkKf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,oBAAoB,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,kLAA+Lf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,+BAA+B,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAc,iLAA0Lf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,KAAK,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,gEAAiEE,SAAU,GAC75GtC,EAASW,SAASX,EAASrE,MAAQ,mBAAqB,CAAC4G,EAAI,SAASzB,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAAOb,EAAUQ,iBAAiBG,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,MAAM,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,SAAUI,EAAI,SAAS1B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,MAAO,KAAMuB,EAAI,SAAS3B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAOL,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,eAAoBR,EAAOM,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,mBAAmB,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,0BAA+BjB,EAAOL,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,YAAcA,EAASA,IAAc,gBAAiB2B,EAAI,SAAS5B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAAOb,EAAUQ,iBAAiBG,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,MAAM,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAUO,EAAI,SAAS7B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,MAAO,KAAM0B,GAAK,SAAS9B,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAOL,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,eAAoBR,EAAOM,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,gBAAgB,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,yBAA8BjB,EAAOL,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,SAAWA,EAASA,IAAc,kBAAmBuC,GAAK,SAASxC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAI2B,EAAQpB,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,gBAAgX,OAA1VkB,EAASpB,EAAeT,EAAQ,MAAMc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAe,MAAVL,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAGA,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAS,0BAA+B/B,EAAUQ,iBAAiBR,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,gBAAiBoC,GAAK,SAASrC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIO,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,OAAOb,EAAUQ,iBAAiBG,EAAeT,EAAQ,QAAQc,KAAe,MAAVf,EAAiBA,EAAUD,EAAUM,aAAe,GAAI,MAAM,CAACW,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,SAAUmB,GAAK,SAASzC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,MAAO,KAAMsC,GAAK,SAAS1C,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,sBAA4BN,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,aAAa,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,MAAM,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,KAAUf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,MAAM,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAa,0BAA+Bf,EAAOP,EAAUU,OAAkB,MAAVT,EAAiBU,EAAeV,EAAO,OAASA,EAASA,IAAc,gBAAiBH,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAI2B,EAAQ1B,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUU,OAAQD,EAAOT,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,gFAA6X,OAArSkB,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAGA,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAkBS,EAAS,IAAS,0BAA+BtB,EAAOF,EAAkB,MAAVN,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,cAA4S,OAAxR8B,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,YAAcA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,GAAGC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAkBS,EAAS,IAAS,yCAAsV,OAAvSA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAG8B,QAAUlC,EAAUiC,QAAQ,EAAG7B,EAAM,GAAGA,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,IAAIC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAS,0BAA+BtB,EAAOF,EAAkB,MAAVN,EAAiBU,EAAeV,EAAO,KAAOA,EAASA,IAAc,cAA4S,OAAxR8B,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,SAAWA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAS,6BAAuT,OAApRA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,KAAOA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,KAAiS,OAAtRA,EAASpB,EAAeT,EAAQ,MAAMc,KAAKX,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,OAASA,EAAQ,CAACgB,KAAO,KAAKC,KAAO,GAAGc,GAAKhC,EAAUiC,QAAQ,GAAI7B,EAAM,GAAG8B,QAAUlC,EAAUmC,KAAK/B,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,GAAGC,OAAS,GAAGC,IAAM,CAACF,KAAO,GAAGC,OAAS,QAAkBS,EAAS,IAAS,iCAAkCP,SAAU,GAC76PtC,EAASW,SAASX,EAASrE,MAAQ,eAAiB,CAACiF,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAOL,EAAUU,OAAQH,EAAOP,EAAUQ,iBAAkBC,EAAiB,MAAVR,EAAiBA,EAAUD,EAAUM,aAAe,GAAKK,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,6GAAuHN,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,6DAAqEM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,+BAA+B,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,+EAAuFf,EAAOF,EAAkB,MAAVJ,EAAiBU,EAAeV,EAAO,aAAeA,EAASA,IAAc,0DAAmEM,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,YAAY,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,KAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKP,EAAO,MAAM,CAACQ,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,yCAA0CE,SAAU,GAC/lDtC,EAASW,SAASX,EAASrE,MAAQ,iBAAmB,CAACiF,SAAW,CAAC,EAAE,YAAYC,KAAO,SAASC,EAAUC,EAAOC,EAAQC,EAASC,GAAW,IAAIC,EAAiB,MAAVJ,EAAiBA,EAAUD,EAAUM,aAAe,GAAKC,EAAOP,EAAUQ,iBAAkBG,EAAiBX,EAAUW,gBAAkB,SAASC,EAAQC,GAAuB,GAAIC,OAAO3B,UAAU4B,eAAeC,KAAKJ,EAAQC,GAA0B,OAAOD,EAAOC,IAAuD,MAAO,mPAAgQN,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,cAAc,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,MAAWf,EAAOI,EAAeT,EAAQ,QAAQc,KAAKX,EAAO,QAAQ,CAACY,KAAO,OAAOC,KAAO,GAAGd,KAAOA,EAAKe,IAAM,CAACC,MAAQ,CAACC,KAAO,EAAEC,OAAS,IAAIC,IAAM,CAACF,KAAO,EAAEC,OAAS,QAAa,iPAAwPE,SAAU,GAE10C,IAAImB,EAAkB,SAAUC,GAC5B,MAAMC,EAAO7I,KACC4I,EAAEE,MAEZF,EAAEG,UAAYF,EAAKG,KAAKC,gBAIxBL,EAAEE,QAAUD,EAAKK,YACjBL,EAAKM,kBAIbjE,EAASkE,SAAW,SAAUC,GAC1B,MAAMR,EAAO7I,KACPsJ,EAASrJ,GAAGE,QAAQgF,UAAUiE,SAASpC,KAAK6B,EAAMQ,GAExDR,EAAKG,KAAO,IAAI/I,GAAG+I,KAAK9I,QAAQQ,YAAYmI,GAC5CA,EAAKG,KAAKI,SAASC,GAEnBA,EAAIE,gBAAkB,GAEtBV,EAAKW,mBAAuBX,EAAKlI,SAAWkI,EAAKlI,QAAQ6I,oBACpDX,EAAKQ,IAAI1I,QAAQ8I,WAAaZ,EAAKQ,IAAI1I,QAAQ8I,UAAUD,oBAC1D,GAEJH,EAAIK,SAAS,CACTjK,GAAIoJ,EAAKc,SACTC,KAAM3J,GAAGM,OAAOsJ,UAAUC,OAC1BC,MAAOlB,EACPmB,SAAS,EACTC,MAAO,mBACRC,KAAK,SAAUpB,GACdD,EAAKsB,SAAWrB,IAEpBO,EAAIK,SAAS,CACTjK,GAAIoJ,EAAKc,SACTC,KAAM3J,GAAGM,OAAOsJ,UAAUC,OAC1BC,MAAOlB,EACPmB,SAAS,EACTC,MAAO,sBACPG,OAAQ,CACJC,MAAO,CACHC,OAAQ,EACRC,UAAW,UACXC,YAAa,WACT,OAAOxK,KAAKyK,MAAMC,YAAYC,QAAU,EAAI,GAC9CC,KAAK/B,GACPgC,YAAa,UACbC,UAAW,UACXC,kBAAmB,UACnBC,kBAAmB,EACnBC,MAAO,SAAUlC,GACb,IAAI9B,EAAO8B,EAAQmC,UAAgB,KAOnC,OALIjE,EADAA,IAASA,EAAO,IAAIkE,OAAO/M,OAAS,GAC5B6I,EAAO,IAAIkE,OAAOC,cAEnB,KAMnB/D,KAAM,CACFgE,cAAe,WACX,OAAOrL,KAAKyK,MAAMC,YAAYC,QAAU,EAAI,GAC9CC,KAAK/B,GACPyC,YAAa,EACbT,YAAa,UACbU,SAAU,CAAC,GAAI,OAGxBrB,KAAK,SAAUpB,GACdD,EAAK2C,cAAgB1C,IAEzBO,EAAIK,SAAS,CACTjK,GAAIoJ,EAAKc,SACTC,KAAM3J,GAAGM,OAAOsJ,UAAUC,OAC1BC,MAAOlB,EACPmB,SAAS,EACTC,MAAO,mBACPG,OAAQ,CACJ/C,KAAM,CACFiE,YAAa,EACbT,YAAa,WAEjBR,MAAO,CACHC,OAAQ,SAAUvB,GACd,IAAI9B,EAAO8B,EAAQmC,UAAgB,KACnC,OAAIjE,IAASA,EAAO,IAAIkE,OAAO/M,OAAS,EAC7B,EAEA,GAKfmM,UAAW,UACXM,YAAa,UACbC,UAAW,UACXW,SAAU,GACVV,kBAAmB,UACnBC,kBAAmB,EACnBC,MAAO,SAAUlC,GACb,IAAI9B,EAAO8B,EAAQmC,UAAgB,KAOnC,OALIjE,EADAA,IAASA,EAAO,IAAIkE,OAAO/M,OAAS,GAC5B6I,EAAO,IAAIkE,OAAOC,cAEnB,QAOxBlB,KAAK,SAAUpB,GACdD,EAAKK,WAAaJ,IAGtBO,EAAIqC,GAAGzL,GAAGM,OAAOC,MAAMmL,eAAgB,SAAU/C,GAC7C,MAAMC,EAAO7I,KAEP4L,EAAiB,SAAUhD,GAC7B,MAAMiD,EAAWjD,EAAEiD,SACbC,EAASlD,EAAEmD,WACjB,IAAIC,EAAa,IAAM/L,GAAGM,OAAO0L,OAAO1I,IAAI6H,cACxCc,EAAa,IAAMjM,GAAGM,OAAO0L,OAAOzI,IAAI4H,cAG5C,GAAIS,EAAST,cAAce,QAAQD,KAAgBL,EAASzN,OAAS8N,EAAW9N,QAE3EyN,EAAST,cAAce,QAAQH,KAAgBH,EAASzN,OAAS4N,EAAW5N,QAAU0N,IAAWjD,EAAO,CAEzGA,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAC7B,MAAMwI,EAAc,WAEhB3M,WAAW,WACPmJ,EAAKQ,IAAIE,gBAAkBV,EAAKQ,IAAIE,gBAAgB+C,OAAO1D,EAAE2D,UAC7D3N,OAAO4N,mBACP,GAAyB,IAArBA,iBAAwB,CACxB3D,EAAKQ,IAAIoD,eAAe5D,EAAKQ,IAAIE,iBACjCV,EAAKQ,IAAIE,gBAAkB,UACpB3K,OAAO4N,iBACd,IAAIE,EAAK7D,EAAKQ,IAAIsD,sBAClB,GAAID,EAAI,CACJA,EAAGE,WAAW/D,EAAKQ,IAAIwD,2BACvBhE,EAAKQ,IAAIwD,0BAA4B,KAEzChE,EAAKiE,IAAIjE,EAAK9H,MAAM6B,MAAMS,cAAegJ,KAE9C,IAGPxD,EAAK6C,GAAG7C,EAAK9H,MAAM6B,MAAMS,cAAegJ,GACxCxD,EAAKkE,YAAYnE,GAEb,SAASoE,KAAKnB,EAAST,gBAAkBvC,EAAKK,YAC1CL,EAAKK,WAAWkB,QAChBvB,EAAKK,WAAWqD,SAASU,QAAQ,SAAUlE,GACnC9I,GAAG8I,QAAQmE,OAASnE,aAAmB9I,GAAG8I,QAAQmE,OAASrE,EAAKK,WAAWkB,OAAOC,MAClFtB,EAAQoE,SAAStE,EAAKK,WAAWkB,OAAOC,OACjCpK,GAAG8I,QAAQqE,UAAYrE,aAAmB9I,GAAG8I,QAAQqE,UAAYvE,EAAKK,WAAWkB,OAAO/C,MAC/F0B,EAAQoE,SAAStE,EAAKK,WAAWkB,OAAO/C,UAWhE,GAAIwB,EAAKwE,SAAWpN,GAAGgE,KAAKqJ,WAAWzE,EAAKwE,QAAQnD,MAChDrB,EAAKwE,QAAQnD,KAAK0B,EAAehD,QAC9B,CACHC,EAAKwE,SAAU,EACfzB,EAAehD,KAGrBgC,KAAK/B,IAEPQ,EAAIqC,GAAGzL,GAAGM,OAAOC,MAAM+M,iBAAkB,SAAU3E,GAC3CC,EAAK2E,qBACL3E,EAAK2E,mBAAmBC,OAASxN,GAAGgE,KAAKyJ,UAAU7E,EAAK2E,mBAAmBC,OAAQ7E,EAAE+E,OAAQ/E,EAAEgF,WAIvGvE,EAAIqC,GAAGzL,GAAGM,OAAOC,MAAMC,OAAQ,SAAUmI,GACrC,GAAIA,EAAE1I,QACF,OAAQ0I,EAAEiF,QACN,IAAK,QACGjF,EAAE1I,QAAQ4N,SAAWjF,GACrBA,EAAKkF,kBAAkBnF,EAAE1I,QAAQ4N,QAErC,MACJ,IAAK,WACDjF,EAAKmF,qBAAqBpF,EAAE1I,QAAQ4N,WAMpDjF,EAAKhE,iBAAmBiC,OAAOmH,OAAOpF,EAAKlI,QAAQuN,cAAgB,GAAI,CACnEC,IAAK,oBACLC,QAAS,CAAC,KACVC,UAAU,EACVC,oBAAoB,EACpB/J,KAAMsE,EAAK0F,gBAAgB,8BAC5B,CACKtE,MAAOpB,EAAKlI,QAAQuN,cAAgBrF,EAAKlI,QAAQuN,aAAajE,MAAQpB,EAAK0F,gBAAgB1F,EAAKlI,QAAQuN,aAAajE,OAAS3F,SAAS2F,QAG/I,OAAOX,GAGXpE,EAASsJ,oBAAsBC,iBAC3B,MAAM5F,EAAO7I,KAEb,IAAK6I,EAAK6F,iBAAkB,CACxB,IAAI/N,EAAU,IACTkI,EAAKlI,QAAQgO,kBAAoB9F,EAAKlI,QAAQiO,UAC/CjO,EAAQiO,UAAY/F,EAAKlI,QAAQiO,UAC1B/F,EAAKlI,QAAQgO,mBACpBhO,EAAUkI,EAAKlI,QAAQgO,kBAEvB9F,EAAKlI,QAAQoG,eAAe,cAC5BpG,EAAQkO,WAAahG,EAAKlI,QAAQkO,WAElClO,EAAQkO,WAAa,EAEzBhG,EAAK6F,uBAAyB7F,EAAKQ,IAAIyF,WAAW,YAAanO,GAE/DkI,EAAK6F,iBAAiBK,oBAAsB,WACxC/O,KAAKgP,aAAaC,kBAAoB,SAAUlG,GAC5C,MAAMmG,EAAOlP,KACbkP,EAAKC,eAAiBtG,EAAKK,WAAWqD,SAAS6C,OAAQrG,KAC1C9I,GAAG8I,QAAQsG,QAAUtG,aAAmB9I,GAAG8I,QAAQsG,QAAapP,GAAG8I,QAAQmE,OAASnE,aAAmB9I,GAAG8I,QAAQmE,QAC5H,GACH,MAAMoC,EAAuBzG,EAAK0G,mBAClC,GAAID,EAAsB,CACtBJ,EAAKC,eAAeK,IAAMF,EAAqBG,QAAQD,IACvDN,EAAKC,eAAetD,SAAW6D,EAAoB1I,KAAK6B,EAAMyG,MAO9E,OAAOzG,EAAK6F,kBAGhBxJ,EAASyK,OAAS,SAAUxQ,GACxB,MAAM0J,EAAO7I,KACb,OAAO6I,EAAK+G,gBAAgB/G,EAAKhI,MAAQ,UAAW,KAAM,SAAUgP,GAChEhH,EAAK7E,WAAW8L,UAAYD,IAC7B3F,KAAK,WACJ,OAAOrB,EAAKkH,oBAAoB7F,KAAK,KACjCrB,EAAKmH,gBAAgBlC,OAASjF,EAC9BA,EAAK+G,gBAAgB/G,EAAKhI,MAAQ,cAAe,CAAEoP,UAAWpH,EAAKpJ,IAAM,SAAUoQ,GAC/E,IAAIhK,EAAWvB,SAAS4L,cAAc,YACtCrK,EAASiK,UAAYD,EACrBhH,EAAKsH,uBAAyBtK,EAASuK,QAAUvK,EAASuK,QAAQC,WAAaxK,EAASwK,WACxFxH,EAAK+G,gBAAgB/G,EAAKhI,MAAQ,gBAAiB,GAAI,SAAUgP,GAC7DhH,EAAKpE,gBAAgBqL,UAAYD,EACjC,OAAOhH,EAAKyH,WAAW,CAAEL,UAAWpH,EAAKpJ,IAAMN,YAOnE+F,EAAS6H,YAAc,SAAUpM,GAC7B,IAAIkI,EAAO7I,KACX6I,EAAKQ,IAAIyD,IAAI7M,GAAGM,OAAOC,MAAM+P,cAAe5H,GAC5C,GAAKE,EAAK2H,WAmCC,SAASxD,KAAKrM,EAAQkL,SAAST,gBACtCvC,EAAKQ,IAAIoH,MAAM5H,EAAK0F,gBAAgB,2BAA4B,CAAE3E,KAAM3J,GAAGM,OAAOmQ,QAAQC,eAnC1F,GAAIhQ,EAAQkL,UAAYlL,EAAQ4L,UAAY5L,EAAQ4L,SAASnO,OAAS,EAAG,CACrE,IAAIwS,EAAO/H,EAAK8D,sBAAsBkE,UACtChI,EAAKiI,iBAAmBnQ,EAAQkL,SAChC,MAAMkF,EAAc,GACpB,IAAK,IAAIzS,EAAI,EAAG0S,EAAMrQ,EAAQ4L,SAASnO,OAAQE,EAAI0S,EAAK1S,IACpDyS,EAAYE,KAAKpI,EAAKK,WAAWgI,WAAWvQ,EAAQ4L,SAASjO,KAEjE6S,QAAQC,IAAIL,GAAa7G,KAAK,WAC1BrB,EAAKG,KAAKqI,wBAAwB,CAAET,KAAMA,EAAMU,aAAc3Q,EAAQ2Q,eACtE,GAAIzI,EAAKK,WAAY,CAEbL,EAAKQ,KAAOR,EAAKQ,IAAIkI,QAAU1I,EAAKQ,IAAIkI,OAAOC,WAC3C3I,EAAK4I,IAAIC,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQC,YAC9ChJ,EAAKQ,IAAIyI,SACJ1C,OAAO,SAAU2C,GAEd,OAAOA,IAAQlJ,IAASkJ,EAAIC,mBAE/B/E,QAAQ,SAAU8E,GACfA,EAAIN,IAAIC,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQC,aAKxDhJ,EAAK4I,IAAIC,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQC,WAC5ChJ,EAAK4I,IAAIU,cAAc,IAAMtJ,EAAKhI,MAAQ,sBAAsBuR,QAE3DzR,EAAQ0R,UAETxJ,EAAKQ,IAAIiJ,QAAQrS,GAAGM,OAAOC,MAAMoF,gBAUzDV,EAASqN,uBAAyB,SAAU5R,GACxC,MAAMkI,EAAO7I,KACb,IAAIwS,EAAW7R,EAAQ6O,IACvB,OAAO,IAAI2B,QAAQ,SAAUsB,EAASC,GAClC,GAAIF,EAAU,CACV,IAAIG,EAAc9J,EAAK+J,gBAAgBxD,OAAO,SAAUyD,GACpD,OAAOA,EAAMrD,IAAIsD,aAAeN,EAASM,aAC1C,GAAG1M,KAKF2M,GAFY9U,KAAK+U,IAAI,GAAI/S,GAAGM,OAAO0S,iBAAmB,IAEpC,IAAIC,GAAGjH,OAAOkH,SAAUC,aAAaT,IAC3D,MAAMU,EAAW,IAAIC,MAAMP,EAAgB3U,QAC3C2U,EAAgB9F,QAAQ,SAAUsG,EAAGC,GACjCH,EAASG,GAAOvT,GAAG+I,KAAKyK,QAAQC,cAAcH,KAGlDpC,QAAQC,IAAIiC,GAAUnJ,KAAK,SAAUyJ,GACjC,IAAIpH,EAAWoH,EAAWtK,IAAI,SAAUkK,GACpC,MAAMK,EAAO,GAEb,QAAQ,GACJ,KAAK3T,GAAG8I,QAAQsG,QAAUkE,aAAatT,GAAG8I,QAAQsG,OAC9CuE,EAAKhK,KAAO3J,GAAGM,OAAOsT,KAAKC,OAC3B,MACJ,KAAK7T,GAAG8I,QAAQmE,OAASqG,aAAatT,GAAG8I,QAAQmE,MAC7C0G,EAAKhK,KAAO3J,GAAGM,OAAOsT,KAAKE,MAC3B,MACJ,KAAK9T,GAAG8I,QAAQqE,UAAYmG,aAAatT,GAAG8I,QAAQqE,SAChDwG,EAAKhK,KAAO3J,GAAGM,OAAOsT,KAAKG,SAC3B,MACJ,KAAK/T,GAAG8I,QAAQkL,eAAiBV,aAAatT,GAAG8I,QAAQkL,cACrDL,EAAKhK,KAAO3J,GAAGM,OAAOsT,KAAKK,cAGnCN,EAAKnU,GAAK8T,EAAE9T,GACZmU,EAAKC,KAAON,EAAEY,SACdP,EAAKxN,KAAOmN,EAAErI,UAEd,OAAO0I,IAGPjT,EAAQyT,qBACRvL,EAAKnD,gBAAkB6G,GAE3BkG,EAAQlG,UAGZmG,OAOZ,MAAMhD,EAAsB,SAAU2E,GAElC,IAAIC,EAAWD,EAAKlC,cAAc,QAAQoC,YACtCC,EAAQ,IAAIC,OAFHzU,KAEee,MAAM0C,wBAAwBiR,KAAK,KAAM,MACrE,OAAOJ,EAASK,QAAQH,EAAO,IAAM,IAAMvU,GAAGgE,KAAK2Q,iBAAiB,IAAItV,MAAQ,IAyBpF4F,EAAS6I,kBAAoB,SAAUD,GACnC,MAAMjF,EAAO7I,KACb,GAAI8N,aAAkB+G,SAAW/G,aAAkBgH,aAC/C,OAAIhH,EAAO4D,UAAUC,SAAS9I,EAAKhI,MAAQ,iBAChCZ,GAAGC,QAAQI,UAAUyN,kBAAkB/G,KAAK6B,GAE5CsI,QAAQsB,UAEhB,GAAI3E,IAAWjF,EAClB,OAAO5I,GAAGC,QAAQI,UAAUyN,kBAAkB/G,KAAK6B,GAE9CiF,IAAWjF,GAChBiF,EAAOiH,SACPjH,EAAOiH,QAAQhM,SACf+E,EAAOiH,QAAQhM,QAAQD,QAAUD,EAAKK,YAEtCjJ,GAAGgE,KAAK+Q,WAAW,WACf/U,GAAGC,QAAQI,UAAU2U,mBAAmBjO,KAAK8G,GAC7C,MAAMoH,EAAgBrM,EAAK0G,mBAC3B,OAAI2F,EACOrM,EAAKsM,WAAWD,GAAehL,KAAK,WACvC,MAAMkL,EAAcvM,EAAKpE,gBAAgB0N,cAAc,IAAMtJ,EAAKhI,MAAQ,iBAC1EZ,GAAGgE,KAAKoR,UAAUD,EAAa,CAC3BE,aAAc,WACV,OAAOrV,GAAGC,QAAQI,UAAUyN,kBAAkB/G,KAAK6B,IAEvD0M,cAAe,WACXtV,GAAGC,QAAQI,UAAU2U,mBAAmBjO,KAAK6B,QAMlDsI,QAAQsB,aAM/B,IAAI+C,EAAqB,KAErBC,EAAqB,KACzBvQ,EAAS8I,qBAAuB,SAAUF,EAAQ4H,GAC9C,MAAM7M,EAAO7I,KAGP2V,EAAyB9M,EAAKmH,gBAAgB4F,cAGpD,GAAI9H,IAAWjF,GAAQA,EAAKmH,gBAAgB4F,cAAcC,MAAMtC,GAAKA,GAAKA,EAAEzK,QAAUD,EAAKK,YAAa,CACpG,IAAI4M,EAAiBjN,EAAKmH,gBAAgB+F,aACtCC,EAAiBnN,EAAKoN,2BAC1BH,EAAerM,UAAYuM,EAAevM,iBACnCqM,EAAeR,aAEtBzM,EAAKmH,gBAAgBkG,KAAKrN,EAAKmH,gBAAgB4F,cAAeE,GAI5B,IAAlCH,EAAuBvX,QAAgBuX,EAAuBE,MAAOtC,GAAMA,GAAKA,EAAE1H,WAClFhD,EAAKmH,gBAAgBmG,WAAW,CAAEtK,SAAU8J,EAAuB,GAAG9J,WAI1E,GAAKhD,EAAKlI,QAAQgO,mBAKdb,IAAWjF,GAAQA,EAAKmH,gBAAgB4F,cAAcC,MAAMtC,GAAKA,GAAKA,EAAEzK,QAAUD,EAAKK,eAClFL,EAAKmH,gBAAgBoG,UAAUjE,cAAc,IAAMtJ,EAAKhI,MAAQ,eAAgB,CACjF,IAAIwV,EAAkBxN,EAAKmH,gBAAgBoG,UAAUjE,cAAc,IAAMtJ,EAAKmH,gBAAgBnP,MAAQ,QACtG,GAAIwV,EAAiB,CACjBA,EAAgB7R,YAAYqE,EAAKsH,wBAEjCsF,EAAqB5M,EAAKmH,gBAAgBoG,UAAUjE,cAAc,IAAMtJ,EAAKmH,gBAAgBnP,MAAQ,gCACrG2U,EAAqB3M,EAAKmH,gBAAgBoG,UAAUjE,cAAc,IAAMtJ,EAAKmH,gBAAgBnP,MAAQ,OACrG,MAAMyV,EAAgBzN,EAAKmH,gBAAgBoG,UAAUG,4CAA4C1N,EAAKpJ,sBAGhG+W,EAAwB,SAAUC,GACpC,MAAMC,EAAiBJ,EAAc,GACjCG,EACKC,EAAehF,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQ+E,WACrDD,EAAehF,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQ+E,UAGnDD,EAAehF,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQ+E,WAG1D,IAAI5N,EAAU4M,EAAuBvG,OAAQwH,GAClC3W,GAAG8I,QAAQqE,UAAYwJ,aAAgB3W,GAAG8I,QAAQqE,UAC1D,GAECyJ,GADQ9N,EAAQoL,SAAS,GACY,IAA/BpL,EAAQoL,SAAS,GAAG/V,QAC1ByY,EACAL,EAAsBK,GACf9N,EAAQoL,SAAS,GAAG/V,OAAS,GACpCoY,EAAsBzN,EAAQoL,SAAS9K,IAAKyN,GAAMA,EAAE,IAAIjB,MAAOkB,GAAgB,IAARA,IAI3E,MAAMC,EAA6B,WAC/B,OAAOxB,GAAsBA,EAAmB9D,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQqF,SAEnFC,EAAkC,WACpC,GAAIZ,EAAc,GAAG3L,UAAYqM,IAC7BxB,EAAmB9D,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,aAChD,GAAIX,EAAc,GAAG3L,QAAS,CACjC,IAAIwM,EAAW,IAAIC,iBAAiB,SAAUC,GAC1CA,EAAUjI,OAAOkI,GAAyB,UAApBA,EAAEC,eAA2BtK,QAAQ,SAAUuK,GACjE,GAAIA,EAASC,SAAStL,QAAQlM,GAAGM,OAAOqR,QAAQqF,SAAW,EACvD,GAAIX,EAAc,GAAG3L,QAAS,CAC1B6K,EAAmB9D,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QACnDE,EAASO,kBAETP,EAASO,iBAMrBC,EAAS,CAAEC,YAAY,EAAMC,mBAAmB,GACpDV,EAASW,QAAQtC,EAAoBmC,QAEjCX,KAAgCvB,EAAmB9K,SACnD6K,EAAmB9D,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,SAKlE,GAAIxB,EAAoB,CACpB,GAAIA,EAAmB9K,QAAS,CAC5BuM,IACArO,EAAKsH,uBAAuBuB,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,aACvDpO,EAAKsH,uBAAuBuB,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQqF,SACzEpO,EAAKsH,uBAAuBuB,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAEhExB,EAAmBsC,iBAAiB,SAAU,WAC1Cb,IACArO,EAAKsH,uBAAuBuB,UAAUsG,OAAO/X,GAAGM,OAAOqR,QAAQqF,UAIvE,GAAIX,EAAe,CACfY,IACAZ,EAAcrJ,QAAQgL,IAClB,IAAIA,EAAKxI,QAAQyI,eAAjB,CAGAD,EAAKxI,QAAQyI,gBAAiB,EAC9BD,EAAKF,iBAAiB,SAAUtJ,eAAgB7F,GAC5C,GAAIA,EAAEkD,OAAOnB,QAAS,CAClBuM,IACA,IAAIiB,EACJ,GA/GR,UA+GYvP,EAAEkD,OAAOsM,MACTD,EAAqBxC,MAClB,CACH,IAAI0C,EAAqB1C,EACrB5M,EAAUsP,EAAmBjJ,OAAQwH,GAC9B3W,GAAG8I,QAAQqE,UAAYwJ,aAAgB3W,GAAG8I,QAAQqE,UAC1D,GAECsI,IACAyC,EAAqBE,EAAmBjJ,OAAQwH,GACrC3W,GAAG8I,QAAQmE,OAAS0J,aAAgB3W,GAAG8I,QAAQmE,QAI9D,IAAIsC,EAAMzG,EAAQyG,IACd8I,EAAgBC,EAA6B/I,GACjD,GAAI8I,EAAe,CAEf,IAAIE,EAAazP,EAAQ0P,QACzBD,EAAWE,UAAUJ,EAAclS,KAAKuS,mCAAmC,GAAGlL,QAC9E,GAAIiI,EAAa,CACRyC,IACDA,EAAsBS,EAAiB5R,KAAK6B,IAAS,IAEzDsP,EAAmBlH,KAAKuH,QAExBL,EAAqBK,MAEtB,CACH3P,EAAKmH,gBAAgBoG,UAAU1E,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQiH,SAE/D,IAAIL,QAhNZ/J,eAAgB1F,GAC5C,MAAMF,EAAO7I,KACb,IAAI8Y,EAAgBC,EAA+BhQ,GACnD,GAAI+P,EAAe,CACfE,QAAQC,IAAI,wBACZ,OAAOH,EAAc1S,KAClB,CACH4S,QAAQC,IAAI,2BACZ,MAAMC,QAAarQ,EAAKsQ,mBACxB,GAAID,EAAM,CACN,IAAIE,EAASrQ,EAAQ0P,QACrB,IACI,IAAID,QAAmBU,EAAKG,YAAY,CAAE9M,SAAU,CAAC6M,GAASE,IAAKzQ,EAAKQ,IAAIiQ,MAC5EC,EAA0BxQ,EAASyP,EAAW,IAC9C,OAAOA,EAAW,GACpB,MAAO5P,GACL,OAAO,SAgMgE5B,KAAK6B,EAAME,GAC1D,GAAIyP,EACI9C,EACAyC,EAAmBlH,KAAKuH,GAExBL,EAAqBK,MAEtB,CACH3P,EAAKQ,IAAIoH,MAAM5H,EAAK0F,gBAAgB,mBAAoB,CAAE3E,KAAM3J,GAAGM,OAAOmQ,QAAQ8I,MAAOC,SAAU,MACnGnD,EAAc,GAAG3L,SAAU,EAG/B9B,EAAKmH,gBAAgBoG,UAAU1E,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQiH,UAI1EhQ,EAAKmH,gBAAgB0J,YAAYvB,SAK7C,GAAI7B,EAAc,GAAG5E,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQ+E,WAlKxD,QAmKErS,SAAS6N,cAAc,IAAMtJ,EAAKhI,MAAQ,yCAAyCuX,MAAqB,CACxG,MAAMuB,EAAWrD,EAAc,GAC/BqD,EAAShP,SAAU,EACnBgP,EAASC,cAAc,IAAIhX,MAAM,YAIH,IAAlC+S,EAAuBvX,QAAgBuX,EAAuB,GAAG9J,UACjEhD,EAAKmH,gBAAgBmG,WAAW,CAAEtK,SAAU8J,EAAuB,GAAG9J,cAO1F3G,EAAS+Q,yBAA2B,SAAUpK,GAC1C,MAAMhD,EAAO7I,KAEPW,EAAU,CACZsJ,MAAOpB,EAAK0F,gBAAgB,YAC5B1C,SAAUA,EACVyJ,aAAc,WACVzM,EAAKmF,qBAAqBnF,GAAM,KAGpCA,EAAKlI,QAAQgO,iBACbhO,EAAQ8I,UAAY,CAChBoF,WAAahG,EAAKlI,QAAQgO,kBAAoB9F,EAAKlI,QAAQgO,iBAAiBE,YAAgBhG,EAAKQ,IAAI1I,QAAQ8I,WAAaZ,EAAKQ,IAAI1I,QAAQ8I,UAAUoF,YAAe,GACpKgL,aAAehR,EAAKlI,QAAQgO,kBAAoB9F,EAAKlI,QAAQgO,iBAAiBkL,cAAkBhR,EAAKQ,IAAI1I,QAAQ8I,WAAaZ,EAAKQ,IAAI1I,QAAQ8I,UAAUoQ,cAAiB,EAC1KlP,SAAS,GAGbhK,EAAQ8I,UAAY,CAChBkB,SAAS,GAIjB,OAAOhK,GAGX,IAAImZ,GAAkB,EACtB5U,EAASoL,WAAa,SAAUlK,EAAMjH,GAClC,MAAM0J,EAAO7I,KAEb,IAAI+Z,EAAMlR,EAAK9H,MAAMO,SAErB,OAAOrB,GAAGE,QAAQgF,UAAUmL,WAAWtJ,KAAK6B,EAAMzC,EAAM,WAEpD,MAAMzF,EAAUkI,EAAK4I,IAAI8E,iBAAiB1N,EAAKjI,eAAiB,UAChEiI,EAAK4I,IAAI8E,iBAAiB,IAAM1N,EAAKhI,MAAQ,gBAAgBoM,QAAQ,SAAU+M,GAC3EA,EAAKjC,iBAAiB9X,GAAGM,OAAOC,MAAMyZ,MAAO,SAAUrR,GAEnD,IADA,IAAIqC,EAAQrC,EAAEkD,OACPb,GAA2B,UAAlBA,EAAMiP,SAClBjP,EAAQA,EAAMkP,cAElB,MAAMC,EAAYnP,EAAMkH,yCAAyCtJ,EAAKpJ,aAAa2Y,MAEnFzX,EAAQsM,QAAQ,SAAUoN,GACtBA,EAAO3I,UAAUsG,OAAO/X,GAAGM,OAAOqR,QAAQqF,QAASoD,EAAOC,QAAQ,IAAMzR,EAAKhI,MAAQ,IAAMuZ,OAEhG,CAAEG,SAAS,MAGlB1R,EAAK4B,MAAQ,CACT+P,eAAgB3R,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,sBAC7D6Z,iBAAkB5R,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,wBAC/D8Z,YAAa7R,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,yBAC1D+Z,gBAAiB9R,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,iBAC9Dga,UAAW/R,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,eACxDia,SAAUhS,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,kBACvDka,cAAejS,EAAK7E,WAAWmO,cAAc,IAAMtJ,EAAKhI,MAAQ,mBAChEka,WAAYlS,EAAK7E,WAAWmO,cAAc,IAAMtJ,EAAKhI,MAAQ,cAC7Dma,WAAYnS,EAAK7E,WAAWmO,cAAc,IAAMtJ,EAAKhI,MAAQ,gDAE7Doa,qBAAsBpS,EAAK7E,WAAWmO,cAAc,IAAMtJ,EAAKhI,MAAQ,qBAG3EgI,EAAK4B,MAAMyQ,UAAYrS,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,wBAEpEiI,EAAK4B,MAAM0Q,qBAAuBtS,EAAK4I,IAAIU,cAAc,0CAA4CtJ,EAAKpJ,IAE1GoJ,EAAK4I,IAAIU,cAAc,IAAMjN,EAASrE,MAAQ,qBAAqBkX,iBAAiB,QAAS,WACzFqD,EAAapU,KAAK6B,KAGtBA,EAAK4B,MAAM4Q,UAAYxS,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,gBAEpEiI,EAAK4B,MAAM6Q,SAAWzS,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,mBAE/DX,GAAGgE,KAAKsX,gBACJC,WAAW,uDAAuDlB,UAClEzR,EAAK4B,MAAM0Q,qBAAqBxQ,SAAU,GAGlD,GAAI/L,OAAO6c,MAAQ7c,OAAO8c,YAAc9c,OAAO+c,UAAY/c,OAAOgd,KAAM,CACpE/S,EAAK4B,MAAMkQ,gBAAgBkB,UAAW,EAEtChT,EAAK4B,MAAMkQ,gBAAgB5C,iBAAiB9X,GAAGM,OAAOC,MAAMyZ,MAAO,SAAUrR,GAEzE,MACMkT,EAAOxX,SAAS4L,cAAc,QAC9BtJ,EAFQ5G,KAEOma,cACrBvT,EAAOmV,aAAaD,EAHN9b,MAId8b,EAAKtX,YAJSxE,MAKd8b,EAAKE,QAELF,EAAKG,sBAAsB,WAPbjc,MAQd4G,EAAOsV,YAAYJ,IACpB,CAAEvB,SAAS,IAEd,MAAM4B,EAAc,WAChBtT,EAAKQ,IAAIyD,IAAI7M,GAAGM,OAAOC,MAAM4b,WAAYD,GACzCtT,EAAKwT,eAAexT,EAAK4B,MAAMkQ,iBAE/B1a,GAAGqc,MAAMzT,EAAK0F,gBAAgB,2BAGlC1F,EAAK4B,MAAMkQ,gBAAgB5C,iBAAiB,SAAU,SAAUnP,GAC5D,IAAKC,EAAK0T,UAAW,CACjB1T,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAE7B,GAAIgF,EAAKQ,IAAK,CACVR,EAAKQ,IAAIqC,GAAGzL,GAAGM,OAAOC,MAAM4b,WAAYD,GACxCtT,EAAKQ,IAAIL,KAAKwT,UAAU5T,EAAEkD,OAAO2Q,MAAO,CAAEvc,QAAS2I,aAK/DmQ,QAAQC,IAAI,mCAGhBpQ,EAAK4B,MAAM+P,eAAezC,iBAAiB,QAAS,WAChDlP,EAAK6T,mBACLC,EAAsB3V,KAAK6B,KAG/BA,EAAK4B,MAAMgQ,iBAAiB1C,iBAAiB,QAAS,WAClDlP,EAAK+T,qBACLC,EAAwB7V,KAAK6B,KAsCjC,MAAMiU,EAAsB,YAnCd,SAAUC,GACpBA,EAAaA,EAAW3R,cAExB,MAAM4R,EAAM1J,MAAM2J,KAAKpU,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,OAC7DyG,EAAI/P,QAAQ,SAAUP,GAClBA,EAAGwQ,MAAMC,QAAU,SAEvB,MAAMC,EAAWJ,EAAI5N,OAAO,SAAU1C,GAClC,OAAOA,EAAG4N,QAAQ,sBAAwBzR,EAAK9H,MAAMC,QAAQG,iBAG3Dkc,EAAaxU,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,sBAChE,GAA0B,IAAtBmc,EAAW3e,OAAc,CACzBgf,EAASnQ,QAAQ,SAAUP,GACvBA,EAAGwQ,MAAMC,QAAU,KAEvBE,EAAWH,MAAMI,WAAa,cAC3B,CACHD,EAAWH,MAAMI,WAAa,SAC9B,IAAIC,EAAI,IAAI9I,OAAOsI,EAAY,KAC/BK,EAASnQ,QAAQ,SAAUP,GACvBA,EAAGwQ,MAAMC,QAAUI,EAAEvQ,KAAKN,EAAGyF,cAAc,QAAQoC,aAAe,GAAK,SAGtE6I,EAASI,KAAK,SAAU9Q,GACzB,MAA4B,KAArBA,EAAGwQ,MAAMC,WAEhBH,EAAI/P,QAAQ,SAAUP,GACdA,EAAG4N,QAAQ,6CACX5N,EAAGwQ,MAAMC,QAAU,OAOnCM,CAAQzd,KAAKoY,MAAMhN,cAAcD,SAErCtC,EAAK4B,MAAMiQ,YAAY3C,iBAAiB,QAAS+E,GACjDjU,EAAK4B,MAAMiQ,YAAY3C,iBAAiB,SAAU+E,GAGlDjU,EAAK4B,MAAMmQ,UAAU7C,iBAAiB,QAASlP,EAAK6U,UAAU9S,KAAK/B,IACnEA,EAAK4B,MAAMoQ,SAAS9C,iBAAiB,QAASlP,EAAK8U,YAAY/S,KAAK/B,IAEpE,MAAM+U,EAAO/U,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,wBAG1D,IAAIid,EAAQ,SAAUC,EAAMC,GACJ,OAAhBA,EAAI7D,UACJ6D,EAAMA,EAAI5D,eAGd,MAAM6D,EAAQD,EAAI5L,cAAc,SAC1B6H,EAAO+D,EAAI5L,cAAc,QAE/B,GAAI2L,EAAM,CAENE,EAAMtM,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QACzC+G,EAAMC,QACND,EAAM5F,MAAQ4B,EAAKzF,YACnByF,EAAKtI,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QACrC8G,EAAItO,QAAe,MAAIsO,EAAI9T,MAC3B8T,EAAI9T,MAAQ,GAEZ8T,EAAI5L,cAAc4H,EAAIxY,UAAUmQ,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAChE8G,EAAI5L,cAAc4H,EAAItY,MAAMiQ,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAC5D8G,EAAI5L,cAAc4H,EAAIrY,QAAQgQ,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAC9D8G,EAAI5L,cAAc4H,EAAIvY,MAAMkQ,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAC5D8G,EAAI5L,cAAc4H,EAAIlY,QAAQ6P,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAC9D8G,EAAI5L,cAAc4H,EAAIjY,OAAO4P,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAE7D8G,EAAI5L,cAAc4H,EAAIpY,MAAM+P,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAC/D8G,EAAI5L,cAAc4H,EAAInY,QAAQ8P,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,YAC9D,CAEH+G,EAAMtM,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QACtC+C,EAAKtI,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QACxC8G,EAAI9T,MAAQ8T,EAAItO,QAAe,aACxBsO,EAAItO,QAAe,MAE1BsO,EAAI5L,cAAc4H,EAAIxY,UAAUmQ,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QACnE8G,EAAI5L,cAAc4H,EAAItY,MAAMiQ,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAC/D8G,EAAI5L,cAAc4H,EAAIrY,QAAQgQ,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QACjE8G,EAAI5L,cAAc4H,EAAIvY,MAAMkQ,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAC/D8G,EAAI5L,cAAc4H,EAAIlY,QAAQ6P,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QACjE8G,EAAI5L,cAAc4H,EAAIjY,OAAO4P,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAEhE8G,EAAI5L,cAAc4H,EAAIpY,MAAM+P,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAC5D8G,EAAI5L,cAAc4H,EAAInY,QAAQ8P,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,UAItEpO,EAAKqV,WAAa,SAAUC,EAAUJ,GAClC,GAAIA,EAAK,CACL,IAAIK,EAAe,CACfrE,EAAIxY,SACJwY,EAAItY,KACJsY,EAAIrY,OACJqY,EAAIlY,OACJkY,EAAIjY,OAEJuc,EAAmB,CACnBtE,EAAIhY,KACJgY,EAAI/X,MACJ+X,EAAI9X,SACJ8X,EAAI7X,QACJ6X,EAAI5X,OAEJmc,EAAsB,OAAhBP,EAAI7D,QAAmB6D,EAAMA,EAAIQ,WAE3CH,EAAanR,QAAQ,SAAU8E,GAC3BuM,EAAInM,cAAcJ,GAAKyM,OAASL,IAGpCE,EAAiBpR,QAAQ,SAAU8E,GAC/BuM,EAAInM,cAAcJ,GAAKyM,QAAUL,MAK7CP,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB3E,EAAIxY,SAAU,SAAUqH,GACrF,IAAIgI,EAAO/H,EAAK8D,sBAAsBkE,UAEtCjI,EAAEkD,OAAOqO,cAAchI,cAAc4H,EAAI5X,OAAOoS,YAAc,MAE9DoK,EAAW9V,EAAMD,EAAEkD,QAAQ5B,KAAK,WAC5BrB,EAAK8D,sBAAsBC,WAAWgE,QAG9CgN,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB3E,EAAIvY,KAAM,SAAUoH,GACjF,IAAIgI,EAAO/H,EAAK8D,sBAAsBkE,UAEtC+N,EAAW/V,EAAMD,EAAEkD,QAAQ5B,KAAK,WAC5BrB,EAAK8D,sBAAsBC,WAAWgE,QAI9C/H,EAAK6C,GAAG7C,EAAK9H,MAAM6B,MAAMS,cAAe,SAAUuF,GAC9C,GAAKC,EAAK2H,WAYN3H,EAAKQ,IAAIoH,MAAM5H,EAAK0F,gBAAgB,2BAA4B,CAAE3E,KAAM3J,GAAGM,OAAOmQ,QAAQC,cAZxE,CAClB,MAAMkO,EAAchW,EAAK4B,MAAMyQ,UAAU/I,cAAc,eAAiBvJ,EAAEkW,MAAQ,MAClFF,EAAW/V,EAAMgW,EAAY1M,cAAc4H,EAAIvY,OAAO0I,KAAK,WACvD,GAAIrB,EAAKkW,aAAc,QACZlW,EAAKkW,oBACLlW,EAAKkM,WAGpBrV,WAAW,WACPmJ,EAAK4B,MAAMyQ,UAAU8D,UAAYpW,EAAEkW,MAAQD,EAAYI,cACxD,QAMX,MAAMC,EAAmB,SAAUrW,EAAMsW,GACrCtW,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,eAAetJ,QAAQ,SAAUmS,GACnE,GAAIA,EAAS3P,QAAQhQ,KAAO0f,EAAW,CACnC,MAAME,EAAcD,EAASjN,cAAc4H,EAAIxY,UACzC+d,EAAWF,EAASjN,cAAc4H,EAAI/X,OAE5Cqd,EAAY3N,UAAUQ,OAAOrJ,EAAK9H,MAAMC,QAAQK,qBAChDge,EAAYE,aAAa,QAAS1W,EAAK0F,gBAAgB,oBACvD+Q,EAAS5N,UAAUQ,OAAO,QAC1BoN,EAASC,aAAa,QAAS1W,EAAK0F,gBAAgB,iBAEpD1F,EAAKqV,YAAW,EAAOkB,GACvBvB,GAAM,EAAOuB,OAQzB,IAAIR,EAAa,SAAU/V,EAAM2W,GAC7B,OAAO,IAAIrO,QAAQ,SAAUsB,EAASC,GAElC,MAAM+M,EAAUD,EAAQrF,cAExBza,WAAW,WACP,GAAI+f,EAAQ/N,UAAUC,SAAS9I,EAAK9H,MAAMC,QAAQG,eAAgB,CAC9D0H,EAAKqV,YAAW,EAAOsB,GAEvB3W,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAC7BgF,EAAKQ,IAAIyD,IAAI7M,GAAGM,OAAOC,MAAM+P,cAAe5H,GAE5C6W,EAAQD,aAAa,QAASC,EAAQjL,kBAErC,GAAI1L,EAAK0G,mBAAoB,CAC9B2P,EAAiBrW,EAAM4W,EAAQhQ,QAAQhQ,IACvCoJ,EAAKwE,QAAUxE,EAAK6W,UAAUD,QAE9B5W,EAAKwE,QAAUxE,EAAK6W,UAAUD,GAK9BA,EAAQ/N,UAAUC,SAAS9I,EAAK9H,MAAMC,QAAQG,eAC9C0H,EAAK0J,uBAAuB,CAAE/C,IAAKiQ,EAAQhQ,QAAQD,IAAK4E,oBAAoB,IAAQlK,KAAK,WACrFuI,MAGJA,KAEL,MAIPkM,EAAa,SAAU9V,EAAMwW,GAC7B,OAAO,IAAIlO,QAAQ,SAAUsB,EAASC,GAClChT,WAAW,WACP,MAAM+f,EAAUJ,EAAYlF,cACtBjF,EAAgBrM,EAAK0G,mBAC3B2P,EAAiBrW,EAAM4W,EAAQhQ,QAAQhQ,IACvCoJ,EAAKqV,YAAW,EAAOhJ,GACvBrM,EAAKqV,YAAW,EAAMmB,GAGlBnK,GAAiBuK,EAAQhQ,QAAQhQ,KAAOyV,EAAczF,QAAQhQ,IAC9DoJ,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAGjCgF,EAAK8W,iBAAkB,EACvB9W,EAAK+W,cAAcH,GAEnBhN,KACD,MAIXmL,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAItY,KAAM,SAAUmH,GAC7GiV,GAAM,EAAMjV,EAAEkD,WAElB8R,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAIrY,OAAQ,SAAUkH,GAC/GC,EAAKgX,YAAYjX,EAAEkD,OAAOqO,kBAE9ByD,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAIpY,KAAM,SAAUiH,GAE7G,GAA8B,IADhBA,EAAEkD,OAAOqO,cAAchI,cAAc,SAASiG,MAChDjN,OAAO/M,OACf6B,GAAGqc,MAAMzT,EAAK0F,gBAAgB,2BAE7B,CACD1F,EAAKiX,cAAclX,EAAEkD,OAAOqO,cAAc1K,QAAQhQ,GAAImJ,EAAEkD,OAAOqO,cAAchI,cAAc,SAASiG,OACpGyF,GAAM,EAAOjV,EAAEkD,YAGvB8R,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAInY,OAAQ,SAAUgH,GAC/GiV,GAAM,EAAOjV,EAAEkD,WAGnB8R,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAIjY,MAAO,SAAU8G,GAC9GC,EAAKsM,WAAWvM,EAAEkD,OAAOqO,eAAejQ,KAAK,WACzCrB,EAAKkX,gBAAgBlX,EAAKpE,sBAIlCmZ,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAIlY,OAAQ,SAAU+G,GAC/G,MAAMhC,EAASgC,EAAEkD,OAAOqO,cACxBvR,EAAEkD,OAAOyT,aAAa,WAAY,IAElC1W,EAAKmX,OAAOpZ,GAAQsD,KAAMqC,IACtB1D,EAAKkH,oBAAoB7F,KAAK,SAAU+V,GACpC,MAAMtf,EAAUkI,EAAKoN,yBAAyBvG,EAAoB1I,KAAK6B,EAAMjC,IAC7EqZ,EAAO/J,KAAK3J,EAASlD,IAAKkK,IAAQA,EAAE/D,IAAM5I,EAAO6I,QAAQD,IAAK,OAAO+D,IAAO5S,GAE5EiI,EAAEkD,OAAOoU,gBAAgB,mBAKrCtC,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAIhY,KAAM,SAAU6G,GAC7GC,EAAKqV,YAAW,EAAOtV,EAAEkD,QACzBjD,EAAKG,KAAKmX,mBACV,MAAMb,EAAW1W,EAAEkD,OAAOqO,cAAchI,cAAc4H,EAAI/X,OAC1Dsd,EAAS5N,UAAUQ,OAAO,QAC1BoN,EAASC,aAAa,QAAS1W,EAAK0F,gBAAgB,iBAEpD3F,EAAEkD,OAAOqO,cAAchI,cAAc4H,EAAI5X,OAAOoS,YAAc,MAC9D1L,EAAKuX,eAAiB,KAG1BxC,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAI/X,MAAO,SAAU4G,GAC9GC,EAAK8W,iBAAmB/W,EAAEkD,OAAO4F,UAAUC,SAAS,QAChD9I,EAAK8W,kBACL9W,EAAKwX,uBAAyB,GAElCzX,EAAEkD,OAAOyT,aAAa,QAAS1W,EAAK0F,gBAAgB1F,EAAK8W,gBAAkB,cAAgB,iBAC3F/W,EAAEkD,OAAO4F,UAAUsG,OAAO,SAAUnP,EAAK8W,oBAI7C/B,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAI9X,SAAU,SAAU2G,GACtF,GAAvBC,EAAKuX,eACLvX,EAAKuX,eAHD,GAIHvX,EAAKuX,eAAiBvX,EAAKuX,eAAiB,EAEjDxX,EAAEkD,OAAOqO,cAAchI,cAActJ,EAAKjI,eAAiB,IAAMmZ,EAAI7X,SAAS2Z,UAAW,EAEzFjT,EAAEkD,OAAOqO,cAAchI,cAAc4H,EAAI5X,OAAOoS,YAAc1L,EAAKuX,eAAiB,EAAI,KAAQ,EAAIvX,EAAKuX,eAAkB,KAAOvX,EAAKuX,eAE5G,eAAvBvX,EAAKuX,iBACLxX,EAAEkD,OAAO+P,UAAW,MAI5B+B,EAAK7F,iBAAiB,QAAS9X,GAAGwe,YAAYC,mBAAmB7V,EAAKjI,eAAiB,IAAMmZ,EAAI7X,QAAS,SAAU0G,GAChHC,EAAKuX,eAAiBvX,EAAKuX,eAhBnB,GAkBRxX,EAAEkD,OAAOqO,cAAchI,cAAc4H,EAAI5X,OAAOoS,YAAc1L,EAAKuX,eAAiB,EAAI,KAAQ,EAAIvX,EAAKuX,eAAkB,KAAOvX,EAAKuX,eAEvIxX,EAAEkD,OAAOqO,cAAchI,cAActJ,EAAKjI,eAAiB,IAAMmZ,EAAI9X,UAAU4Z,UAAW,EAE/D,MAAvBhT,EAAKuX,iBACLxX,EAAEkD,OAAO+P,UAAW,MAM5BhT,EAAK4B,MAAMqQ,cAAc/C,iBAAiB,QAAS,WAE/C9X,GAAGgE,KAAK+Q,aAERsL,EAAUtZ,KAAK6B,KAEnBA,EAAK4B,MAAMsQ,WAAWhD,iBAAiB,QAAS,kBAErClP,EAAK0X,gBACZtgB,GAAGgE,KAAKuc,QAAQC,qBAAqB5X,EAAK9H,MAAMqB,gBAAgBE,kBAAcoe,GAC9EC,YAAYC,WAAW/X,EAAK9H,MAAMqB,gBAAgBE,cAElDrC,GAAGgE,KAAK+Q,aAERsL,EAAUtZ,KAAK6B,KAEnBA,EAAK4B,MAAMuQ,WAAWjD,iBAAiB,QAAS,WAC5C8E,EAAwB7V,KAAK6B,KASjCA,EAAK4B,MAAMwQ,qBAAqBlD,iBAAiB,QAAS,WAEtD,MAAM8I,EAAavc,SAASC,KAAKgS,iBAAiB,wCAElD,GAAIsK,EAAWziB,OAAS,EAAG,CACP,IAAI+S,QAAQ,SAAUsB,EAASC,GACvC9T,OAAO+hB,YACPlO,IAEAxS,GAAG6gB,QAAQliB,OAAO+hB,YAAa,CAAC1gB,GAAGM,OAAOwgB,IAAIC,aAAc,WACxDvO,QAKJvI,KAAK,WACTyW,YAAYM,QAAQJ,EAAW,GAAGK,aAAa,SAAS,KAIhEjhB,GAAGgE,KAAK+Q,eAGZnM,EAAK4B,MAAMC,YAAc7B,EAAK4I,IAAIU,cAAc,oCAAsCtJ,EAAKpJ,IAC3FoJ,EAAK4B,MAAMC,YAAYqN,iBAAiB,SAAU,WAC1ClP,EAAK4B,MAAM+P,eAAe9I,UAAUC,SAAS1R,GAAGM,OAAOqR,QAAQqF,SAC/DpO,EAAK2C,cAAc2V,cAAcnhB,KAAK2K,SAG1CmP,EAAkB9Z,KAAK2K,UAGvB/L,OAAO+hB,YACP9X,EAAKuY,aAELnhB,GAAG6gB,QAAQliB,OAAO+hB,YAAa,CAAC1gB,GAAGM,OAAOwgB,IAAIC,aAAc,WACxDnY,EAAKuY,eAITnhB,GAAGgE,KAAKqJ,WAAWnO,IACnBA,OAKZ+F,EAASiQ,WAAa,SAAUzI,GAC5B,MAAM7D,EAAO7I,KACb,OAAO6I,EAAKwY,eAAexY,EAAKpE,iBAAiByF,KAAK,WAClD,OAAOrB,EAAK0J,uBAAuB,CAAE/C,IAAK9C,EAAG+C,QAAQD,IAAK4E,oBAAoB,IACzElK,KAAK,SAAUqC,GACZ1D,EAAKkM,QAAU,CACXsG,UAAW3O,EAAGyF,cAAc,QAAQrC,UACpCvD,SAAUA,QAM9BrH,EAASoc,SAAW,aAKpBpc,EAASqc,WAAa,WAGlBthB,GAAGgE,KAAK+Q,aAFGhV,KAGNmJ,iBAHMnJ,KAIN4c,sBAIT,IAAID,EAAwB,WACb3c,KAENyK,MAAM+P,eAAe9I,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,QAF/CjX,KAGNyK,MAAMgQ,iBAAiB/I,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,SAG/D4F,EAA0B,WACf7c,KAENyK,MAAM+P,eAAe9I,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAFlDjX,KAGNyK,MAAMgQ,iBAAiB/I,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,SAG5DmE,EAAe,WACJpb,KACNqJ,IAAIoH,MADEzQ,KACSyR,IAAIU,cAAc,kBAAkBrC,UAAW,CAC/D2J,SAAU,OAIlBvU,EAASsc,YAAc,CACnBlX,OAAQ,GACRC,UAAW,CAAC,IAAK,EAAG,EAAG,KACvBM,YAAa,CAAC,IAAK,IAAK,IAAK,KAC7BS,YAAa,GAGjBpG,EAASuc,UAAY,CACjBnW,YAAa,EACbT,YAAa,CAAC,EAAG,IAAK,IAAK,MAG/B3F,EAASwc,yBAA2B,SAAUC,GAC1C,IAEIvb,EAAO,GACPwb,EAAS3hB,GAAGgE,KAAK4d,aAHV7hB,KAG4BqJ,KAEvC,GALWrJ,KAKFqJ,IAAIyY,SAAU,CACnB,IAAIC,EANG/hB,KAMcqJ,IAAIiQ,MANlBtZ,KAM+BqJ,IAAI2Y,OAAO1I,IAAMrZ,GAAGgE,KAAKyJ,UAAUiU,EAAYM,SAN9EjiB,KAM6FqJ,IAAIiQ,IANjGtZ,KAM2GqJ,IAAI2Y,OAAO1I,KAAOqI,EAAYM,SAChJ7b,EAAKrH,EAAIgjB,EAAU,GAAGG,eAAeN,GACrCxb,EAAKjI,EAAI4jB,EAAU,GAAGG,eAAeN,GAErCxb,EAAK+b,IAAMlkB,KAAKmkB,MAVTpiB,KAUoBqJ,IAAI2Y,OAAOK,iBAAiBN,IAAYG,eAAeN,GAElFxb,EAAKkc,OAAQ,MAEV,CACHlc,EAAKrH,EAAId,KAAKmkB,MAAMT,EAAYM,SAAS,IAAIC,eAAeN,GAC5Dxb,EAAKjI,EAAIF,KAAKmkB,MAAMT,EAAYM,SAAS,IAAIC,eAAeN,GAGhExb,EAAKmc,EAAKtkB,KAAKmkB,MAAMT,EAAYa,UAAUN,eAAeN,GAC1Dxb,EAAKqc,SAAYxkB,KAAKmkB,MAAMT,EAAYc,UAAUP,eAAeN,GACjExb,EAAKsc,MAAQf,EAAYe,MAAMR,eAAeN,EAAQ,CAAEe,sBAAuB,EAAGC,sBAAuB,IAEzG,OAAOxc,GAGXlB,EAAS2d,kBAAoB,WACzB,MAAMha,EAAO7I,KACR6I,EAAK4B,MAAMqY,oBACZja,EAAK4B,MAAMqY,kBAAoB,IAAI3R,QAAQ,SAAUsB,EAASC,GAC1D,GAAK7J,EAAK4B,MAAMsY,UA4CZtQ,EAAQ5J,EAAK4B,MAAMsY,eA5CI,CAEvB,IAYIC,EAZAC,EAAsB,CACtB7S,QAAS,QACT8S,QAAQ,EACRC,OAAQ,CACJpd,KAAM8C,EAAK0F,gBAAgB,kBAC3BvP,IAAK6J,EAAK0F,gBAAgB,wBAE9BqD,QAAS,CACLwR,UAAW,aAKnB,MAAMC,EAAsB,SAAUC,GAClCL,EAAoBhB,SAAWqB,EAAiBC,SAASC,MACzDR,EAAaM,EAAiBxU,WAAW,eAAgBmU,IAG7D,IAAIrU,GACC/F,EAAKlI,QAAQgO,kBAAoB9F,EAAKlI,QAAQiO,UAC/CA,EAAY/F,EAAKlI,QAAQiO,UAClB/F,EAAKlI,QAAQgO,mBACpBC,EAAY/F,EAAKlI,QAAQgO,iBAAiBC,WAE9C,GAAIA,EAAW,CACX,IAAI0U,EAAmBza,EAAKQ,IAAIoa,mBAAmB,cAAgB7U,EAAU,GAAG8U,cAAgB9U,EAAU+U,UAAU,IAAI,GACnHL,EAGDD,EAAoBC,GAFpBza,EAAKQ,IAAIyF,WAAWF,GAAW1E,KAAKmZ,OAIrC,CACHJ,EAAoBxR,IAAMnN,SAAS4L,cAAc,OACjDrH,EAAKQ,IAAIoI,IAAIjN,YAAYye,EAAoBxR,KAC7CuR,EAAana,EAAKQ,IAAIyF,WAAW,eAAgBmU,GAGrDD,EAAW9Y,KAAK,SAAU0Z,GACtB/a,EAAK4B,MAAMsY,UAAYa,EACvBnR,EAAQmR,SAOxB,OAAO/a,EAAK4B,MAAMqY,mBAGtB5d,EAAS2e,sBAAwB,SAAUC,GACvC,MAAMjb,EAAO7I,KAEb6I,EAAK+G,gBAAgB/G,EAAKhI,MAAQ,kBAAmBgI,EAAK6Y,yBAAyBoC,EAAEC,IAAK,SAAUlU,GAChGhH,EAAKga,oBAAoB3Y,KAAK,SAAU6Y,GACpC,IAAKA,EAAUiB,cAAe,CAC1Bnb,EAAKQ,IAAIoa,mBAAmBxjB,GAAGC,QAAQ+jB,cAClC7U,OAAO8U,GAASA,EAAM9T,UAAY8T,EAAMC,YAAYC,OAASF,IAAUnB,GACvE9V,QAAQ,SAAUiX,GACfA,EAAMG,UAEdtB,EAAUuB,gBAAgBpa,KAAK,WAC3B6Y,EAAUpiB,QAAQ4jB,kBAAoBxB,EAAUyB,mBAAmBC,OACnE1B,EAAU7M,KAAKrG,WAQnC,IAAI6U,EAA2B,WAChB1kB,KAEDyK,MAAM0Q,qBAAqBxQ,SAF1B3K,KAGFqJ,IAAIiJ,QAAQrS,GAAGM,OAAOC,MAAMmF,aAIrC2a,EAAY,WACZ,IAAIzX,EAAO7I,KAEX6I,EAAKyY,WAEL3E,EAAsB3V,KAAK6B,GAC3B6b,EAAyB1d,KAAK6B,GAE9BA,EAAK6C,GAAG7C,EAAK9H,MAAM6B,MAAMC,eAAgB,SAAUihB,GAE/Cjb,EAAK8b,aAAeb,EAAEC,GACtBlb,EAAKgb,sBAAsBC,GAE3Bjb,EAAK4B,MAAM4Q,UAAUQ,UAAW,EAChChT,EAAK4B,MAAMmQ,UAAUiB,UAAW,EAEhChT,EAAK4B,MAAM6Q,SAASO,UAAW,EAC/BhT,EAAK4B,MAAMoQ,SAASgB,UAAW,EAG/B5b,GAAGgE,KAAKuc,QAAQC,qBAAqB5X,EAAK9H,MAAMqB,gBAAgBE,aAAcuG,EAAKG,KAAK4b,mBAAmB/b,EAAK2C,eAAee,YAEnI1D,EAAK6C,GAAG7C,EAAK9H,MAAM6B,MAAMI,aAAc,SAAUoD,MAIjDyC,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOvB,UAE7BwiB,EAAc7d,KAAK6B,EAAMA,EAAK9H,MAAMqB,gBAAgBG,2BAEpDsG,EAAKG,KAAK8b,aAAY,IAK1B,IAAIC,GAAc,EACdC,EAAW,KACXC,EAAgB,KAChB,aAAcC,YACdH,GAAc,GAElB,IAAII,EAAe,KAEnB,IAyEIC,EAOAC,EAuBAC,EAvGAC,EAAe,WACf,IAAI1c,EAAOsc,EAAenlB,KAC1B,GAAK+kB,EAEA,CAGuBtW,WACpB,IACIuW,QAAiBE,UAAUF,SAASQ,QAAQ,UAC5CxM,QAAQC,IAAI,oBACZ+L,EAASjN,iBAAiB,UAAW,KAEjCiB,QAAQC,IAAI,wBAElB,MAAOwM,GAELzM,QAAQ0M,MAAMD,KAGtBE,QAjBAC,EAAqB9hB,MAAM+E,IAkC/B+c,EAAuB,WAGvB,IAFW5lB,KAED6lB,cAAe,CACrB,IAAIC,EAAQ,CACRC,KAAM,kRACNC,IAAK,klCALFhmB,KAQF6lB,cAAgBvhB,SAAS4L,cAAc,SARrClQ,KASF6lB,cAActG,aAAa,OAAQ,IATjCvf,KAUF6lB,cAActG,aAAa,QAAS,IAVlCvf,KAWF6lB,cAActG,aAAa,qBAAsB,IAX/Cvf,KAYF6lB,cAActG,aAAa,cAAe,IAZxCvf,KAaF6lB,cAActG,aAAa,QAAS,+BAEzC,IAAI0G,EAAa3hB,SAAS4L,cAAc,UACxC+V,EAAWC,IAAMJ,EAAMC,KACvBE,EAAWrc,KAAO,aAjBX5J,KAkBF6lB,cAAcrhB,YAAYyhB,GAE/B,IAAIE,EAAY7hB,SAAS4L,cAAc,UACvCiW,EAAUD,IAAMJ,EAAME,IACtBG,EAAUvc,KAAO,YAtBV5J,KAuBF6lB,cAAcrhB,YAAY2hB,GAvBxBnmB,KA0BN6lB,cAAcO,QAEnBC,EAA0B,WACfrmB,KACF6lB,eADE7lB,KAEF6lB,cAAcS,SAYvBC,EAAkB,WACPvmB,KAEF6lB,eAFE7lB,KAEoB6lB,cAAcW,QAFlCxmB,KAGF6lB,cAAcO,OAEvBK,EAAqB3iB,MALV9D,OAsBX0mB,EAAqBjY,iBACrB,IAEI+P,EAjBgB,WACpB,IAAImI,EAAW,CAAC,SAAU,MAAO,KAAM,KAEvC,GAAI,WAAYriB,SAAU,MAAO,SAEjC,IAAK,IAAIhG,EAAI,EAAGA,EAAIqoB,EAASvoB,OAAQE,IACjC,GAAKqoB,EAASroB,GAAK,WAAagG,SAC5B,OAAOqiB,EAASroB,GAAK,SAG7B,OAAO,KAOMsoB,GAEb,GAAKtiB,SAASka,IAOT,GAAIyG,EACL,GAAIC,UAAU2B,gBAET3B,UAAU2B,cAAcC,YAdtB9mB,KAgBOqJ,IAAIoa,mBAAmBxjB,GAAGC,QAAQ6mB,eAAe3oB,QAAwG,qBAhBhK4B,KAgB8EqJ,IAAIoa,mBAAmBxjB,GAAGC,QAAQ6mB,eAAe,GAAGC,oBAAoBC,OACzJ,WAC+B/B,UAAU2B,cAAcK,OACtCC,iBAnBdnnB,KAmBoC6E,iBAAiBoF,MAAOnD,OAAOmH,OAnBnEjO,KAmB+E6E,iBAAkB,CAC5FuiB,QAAS,CAAC,CACNvZ,OAAQ,OACR5D,MAtBTjK,KAsBqBuO,gBAAgB,qCAC5BnI,KAAM,CACN2a,IAAOzc,SAAS+iB,SAASC,SAIrC,MAAOC,GACkB,IAAIC,aA7B1BxnB,KA6B4C6E,iBAAiBoF,MA7B7DjK,KA6ByE6E,sBAE3E,CACoB,IAAI2iB,aAhCtBxnB,KAgCwC6E,iBAAiBoF,MAhCzDjK,KAgCqE6E,wBA3B3D,OAAbmgB,EACAO,EAAazhB,MANV9D,MASHumB,EAAgBziB,MATb9D,OAmCNglB,GAnCMhlB,KAmCW6lB,eAClB7M,QAAQC,IAAI,aApCLjZ,KAoCyB6lB,cAAcW,SAGlDiB,EAAkB,WAGbnC,IACDA,EAAsBoB,EAAmB9b,KAHlC5K,OAKNolB,IACDA,EA7Ec,WAGlBsC,EAAqB5jB,MAFV9D,OA4E4B4K,KAN5B5K,OAQNqlB,IACDA,EAAmBkB,EAAgB3b,KAT5B5K,OAWXpB,OAAOmZ,iBAAiB,mBAAoBuN,GAAqB,GAGjE,GAAIrlB,GAAGgE,KAAK0jB,gBAAkB1nB,GAAG2nB,gBAAgBC,UAAY3C,UAAU4C,UAAUC,MAAM,cAAgB7C,UAAU4C,UAAUC,MAAM,UAAW,CACxInpB,OAAOmZ,iBAAiB,WAAYqN,GAAkB,GACtDxmB,OAAOmZ,iBAAiB,WAAYsN,GAAkB,OACnD,CACHzmB,OAAOmZ,iBAAiB,OAAQqN,GAAkB,GAClDxmB,OAAOmZ,iBAAiB,QAASsN,GAAkB,KAiBvDqC,EAAuB,WACvB,IAEInH,EAAkBtgB,GAAGgE,KAAKuc,QAAQwH,qBAF3BhoB,KAEqDe,MAAMqB,gBAAgBE,cAClFie,GAAmBA,EAAgBniB,OAAS,GAC5CuiB,YAAYM,QAJLjhB,KAIkBe,MAAMqB,gBAAgBE,aAA2C,iBAAtB,EAAiCie,EAAkB0H,KAAKC,UAAU3H,KAE1IkG,EAAuB,WACvB,IAAI5d,EAAO7I,KAEX2gB,YAAYwH,QAAQtf,EAAK9H,MAAMqB,gBAAgBE,cAAc4H,KAAK,SAAUyI,GACpD,OAAhBA,GAAwC,SAAhBA,GAA0BA,EAAYvU,OAAS,GACvE6B,GAAGgE,KAAKuc,QAAQC,qBAAqB5X,EAAK9H,MAAMqB,gBAAgBE,aAAcqQ,MAMtFkS,EAAgB,SAAUuD,GAC1B,IAAIvf,EAAO7I,KAEA,IAAImR,QAAQ,SAAUsB,EAASC,GAClC9T,OAAO+hB,YACPlO,IAEAxS,GAAG6gB,QAAQliB,OAAO+hB,YAAa,CAAC1gB,GAAGM,OAAOwgB,IAAIC,aAAc,WACxDvO,QAKPvI,KAAK,WACNyW,YAAYwH,QAAQC,GAAmBle,KAAK,SAAUme,GAClD,GAAmC,MAA/BA,EAAqC,CACrC,MAAMpI,EAASpX,EAAK7E,WAAWmO,cAAc,2CACvCmW,EAAWrI,EAAO9N,cAAc,0BACtCmW,EAAS/I,aAAa,OAAQ6I,GAC9BE,EAAS3d,SAAU,EAEnBrG,SAAS6N,cAAc,gBAAgBoC,YAActU,GAAGgE,KAAKsX,eAAiB1S,EAAK0F,gBAAgB,qBAAuB1F,EAAK0F,gBAAgB,6BAE/I0R,EAAO9N,cAAc,MAAMoC,YAAc6T,GAAqBvf,EAAK9H,MAAMqB,gBAAgBI,qBACrFqG,EAAK0F,gBAAgB,sBAAwB,IAAM1F,EAAK0F,gBAAgB,WACxE1F,EAAK0F,gBAAgB,4BAEzBtO,GAAGgE,KAAKoR,UAAUxM,EAAK7E,WAAWmO,cAAc,iDAK5DtJ,EAAKQ,IAAIoH,MAAOxQ,GAAGgE,KAAKsX,eAAqE1S,EAAK0F,gBAAgB,qBAAzE1F,EAAK0F,gBAAgB,6BAA0E,CACpI3E,KAAM3J,GAAGM,OAAOmQ,QAAQC,WAIhCzL,EAASqjB,aAAe,SAAUppB,GAG9Bc,GAAGgE,KAAKoR,UAFGrV,KAEYgE,WAAWmO,cAAc,6CAA8C,CAC1FoD,cAAe,WAEPtV,GAAGgE,KAAKqJ,WAAWnO,IACnBA,OAKZ,OAAO,GAGX+F,EAASwX,iBAAmB,WACxB,IAAI7T,EAAO7I,KACPwoB,GAAoB,EAEnB3f,EAAK4f,UACN5f,EAAKyY,WAGTzY,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOvB,UAE7B,IACIpC,GAAGgE,KAAKuc,QAAQC,qBAAqB5X,EAAK9H,MAAMqB,gBAAgBK,KAAMoG,EAAK9H,MAAMqB,gBAAgBK,MACnG,MAAOijB,GACDA,EAAMgD,OAASC,aAAaC,mBAC5B3oB,GAAGqc,MAAMzT,EAAK0F,gBAAgB,mCAC7BtO,GAAGylB,MAAMA,GAEd8C,GAAoB,EAGxB,GAAIA,EAAmB,CACnB,GAAI5pB,OAAO4oB,cAAgB5oB,OAAOiqB,oBAAqB,CAInD,MAAMC,EAAiBlqB,OAAO4oB,cAAgB5oB,OAAOiqB,oBACnB,WAA9BC,EAAeC,WACf9D,EAAgB,KACqB,YAA9B6D,EAAeC,WAA0B9D,EAAgB6D,EAC/DA,EAAeE,kBAPU,SAAUD,GACjB,YAAfA,IAA0B9D,EAAgB6D,KAQtDvD,EAAazhB,MAAM+E,GACnB4e,EAAgB3jB,MAAM+E,GAEtBA,EAAK0X,gBAAkBtgB,GAAGgE,KAAKuc,QAAQwH,qBAAqBnf,EAAK9H,MAAMqB,gBAAgBE,cACvF,GAAIuG,EAAK0X,gBAAiB,CACV1X,EAAK0f,aAAa,WAC1B1L,EAAwB7V,KAAK6B,MAI7BA,EAAK4B,MAAMsQ,WAAW3I,aAEvBkO,EAAUtZ,KAAK6B,QACjBgU,EAAwB7V,KAAK6B,IAG1C3D,EAAS0X,mBAAqB,WAC1B,IAAI/T,EAAO7I,KAEPipB,EAAsB,WAEtBpgB,EAAKga,oBAAoB3Y,KAAKga,GAASA,EAAMG,SAE7CqD,EAAqB5jB,MAAM+E,GAE3BA,EAAKG,KAAK8b,aAAY,UAGfjc,EAAKqgB,oBAEPpP,GACDjR,EAAK4I,IAAIU,cAActJ,EAAKjI,eAAiB,iBAAiBuR,cAAc,SAASC,SAhS/E,WACd,IAAIvJ,EAAOsc,EAAenlB,KACrB+kB,EAIDC,EAASmE,UACJjf,KAAK,KACF8a,EAAW,OALnBqB,EAAwBviB,MAAM+E,KAgSlB/E,MAAM+E,IArJD,WAErBjK,OAAOwqB,oBAAoB,mBAAoB9D,GAAqB,GAGpE,GAAIrlB,GAAGgE,KAAK0jB,gBAAkB1nB,GAAG2nB,gBAAgBC,UAAY3C,UAAU4C,UAAUC,MAAM,cAAgB7C,UAAU4C,UAAUC,MAAM,UAAW,CACxInpB,OAAOwqB,oBAAoB,WAAYhE,GAAkB,GACzDxmB,OAAOwqB,oBAAoB,WAAY/D,GAAkB,OACtD,CACHzmB,OAAOwqB,oBAAoB,OAAQhE,GAAkB,GACrDxmB,OAAOwqB,oBAAoB,QAAS/D,GAAkB,MA4InCvhB,MAAM+E,GAEzBA,EAAKiE,IAAIjE,EAAK9H,MAAM6B,MAAMC,gBAC1BgG,EAAKiE,IAAIjE,EAAK9H,MAAM6B,MAAMI,cAE1B6Z,EAAwB7V,KAAK6B,GAE7BA,EAAK4B,MAAM4Q,UAAUjD,MAAQ,GAC7BvP,EAAK4B,MAAM4Q,UAAUQ,UAAW,EAChChT,EAAK4B,MAAMmQ,UAAUiB,UAAW,EAEhChT,EAAK4B,MAAM6Q,SAASlD,MAAQ,GAC5BvP,EAAK4B,MAAM6Q,SAASO,UAAW,EAC/BhT,EAAK4B,MAAMoQ,SAASgB,UAAW,EAE/BhT,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOvB,UAC7BwG,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOD,KAI7B,OAAO,GAGX,GAAIkF,EAAKG,KAAKqgB,iBAAkB,CAC5BxgB,EAAKQ,IAAIoH,MAAM5H,EAAK0F,gBAAgB,4BAA6B,CAC7DkL,SAAU,MAGd,OAAOwP,IACJ,OAAOA,KAIlB/jB,EAASokB,gBAAkB,WACvB,MAAMzgB,EAAO7I,KACb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAClC,IAAI6W,EAAS,GAEb,MAAMC,EAAY,SAAUC,GAEa,IAAjCC,EAAsBtrB,QACtBqrB,EACKra,OAAO2O,GAAgBA,EAAI4L,SAC3B1c,QAAS8Q,GAAQ2L,EAAsBzY,KAAK,CAAEzB,IAAKuO,EAAIvO,IAAKpJ,KAAM6hB,KAAK2B,MAAM7L,EAAI4L,YAE1FlX,EAAQgX,IAGZ9I,YAAYkJ,OACP3f,KAAK,SAAU2f,GAQZ,GAAmB,IAPnBA,EAAOA,EAAKza,OAAO,SAAU0a,GACzB,OAA6D,IAAvDA,EAAE3d,QAAQtD,EAAK9H,MAAMqB,gBAAgBE,eAA2E,IAAnDwnB,EAAE3d,QAAQtD,EAAK9H,MAAMqB,gBAAgBC,WAC7F,UAAU0nB,KAAKD,MAKrB1rB,OAAa,CAClByK,EAAK+J,gBAAkB2W,EACvBC,EAAUD,GAGd,MAAMlW,EAAW,IAAIC,MAAMuW,EAAKzrB,QAChCyrB,EAAK5c,QAAQ,SAAU+c,EAAKxW,GACxBH,EAASG,GAAO,IAAIrC,QAAQ,SAAU8Y,EAAKC,GACvCvJ,YAAYwH,QAAQ6B,EAAK,SAAUphB,EAAGuhB,GAClCF,EAAIE,SAKhBhZ,QAAQC,IAAIiC,GAAUnJ,KAAK,SAAUkgB,GACjC,GAAIA,GAAWA,EAAQhsB,OAAQ,CAC3BgsB,EAAQnd,QAAQ,SAAUsQ,IAClBA,EAAI0K,KAAK2B,MAAMrM,cACFjK,MACbiW,EAASA,EAAOjd,OAAOiR,GAEvBgM,EAAOtY,KAAKsM,KAIpB,IAAI8M,EAAcd,EAAOnrB,OAAS,EAAIksB,EAAaf,GAAUA,EAC7D1gB,EAAK+J,gBAAkByX,EACvBb,EAAUa,QAIrBE,MAAO9E,IACJzM,QAAQC,IAAI,uEACZhZ,GAAGylB,MAAM7c,EAAK0F,gBAAgB,oCAQ9C,IAAI+b,EAAe,SAAUf,GACzB,IAAIc,EAAc,GAElB,IAAK,IAAIvL,KAASyK,EACd,GAAIA,EAAOzK,IAAqC,iBAAnByK,EAAOzK,GAAsB,CACtDuL,EAAYpZ,KAAKsY,EAAOzK,IACxBuL,EAAYG,KAAK,SAAUC,EAAGC,GAC1B,MAAwB,iBAAZD,EAAM,MACPxqB,GAAGgE,KAAKqJ,WAAWmd,EAAExjB,KAAK0jB,eAAiBF,EAAExjB,KAAK0jB,cAAcD,EAAEzjB,MAC7D,IAK5B,OAAOojB,GAIXnlB,EAAS0lB,gBAAkB,SAAUrB,GACjC,MAAM1gB,EAAO7I,KACb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAClC,MAAMW,EAAW,GACjBkW,EAAOtc,QAAQ,SAAU4d,GACrBxX,EAASpC,KAAK,IAAIE,QAAQ,SAAU8Y,EAAKC,GACrCvJ,YAAYM,QAAQpY,EAAK9H,MAAMqB,gBAAgBC,SAAW,IAAMwoB,EAAErb,IAAKyY,KAAKC,UAAU2C,GAAI,SAAUjiB,EAAGuhB,GACnGF,EAAIE,UAKhBhZ,QAAQC,IAAIiC,GAAUnJ,KAAK,WACvBrB,EAAKygB,kBAAkBpf,KAAK,WACxBrB,EAAKuY,aACL3O,WAOhBvN,EAAS4lB,mBAAqB,WAC1B,MAAMjiB,EAAO7I,KACb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAC7B7J,EAAK+J,gBAMNH,EAAQ5J,EAAK+J,iBALb/J,EAAKygB,kBAAkBpf,KAAK,SAAU0I,GAClCH,EAAQG,QASxB1N,EAASkc,WAAa,WAClB,IAAIvY,EAAO7I,KAEO6I,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,MAC9CtJ,QAAQ,SAAUP,GACxBA,EAAGwQ,MAAMC,QAAU,SAGvBtU,EAAKiiB,qBAAqB5gB,KAAK,SAAUqf,GAErC,GAAIwB,EAASxB,GAAS,CAClB1gB,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,yDAAyDtJ,QAAQ,SAAUP,GAC7GA,EAAGwQ,MAAMC,QAAU,KAEvBtU,EAAK4B,MAAMiQ,YAAYmB,UAAW,MAEjC,CACD,MAAMvM,EAAuBzG,EAAK0G,mBAClC,IAAIyb,EACA1b,IACA0b,EAAyB1b,EAAqBG,QAAQD,KAE1D3G,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,eAAetJ,QAAQ,SAAUP,GACnE7D,EAAK4B,MAAMyQ,UAAUgB,YAAYxP,KAGrC,IAAK,IAAIpO,EAAI,EAAGA,EAAIirB,EAAOnrB,OAAQE,IAAK,CACpC,IAAIusB,EAAItB,EAAOjrB,GACI,iBAAR,GACPuK,EAAK+G,gBAAgB/G,EAAKhI,MAAQ,cAAe,CAC7CpB,GAAInB,EAAGkR,IAAKqb,EAAErb,IAAKvI,KAAM4jB,EAAE5jB,KAAO4jB,EAAE5jB,KAAKkE,OAAS,IACnD,SAAU0E,GACT,MACMob,GADS,IAAIC,WACEC,gBAAgBtb,EAAM,aAAatL,KAAK8L,WAC7DxH,EAAK4B,MAAMyQ,UAAU1W,YAAYymB,KAKzCD,GACAniB,EAAKuiB,iBAAiBviB,EAAK4B,MAAMyQ,UAAU/I,cAAc,gBAAkB6Y,EAAyB,OAGxGniB,EAAK4B,MAAMiQ,YAAYmB,UAAW,MAK9C3W,EAASmmB,mBAAqB,WACbrrB,KAERwO,sBAAsBtE,KAAKohB,GAAWA,GAAWA,EAAQC,2BAGlErmB,EAASsmB,iBAAmB,SAAUC,EAAUC,EAASC,EAAUC,GAC/D,IAAI/iB,EAAO7I,KAEX,GAAI6I,EAAK6F,kBAAoB7F,EAAK6F,iBAAiBM,gBAAkBnG,EAAK6F,iBAAiBM,aAAa6c,aAAehjB,EAAK6F,iBAAiBM,aAAagV,eACtJ,OAGJ,IAGI8H,EAHAC,EAAON,EAAS3H,EAChBlC,EAAS/Y,EAAKQ,IAAI1I,QAAQihB,QAAU/Y,EAAKQ,IAAI1I,QAAQihB,OAAOjN,QAAQ,IAAK,WAAQ+L,EAC3EsL,SAASN,EAAQ,GAAGO,QAAQ,IAAI/J,eAAeN,GAGzD,GAAKmK,EAAO,IAAQ,EAAG,CACnBD,EAAO7tB,KAAKmkB,MAAO2J,EAAO,IAAQ,KACxB,SACP,CACHD,EAAO7tB,KAAKmkB,MAAO2J,EAAO,IAAQ,KAAO,IAC/B,MAGdD,EAAOA,EAAK5J,eAAeN,GAE3B,MAAMsK,EAAwCrjB,EAAK2E,oBAAsB3E,EAAK2E,mBAAmBmL,oCAC7FrF,MAAM6Y,QAAQtjB,EAAK2E,mBAAmBmL,qCAAuC9P,EAAK2E,mBAAmBmL,mCAAmCva,OAAS,GACjJyK,EAAK2E,mBAAmBmL,mCAAmC,GAE/D,GAAIuT,GACArjB,EAAK2E,mBAAmBmL,mCAAmC,GAAGyT,OAC7DvjB,EAAK2E,mBAAmBmL,mCAAmC,GAAG0T,aAC9DxjB,EAAK2E,mBAAmBmL,mCAAmC,GAAG2T,eAAgB,CAE/E,IAAI7e,EAAS,IAAI5E,EAAK2E,mBAAmBC,QAEzC,GAAI6F,MAAM6Y,QAAQ1e,IAAW6F,MAAM6Y,QAAQ1e,EAAO,IAAK,CACnDA,EAAOR,QAAQ,CAAC6J,EAAGxY,KACfwY,EAAEyV,OAAO,EAAG,EAAG1jB,EAAK2E,mBAAmBmL,mCAAmC,GAAG6T,IAAIluB,MAGrFuK,EAAK2E,mBAAmBmL,mCAAmC,GAAG0T,WAAaxjB,EAAK2E,mBAAmBmL,mCAAmC,GAAG2T,eAAiB7e,GAIlK,IAAIgf,EACJ,GAAIP,GACArjB,EAAK2E,mBAAmBmL,mCAAmC,GAAG2T,eAAgB,CAC9EG,EAAOxsB,GAAG+I,KAAK0jB,SAASC,WAAWjB,EAAS7iB,EAAK2E,mBAAmBmL,mCAAmC,GAAG2T,gBAC1GG,EAAOT,SAASS,EAAK,GAAGR,QAAQ,IAAI/J,eAAeN,GAGvD,GAAI/Y,EAAK2E,mBAAoB,CACzB,IAAIof,EAAK,EACT,KAAO/jB,EAAK2E,mBAAmBzO,EAAE6tB,IAAOb,GACpCa,IAGJ/jB,EAAK2F,sBAAsBtE,KAAKohB,GAAWA,GACvCA,EAAQuB,kBAAkB3iB,KAAK,SAAUga,GACrC,GAAIA,EAAO,CACPA,EAAM4I,MAAMA,MAAMC,QAAQC,KAAK,CAAEjuB,EAAG8J,EAAK2E,mBAAmBzO,EAAS,IAAP6tB,EAAW,EAAIA,EAAK,KAClF1I,EAAMlb,KAAKikB,4BAM/B/nB,EAASgoB,SAAW,SAAUC,EAAUC,GACpC,IAAIC,EAAOD,EAASD,EAChBrJ,EAAI,GACJwJ,EAAiBrvB,KAAKsvB,MAAMF,EAAO,IAAO,GAAK,GAAK,IACxDA,GAAyB,IAAjBC,EAAwB,GAAK,GAAK,GAE1C,IAAIE,EAAkBvvB,KAAKsvB,MAAMF,EAAO,IAAO,GAAK,IACpDA,GAA0B,IAAlBG,EAAyB,GAAK,GAEtC1J,EAAE2J,EAAID,EAAoC,GAAjBF,EAEzB,IAAII,EAAoBzvB,KAAKsvB,MAAMF,EAAO,IAAO,IACjDA,GAA4B,IAApBK,EAA2B,GAEnC5J,EAAExM,EAAIoW,EAEN5J,EAAE6J,EAAI1vB,KAAKsvB,MAAMF,EAAO,KAExB,OAAOptB,GAAGgE,KAAK2pB,OAAO,GAAI9J,EAAG,CAAEhR,UAAW,QAAUgR,EAAE2J,GAAGI,OAAO,GAAK,KAAO,QAAU/J,EAAExM,GAAGuW,OAAO,GAAK,KAAO,QAAU/J,EAAE6J,GAAGE,OAAO,MAGxI3oB,EAAS0a,cAAgBnR,eAAgB/B,GACrC,IAAI7D,EAAO7I,KAEX,MAAMsrB,QAAgBziB,EAAK2F,sBAC3B8c,EAAQC,yBACR1iB,EAAKuX,eAAiB,EACtB,GAAIvX,EAAK0G,qBAAuB7C,GAC5B4e,EAAQtc,cAAgBsc,EAAQtc,aAAa8d,OAASxB,EAAQtc,aAAa8d,MAAMA,MAAO,CACnFjkB,EAAKilB,eACNjlB,EAAKilB,aAAyD,IAA1CxC,EAAQyC,0BAA0BC,KAAuD,IAA1C1C,EAAQyC,0BAA0B/uB,KAEzG6J,EAAKG,KAAK4W,qBAEV/W,EAAK6W,UAAUhT,GAAI,GAAOxC,KAAK,WAC3B,GAAIrB,EAAK2E,oBAC2B,IAAhC3E,EAAK2E,mBAAmBwgB,KACQ,IAAhCnlB,EAAK2E,mBAAmBxO,IAAW,CACnC6J,EAAKQ,IAAIoH,MAAM5H,EAAK0F,gBAAgB,0BAA2B,CAAEkL,SAAU,MAC3E5Q,EAAKilB,cAAe,OACqB,IAAhCjlB,EAAK2E,mBAAmBwgB,KAA6C,IAAhCnlB,EAAK2E,mBAAmBxO,MACtE6J,EAAKilB,cAAe,GAGxBjlB,EAAKG,KAAK4W,mBAKtB1a,EAASwa,UAAY,SAAUhT,EAAIuhB,GAC/B,IAAIplB,EAAO7I,KAEX6I,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAE7B6gB,EAAyB1d,KAAK6B,GAC9B,OAAO,IAAIsI,QAAQ,SAAUsB,EAASC,GAClC7J,EAAKuiB,iBAAiB1e,GACtB7D,EAAKqlB,iBAAiBxhB,GAAIxC,KAAK,WAC3BrB,EAAKslB,eAAezhB,GAAIxC,KAAK,KACzBrB,EAAKyY,WAEL7O,MACD8X,MAAM7X,QAKrB,MAAMgX,EAAwB,GAExBnR,EAA+B,SAAU/I,GAC3C,OAAOka,EAAsBta,OAAO,SAAU2O,GAC1C,OAAOA,EAAIvO,IAAIsD,aAAetD,EAAIsD,aACnC,IAyBDsb,EAA4B,GAyBlC,MAAMrV,EAAiC,SAAUhQ,GAC7C,IAAIslB,EAAYD,EAA0Bhf,OAAO,SAAU2O,GACvD,OAAOA,EAAIhV,UAAYA,IACxB,GACH,OAAKslB,GACMD,EAA0Bhf,OAAO,SAAU2O,GAC9C,OAAmE,IA7BhE,SAAUuQ,EAAIC,GAIzB,IAFA,IAAI9D,EAAI,GAAI4C,EAAO,GAEV/uB,EAAI,EAAGA,EAAIgwB,EAAGlwB,OAAQE,IAC3BmsB,EAAE6D,EAAGhwB,KAAM,EAGf,IAASA,EAAI,EAAGA,EAAIiwB,EAAGnwB,OAAQE,IACvBmsB,EAAE8D,EAAGjwB,WACEmsB,EAAE8D,EAAGjwB,IAEZmsB,EAAE8D,EAAGjwB,KAAM,EAInB,IAAK,IAAIwrB,KAAKW,EACV4C,EAAKpc,KAAK6Y,GAGd,OAAOuD,EASQmB,CAASzQ,EAAIhV,QAAQoL,SAAUpL,EAAQoL,UAAU/V,SAEzD,IAMLmb,EAA4B,SAAUxQ,EAAS3C,GACjD,IAAIkD,EAASyP,EAA+BhQ,GAC5C,IAAKO,EAAQ,CACTA,EAAS,CACLP,QAASA,GAEbqlB,EAA0Bnd,KAAK3H,GAEnCA,EAAOlD,KAAOA,EACd,OAAOkD,GAELmlB,EAAS,SAAU7X,GACrB,OAAO3W,GAAG8I,QAAQqE,UAAYwJ,aAAgB3W,GAAG8I,QAAQqE,UAQvDwL,EAAmB,WACrB,OAAO5Y,KAAKkJ,WAAWqD,SAClB6C,OAAO,SAAUwH,GACd,OAAO3W,GAAG8I,QAAQsG,UAAYuH,aAAgB3W,GAAG8I,QAAQsG,UACpDof,EAAO7X,MAIxB1R,EAASipB,eAAiB,SAAUzhB,EAAIgiB,GACpC,IAAI7lB,EAAO7I,KAEX,OAAO,IAAImR,QAAQ,CAACsB,EAASC,KACzB,GAAIgc,EAAJ,CACI7lB,EAAKG,KAAKmX,iBAAiBuO,GAC3B7lB,EAAKqV,YAAW,EAAOxR,OAF3B,CAKA,IAAK7D,EAAK8lB,SAAU,CAChB9lB,EAAK8lB,SAAW9lB,EAAKslB,eAAevjB,KAAK/B,EAAM6D,GAAI,GACnD9N,OAAOmZ,iBAAiB,SAAUlP,EAAK8lB,UAAU,GAErD9lB,EAAK2F,sBAAsBtE,KAAKuE,eAAgB6c,GAC5C,GAAIA,EAAS,CACT,IAAIhT,EAAgBC,EAA6B7L,EAAG+C,QAAQD,KAC5D,GAAK8I,EAuEE,CACEzP,EAAKlI,QAAQgO,yBACP2J,EAAclS,KAAKuS,mCAAmC,GAEjE9P,EAAK2E,mBAAqB8K,EAAclS,KACxCklB,EAAQuB,kBAAkB3iB,KAAK,SAAU8E,GACrCA,EAAasV,gBAAgBpa,KAAK,WAC9B8E,EAAa4f,YACbtD,EAAQuD,uBAAuBhmB,EAAK2E,sBAExCwB,EAAaC,0BAjFD,CAChB,MAAMxE,QAAc5B,EAAKimB,gBAAgBpiB,GACzC,GAAI7D,EAAKK,YAAcL,EAAKK,WAAWqD,SAAU,CAC7C,IAAIA,EAAW1D,EAAKK,WAAWqD,SAAS6C,OAAQmE,GACrCkb,EAAOlb,KACR9I,EAAM8G,SAAW2B,GAAGW,KAAKkb,eAAeC,MACtCvkB,EAAM8G,SAAW2B,GAAGW,KAAKkb,eAAeE,KAAQpmB,EAAKlI,QAAQgO,mBAGzE,GAAIpC,EAASnO,OAAS,EAAG,CACrB,IAAIiJ,EAAOkF,EAAS,GAChB2iB,EAAO,GAEX,GAAIzkB,EAAM8G,QAAU2B,GAAGW,KAAKkb,eAAeC,MACvCvkB,EAAM8G,QAAU2B,GAAGW,KAAKkb,eAAeI,IAAK,CAC5C,IAAI9B,EAAO,EAEPA,EADA5iB,EAAM8G,QAAU2B,GAAGW,KAAKkb,eAAeC,KAChC3nB,EAAK8M,SAAS9M,EAAK8M,SAAS/V,OAAS,GAAG,GAAKiJ,EAAK8M,SAAS,GAAG,GAE9D9M,EAAK8M,SAAS9M,EAAK8M,SAAS/V,OAAS,GAAG,GAAKiJ,EAAK8M,SAAS,GAAG,GAEzE+a,EAAO,CACHvB,EAAG1vB,KAAKsvB,MAAOF,EAAO,IAAQ,IAC9B/V,EAAGrZ,KAAKsvB,MAAQF,EAAO,IAAe,IACtCI,EAAGxvB,KAAKsvB,MAAQF,EAAO,KAAoB,KAInD,IAAI1sB,EAAU,CACVyuB,mBAAmB,EACnBC,uBAAwBxmB,EAAKlI,QAAQgO,iBACrC2gB,eAAe,EACfJ,KAAMA,EACN/vB,SAAU,WACN0J,EAAK2E,mBAAqB8d,EAAQyC,0BAClCllB,EAAKilB,aAAyD,IAA1CxC,EAAQyC,0BAA0BC,KAAuD,IAA1C1C,EAAQyC,0BAA0B/uB,KA5I3G,SAAU+J,EAAS3C,EAAMmpB,GACnD,MAAM1mB,EAAO7I,KACb,IAAIsJ,EAASiP,EAA6BgX,GAC1C,IAAKjmB,EAAQ,CACTA,EAAS,CACLkG,IAAKggB,WAAWD,IAEpB7F,EAAsBzY,KAAK3H,GAC3BT,EAAKiiB,qBAAqB5gB,KAAK,SAAUqf,GACrC,GAAIA,EAAQ,CACR,IAAIzK,EAAQyK,EAAOkG,UAAW5E,GAAeA,EAAErb,IAAIsD,aAAeyc,GAClE,GAAIzQ,GAAS,EAAG,CACZyK,EAAOzK,GAAO6K,QAAU1B,KAAKC,UAAU9hB,GACvCyC,EAAK+hB,gBAAgBrB,OAKrCjgB,EAAOlD,KAAOA,EACd,OAAOkD,IA0H+CtC,KAAK6B,EAlEpC,WACvB,OAAO7I,KAAKkJ,WAAWqD,SAClB6C,OAAO,SAAUwH,GACd,OAAO6X,EAAO7X,KACf,IA8D6E5P,KAAK6B,GAAOyiB,EAAQyC,0BAA2BrhB,EAAG+C,QAAQD,KAG9G7G,EAAkBA,EAAgBiC,KAAK/B,GACvCA,EAAKQ,IAAIqC,GAAGzL,GAAGM,OAAOC,MAAM+P,cAAe5H,GAE3C+mB,kBAAkBje,IAAIsG,iBAAiB,YAAa,SAAUnP,GACtDC,EAAKK,YAAcL,EAAKK,WAAWymB,iBAAmB9mB,EAAKK,WAAW0mB,aAAe,GACrF/mB,EAAKG,KAAKilB,iBAAiBjnB,KAAK6B,EAAKG,QAE7C0mB,kBAAkBje,IAAIsG,iBAAiB,WAAY,SAAUnP,GACrDC,EAAKK,aAAgBL,EAAKK,WAAWymB,iBAAmD,GAAhC9mB,EAAKK,WAAW0mB,cACxE/mB,EAAKG,KAAK6mB,mBAAmB7oB,KAAK6B,EAAKG,QAG/CH,EAAKQ,IACAqC,GAAGzL,GAAGM,OAAOC,MAAMsvB,gBAAiB,WAAcjnB,EAAKwiB,uBACvD3f,GAAGzL,GAAGM,OAAOC,MAAMuvB,kBAAmB,WAAclnB,EAAKwiB,uBAG9DC,EAAQuB,kBAAkB3iB,KAAK,SAAU8E,GACjBnG,EAAK0G,qBAErBP,EAAaG,eAAetD,SAAW6D,EAAoB1I,KAAK6B,EAAMA,EAAK0G,yBAK3F+b,EAAQ0E,wBAAwB3oB,EAAM1G,QAEtC+R,SAGJA,IAeRD,SAEAC,MAEL6X,MAAM7X,OAIjBxN,EAASkH,MAAQ,SAAUvC,GACvB,IAAIhB,EAAO7I,KAEX,GAAI6I,EAAK8lB,SAAU,CACf/vB,OAAOwqB,oBAAoB,SAAUvgB,EAAK8lB,UAAU,GACpD9lB,EAAK8lB,cAAWjO,EAGpB,GAAI7W,GAAahB,EAAK9H,MAAM6C,OAAOC,MAAO,CAEtCgF,EAAKK,WAAW+mB,gBAGhBpnB,EAAK2F,sBAAsBtE,KAAKohB,GAAWA,GAAWA,EAAQ4E,gCACvDrnB,EAAK2E,mBAGZ3E,EAAKG,KAAKmX,mBAEVtX,EAAKG,KAAKoD,QAGVvD,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,MAAMtJ,QAAQ,SAAUP,GAC1DA,EAAGgF,UAAUQ,OAAOrJ,EAAK9H,MAAMC,QAAQG,iBAG3C0H,EAAKQ,IAAIiJ,QAAQzJ,EAAK9H,MAAM6B,MAAMQ,YAElCyF,EAAKnD,gBAAkB,GAElBmD,EAAKkW,qBACClW,EAAKkM,YAKb,CACHlM,EAAK2C,cAAcykB,gBACnBpnB,EAAKsB,SAAS8lB,kBAItB/qB,EAASwY,UAAY,SAAU/c,GAC3B,MAAMkI,EAAO7I,KACb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAClC,IAAIyd,EAAUxvB,EAAQwvB,SAAWtnB,EAAK0F,gBAAgB,sBAEtD,IAAI6hB,EAAQ,SAAUtnB,GAClB,IAAI8H,EACJA,EAAO/H,EAAK8D,sBAAsBkE,UAElC,IAAIwK,EAAY1a,EAAQmQ,kBAAoBjI,EAAK4B,MAAM4Q,UAAUjD,MAAMjN,OAEnEoe,EAAS1gB,EAAK+J,gBACb2W,IACDA,EAAS,IAGb,IAAI8G,EAAYxnB,EAAKG,KAAK4b,mBAAmB9b,GAAO,EAAMnI,EAAQ2Q,cAE9Dgf,EAAQ,SAAU1f,GAClB/H,EAAK4B,MAAM4Q,UAAUjD,MAAQ,GAC7BvP,EAAK4B,MAAM4Q,UAAUQ,UAAW,EAChChT,EAAK4B,MAAMmQ,UAAUiB,UAAW,EAEhChT,EAAK4B,MAAM6Q,SAASlD,MAAQ,GAC5BvP,EAAK4B,MAAM6Q,SAASO,UAAW,EAC/BhT,EAAK4B,MAAMoQ,SAASgB,UAAW,EAE/BhT,EAAK8D,sBAAsBC,WAAWgE,GAEtC8T,EAAyB1d,KAAK6B,IAG9B0nB,EAAW,CACXtpB,KAAMoU,EACNjV,KAAMiqB,EAAU9jB,SAChBgF,OAAQ8e,EAAU9e,OAClB+H,IAAKzQ,EAAK9D,YAGd,MAAMyrB,EAAmB,SAAUC,GAE/B,IAAIC,EAAYzI,KAAK2B,MAAM3B,KAAKC,UAAUuI,IAE1CC,EAAUtqB,KAAOsqB,EAAUtqB,KAAKuO,QADlB,kCACiC,MAE/C,OAAOgc,QAAQ1I,KAAKC,UAAUwI,KAGlCzwB,GAAG6gB,QACEliB,OAAO+xB,QACR,CAAC1wB,GAAGI,YAAcJ,GAAGM,OAAOwgB,IAAI6P,MAChC,WACI,IAAI1pB,EAAOspB,EAAiBD,GAExBM,EAAetH,EAAOlgB,IAAI,SAAUynB,GACpC,IAAIC,EAAc9I,KAAK2B,MAAM3B,KAAKC,UAAU4I,WACrCC,EAAYvhB,WACZuhB,EAAYpH,QAEnB,GAAIziB,IAASspB,EAAiBO,GAC1B,OAAOD,EAAWthB,IACf,CACH,MAAMwhB,EAAa,IAAI9d,GAAGjH,OAAOkH,QAEjC,IAAI5G,EAAWykB,EAAW5d,aAAa2d,EAAY3qB,MAE/C6qB,EAAYhzB,KAAK+U,IAAI,GAAI/S,GAAGM,OAAO0S,iBAAmB,GAE1D1G,EAASU,QAAQ,SAAUlE,GACvB,IAAI8K,EAAO5T,GAAGgE,KAAKitB,gBAAgBjxB,GAAGgE,KAAKktB,gBAAgBpoB,EAAQqoB,cAAcC,iBAAkBJ,IACnGloB,EAAQqoB,cAAcE,eAAezd,KAGzCkd,EAAY3qB,KAAO4qB,EAAWO,cAAchlB,GAE5C,OAAIrF,IAASypB,QAAQ1I,KAAKC,UAAU6I,IACzBD,EAAWthB,IAEX,QAIhBJ,OAAO,SAAUI,GAChB,OAAe,OAARA,IAGX,MAAMgiB,EAAgB,SAAUhiB,GAC5B,OAAO3G,EAAKygB,kBAAkBpf,KAAK,WAC/BrB,EAAKuY,aAEL,IAAItC,EACJ,IAAK,IAAIxgB,EAAI,EAAGA,EAAIuK,EAAK+J,gBAAgBxU,OAAQE,IAC7C,GAAIuK,EAAK+J,gBAAgBtU,GAAGkR,MAAQA,EAAK,CACrCsP,EAAQxgB,EACR,MAIR,OAAOwgB,KAIf,GAA4B,IAAxB+R,EAAazyB,OAAc,CAC3BmyB,EAAS/gB,IAAMlQ,KAAKR,MAAQb,KAAKwzB,SACjClI,EAAOtY,KAAKsf,GACZhH,EAASe,EAAaf,GAEtB,IACI1gB,EAAK+hB,gBAAgBrB,GAAQrf,KAAK,WAC9BrB,EAAKQ,IAAIoH,MAAM0f,EAAS,CAAE1W,SAAU,MAEpC6W,EAAM1f,GAEN4gB,EAAcjB,EAAS/gB,KAAKtF,KAAK,SAAU4U,GACvCrM,EAAQqM,OAIlB,MAAO4G,GACLzlB,GAAGqc,MAAMzT,EAAK0F,gBAAgB,8BAAgC,KAAOmX,EAAMyK,SAC3EG,EAAM1f,GACN8B,EAAOgT,QAER,CACH1M,QAAQC,IAAI,yCAEZqX,EAAM1f,GAEN4gB,EAAcX,EAAa,IAAI3mB,KAAK,SAAU4U,GAC1CrM,EAAQqM,SAqB5B,GAAIjW,EAAKiI,iBACLsf,EAAMvnB,EAAKK,iBACV,GAAgD,GAA5CL,EAAK4B,MAAM4Q,UAAUjD,MAAMjN,OAAO/M,OAAa,CACpDyK,EAAK4B,MAAM4Q,UAAUjD,OAAQ,IAAI9Y,MAAO4iB,iBACxCkO,EAAMvnB,EAAK2C,oBAGX4kB,EAAMvnB,EAAK2C,kBAKvBtG,EAASyY,YAAc,WACnB,IAEI+T,EAFO1xB,KAEayK,MAAM6Q,SAASlD,MAAMjN,OACxCumB,IACDA,GAAe,IAAIpyB,MAAO4iB,kBAG9B,IAAItR,EAPO5Q,KAOK2M,sBAAsBkE,UAEtC6T,EAAyB1d,KATdhH,MAAAA,KAWNgJ,KAAK2U,YAXC3d,KAWgB2kB,aAAa1C,SAAU,CAC9Chb,KAAMyqB,EACNlF,IAbOxsB,KAaG2kB,aAAagN,QACvBzC,MAAM,IAAI5vB,MAAOC,YAdVS,KAiBNyK,MAAM6Q,SAASlD,MAAQ,GAjBjBpY,KAkBNyK,MAAM6Q,SAASO,UAAW,EAlBpB7b,KAmBNyK,MAAMoQ,SAASgB,UAAW,EAG/B5b,GAAGgE,KAAKuc,QAAQC,qBAtBLzgB,KAsB+Be,MAAMqB,gBAAgBE,aAtBrDtC,KAsBwEgJ,KAAK4b,mBAtB7E5kB,KAsBqGwL,eAAee,UAtBpHvM,KAwBN2M,sBAAsBC,WAAWgE,IAG1C1L,EAAS4a,cAAgB,SAAU8R,EAASC,GACxC,IAAIhpB,EAAO7I,KAEX6I,EAAKiiB,qBAAqB5gB,KAAK,SAAUqf,GACrC,GAAIA,GACIA,EAAOqI,GAAU,CACjBrI,EAAOqI,GAAS3qB,KAAO4qB,EAEvBhpB,EAAK+hB,gBAAgBrB,OAMrCrkB,EAAS2a,YAAc,SAAUnT,GAC7B,IAAI7D,EAAO7I,KAEX6I,EAAKiiB,qBAAqB5gB,KAAK,SAAUqf,GACrC,GAAIA,EAAQ,CACR,IAAIuI,EAASplB,EAAG+C,QAAQhQ,GACxB,GAAI8pB,EAAOuI,GAAS,CAChB,IAAItiB,EAAM+Z,EAAOuI,GAAQtiB,IAEzBvP,GAAG8xB,QAAQlpB,EAAK0F,gBAAgB,wBAAyB,WAErD,MAAM2G,EAAgBrM,EAAK0G,mBACvB2F,GAAiBA,EAAczF,QAAQhQ,KAAOqyB,GAC9CjpB,EAAKuD,MAAMvD,EAAK9H,MAAM6C,OAAOC,OAGjC8c,YAAYC,WAAW/X,EAAK9H,MAAMqB,gBAAgBC,SAAW,IAAMmN,GAAKtF,KAAK,WACzErB,EAAKygB,kBAAkBpf,KAAK,WACxBrB,EAAKuY,iBAEVmJ,MAAM,SAAU9E,GACfzM,QAAQC,IAAIwM,MAGjB,mBAMnBvgB,EAASkmB,iBAAmB,SAAU1e,GAClC,IAAI7D,EAAO7I,KAEN6I,EAAK4f,UACN5f,EAAKyY,WAGTzY,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,sBAAsBtJ,QAAQ,SAAU+M,GAC1EA,EAAKuF,aAAa,QAASvF,EAAKzF,eAEpC1L,EAAK4B,MAAMyQ,UAAU3E,iBAAiB,MAAMtJ,QAAQ,SAAUP,GAC1DA,EAAGgF,UAAUQ,OAAOrJ,EAAK9H,MAAMC,QAAQG,iBAG3CuL,EAAGgF,UAAUO,IAAIpJ,EAAK9H,MAAMC,QAAQG,eAEpCuL,EAAG6S,aAAa,QAAS1W,EAAK0F,gBAAgB,gBAAkB,IAAM7B,EAAGyF,cAAc,QAAQoC,aAC/F7H,EAAGyF,cAActJ,EAAK9H,MAAMO,SAASE,MAAM+d,aAAa,QAAS7S,EAAGwU,aAAa,UAE5ErY,EAAKkW,qBACClW,EAAKkM,SAIpB7P,EAASqK,iBAAmB,WAGxB,OAFWvP,KAECyK,MAAMyQ,UAAU/I,cAAc,MAF/BnS,KAE4Ce,MAAMC,QAAQG,gBAGzE+D,EAAS8sB,mBAAqB,WAC1B,MAAMnpB,EAAO7I,KAEPiyB,EAAWppB,EAAK0G,mBACtB,GAAI0iB,EAAU,CAEV,GAAIppB,EAAK8lB,SAAU,CACf/vB,OAAOwqB,oBAAoB,SAAUvgB,EAAK8lB,UAAU,GACpD9lB,EAAK8lB,cAAWjO,EAGpBuR,EAASvgB,UAAUQ,OAAOrJ,EAAK9H,MAAMC,QAAQG,eAC7C8wB,EAAS1S,aAAa,QAAS0S,EAAS1d,aACxC0d,EAAS9f,cAActJ,EAAK9H,MAAMO,SAASE,MAAM+d,aAAa,QAAS0S,EAAS/Q,aAAa,iBAEtFrY,EAAKkM,UAIpB7P,EAASiE,eAAiB,WACXnJ,KACNgJ,KAAK6mB,qBADC7vB,KAESuP,oBAFTvP,KAIFgyB,qBAET,GANWhyB,KAMF0vB,kBAAmB,CANjB1vB,KAQF0vB,kBAAkBje,IAAI2X,oBAAoB,YARxCppB,KAQ0D0vB,kBAAkBG,oBAR5E7vB,KASF0vB,kBAAkBje,IAAI2X,oBAAoB,WATxCppB,KASyD0vB,kBAAkBzB,kBAT3EjuB,KAWF0vB,kBAAkBrL,QAXhBrkB,KAcNoM,MAdMpM,KAcKe,MAAM6C,OAAOC,QAGjCqB,EAASgpB,iBAAmB,SAAUxhB,GAClC,MAAM7D,EAAO7I,KAEb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAClC7J,EAAKG,KAAKoD,QAEVvD,EAAKimB,gBAAgBpiB,GAAIxC,KAAK,SAAUO,GACzBA,EAAMrE,KACbqE,EAAMrE,MACNyC,EAAKG,KAAKklB,iBAAiBzjB,GAAOP,KAAK,WACnC,IAAIgoB,EAAerpB,EAAKK,WAAWqD,SACnC,GAAI2lB,GAAgBA,EAAa9zB,OAAS,EAAG,CAEzC,IAAI+zB,EAAcD,EAAa9iB,OAAO,SAAUrG,GAC5CA,EAAQqpB,YAAa,EACrB,SAAInyB,GAAG8I,QAAQkL,eAAiBlL,aAAmB9I,GAAG8I,QAAQkL,gBAEnDlL,aAAmB9I,GAAG8I,QAAQqE,WAI1C/D,IAAI,SAAUN,GACb,OAAI9I,GAAG8I,QAAQkL,eAAiBlL,aAAmB9I,GAAG8I,QAAQkL,cACnDlL,EAAQoL,SAAS,GACjBpL,aAAmB9I,GAAG8I,QAAQqE,SAC9BrE,EAAQoL,cADZ,IAGR,GAEH,GAAIge,EAAa,CACb,IAAIE,EAAQF,EAAY,GACpBG,EAAOH,EAAYA,EAAY/zB,OAAS,GAExCi0B,GAAWA,IAAUC,GACrBzpB,EAAKK,WAAWqpB,UAAUF,EAAMxE,QAAQtB,OAAO,EAAG,GAAI,CAClD6F,YAAY,EAAOI,SAAU3pB,EAAKhI,MAAQ,yBAA0B4xB,OAAQ,CAAC,GAAK,GAAIC,WAAW,IAIrGJ,GACAzpB,EAAKK,WAAWqpB,UAAUD,EAAKzE,QAAQtB,OAAO,EAAG,GAAI,CACjD6F,YAAY,EAAOI,SAAU3pB,EAAKhI,MAAQ,qBAAsB4xB,OAAQ,CAAC,GAAK,GAAIC,WAAW,KAK7G7pB,EAAKK,WAAWiY,eAAc,GAC9B1O,WAMpBvN,EAAS4pB,gBAAkB,SAAUpiB,GACjC,MAAM7D,EAAO7I,KACb,OAAO,IAAImR,QAAQ,SAAUsB,EAASC,GAClC7J,EAAKiiB,qBAAqB5gB,KAAK,SAAUqf,GACrC,GAAIA,EAAQ,CACR,MAAMuI,EAASplB,EAAG+C,QAAQhQ,GAC1B,GAAI8pB,EAAOuI,GAAS,CAChB,IAAIrnB,EAAQ8e,EAAOuI,GAAQ1rB,KAI3BqE,EAAQ5B,EAAKG,KAAK2pB,qBAAqBloB,GAEvCgI,EAAQ,CAAErM,KAAMqE,EAAO8G,OAAQgY,EAAOuI,GAAQvgB,eAGlDkB,SAMhBvN,EAAS8a,OAAS,SAAUtT,GAExB,OADW1M,KACCgJ,KAAKgX,OAAOtT,IAI5BxH,EAASmX,eAAiB,SAAUuW,GAChC,MAAM9W,EAAOxX,SAAS4L,cAAc,QAC9BtJ,EAASgsB,EAAUzY,cACzBvT,EAAOmV,aAAaD,EAAM8W,GAC1B9W,EAAKtX,YAAYouB,GACjB9W,EAAKE,QAELF,EAAKG,sBAAsB,WAAY2W,GACvChsB,EAAOsV,YAAYJ,IAGvB5W,EAASyH,oBAAsB,WAG3B,IAFW3M,KAED6yB,QAAS,CAFR7yB,KAGF6yB,QAHE7yB,KAGaqJ,IAAIoa,mBAAmBxjB,GAAGC,QAAQ4yB,kBAH/C9yB,KAIE6yB,SAJF7yB,KAIkB6yB,QAAQz0B,OAAS,IAJnC4B,KAKE6yB,QALF7yB,KAKiB6yB,QAAQ,IAGpC,OARW7yB,KAQC6yB,SAGhB3tB,EAAS6tB,iBAAmB,SAAUrN,GAClC,IAmBIsN,EAjBJ,GAAI9N,UAAU+N,YAAa,CAFhBjzB,KAGEkzB,iBACLhO,UAAU+N,YAAYE,WAJnBnzB,KAImCkzB,iBAC1C,GALOlzB,KAKEozB,mBAAoB,CALtBpzB,KAMEozB,mBANFpzB,KAM4BozB,8BAA8B9f,MAN1DtT,KAMuEozB,mBAAqB,CAN5FpzB,KAMkGozB,oBANlGpzB,KAQEozB,mBAAmBnmB,QAAQ,SAAUomB,GACtCnO,UAAU+N,YAAYE,WAAWE,KATlCrzB,KAYEozB,mBAAqB,IAZvBpzB,KAgBFszB,wBAhBEtzB,KAiBF2M,sBAAsBC,WAjBpB5M,KAiBoCszB,wBAG/C,OAAQ5N,EAAMgD,MACV,KAAKhD,EAAM6N,kBACPP,EAtBGhzB,KAsBauO,gBAAgB,+BAChC,MACJ,KAAKmX,EAAM8N,qBACPR,EAzBGhzB,KAyBauO,gBAAgB,kCAChC,MACJ,KAAKmX,EAAM+N,QACPT,EA5BGhzB,KA4BauO,gBAAgB,qBAChC,MACJ,QACIykB,EA/BGhzB,KA+BauO,gBAAgB,qBA/B7BvO,KAmCNqJ,IAAIoH,MAAMuiB,EAAU,CAAEppB,KAAM3J,GAAGM,OAAOmQ,QAAQC,UAEnD,IArCW3Q,KAqCDkpB,qBArCClpB,KAqC2ByK,MAAO,CArClCzK,KAsCFyK,MAAM+P,eAAe9I,UAAUQ,OAAOjS,GAAGM,OAAOqR,QAAQqF,QAtCtDjX,KAuCFyK,MAAMgQ,iBAAiB/I,UAAUO,IAAIhS,GAAGM,OAAOqR,QAAQqF,UAIpE,IAAI8T,EAAW,SAAU2I,GACrB,OAAQA,GAAsB,IAAfA,EAAIt1B,QAGvB8G,EAASyuB,YAAc,WACnB,MAAM9qB,EAAO7I,KAEb,GAAI6I,EAAKK,YAAcL,EAAK4B,OAAS5B,EAAKkM,QAAS,CAC/C,IAAIkS,EAAQ,CACRxnB,GAAIoJ,EAAKpJ,IAEb,IAAKoJ,EAAKkM,SAAWlM,EAAKkM,UAAYlM,EAAKkM,QAAQ6e,OAAQ,CACvD/qB,EAAKkM,QAAU,CAAE6e,QAAQ,GACzB,IAAIC,EAAgB/sB,OAAOmH,OAAO,GAAIpF,EAAKkM,SACvCxI,EAAW1D,EAAKK,WAAWqD,SAE/B,GAAIA,EAASnO,OAAS,GAAKyK,EAAKnD,iBAAmBmD,EAAKnD,gBAAgBtH,OAAS,EAC7Ey1B,EAActnB,SAAW1D,EAAKnD,oBAC3B,CACH,MAAMouB,EAAajrB,EAAKK,WAAWyqB,YAAY,CAC3CpnB,SAAUA,IAGdsnB,EAActnB,SAAWunB,EAAWvnB,SAGxC,MAAM2I,EAAgBrM,EAAK0G,mBACvB2F,IACA2e,EAAcxY,UAAYnG,EAAc/C,cAAc,QAAQrC,WAElEmX,EAAM8M,YAAc9L,KAAKC,UAAU2L,QAEnC5M,EAAM8M,YAAc9L,KAAKC,UAAUrf,EAAKkM,SAG5C,OAAOkS,EAGP,OAAO,MAIf/hB,EAAS8uB,YAAc,SAAU/M,GAC7B,MAAMpe,EAAO7I,KACb,GAAI6I,EAAKQ,KACD4d,EAAM8M,aAAe9M,EAAM8M,YAAY31B,OAAQ,CAC/CyK,EAAKorB,SACL,IAAIC,EAAoBjM,KAAK2B,MAAM3C,EAAM8M,aAEzC,GAAIG,EAAkB3nB,UAAY2nB,EAAkB3nB,SAASnO,OAAS,EAAG,CACrE,MAAMiV,EAAW,IAAIC,MAAM4gB,EAAkB3nB,SAASnO,QACtD81B,EAAkB3nB,SAASU,QAAQ,SAAUsG,EAAGC,GAC5C,MAAM2gB,EAAiB,CAAE/tB,KAAMmN,EAAEnN,KAAM3G,GAAI8T,EAAE9T,GAAI2yB,WAAY7e,EAAE6e,YAC/D,IACIve,EAAON,EAAEM,KACb,OAAQN,EAAE3J,MACN,KAAK3J,GAAGM,OAAOsT,KAAKG,SAChBX,EAASG,GAAO,IAAIvT,GAAG8I,QAAQqE,SAASyG,EAAMsgB,GAC9C,MACJ,KAAKl0B,GAAGM,OAAOsT,KAAKK,cAChBb,EAASG,GAAO,IAAIvT,GAAG8I,QAAQkL,cAAcJ,EAAMsgB,GACnD,MACJ,KAAKl0B,GAAGM,OAAOsT,KAAKC,OAChBT,EAASG,GAAO,IAAIvT,GAAG8I,QAAQsG,OAAOwE,EAAMsgB,GAC5C,MACJ,KAAKl0B,GAAGM,OAAOsT,KAAKE,MAChBV,EAASG,GAAO,IAAIvT,GAAG8I,QAAQmE,MAAM2G,EAAMsgB,MAKvD,GAAID,EAAkBntB,eAAe,UAAW,CAC5C8B,EAAKkW,cAAe,EACpBlW,EAAKkM,QAAU,CAAE6e,OAAQM,EAAkBN,QAG/CziB,QAAQC,IAAIiC,GAAUnJ,KAAK,SAAUyJ,GACjC,IAAIhT,EAAU,CAAE4L,SAAUoH,EAAY9H,SAAUqoB,EAAkB7Y,UAAW/J,cAAc,EAAMe,UAAU,GACtGxJ,EAAK+J,gBAKN/J,EAAKkE,YAAYpM,GAJjBkI,EAAKygB,kBAAkBpf,KAAK,WACxBrB,EAAKkE,YAAYpM,UA9vFjD","sourcesContent":["/**\r\n  * Opciones del control GPS y rutas.\r\n  * @typedef GeolocationOptions\r\n  * @extends ControlOptions\r\n  * @see MapControlOptions\r\n  * @property {HTMLElement|string} [div] - Elemento del DOM en el que crear el control o valor de atributo id de dicho elemento.\r\n  * @property {boolean} [displayElevation=true] - Si se establece a `true`, se completar el grfico del perfil de elevacin de la ruta (si esta cuenta con datos de elevacin) aadiendo el perfil de elevacin resultante del MDT (Modelo Digital de Terreno)\r\n  \r\n  * @example <caption>[Ver en vivo](../examples/cfg.GeolocationOptions.html)</caption> {@lang html}\r\n  * <div id=\"mapa\"/>\r\n  * <script>\r\n  *     // Establecemos un layout simplificado apto para hacer demostraciones de controles.\r\n  *     SITNA.Cfg.layout = \"layout/ctl-container\";\r\n  *     // Aadimos el control GPS y rutas en el primer contenedor definido en el marcado markup.html contenido en el layout definido en la anterior instruccin.\r\n  *     SITNA.Cfg.controls.geolocation = {\r\n  *         div: \"slot1\",\r\n  *         displayElevation: true // Se aadir el perfil de elevacin del MDT\r\n  *     };\r\n  *     var map = new SITNA.Map(\"mapa\");\r\n  * </script>\r\n  */\r\n\r\n\r\n(function () {\r\n    Math.hypot = Math.hypot || function () {\r\n        var y = 0;\r\n        var length = arguments.length;\r\n\r\n        for (var i = 0; i < length; i++) {\r\n            if (arguments[i] === Infinity || arguments[i] === -Infinity) {\r\n                return Infinity;\r\n            }\r\n            y += arguments[i] * arguments[i];\r\n        }\r\n        return Math.sqrt(y);\r\n    };\r\n}());\r\n(function () {\r\n    var lastTime = 0,\r\n        vendors = ['ms', 'moz', 'webkit', 'o'],\r\n        // Feature check for performance (high-resolution timers)\r\n        hasPerformance = !!(window.performance && window.performance.now);\r\n\r\n    for (var x = 0, max = vendors.length; x < max && !window.requestAnimationFrame; x += 1) {\r\n        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];\r\n        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame']\r\n            || window[vendors[x] + 'CancelRequestAnimationFrame'];\r\n    }\r\n\r\n    if (!window.requestAnimationFrame) {\r\n        window.requestAnimationFrame = function (callback, element) {\r\n            var currTime = new Date().getTime();\r\n            var timeToCall = Math.max(0, 16 - (currTime - lastTime));\r\n            var id = window.setTimeout(function () { callback(currTime + timeToCall); },\r\n                timeToCall);\r\n            lastTime = currTime + timeToCall;\r\n            return id;\r\n        };\r\n    }\r\n\r\n    if (!window.cancelAnimationFrame) {\r\n        window.cancelAnimationFrame = function (id) {\r\n            clearTimeout(id);\r\n        };\r\n    }\r\n\r\n    // Add new wrapper for browsers that don't have performance\r\n    if (!hasPerformance) {\r\n        // Store reference to existing rAF and initial startTime\r\n        var rAF = window.requestAnimationFrame,\r\n            startTime = +new Date;\r\n\r\n        // Override window rAF to include wrapped callback\r\n        window.requestAnimationFrame = function (callback, element) {\r\n            // Wrap the given callback to pass in performance timestamp\r\n            var wrapped = function (timestamp) {\r\n                // Get performance-style timestamp\r\n                var performanceTimestamp = (timestamp < 1e12) ? timestamp : timestamp - startTime;\r\n\r\n                return callback(performanceTimestamp);\r\n            };\r\n\r\n            // Call original rAF with wrapped callback\r\n            rAF(wrapped, element);\r\n        }\r\n    }\r\n})();\r\n(function () {\r\n    // Polyfill window.performance.now\r\n    if (!window.performance) {\r\n        window.performance = {\r\n            offset: Date.now(),\r\n            now: function () {\r\n                return Date.now() - this.offset;\r\n            }\r\n        };\r\n    } else if (window.performance && !window.performance.now) {\r\n        window.performance.offset = Date.now();\r\n        window.performance.now = function () {\r\n            return Date.now() - window.performance.offset;\r\n        };\r\n    }\r\n}());\r\n\r\nTC.control = TC.control || {};\r\n\r\nif (!TC.Control) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/Control');\r\n}\r\n\r\nif (!TC.control.infoShare) {\r\n    TC.syncLoadJS(TC.apiLocation + 'TC/control/infoShare');\r\n}\r\n\r\nTC.Consts.event.DIALOG = TC.Consts.event.DIALOG || 'dialog.tc';\r\n\r\nTC.control.Geolocation = function (options) {\r\n    var self = this;\r\n    self._classSelector = '.' + self.CLASS;\r\n\r\n    self._layerPromises = {};\r\n\r\n    self.Const = {\r\n        Classes: {\r\n            ACTIVE: 'tc-ctl-geolocation-active',\r\n            CLOSED: 'closed',\r\n            SELECTEDTRACK: 'selectedTrack',\r\n            DRAWACTIVATED: 'draw-activated',\r\n            SIMULATIONACTIVATED: 'simulation-activated'\r\n        },\r\n        Selector: {\r\n            SIMULATE: '.tc-btn-simulate',\r\n            DRAW: '.tc-draw',\r\n            EDIT: '.tc-btn-edit',\r\n            DELETE: '.tc-btn-delete',\r\n            SAVE: '.tc-btn-save',\r\n            CANCEL: '.tc-btn-cancel',\r\n            EXPORT: '.tc-btn-export',\r\n            SHARE: '.tc-btn-share',\r\n            STOP: '.tc-btn-stop',\r\n            PAUSE: '.tc-btn-pause',\r\n            BACKWARD: '.tc-btn-backward',\r\n            FORWARD: '.tc-btn-forward',\r\n            SPEED: '.tc-spn-speed'\r\n        },\r\n        LocalStorageKey: {\r\n            TRACKING: 'trk',\r\n            TRACKINGTEMP: 'trktemp',\r\n            TRACKINGSHOWADVERTISEMENT: 'trkAdvertisement',\r\n            GPSSHOWADVERTISEMENT: 'gpsAdvertisement',\r\n            TEST: 'test'\r\n        },\r\n        Message: {\r\n            VALIDATENAME: '',\r\n        },\r\n        Event: {\r\n            POSITIONCHANGE: 'positionchange.tc.geolocation',\r\n            GPSPOSITIONCHANGE: 'gpspositionchange.tc.geolocation',\r\n            GPSPOSITIONERROR: 'positionerror.tc.geolocation',\r\n            STATEUPDATED: 'stateupdated.tc.geolocation',\r\n            GPSADD: 'gpsadd.tc.geolocation',\r\n            TRACKSNAPPING: 'tracksnapping.tc.geolocation',\r\n            DRAWTRACK: 'drawtrack.tc.geolocation',\r\n            CLEARTRACK: 'cleartrack.tc.geolocation',\r\n            IMPORTEDTRACK: 'importedtrack.tc.geolocation'\r\n        },\r\n        MimeMap: {\r\n            KML: 'application/vnd.google-earth.kml+xml',\r\n            GPX: 'application/gpx+xml'\r\n        },\r\n        SupportedFileExtensions: [\r\n            '.kml',\r\n            '.gpx'\r\n        ],\r\n        Tabs: {\r\n            GPS: \"gps\"\r\n        },\r\n        Layers: {\r\n            GPS: \"gps\",\r\n            TRACK: \"track\",\r\n            TRACKING: \"tracking\"\r\n        }\r\n    };\r\n\r\n    TC.Control.apply(self, arguments);\r\n\r\n    var opts = options || {};\r\n    self._dialogDiv = TC.Util.getDiv(opts.dialogDiv);\r\n    if (window.$) {\r\n        self._$dialogDiv = $(self._dialogDiv);\r\n    }\r\n    if (!opts.dialogDiv) {\r\n        document.body.appendChild(self._dialogDiv);\r\n    }\r\n\r\n    self._shareDialogDiv = TC.Util.getDiv({});\r\n    document.body.appendChild(self._shareDialogDiv);\r\n\r\n    self.delta = 500;\r\n    self.walkingSpeed = 5000;\r\n\r\n    self.snappingTolerance = self.options.snappingTolerance || 50;\r\n\r\n    self.notificationConf = {};\r\n\r\n    self.exportsState = true;\r\n\r\n    self.storageCRS = 'EPSG:4326';\r\n};\r\n\r\nTC.inherit(TC.control.Geolocation, TC.Control);\r\nTC.mix(TC.control.Geolocation, TC.control.infoShare);\r\n\r\n(function () {\r\n    var ctlProto = TC.control.Geolocation.prototype;\r\n\r\n    ctlProto.CLASS = 'tc-ctl-geolocation';\r\n\r\n    ctlProto.CHART_SIZE = {\r\n        MIN_HEIGHT: 75,\r\n        MAX_HEIGHT: 128,\r\n\r\n        MIN_WIDTH: 315,\r\n        MEDIUM_WIDTH: 310,\r\n        MAX_WIDTH: 445\r\n    };\r\n\r\n    ctlProto.featuresToShare = [];\r\n\r\n    TC.Consts.event.TOOLSCLOSE = TC.Consts.event.TOOLSCLOSE || 'toolsclose.tc';\r\n    TC.Consts.event.TOOLSOPEN = TC.Consts.event.TOOLSOPEN || 'toolsopen.tc';\r\n\r\n    ctlProto.template = {};\r\n    ctlProto.template[ctlProto.CLASS] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-track-node'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-track-node.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-track-snapping-node'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-track-snapping-node.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-dialog'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-dialog.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-tracking-toast'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-tracking-toast.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-ext-dldlog'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-ext-dldlog.hbs\";\r\n    ctlProto.template[ctlProto.CLASS + '-share-dialog'] = TC.apiLocation + \"TC/templates/tc-ctl-geolocation-share-dialog.hbs\";\r\n\r\n    var onFeatureRemove = function (e) {\r\n        const self = this;\r\n        const layer = e.layer;\r\n\r\n        if (e.feature === self.wrap.simulateMarker) {\r\n            return;\r\n        }\r\n\r\n        if (e.layer === self.layerTrack) {\r\n            self.clearSelection();\r\n        }\r\n    };\r\n\r\n    ctlProto.register = function (map) {\r\n        const self = this;\r\n        const result = TC.Control.prototype.register.call(self, map);\r\n\r\n        self.wrap = new TC.wrap.control.Geolocation(self);\r\n        self.wrap.register(map);\r\n\r\n        map._bufferFeatures = [];\r\n\r\n        self.hillDeltaThreshold = ((self.options && self.options.hillDeltaThreshold) ||\r\n            (self.map.options.elevation && self.map.options.elevation.hillDeltaThreshold)) ||\r\n            20;\r\n\r\n        map.addLayer({\r\n            id: self.getUID(),\r\n            type: TC.Consts.layerType.VECTOR,\r\n            owner: self,\r\n            stealth: true,\r\n            title: 'Posicionar.GPS',\r\n        }).then(function (layer) {\r\n            self.layerGPS = layer;\r\n        });\r\n        map.addLayer({\r\n            id: self.getUID(),\r\n            type: TC.Consts.layerType.VECTOR,\r\n            owner: self,\r\n            stealth: true,\r\n            title: 'Posicionar.Tracking',\r\n            styles: {\r\n                point: {\r\n                    radius: 3,\r\n                    fillColor: \"#00ced1\",\r\n                    fillOpacity: function () {\r\n                        return this.track.renderTrack.checked ? 1 : 0;\r\n                    }.bind(self),\r\n                    strokeColor: \"#ffffff\",\r\n                    fontColor: \"#00ced1\",\r\n                    labelOutlineColor: \"#ffffff\",\r\n                    labelOutlineWidth: 1,\r\n                    label: function (feature) {\r\n                        var name = feature.getData()['name'];\r\n                        if (name && (name + '').trim().length > 0) {\r\n                            name = (name + '').trim().toLowerCase();\r\n                        } else {\r\n                            name = '';\r\n                        }\r\n\r\n                        return name;\r\n                    }\r\n                },\r\n                line: {\r\n                    strokeOpacity: function () {\r\n                        return this.track.renderTrack.checked ? 1 : 0;\r\n                    }.bind(self),\r\n                    strokeWidth: 2,\r\n                    strokeColor: \"#00ced1\",\r\n                    lineDash: [.1, 6]\r\n                }\r\n            }\r\n        }).then(function (layer) {\r\n            self.layerTracking = layer;\r\n        });\r\n        map.addLayer({\r\n            id: self.getUID(),\r\n            type: TC.Consts.layerType.VECTOR,\r\n            owner: self,\r\n            stealth: true,\r\n            title: 'Posicionar.Track',\r\n            styles: {\r\n                line: {\r\n                    strokeWidth: 2,\r\n                    strokeColor: \"#C52737\"\r\n                },\r\n                point: {\r\n                    radius: function (feature) {\r\n                        var name = feature.getData()['name'];\r\n                        if (name && (name + '').trim().length > 0) {\r\n                            return 3;\r\n                        } else {\r\n                            return 6;\r\n                        }\r\n\r\n                        return 3;\r\n                    },\r\n                    fillColor: \"#C52737\",\r\n                    strokeColor: \"#ffffff\",\r\n                    fontColor: \"#C52737\",\r\n                    fontSize: 10,\r\n                    labelOutlineColor: \"#ffffff\",\r\n                    labelOutlineWidth: 2,\r\n                    label: function (feature) {\r\n                        var name = feature.getData()['name'];\r\n                        if (name && (name + '').trim().length > 0) {\r\n                            name = (name + '').trim().toLowerCase();\r\n                        } else {\r\n                            name = '';\r\n                        }\r\n\r\n                        return name;\r\n                    }\r\n                }\r\n            }\r\n        }).then(function (layer) {\r\n            self.layerTrack = layer;\r\n        });\r\n\r\n        map.on(TC.Consts.event.FEATURESIMPORT, function (e) {\r\n            const self = this;\r\n\r\n            const featuresImport = function (e) {\r\n                const fileName = e.fileName;\r\n                const target = e.dropTarget;\r\n                var kmlPattern = '.' + TC.Consts.format.KML.toLowerCase();\r\n                var gpxPattern = '.' + TC.Consts.format.GPX.toLowerCase();\r\n\r\n                // GLS: es un GPX?\r\n                if (fileName.toLowerCase().indexOf(gpxPattern) === fileName.length - gpxPattern.length ||\r\n                    // GLS: es un KML y viene desde el upload de Geolocation?\r\n                    (fileName.toLowerCase().indexOf(kmlPattern) === fileName.length - kmlPattern.length && target === self)) {\r\n\r\n                    self.clear(self.Const.Layers.TRACK);\r\n                    const importedGPX = function () {\n                        //Controlamos que todo ha acabado para hacer zoom a las features y ocultar el loading\n                        setTimeout(function () {\n                            self.map._bufferFeatures = self.map._bufferFeatures.concat(e.features);\n                            window.dropFilesCounter--;\n                            if (dropFilesCounter === 0) {\n                                self.map.zoomToFeatures(self.map._bufferFeatures);\n                                self.map._bufferFeatures = [];\n                                delete window.dropFilesCounter;\n                                var li = self.map.getLoadingIndicator();\n                                if (li) {\n                                    li.removeWait(self.map._fileDropLoadingIndicator);\n                                    self.map._fileDropLoadingIndicator = null;\n                                }\n                                self.off(self.Const.Event.IMPORTEDTRACK, importedGPX);\n                            }\n                        }, 0);                       \n\n                    }\n                    self.on(self.Const.Event.IMPORTEDTRACK, importedGPX);\r\n                    self.importTrack(e);\r\n                                        \r\n                    if (/.kml$/g.test(fileName.toLowerCase()) && self.layerTrack) {\r\n                        if (self.layerTrack.styles) {\r\n                            self.layerTrack.features.forEach(function (feature) {\r\n                                if (TC.feature.Point && feature instanceof TC.feature.Point && self.layerTrack.styles.point) {\r\n                                    feature.setStyle(self.layerTrack.styles.point);\r\n                                } else if (TC.feature.Polyline && feature instanceof TC.feature.Polyline && self.layerTrack.styles.line) {\r\n                                    feature.setStyle(self.layerTrack.styles.line);\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                } else {\r\n                    //GLS: si es un KML pero viene desde el mapa o es otro tipo de archivo que no es ni GPX ni KML, lo ignoramos\r\n                    return;\r\n                }\r\n            };\r\n\r\n            if (self.working && TC.Util.isFunction(self.working.then)) {\r\n                self.working.then(featuresImport(e));\r\n            } else {\r\n                self.working = true;\r\n                featuresImport(e);\r\n            }\r\n\r\n        }.bind(self));\r\n\r\n        map.on(TC.Consts.event.PROJECTIONCHANGE, function (e) {\r\n            if (self.elevationChartData) {\r\n                self.elevationChartData.coords = TC.Util.reproject(self.elevationChartData.coords, e.oldCrs, e.newCrs);\r\n            }\r\n        });\r\n\r\n        map.on(TC.Consts.event.DIALOG, function (e) {\r\n            if (e.control) {\r\n                switch (e.action) {\r\n                    case \"share\":\r\n                        if (e.control.caller !== self) {\r\n                            self.onShowShareDialog(e.control.caller);\r\n                        }\r\n                        break;\r\n                    case \"download\":\r\n                        self.onShowDownloadDialog(e.control.caller);\r\n                        break;\r\n                }\r\n            }\r\n        });\r\n\r\n        self.notificationConf = Object.assign(self.options.notification || {}, {\n            tag: \"Geolocation Track\",\n            vibrate: [200],\n            renotify: true,\n            requireInteraction: true,\n            body: self.getLocaleString(\"geo.trk.notification.body\")\n        }, {\n                title: self.options.notification && self.options.notification.title ? self.getLocaleString(self.options.notification.title) : document.title,\n            });\r\n\r\n        return result;\r\n    };\r\n\r\n    ctlProto.getElevationControl = async function () {\r\n        const self = this;\r\n\r\n        if (!self.elevationControl) {\r\n            let options = {};\r\n            if (!self.options.displayElevation && self.options.displayOn) {\r\n                options.displayOn = self.options.displayOn;\r\n            } else if (self.options.displayElevation) {\r\n                options = self.options.displayElevation;\r\n            }\r\n            if (self.options.hasOwnProperty('resolution')) { // la configuracin de la resolucin es distinta al obtener el perfil (0) que para la descarga (20). La configuracin para la descarga se gestiona en getDownloadDialog...\r\n                options.resolution = self.options.resolution;\r\n            } else {\r\n                options.resolution = 0;\r\n            }\r\n            self.elevationControl = await self.map.addControl('elevation', options);\r\n\r\n            self.elevationControl._decorateChartPanel = function () {\r\n                this.resultsPanel.setCurrentFeature = function (feature) {\r\n                    const that = this;\r\n                    that.currentFeature = self.layerTrack.features.filter((feature) => {\r\n                        return !(TC.feature.Marker && feature instanceof TC.feature.Marker) && !(TC.feature.Point && feature instanceof TC.feature.Point)\r\n                    })[0];\r\n                    const currentSelectedTrack = self.getSelectedTrack();\r\n                    if (currentSelectedTrack) {\r\n                        that.currentFeature.uid = currentSelectedTrack.dataset.uid;\r\n                        that.currentFeature.fileName = getDownloadFileName.call(self, currentSelectedTrack);\r\n                    }\r\n\r\n                };\r\n            };\r\n\r\n        }\r\n        return self.elevationControl;\r\n    };\r\n\r\n    ctlProto.render = function (callback) {\r\n        const self = this;\r\n        return self.getRenderedHtml(self.CLASS + '-dialog', null, function (html) {\r\n            self._dialogDiv.innerHTML = html;\r\n        }).then(function () {\r\n            return self.getDownloadDialog().then(() => {\r\n                self._downloadDialog.caller = self;\r\n                self.getRenderedHtml(self.CLASS + '-ext-dldlog', { controlId: self.id }, function (html) {\r\n                    var template = document.createElement('template');\r\n                    template.innerHTML = html;\r\n                    self._downloadDialogExtNode = template.content ? template.content.firstChild : template.firstChild;\r\n                    self.getRenderedHtml(self.CLASS + '-share-dialog', {}, function (html) {\r\n                        self._shareDialogDiv.innerHTML = html;\r\n                        return self.renderData({ controlId: self.id }, callback);\r\n                    });\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.importTrack = function (options) {\r\n        var self = this;\r\n        self.map.off(TC.Consts.event.FEATUREREMOVE, onFeatureRemove);\r\n        if (!self.isDisabled) {\r\n            if (options.fileName && options.features && options.features.length > 0) {\r\n                var wait = self.getLoadingIndicator().addWait();\r\n                self.importedFileName = options.fileName;\r\n                const addPromises = [];\r\n                for (var i = 0, len = options.features.length; i < len; i++) {\r\n                    addPromises.push(self.layerTrack.addFeature(options.features[i]));\r\n                }\r\n                Promise.all(addPromises).then(function () {\r\n                    self.wrap.processImportedFeatures({ wait: wait, notReproject: options.notReproject });\r\n                    if (self.layerTrack) { // Si tenemos capa es que todo ha ido bien y gestionamos el despliegue del control\r\n                        // Desplegamos el control \"ubicar\" al importar mediante drag&drop\r\n                        if (self.map && self.map.layout && self.map.layout.accordion) {\r\n                            if (self.div.classList.contains(TC.Consts.classes.COLLAPSED)) {\r\n                                self.map.controls\r\n                                    .filter(function (ctl) {\r\n                                        // Todos los otros controles que no cuelgan de otro control\r\n                                        return ctl !== self && !ctl.containerControl;\r\n                                    })\r\n                                    .forEach(function (ctl) {\r\n                                        ctl.div.classList.add(TC.Consts.classes.COLLAPSED);\r\n                                    });\r\n                            }\r\n                        }\r\n\r\n                        self.div.classList.remove(TC.Consts.classes.COLLAPSED);\r\n                        self.div.querySelector('.' + self.CLASS + '-btn-tracks > span').click();\r\n\r\n                        if (!options.isShared) {\r\n                            // abrimos el panel de herramientas\r\n                            self.map.trigger(TC.Consts.event.TOOLSOPEN);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        } else if (/.gpx$/g.test(options.fileName.toLowerCase())) {\r\n            self.map.toast(self.getLocaleString(\"geo.trk.import.disabled\"), { type: TC.Consts.msgType.WARNING });\r\n        }\r\n    };\r\n\r\n    ctlProto.prepareFeaturesToShare = function (options) {\r\n        const self = this;\r\n        let trackUid = options.uid;\r\n        return new Promise(function (resolve, reject) {\r\n            if (trackUid) {\r\n                var storageData = self.availableTracks.filter(function (saved) {\r\n                    return saved.uid.toString() === trackUid.toString();\r\n                })[0].data;\r\n\r\n                // Aplicamos una precisin un dgito mayor que la del mapa, si no, al compartir algunas parcelas se deforman demasiado\r\n                var precision = Math.pow(10, TC.Consts.DEGREE_PRECISION + 1);\r\n\r\n                var storageFeatures = new ol.format.GeoJSON().readFeatures(storageData);\r\n                const promises = new Array(storageFeatures.length);\r\n                storageFeatures.forEach(function (f, idx) {\r\n                    promises[idx] = TC.wrap.Feature.createFeature(f);\r\n                });\r\n\r\n                Promise.all(promises).then(function (tcFeatures) {\r\n                    let features = tcFeatures.map(function (f) {\r\n                        const fObj = {};\r\n                        var layerStyle;\r\n                        switch (true) {\r\n                            case TC.feature.Marker && f instanceof TC.feature.Marker:\r\n                                fObj.type = TC.Consts.geom.MARKER;\r\n                                break;\r\n                            case TC.feature.Point && f instanceof TC.feature.Point:\r\n                                fObj.type = TC.Consts.geom.POINT;\r\n                                break;\r\n                            case TC.feature.Polyline && f instanceof TC.feature.Polyline:\r\n                                fObj.type = TC.Consts.geom.POLYLINE;\r\n                                break;\r\n                            case TC.feature.MultiPolyline && f instanceof TC.feature.MultiPolyline:\r\n                                fObj.type = TC.Consts.geom.MULTIPOLYLINE;\r\n                                break;\r\n                        }\r\n                        fObj.id = f.id;\r\n                        fObj.geom = f.geometry; // El redondeo hace que ya no podamos validar con los tracks existentes.\r\n                        fObj.data = f.getData();\r\n\r\n                        return fObj;\r\n                    });\r\n\r\n                    if (options.setFeaturesToShare) {\r\n                        self.featuresToShare = features;\r\n                    }\r\n                    resolve(features);\r\n                });\r\n            } else {\r\n                reject();\r\n            }\r\n        });\r\n\r\n\r\n    };\r\n\r\n    const getDownloadFileName = function (elem) {\r\n        const self = this;\r\n        var filename = elem.querySelector('span').textContent;\r\n        var regex = new RegExp(self.Const.SupportedFileExtensions.join('|'), 'gi');\r\n        return filename.replace(regex, '') + \"_\" + TC.Util.getFormattedDate(new Date(), true);\r\n    };\r\n\r\n    const getElevationFromService = async function (feature) {\r\n        const self = this;\r\n        let cachedFeature = getElevationFromServiceOnCache(feature);\r\n        if (cachedFeature) {\r\n            console.log('Tengo datos en cache');\r\n            return cachedFeature.data;\r\n        } else {\r\n            console.log('NO tengo datos en cache');\r\n            const tool = await self.getElevationTool();\r\n            if (tool) {\r\n                let cloned = feature.clone();\r\n                try {\r\n                    let toDownload = await tool.setGeometry({ features: [cloned], crs: self.map.crs });\r\n                    cacheElevationFromService(feature, toDownload[0]);\r\n                    return toDownload[0];\r\n                } catch (e) {\r\n                    return null;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    ctlProto.onShowShareDialog = function (caller) {\r\n        const self = this;\r\n        if (caller instanceof Element || caller instanceof HTMLDocument) {\r\n            if (caller.classList.contains(self.CLASS + '-share-dialog')) {\r\n                return TC.control.infoShare.onShowShareDialog.call(self);\r\n            } else {\r\n                return Promise.resolve();\r\n            }\r\n        } else if (caller === self) {\r\n            return TC.control.infoShare.onShowShareDialog.call(self);\r\n        }\r\n        else if (caller !== self &&\r\n            caller.toShare &&\r\n            caller.toShare.feature &&\r\n            caller.toShare.feature.layer === self.layerTrack) {\r\n            // cerramos el dilogo abierto por featureTools para mostrar el de geolocation\r\n            TC.Util.closeModal(function () {\r\n                TC.control.infoShare.onCloseShareDialog.call(caller);\r\n                const selectedTrack = self.getSelectedTrack();\r\n                if (selectedTrack) {\r\n                    return self.shareTrack(selectedTrack).then(function () {\r\n                        const shareDialog = self._shareDialogDiv.querySelector('.' + self.CLASS + '-share-dialog');\r\n                        TC.Util.showModal(shareDialog, {\r\n                            openCallback: function () {\r\n                                return TC.control.infoShare.onShowShareDialog.call(self);\r\n                            },\r\n                            closeCallback: function () {\r\n                                TC.control.infoShare.onCloseShareDialog.call(self);\r\n                            }\r\n                        });\r\n\r\n                    });\r\n                } else {\r\n                    return Promise.resolve();\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    var interpolationPanel = null; /* tengo que dejar fuera la vble porque con const y let dentro del bloque una vez cerrado el modal no funciona. \r\n    Ejecuta la intruccin pero no produce cambios en el HTML, es como si se quedase alguna referencia interna pocha */\r\n    var checkboxElevations = null; /* pasa lo mismo que con el panel ??? */\r\n    ctlProto.onShowDownloadDialog = function (caller, allFeatures) {\r\n        const self = this;\r\n        const RADIO_TRACK = \"track\";\r\n        const RADIO_MDT = \"mdt\";\r\n        const originalDialogFeatures = self._downloadDialog.getFeatures();\r\n\r\n        // llega desde el panel del perfil del track: hacemos que el dilogo sea igual que cuando llega desde la lista aunque lo invoque featureTools\r\n        if (caller !== self && self._downloadDialog.getFeatures().every(f => f && f.layer === self.layerTrack)) {\r\n            let currentOptions = self._downloadDialog.getOptions();\r\n            let controlOptions = self.getDownloadDialogOptions();\r\n            currentOptions.elevation = controlOptions.elevation;\r\n            delete currentOptions.openCallback;\r\n\r\n            self._downloadDialog.open(self._downloadDialog.getFeatures(), currentOptions);\r\n        }\r\n\r\n        // normalizamos el nombre del archivo de la descarga\r\n        if (originalDialogFeatures.length === 1 && originalDialogFeatures.every((f) => f && f.fileName)) {\r\n            self._downloadDialog.setOptions({ fileName: originalDialogFeatures[0].fileName });\r\n        }\r\n\r\n        // si no tenemos configurada la opcin del perfil desde MDT retornamos sin gestionar nada ms\r\n        if (!self.options.displayElevation) {\r\n            return;\r\n        }\r\n\r\n        // llega desde la lista de tracks || llega desde el panel del perfil de un track \r\n        if (caller === self || self._downloadDialog.getFeatures().every(f => f && f.layer === self.layerTrack)) {\r\n            if (!self._downloadDialog.modalBody.querySelector('.' + self.CLASS + \"-ext-dldlog\")) {\r\n                let divToExtensions = self._downloadDialog.modalBody.querySelector('.' + self._downloadDialog.CLASS + \"-ext\");\r\n                if (divToExtensions) {\r\n                    divToExtensions.appendChild(self._downloadDialogExtNode);\r\n\r\n                    checkboxElevations = self._downloadDialog.modalBody.querySelector('.' + self._downloadDialog.CLASS + \"-elev input[type='checkbox']\");\r\n                    interpolationPanel = self._downloadDialog.modalBody.querySelector('.' + self._downloadDialog.CLASS + \"-ip\");\r\n                    const radioDlSource = self._downloadDialog.modalBody.querySelectorAll(`input[type=radio][name=\"${self.id}-dldlog-source\"]`);\r\n\r\n                    // si el track no tiene elevaciones y solo contamos con las del MDT ocultamos el botn de descargar originales                    \r\n                    const disableOriginalsRadio = function (condition) {\r\n                        const originalsRadio = radioDlSource[0];\r\n                        if (condition) {\r\n                            if (!originalsRadio.classList.contains(TC.Consts.classes.DISABLED)) {\r\n                                originalsRadio.classList.add(TC.Consts.classes.DISABLED);\r\n                            }\r\n                        } else {\r\n                            originalsRadio.classList.remove(TC.Consts.classes.DISABLED);\r\n                        }\r\n                    };\r\n                    let feature = originalDialogFeatures.filter((feat) => {\n                        return TC.feature.Polyline && feat instanceof TC.feature.Polyline;\n                    })[0];\r\n                    let coord = feature.geometry[0];\r\n                    let noZ = feature.geometry[0].length === 2;\r\n                    if (noZ) {\r\n                        disableOriginalsRadio(noZ);\r\n                    } else if (feature.geometry[0].length > 2) {\r\n                        disableOriginalsRadio(feature.geometry.map((c) => c[2]).every((val) => val === 0));\r\n                    }\r\n\r\n\r\n                    const interpolationPanelIsHidden = function () {\r\n                        return interpolationPanel && interpolationPanel.classList.contains(TC.Consts.classes.HIDDEN);\r\n                    };\r\n                    const setInterpolationPanelVisibility = function () {\r\n                        if (radioDlSource[0].checked && !interpolationPanelIsHidden()) {\r\n                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                        } else if (radioDlSource[0].checked) {\r\n                            let observer = new MutationObserver(function (mutations) {\r\n                                mutations.filter(m => m.attributeName === \"class\").forEach(function (mutation) {\r\n                                    if (mutation.oldValue.indexOf(TC.Consts.classes.HIDDEN) > -1) {\r\n                                        if (radioDlSource[0].checked) {\r\n                                            interpolationPanel.classList.add(TC.Consts.classes.HIDDEN);\r\n                                            observer.disconnect();\r\n                                        } else {\r\n                                            observer.disconnect();\r\n                                        }\r\n                                    }\r\n                                });\r\n                            });\r\n\r\n                            let config = { attributes: true, attributeOldValue: true };\r\n                            observer.observe(interpolationPanel, config);\r\n                        } else {\r\n                            if (interpolationPanelIsHidden() && checkboxElevations.checked) {\r\n                                interpolationPanel.classList.remove(TC.Consts.classes.HIDDEN);\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    if (checkboxElevations) {\r\n                        if (checkboxElevations.checked) {\r\n                            setInterpolationPanelVisibility();\r\n                            self._downloadDialogExtNode.classList.remove(TC.Consts.classes.HIDDEN);\r\n                        } else if (!self._downloadDialogExtNode.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                            self._downloadDialogExtNode.classList.add(TC.Consts.classes.HIDDEN);\r\n                        }\r\n                        checkboxElevations.addEventListener(\"change\", function () {\r\n                            setInterpolationPanelVisibility();\r\n                            self._downloadDialogExtNode.classList.toggle(TC.Consts.classes.HIDDEN);\r\n                        });\r\n                    }\r\n\r\n                    if (radioDlSource) {\r\n                        setInterpolationPanelVisibility();\r\n                        radioDlSource.forEach(item => {\r\n                            if (item.dataset.hasChangeEvent) {\r\n                                return;\r\n                            }\r\n                            item.dataset.hasChangeEvent = true;\r\n                            item.addEventListener(\"change\", async function (e) {\r\n                                if (e.target.checked) {\r\n                                    setInterpolationPanelVisibility();\r\n                                    let featuresToDownload;\r\n                                    if (e.target.value === RADIO_TRACK) {\r\n                                        featuresToDownload = originalDialogFeatures;\r\n                                    } else {\r\n                                        let featuresFromDialog = originalDialogFeatures;\r\n                                        let feature = featuresFromDialog.filter((feat) => {\r\n                                            return TC.feature.Polyline && feat instanceof TC.feature.Polyline;\r\n                                        })[0];\r\n\r\n                                        if (allFeatures) {\r\n                                            featuresToDownload = featuresFromDialog.filter((feat) => {\r\n                                                return TC.feature.Point && feat instanceof TC.feature.Point;\r\n                                            });\r\n                                        }\r\n\r\n                                        let uid = feature.uid;\r\n                                        let cachedProfile = getElevationProfileFromCache(uid);\r\n                                        if (cachedProfile) {\r\n                                            // Clonamos la feature para presevar la geometra original por si el usuario cambia de nuevo a track\r\n                                            let toDownload = feature.clone();\r\n                                            toDownload.setCoords(cachedProfile.data.secondaryElevationProfileChartData[0].coords);\r\n                                            if (allFeatures) {\r\n                                                if (!featuresToDownload) {\r\n                                                    featuresToDownload = (getCurrentPoints.call(self) || []);\r\n                                                }\r\n                                                featuresToDownload.push(toDownload);\r\n                                            } else {\r\n                                                featuresToDownload = toDownload;\r\n                                            }\r\n                                        } else {\r\n                                            self._downloadDialog.modalBody.classList.add(TC.Consts.classes.LOADING);\r\n\r\n                                            let toDownload = await getElevationFromService.call(self, feature);\r\n                                            if (toDownload) {\r\n                                                if (allFeatures) {\r\n                                                    featuresToDownload.push(toDownload);\r\n                                                } else {\r\n                                                    featuresToDownload = toDownload;\r\n                                                }\r\n                                            } else {\r\n                                                self.map.toast(self.getLocaleString(\"elevation.error\"), { type: TC.Consts.msgType.ERROR, duration: 5000 });\r\n                                                radioDlSource[0].checked = true;\r\n                                            }\r\n\r\n                                            self._downloadDialog.modalBody.classList.remove(TC.Consts.classes.LOADING);\r\n                                        }\r\n                                    }\r\n\r\n                                    self._downloadDialog.setFeatures(featuresToDownload);\r\n                                }\r\n                            });\r\n                        });\r\n\r\n                        if (radioDlSource[0].classList.contains(TC.Consts.classes.DISABLED) ||\r\n                            document.querySelector('.' + self.CLASS + '-ext-dldlog input[type=radio]:checked').value === RADIO_MDT) {\r\n                            const mdtRadio = radioDlSource[1];\r\n                            mdtRadio.checked = true;\r\n                            mdtRadio.dispatchEvent(new Event('change'));\r\n                        }\r\n                    }\r\n\r\n                    if (originalDialogFeatures.length === 1 && originalDialogFeatures[0].fileName) {\r\n                        self._downloadDialog.setOptions({ fileName: originalDialogFeatures[0].fileName });\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    ctlProto.getDownloadDialogOptions = function (fileName) {\r\n        const self = this;\r\n\r\n        const options = {\r\n            title: self.getLocaleString('download'),\r\n            fileName: fileName,\r\n            openCallback: function () {\r\n                self.onShowDownloadDialog(self, true);\r\n            }\r\n        };\r\n        if (self.options.displayElevation) {\r\n            options.elevation = {\r\n                resolution: (self.options.displayElevation && self.options.displayElevation.resolution) || (self.map.options.elevation && self.map.options.elevation.resolution) || 20,\r\n                sampleNumber: (self.options.displayElevation && self.options.displayElevation.sampleNumber) || (self.map.options.elevation && self.map.options.elevation.sampleNumber) || 0,\r\n                checked: true\r\n            };\r\n        } else {\r\n            options.elevation = {\r\n                checked: true\r\n            };\r\n        }\r\n\r\n        return options;\r\n    };\r\n\r\n    var visibilityTrack = true;\r\n    ctlProto.renderData = function (data, callback) {\r\n        const self = this;\r\n\r\n        var sel = self.Const.Selector;\r\n\r\n        return TC.Control.prototype.renderData.call(self, data, function () {\r\n\r\n            const options = self.div.querySelectorAll(self._classSelector + '-panel');\r\n            self.div.querySelectorAll('.' + self.CLASS + '-select span').forEach(function (span) {\r\n                span.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                    var label = e.target;\r\n                    while (label && label.tagName !== 'LABEL') {\r\n                        label = label.parentElement;\r\n                    }\r\n                    const newFormat = label.querySelector(`input[type=radio][name=\"${self.id}-mode\"]`).value;\r\n\r\n                    options.forEach(function (option) {\r\n                        option.classList.toggle(TC.Consts.classes.HIDDEN, !option.matches('.' + self.CLASS + '-' + newFormat));\r\n                    });\r\n                }, { passive: true });\r\n            });\r\n\r\n            self.track = {\r\n                activateButton: self.div.querySelector(self._classSelector + '-track-ui-activate'),\r\n                deactivateButton: self.div.querySelector(self._classSelector + '-track-ui-deactivate'),\r\n                trackSearch: self.div.querySelector(self._classSelector + '-track-available-srch'),\r\n                trackImportFile: self.div.querySelector(self._classSelector + '-track-import'),\r\n                trackSave: self.div.querySelector(self._classSelector + '-track-save'),\r\n                trackAdd: self.div.querySelector(self._classSelector + '-track-add-wpt'),\r\n                trackContinue: self._dialogDiv.querySelector('.' + self.CLASS + '-track-continue'),\r\n                trackRenew: self._dialogDiv.querySelector('.' + self.CLASS + '-track-new'),\r\n                trackClose: self._dialogDiv.querySelector('.' + self.CLASS + '-continue-track-dialog button.tc-modal-close'),\r\n                //trackAddSegment: self.div.querySelector('#tc-ctl-geolocation-track-segment'),\r\n                trackAdvertisementOK: self._dialogDiv.querySelector('.' + self.CLASS + '-track-advert-ok')\r\n            };\r\n\r\n            self.track.trackList = self.div.querySelector(self._classSelector + '-track-available-lst');\r\n\r\n            self.track.trackToolPanelOpened = self.div.querySelector('#tc-ctl-geolocation-track-panel-opened-' + self.id);\r\n\r\n            self.div.querySelector('.' + ctlProto.CLASS + '-track-panel-help').addEventListener('click', function () {\r\n                _showAlerMsg.call(self);\r\n            });\r\n\r\n            self.track.trackName = self.div.querySelector(self._classSelector + '-track-title');\r\n\r\n            self.track.trackWPT = self.div.querySelector(self._classSelector + '-track-waypoint');\r\n\r\n            if (TC.Util.detectMobile()) {\r\n                if (matchMedia('screen and (max-height: 50em) and (max-width: 50em)').matches)\r\n                    self.track.trackToolPanelOpened.checked = false;\r\n            }\r\n\r\n            if (window.File && window.FileReader && window.FileList && window.Blob) {\r\n                self.track.trackImportFile.disabled = false;\r\n                // GLS: Eliminamos el archivo subido, sin ello no podemos subir el mismo archivo seguido varias veces\r\n                self.track.trackImportFile.addEventListener(TC.Consts.event.CLICK, function (e) {\r\n                    // Envolvemos el input en un form\r\n                    const input = this;\r\n                    const form = document.createElement('form');\r\n                    const parent = input.parentElement;\r\n                    parent.insertBefore(form, input);\r\n                    form.appendChild(input);\r\n                    form.reset();\r\n                    // Desenvolvemos el input del form\r\n                    form.insertAdjacentElement('afterend', input);\r\n                    parent.removeChild(form);\r\n                }, { passive: true });\r\n\r\n                const _layerError = function () {\r\n                    self.map.off(TC.Consts.event.LAYERERROR, _layerError);\r\n                    self.clearFileInput(self.track.trackImportFile);\r\n\r\n                    TC.alert(self.getLocaleString(\"geo.trk.upload.error3\"));\r\n                };\r\n\r\n                self.track.trackImportFile.addEventListener('change', function (e) {\r\n                    if (!self._cleaning) { // Valido que el evento import no lo provoco yo al limpiar el fileinput (al limpiar se lanza el change)                        \r\n                        self.clear(self.Const.Layers.TRACK);\r\n\r\n                        if (self.map) {\r\n                            self.map.on(TC.Consts.event.LAYERERROR, _layerError);\r\n                            self.map.wrap.loadFiles(e.target.files, { control: self });\r\n                        }\r\n                    }\r\n                });\r\n            } else {\r\n                console.log('no es posible la importacin');\r\n            }\r\n\r\n            self.track.activateButton.addEventListener('click', function () {\r\n                self.activateTracking();\r\n                _activateTrackingBtns.call(self);\r\n\r\n            });\r\n            self.track.deactivateButton.addEventListener('click', function () {\r\n                self.deactivateTracking();\r\n                _deactivateTrackingBtns.call(self);\r\n            });\r\n\r\n            var _filter = function (searchTerm) {\r\n                searchTerm = searchTerm.toLowerCase();\r\n                //tc-ctl-geolocation-track-available-empty\r\n                const lis = Array.from(self.track.trackList.querySelectorAll('li'));\r\n                lis.forEach(function (li) {\r\n                    li.style.display = 'none';\r\n                });\r\n                const trackLis = lis.filter(function (li) {\r\n                    return li.matches('li:not([class]),li.' + self.Const.Classes.SELECTEDTRACK);\r\n                });\r\n\r\n                const searchIcon = self.div.querySelector(self._classSelector + '-track-search-icon');\r\n                if (searchTerm.length === 0) {\r\n                    trackLis.forEach(function (li) {\r\n                        li.style.display = '';\r\n                    });\r\n                    searchIcon.style.visibility = 'visible';\r\n                } else {\r\n                    searchIcon.style.visibility = 'hidden';\r\n                    var r = new RegExp(searchTerm, 'i');\r\n                    trackLis.forEach(function (li) {\r\n                        li.style.display = r.test(li.querySelector('span').textContent) ? '' : 'none';\r\n                    });\r\n\r\n                    if (!trackLis.some(function (li) {\r\n                        return li.style.display === '';\r\n                    })) {\r\n                        lis.forEach(function (li) {\r\n                            if (li.matches('[class^=\"tc-ctl-geolocation-track-not\"]')) {\r\n                                li.style.display = '';\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            };\r\n            const trackSearchListener = function () {\r\n                _filter(this.value.toLowerCase().trim());\r\n            };\r\n            self.track.trackSearch.addEventListener(\"keyup\", trackSearchListener);\r\n            self.track.trackSearch.addEventListener(\"search\", trackSearchListener);\r\n\r\n            // en el panel\r\n            self.track.trackSave.addEventListener('click', self.saveTrack.bind(self));\r\n            self.track.trackAdd.addEventListener('click', self.addWaypoint.bind(self));\r\n\r\n            const list = self.div.querySelector(self._classSelector + '-track-available-lst');\r\n\r\n            // en lista\r\n            var _edit = function (edit, elm) {\r\n                if (elm.tagName !== 'LI') {\r\n                    elm = elm.parentElement;\r\n                }\r\n\r\n                const input = elm.querySelector('input');\r\n                const span = elm.querySelector('span');\r\n\r\n                if (edit) {\r\n\r\n                    input.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    input.focus();\r\n                    input.value = span.textContent;\r\n                    span.classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.dataset['title'] = elm.title;\r\n                    elm.title = \"\";\r\n\r\n                    elm.querySelector(sel.SIMULATE).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.EDIT).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.DELETE).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.DRAW).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.EXPORT).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.SHARE).classList.add(TC.Consts.classes.HIDDEN);\r\n\r\n                    elm.querySelector(sel.SAVE).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.CANCEL).classList.remove(TC.Consts.classes.HIDDEN);\r\n                } else {\r\n\r\n                    input.classList.add(TC.Consts.classes.HIDDEN);\r\n                    span.classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.title = elm.dataset['title'];\r\n                    delete elm.dataset['title'];\r\n\r\n                    elm.querySelector(sel.SIMULATE).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.EDIT).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.DELETE).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.DRAW).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.EXPORT).classList.remove(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.SHARE).classList.remove(TC.Consts.classes.HIDDEN);\r\n\r\n                    elm.querySelector(sel.SAVE).classList.add(TC.Consts.classes.HIDDEN);\r\n                    elm.querySelector(sel.CANCEL).classList.add(TC.Consts.classes.HIDDEN);\r\n                }\r\n            };\r\n\r\n            self.uiSimulate = function (simulate, elm) {\r\n                if (elm) {\r\n                    var editControls = [\r\n                        sel.SIMULATE,\r\n                        sel.EDIT,\r\n                        sel.DELETE,\r\n                        sel.EXPORT,\r\n                        sel.SHARE\r\n                    ];\r\n                    var simulateControls = [\r\n                        sel.STOP,\r\n                        sel.PAUSE,\r\n                        sel.BACKWARD,\r\n                        sel.FORWARD,\r\n                        sel.SPEED\r\n                    ];\r\n                    var cnt = elm.tagName === 'LI' ? elm : elm.parentNode;\r\n\r\n                    editControls.forEach(function (ctl) {\r\n                        cnt.querySelector(ctl).hidden = simulate;\r\n                    });\r\n\r\n                    simulateControls.forEach(function (ctl) {\r\n                        cnt.querySelector(ctl).hidden = !simulate;\r\n                    });\r\n                }\r\n            };\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(sel.SIMULATE, function (e) {\r\n                var wait = self.getLoadingIndicator().addWait();\r\n\r\n                e.target.parentElement.querySelector(sel.SPEED).textContent = 'x 1';\r\n\r\n                _loadTrack(self, e.target).then(function () { //Para evitar el bloqueo de la interfaz en mviles\r\n                    self.getLoadingIndicator().removeWait(wait)\r\n                });\r\n            }));\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(sel.DRAW, function (e) {\r\n                var wait = self.getLoadingIndicator().addWait();\r\n\r\n                _drawTrack(self, e.target).then(function () {\r\n                    self.getLoadingIndicator().removeWait(wait);\r\n                });\r\n            }));\r\n\r\n            self.on(self.Const.Event.IMPORTEDTRACK, function (e) {\r\n                if (!self.isDisabled) {\r\n                    const listElement = self.track.trackList.querySelector('li[data-id=\"' + e.index + '\"]');\r\n                    _drawTrack(self, listElement.querySelector(sel.DRAW)).then(function () {\r\n                        if (self.loadingState) {\r\n                            delete self.loadingState;\r\n                            delete self.toShare;\r\n                        }\r\n                    });\r\n                    setTimeout(function () {\r\n                        self.track.trackList.scrollTop = e.index * listElement.offsetHeight;\r\n                    }, 100);\r\n                } else {\r\n                    self.map.toast(self.getLocaleString(\"geo.trk.import.disabled\"), { type: TC.Consts.msgType.WARNING });\r\n                }\r\n            });\r\n\r\n            const _stopOtherTracks = function (self, trackLiId) {\r\n                self.track.trackList.querySelectorAll('li[data-id]').forEach(function (listItem) {\r\n                    if (listItem.dataset.id !== trackLiId) {\r\n                        const btnSimulate = listItem.querySelector(sel.SIMULATE);\r\n                        const btnPause = listItem.querySelector(sel.PAUSE);\r\n\r\n                        btnSimulate.classList.remove(self.Const.Classes.SIMULATIONACTIVATED);\r\n                        btnSimulate.setAttribute('title', self.getLocaleString(\"tr.lst.simulate\"));\r\n                        btnPause.classList.remove('play');\r\n                        btnPause.setAttribute('title', self.getLocaleString(\"tr.lst.pause\"));\r\n\r\n                        self.uiSimulate(false, listItem);\r\n                        _edit(false, listItem);\r\n                    }\r\n                });\r\n\r\n                // para el resize no me va bien aqu\r\n                //self.clear(self.Const.Layers.TRACK);\r\n            };\r\n\r\n            var _drawTrack = function (self, btnDraw) {\r\n                return new Promise(function (resolve, reject) {\r\n\r\n                    const trackLi = btnDraw.parentElement;\r\n\r\n                    setTimeout(function () {\r\n                        if (trackLi.classList.contains(self.Const.Classes.SELECTEDTRACK)) {\r\n                            self.uiSimulate(false, btnDraw);\r\n\r\n                            self.clear(self.Const.Layers.TRACK);\r\n                            self.map.off(TC.Consts.event.FEATUREREMOVE, onFeatureRemove);\r\n\r\n                            btnDraw.setAttribute('title', btnDraw.textContent);\r\n                        }\r\n                        else if (self.getSelectedTrack()) { // GLS: si hay elemento seleccionado actuamos\r\n                            _stopOtherTracks(self, trackLi.dataset.id);\r\n                            self.working = self.drawTrack(trackLi);\r\n                        } else {\r\n                            self.working = self.drawTrack(trackLi);\r\n                        }\r\n\r\n                        /* GLS: 15/02/2019 Preparamos la feature por si se comparte, necesito hacerlo aqu \r\n                           porque la gestin en asncrona y todo el flujo de exportacin es sncrono */\r\n                        if (trackLi.classList.contains(self.Const.Classes.SELECTEDTRACK)) {\r\n                            self.prepareFeaturesToShare({ uid: trackLi.dataset.uid, setFeaturesToShare: true }).then(function () {\r\n                                resolve();\r\n                            });\r\n                        } else {\r\n                            resolve();\r\n                        }\r\n                    }, 0);\r\n                });\r\n            };\r\n\r\n            var _loadTrack = function (self, btnSimulate) {\r\n                return new Promise(function (resolve, reject) {\r\n                    setTimeout(function () {\r\n                        const trackLi = btnSimulate.parentElement;\r\n                        const selectedTrack = self.getSelectedTrack();\r\n                        _stopOtherTracks(self, trackLi.dataset.id);\r\n                        self.uiSimulate(false, selectedTrack);\r\n                        self.uiSimulate(true, btnSimulate);\r\n\r\n                        // para el resize con pelcula mejor as\r\n                        if (selectedTrack && trackLi.dataset.id !== selectedTrack.dataset.id) {\r\n                            self.clear(self.Const.Layers.TRACK);\r\n                        }\r\n\r\n                        self.simulate_paused = false;\r\n                        self.simulateTrack(trackLi);\r\n\r\n                        resolve();\r\n                    }, 0);\r\n                });\r\n            };\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.EDIT, function (e) {\r\n                _edit(true, e.target);\r\n            }));\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.DELETE, function (e) {\r\n                self.removeTrack(e.target.parentElement);\r\n            }));\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.SAVE, function (e) {\r\n                var newName = e.target.parentElement.querySelector('input').value;\r\n                if (newName.trim().length === 0) {\r\n                    TC.alert(self.getLocaleString('geo.trk.edit.alert'));\r\n                }\r\n                else {\r\n                    self.editTrackName(e.target.parentElement.dataset.id, e.target.parentElement.querySelector('input').value);\r\n                    _edit(false, e.target);\r\n                }\r\n            }));\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.CANCEL, function (e) {\r\n                _edit(false, e.target);\r\n            }));\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.SHARE, function (e) {\r\n                self.shareTrack(e.target.parentElement).then(function () {\r\n                    self.showShareDialog(self._shareDialogDiv);\r\n                });\r\n            }));\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.EXPORT, function (e) {\r\n                const parent = e.target.parentElement;\r\n                e.target.setAttribute('disabled', \"\");\r\n\r\n                self.export(parent).then((features) => {\r\n                    self.getDownloadDialog().then(function (dialog) {\r\n                        const options = self.getDownloadDialogOptions(getDownloadFileName.call(self, parent));\r\n                        dialog.open(features.map((f) => { f.uid = parent.dataset.uid; return f; }), options);\r\n\r\n                        e.target.removeAttribute('disabled');\r\n                    });\r\n                });\r\n            }));\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.STOP, function (e) {\r\n                self.uiSimulate(false, e.target);\r\n                self.wrap.simulateTrackEnd();\r\n                const btnPause = e.target.parentElement.querySelector(sel.PAUSE);\r\n                btnPause.classList.remove('play');\r\n                btnPause.setAttribute('title', self.getLocaleString('tr.lst.pause'));\r\n\r\n                e.target.parentElement.querySelector(sel.SPEED).textContent = 'x 1';\r\n                self.simulate_speed = 1;\r\n            }));\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.PAUSE, function (e) {\r\n                self.simulate_paused = !e.target.classList.contains('play');\r\n                if (self.simulate_paused)\r\n                    self.simulate_pausedElapse = -1;\r\n\r\n                e.target.setAttribute('title', self.getLocaleString(self.simulate_paused ? 'tr.lst.play' : 'tr.lst.pause'));\r\n                e.target.classList.toggle('play', !!self.simulate_paused);\r\n            }));\r\n\r\n            var lapse = 0.5;\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.BACKWARD, function (e) {\r\n                if (self.simulate_speed == 1)\r\n                    self.simulate_speed = lapse;\r\n                else self.simulate_speed = self.simulate_speed / 2;\r\n\r\n                e.target.parentElement.querySelector(self._classSelector + \" \" + sel.FORWARD).disabled = false;\r\n\r\n                e.target.parentElement.querySelector(sel.SPEED).textContent = self.simulate_speed < 1 ? '/ ' + (1 / self.simulate_speed) : 'x ' + self.simulate_speed;\r\n\r\n                if (self.simulate_speed == 0.000244140625) {\r\n                    e.target.disabled = true;\r\n                }\r\n            }));\r\n\r\n            list.addEventListener('click', TC.EventTarget.listenerBySelector(self._classSelector + ' ' + sel.FORWARD, function (e) {\r\n                self.simulate_speed = self.simulate_speed / lapse;\r\n\r\n                e.target.parentElement.querySelector(sel.SPEED).textContent = self.simulate_speed < 1 ? '/ ' + (1 / self.simulate_speed) : 'x ' + self.simulate_speed;\r\n\r\n                e.target.parentElement.querySelector(self._classSelector + \" \" + sel.BACKWARD).disabled = false;\r\n\r\n                if (self.simulate_speed == 4096) {\r\n                    e.target.disabled = true;\r\n                }\r\n            }));\r\n\r\n\r\n            // popup\r\n            self.track.trackContinue.addEventListener('click', function () {\r\n                // cerramos popup y continuamos con el track de session y almacenando en session\r\n                TC.Util.closeModal();\r\n                // al obtener la posicin se almacena en session y continuamos almacenando en session mientras se mueve\r\n                _tracking.call(self);\r\n            });\r\n            self.track.trackRenew.addEventListener('click', function () {\r\n                // eliminamos el track actual de session - restablecemos el tracking\r\n                delete self.sessionTracking;\r\n                TC.Util.storage.setSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP, undefined);\r\n                localforage.removeItem(self.Const.LocalStorageKey.TRACKINGTEMP);\r\n                // cerramos el popup\r\n                TC.Util.closeModal();\r\n                // al obtener la posicin se almacena en session y continuamos almacenando en session mientras se mueve\r\n                _tracking.call(self);\r\n            });\r\n            self.track.trackClose.addEventListener('click', function () {\r\n                _deactivateTrackingBtns.call(self);\r\n            });\r\n            //self.track.trackAddSegment.addEventListener('click', function () {\r\n            //    TC.alert('pendiente');\r\n            //    // cerramos el popup\r\n            //    TC.Util.closeModal();\r\n            //});\r\n\r\n            // popup advertencia\r\n            self.track.trackAdvertisementOK.addEventListener('click', function () {\r\n\r\n                const checkboxes = document.body.querySelectorAll('input[name*=\"Advertisement\"]:checked');\r\n\r\n                if (checkboxes.length > 0) {\r\n                    const promise = new Promise(function (resolve, reject) {\r\n                        if (window.localforage)\r\n                            resolve();\r\n                        else {\r\n                            TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                                resolve();\r\n                            });\r\n                        }\r\n                    });\r\n\r\n                    promise.then(function () {\r\n                        localforage.setItem(checkboxes[0].getAttribute('name'), false);\r\n                    });\r\n                }\r\n\r\n                TC.Util.closeModal();\r\n            });\r\n\r\n            self.track.renderTrack = self.div.querySelector('#tc-ctl-geolocation-track-render-' + self.id);\r\n            self.track.renderTrack.addEventListener('change', function () {\r\n                if (self.track.activateButton.classList.contains(TC.Consts.classes.HIDDEN)) {\r\n                    self.layerTracking.setVisibility(this.checked);\r\n                }\r\n\r\n                visibilityTrack = this.checked;\r\n            });\r\n\r\n            if (window.localforage)\r\n                self.bindTracks();\r\n            else {\r\n                TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                    self.bindTracks();\r\n                });\r\n            }\r\n\r\n            if (TC.Util.isFunction(callback)) {\r\n                callback();\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.shareTrack = function (li) {\r\n        const self = this;\r\n        return self.getShareDialog(self._shareDialogDiv).then(function () {\r\n            return self.prepareFeaturesToShare({ uid: li.dataset.uid, setFeaturesToShare: false })\r\n                .then(function (features) {\r\n                    self.toShare = {\r\n                        trackName: li.querySelector('span').innerHTML,\r\n                        features: features\r\n                    };\r\n                });\r\n        });\r\n    };\r\n\r\n    ctlProto.activate = function () {\r\n        //var self = this;\r\n        //TC.Control.prototype.activate.call(self);\r\n    };\r\n\r\n    ctlProto.deactivate = function () {\r\n        var self = this;\r\n\r\n        TC.Util.closeModal();\r\n        self.clearSelection();\r\n        self.deactivateTracking();\r\n        //TC.Control.prototype.deactivate.call(self);\r\n    };\r\n\r\n    var _activateTrackingBtns = function () {\r\n        var self = this;\r\n\r\n        self.track.activateButton.classList.add(TC.Consts.classes.HIDDEN);\r\n        self.track.deactivateButton.classList.remove(TC.Consts.classes.HIDDEN);\r\n    };\r\n\r\n    var _deactivateTrackingBtns = function () {\r\n        var self = this;\r\n\r\n        self.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);\r\n        self.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN);\r\n    };\r\n\r\n    var _showAlerMsg = function () {\r\n        var self = this;\r\n        self.map.toast(self.div.querySelector(\".alert-warning\").innerHTML, {\r\n            duration: 10000\r\n        });\r\n    };\r\n\r\n    ctlProto.markerStyle = {\r\n        radius: 10,\r\n        fillColor: [255, 0, 0, 100],\r\n        strokeColor: [255, 255, 255, 255],\r\n        strokeWidth: 2\r\n    };\r\n\r\n    ctlProto.lineStyle = {\r\n        strokeWidth: 2,\r\n        strokeColor: [0, 206, 209, 255]\r\n    };\r\n\r\n    ctlProto.setFormatInfoNewPosition = function (newPosition) {\r\n        var self = this;\r\n\r\n        var data = {};\r\n        var locale = TC.Util.getMapLocale(self.map);\r\n\r\n        if (self.map.on3DView) {\r\n            var geoCoords = self.map.crs !== self.map.view3D.crs ? TC.Util.reproject(newPosition.position, self.map.crs, self.map.view3D.crs) : newPosition.position;\r\n            data.x = geoCoords[0].toLocaleString(locale);\r\n            data.y = geoCoords[1].toLocaleString(locale);\r\n\r\n            data.mdt = Math.round(self.map.view3D.getHeightFromMDT(geoCoords)).toLocaleString(locale);\r\n\r\n            data.isGeo = true;\r\n\r\n        } else {\r\n            data.x = Math.round(newPosition.position[0]).toLocaleString(locale);\r\n            data.y = Math.round(newPosition.position[1]).toLocaleString(locale);\r\n        }\r\n\r\n        data.z = (Math.round(newPosition.altitude).toLocaleString(locale));\r\n        data.accuracy = (Math.round(newPosition.accuracy).toLocaleString(locale));\r\n        data.speed = newPosition.speed.toLocaleString(locale, { minimumFractionDigits: 1, maximumFractionDigits: 1 });\r\n\r\n        return data;\r\n    };\r\n\r\n    ctlProto.getTrackInfoPanel = function () {\r\n        const self = this;\r\n        if (!self.track._infoPanelPromise) {\r\n            self.track._infoPanelPromise = new Promise(function (resolve, reject) {\r\n                if (!self.track.infoPanel) {\r\n\r\n                    var resultsPanelOptions = {\r\n                        content: \"table\",\r\n                        resize: false,\r\n                        titles: {\r\n                            main: self.getLocaleString(\"geo.mylocation\"),\r\n                            max: self.getLocaleString(\"geo.mylocation.show\")\r\n                        },\r\n                        classes: {\r\n                            collapsed: \"tracking\"\r\n                        }\r\n                    };\r\n\r\n                    var ctlPromise;\r\n                    const addResultsPanelInfo = function (controlContainer) {\r\n                        resultsPanelOptions.position = controlContainer.POSITION.RIGHT;\r\n                        ctlPromise = controlContainer.addControl('resultsPanel', resultsPanelOptions);\r\n                    };\r\n\r\n                    let displayOn;\r\n                    if (!self.options.displayElevation && self.options.displayOn) {\r\n                        displayOn = self.options.displayOn;\r\n                    } else if (self.options.displayElevation) {\r\n                        displayOn = self.options.displayElevation.displayOn;\r\n                    }\r\n                    if (displayOn) {\r\n                        var controlContainer = self.map.getControlsByClass('TC.control.' + displayOn[0].toUpperCase() + displayOn.substring(1))[0];\r\n                        if (!controlContainer) {\r\n                            self.map.addControl(displayOn).then(addResultsPanelInfo);\r\n                        } else {\r\n                            addResultsPanelInfo(controlContainer);\r\n                        }\r\n                    } else {\r\n                        resultsPanelOptions.div = document.createElement('div');\r\n                        self.map.div.appendChild(resultsPanelOptions.div);\r\n                        ctlPromise = self.map.addControl('resultsPanel', resultsPanelOptions);\r\n                    }\r\n\r\n                    ctlPromise.then(function (resultsPanelInfo) {\r\n                        self.track.infoPanel = resultsPanelInfo;\r\n                        resolve(resultsPanelInfo);\r\n                    });\r\n                } else {\r\n                    resolve(self.track.infoPanel);\r\n                }\r\n            });\r\n        }\r\n        return self.track._infoPanelPromise;\r\n    };\r\n\r\n    ctlProto.renderInfoNewPosition = function (d) {\r\n        const self = this;\r\n\r\n        self.getRenderedHtml(self.CLASS + '-tracking-toast', self.setFormatInfoNewPosition(d.pd), function (html) {\r\n            self.getTrackInfoPanel().then(function (infoPanel) {\r\n                if (!infoPanel.isMinimized()) {\r\n                    self.map.getControlsByClass(TC.control.ResultsPanel)\r\n                        .filter(panel => panel.content === panel.contentType.TABLE && panel !== infoPanel)\r\n                        .forEach(function (panel) {\r\n                            panel.close();\r\n                        });\r\n                    infoPanel.renderPromise().then(function () {\r\n                        infoPanel.options.collidingPriority = infoPanel.COLLIDING_PRIORITY.IGNORE;\r\n                        infoPanel.open(html);\r\n                    });\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n\r\n    var duringTrackingToolsPanel = function () {\r\n        var self = this;\r\n\r\n        if (!self.track.trackToolPanelOpened.checked) {\r\n            self.map.trigger(TC.Consts.event.TOOLSCLOSE);\r\n        }\r\n    };\r\n\r\n    var _tracking = function () {\r\n        var self = this;\r\n\r\n        self.activate();\r\n\r\n        _activateTrackingBtns.call(self);\r\n        duringTrackingToolsPanel.call(self);\r\n\r\n        self.on(self.Const.Event.POSITIONCHANGE, function (d) {\r\n\r\n            self.currentPoint = d.pd;\r\n            self.renderInfoNewPosition(d);\r\n\r\n            self.track.trackName.disabled = false;\r\n            self.track.trackSave.disabled = false;\r\n\r\n            self.track.trackWPT.disabled = false;\r\n            self.track.trackAdd.disabled = false;\r\n\r\n            // cada vez que se registra una nueva posicin almacenamos en sessionStorage\r\n            TC.Util.storage.setSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP, self.wrap.formattedToStorage(self.layerTracking).features);\r\n        });\r\n        self.on(self.Const.Event.STATEUPDATED, function (data) {\r\n            //self.track.htmlMarker.setAttribute('src', data.moving ? 'layout/idena/img/geo-marker-heading.png' : 'layout/idena/img/geo-marker.png');\r\n        });\r\n\r\n        self.clear(self.Const.Layers.TRACKING);\r\n\r\n        advertisement.call(self, self.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);\r\n\r\n        self.wrap.setTracking(true);\r\n    };\r\n\r\n    /* inicio gestin suspensin de la pantalla en mviles */\r\n    var _onpauseVideo;\r\n    let isSupported = false;\r\n    let wakeLock = null;\r\n    let notifications = null;\r\n    if ('wakeLock' in navigator) {\r\n        isSupported = true;\r\n    }\r\n    let _ctlInstance = null;\r\n\r\n    var keepWakeLock = function () {\r\n        var self = _ctlInstance = this;\r\n        if (!isSupported)\r\n            addVideoKeepScreenOn.apply(self);\r\n        else {\r\n\r\n            // create an async function to request a wake lock\r\n            const requestWakeLock = async () => {\r\n                try {\r\n                    wakeLock = await navigator.wakeLock.request('screen');\r\n                    console.log(\"Wake Lock active\");\r\n                    wakeLock.addEventListener('release', () => {\r\n                        // if wake lock is released alter the button accordingly\r\n                        console.log(\"Wake Lock released\");\r\n                    });\r\n                } catch (err) {\r\n                    // if wake lock request fails - usually system related, such as battery\r\n                    console.error(err);\r\n                }\r\n            };\r\n            requestWakeLock();\r\n            //al cambiar de pestaa volvemos a activar el wakeLock\r\n            //document.addEventListener('visibilitychange', handleVisibilityChange);\r\n        }\r\n    }\r\n    var releaseLock = function () {\r\n        var self = _ctlInstance = this;\r\n        if (!isSupported)\r\n            removeVideoKeepScreenOn.apply(self);\r\n        else {\r\n            //document.removeEventListener('visibilitychange', handleVisibilityChange);\r\n            wakeLock.release()\r\n                .then(() => {\r\n                    wakeLock = null;\r\n                })\r\n        }\r\n    }\r\n    var addVideoKeepScreenOn = function () {\r\n        var self = this;\r\n\r\n        if (!self.videoScreenOn) {\r\n            var media = {\r\n                WebM: \"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=\",\r\n                MP4: \"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw==\"\r\n            };\r\n\r\n            self.videoScreenOn = document.createElement('video');\r\n            self.videoScreenOn.setAttribute(\"loop\", \"\");\r\n            self.videoScreenOn.setAttribute(\"muted\", \"\");\r\n            self.videoScreenOn.setAttribute(\"webkit-playsinline\", \"\");\r\n            self.videoScreenOn.setAttribute(\"playsinline\", \"\");\r\n            self.videoScreenOn.setAttribute(\"style\", \"transform: translateZ(0px);\");\r\n\r\n            var sourceWebM = document.createElement('source');\r\n            sourceWebM.src = media.WebM;\r\n            sourceWebM.type = \"video/webm\";\r\n            self.videoScreenOn.appendChild(sourceWebM);\r\n\r\n            var sourceMP4 = document.createElement('source');\r\n            sourceMP4.src = media.MP4;\r\n            sourceMP4.type = \"video/mp4\";\r\n            self.videoScreenOn.appendChild(sourceMP4);\r\n        }\r\n\r\n        self.videoScreenOn.play();\r\n    };\r\n    var removeVideoKeepScreenOn = function () {\r\n        var self = this;\r\n        if (self.videoScreenOn) {\r\n            self.videoScreenOn.pause();\r\n        }\r\n    };\r\n\r\n    var _onWindowBlurred;\r\n    var onWindowBlurred = function () {\r\n        var self = this;\r\n\r\n        fromSessionToStorage.apply(self);\r\n    };\r\n\r\n    var _onWindowFocused;\r\n    var onWindowFocused = function () {\r\n        var self = this;\r\n\r\n        if (self.videoScreenOn && self.videoScreenOn.paused)\r\n            self.videoScreenOn.play();\r\n\r\n        fromStorageToSession.apply(self);\r\n    };\r\n\r\n    var getHiddenProperty = function () {\r\n        var prefixes = ['webkit', 'moz', 'ms', 'o'];\r\n\r\n        if ('hidden' in document) return 'hidden';\r\n\r\n        for (var i = 0; i < prefixes.length; i++) {\r\n            if ((prefixes[i] + 'Hidden') in document)\r\n                return prefixes[i] + 'Hidden';\r\n        }\r\n\r\n        return null;\r\n    };\r\n\r\n    var _onWindowVisibility;\r\n    var onWindowVisibility = async function () {\r\n        var self = this;\r\n\r\n        var hidden = getHiddenProperty();\r\n\r\n        if (!document[hidden]) {\r\n            if (wakeLock !== null) {\r\n                keepWakeLock.apply(self);\r\n            }\r\n            else\r\n                onWindowFocused.apply(self);\r\n        }\r\n        else if (notifications) {\r\n            if (navigator.serviceWorker &&\r\n                //si se pulta shift + F5 el objeto controller de serviceWorkerContainer es null\r\n                (navigator.serviceWorker.controller ||\r\n                    //entonces ontenemos el SW del control SWCache client si existe y miramos si est activo\r\n                    (self.map.getControlsByClass(TC.control.SWCacheClient).length && (await self.map.getControlsByClass(TC.control.SWCacheClient)[0].getServiceWorker()).state === \"activated\")))\r\n                try {\r\n                    const registration = await navigator.serviceWorker.ready;\r\n                    registration.showNotification(self.notificationConf.title, Object.assign(self.notificationConf, {\r\n                        actions: [{\r\n                            action: \"back\",\r\n                            title: self.getLocaleString(\"geo.trk.notification.backButton\")\r\n                        }], data: {\r\n                            \"url\": document.location.href\r\n                        }\r\n                    }));\r\n                }\r\n                catch (ex) {\r\n                    const notification = new Notification(self.notificationConf.title, self.notificationConf);\r\n                }\r\n            else {\r\n                const notification = new Notification(self.notificationConf.title, self.notificationConf);\r\n            }\r\n        }\r\n        if (!wakeLock && self.videoScreenOn)\r\n            console.log('video is: ' + self.videoScreenOn.paused);\r\n\r\n    };\r\n    var addWindowEvents = function () {\r\n        var self = this;\r\n\r\n        if (!_onWindowVisibility)\r\n            _onWindowVisibility = onWindowVisibility.bind(self);\r\n\r\n        if (!_onWindowBlurred)\r\n            _onWindowBlurred = onWindowBlurred.bind(self);\r\n\r\n        if (!_onWindowFocused)\r\n            _onWindowFocused = onWindowFocused.bind(self);\r\n\r\n        window.addEventListener('visibilitychange', _onWindowVisibility, false);\r\n\r\n        // ipad / iphone / ipod (Safari mobile, not Android default browsers not Chrome Mobile that is)\r\n        if (TC.Util.detectSafari() && TC.browserFeatures.touch() && !navigator.userAgent.match(/Android/i) && !navigator.userAgent.match(/CriOS/i)) {\r\n            window.addEventListener('pagehide', _onWindowBlurred, false);\r\n            window.addEventListener('pageshow', _onWindowFocused, false);\r\n        } else { // the rest            \r\n            window.addEventListener('blur', _onWindowBlurred, false);\r\n            window.addEventListener('focus', _onWindowFocused, false);\r\n        }\r\n    }\r\n    var removeWindowEvents = function () {\r\n\r\n        window.removeEventListener('visibilitychange', _onWindowVisibility, false);\r\n\r\n        // ipad / iphone / ipod (Safari mobile, not Android default browsers not Chrome Mobile that is)\r\n        if (TC.Util.detectSafari() && TC.browserFeatures.touch() && !navigator.userAgent.match(/Android/i) && !navigator.userAgent.match(/CriOS/i)) {\r\n            window.removeEventListener('pagehide', _onWindowBlurred, false);\r\n            window.removeEventListener('pageshow', _onWindowFocused, false);\r\n        } else { // the rest            \r\n            window.removeEventListener('blur', _onWindowBlurred, false);\r\n            window.removeEventListener('focus', _onWindowFocused, false);\r\n        }\r\n    };\r\n\r\n    var fromSessionToStorage = function () {\r\n        var self = this;\r\n\r\n        var sessionTracking = TC.Util.storage.getSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP);\r\n        if (sessionTracking && sessionTracking.length > 0)\r\n            localforage.setItem(self.Const.LocalStorageKey.TRACKINGTEMP, typeof (sessionTracking) === \"string\" ? sessionTracking : JSON.stringify(sessionTracking));\r\n    };\r\n    var fromStorageToSession = function () {\r\n        var self = this;\r\n\r\n        localforage.getItem(self.Const.LocalStorageKey.TRACKINGTEMP).then(function (storageData) {\r\n            if (storageData !== null && storageData !== \"null\" && storageData.length > 0) {\r\n                TC.Util.storage.setSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP, storageData);\r\n            }\r\n        });\r\n    };\r\n    /* final gestin suspensin de la pantalla en mviles */\r\n\r\n    var advertisement = function (showAdvertisement) {\r\n        var self = this;\r\n\r\n        var done = new Promise(function (resolve, reject) {\r\n            if (window.localforage)\r\n                resolve();\r\n            else {\r\n                TC.loadJS(!window.localforage, [TC.Consts.url.LOCALFORAGE], function () {\r\n                    resolve();\r\n                });\r\n            }\r\n        });\r\n\r\n        done.then(function () {\r\n            localforage.getItem(showAdvertisement).then(function (registeredShowAdvertisement) {\r\n                if (registeredShowAdvertisement == null) {\r\n                    const dialog = self._dialogDiv.querySelector('.tc-ctl-geolocation-track-advert-dialog');\r\n                    const checkbox = dialog.querySelector('input[type=\"checkbox\"]');\r\n                    checkbox.setAttribute('name', showAdvertisement);\r\n                    checkbox.checked = false;\r\n\r\n                    document.querySelector('#pageBlurMsg').textContent = TC.Util.detectMobile() ? self.getLocaleString('geo.trk.page.blur') : self.getLocaleString('geo.trk.page.blur.desktop');\r\n\r\n                    dialog.querySelector('h3').textContent = showAdvertisement == self.Const.LocalStorageKey.GPSSHOWADVERTISEMENT ?\r\n                        self.getLocaleString(\"geo.track.activate\") + \" \" + self.getLocaleString(\"geo.gps\") :\r\n                        self.getLocaleString('geo.track.activate.title');\r\n\r\n                    TC.Util.showModal(self._dialogDiv.querySelector('.tc-ctl-geolocation-track-advert-dialog'));\r\n                }\r\n            });\r\n        });\r\n\r\n        self.map.toast(!TC.Util.detectMobile() ? self.getLocaleString('geo.trk.page.blur.desktop') : self.getLocaleString('geo.trk.page.blur'), {\r\n            type: TC.Consts.msgType.WARNING\r\n        });\r\n    };\r\n\r\n    ctlProto._askTracking = function (callback) {\r\n        var self = this;\r\n\r\n        TC.Util.showModal(self._dialogDiv.querySelector('.tc-ctl-geolocation-continue-track-dialog'), {\r\n            closeCallback: function () {\r\n\r\n                if (TC.Util.isFunction(callback)) {\r\n                    callback();\r\n                }\r\n            }\r\n        });\r\n\r\n        return true;\r\n    };\r\n\r\n    ctlProto.activateTracking = function () {\r\n        var self = this;\r\n        var trackingAvailable = true;\r\n\r\n        if (!self.isActive) {\r\n            self.activate();\r\n        }\r\n\r\n        self.clear(self.Const.Layers.TRACKING);\r\n\r\n        try {\r\n            TC.Util.storage.setSessionLocalValue(self.Const.LocalStorageKey.TEST, self.Const.LocalStorageKey.TEST);\r\n        } catch (error) {\r\n            if (error.code === DOMException.QUOTA_EXCEEDED_ERR)\r\n                TC.alert(self.getLocaleString(\"geo.error.trackinglocalstorage\"));\r\n            else TC.error(error);\r\n\r\n            trackingAvailable = false;\r\n        }\r\n\r\n        if (trackingAvailable) {\r\n            if (window.Notification || window.webkitNotifications) {\r\n                var checkNotificationsReply = function (permission) {\r\n                    if (permission === \"granted\") notifications = _notifications;\r\n                };\r\n                const _notifications = window.Notification || window.webkitNotifications;\r\n                if (_notifications.permission === \"denied\") {\r\n                    notifications = null;\r\n                } else if (_notifications.permission === \"granted\") notifications = _notifications;\r\n                else _notifications.requestPermission(checkNotificationsReply);\r\n            }\r\n            keepWakeLock.apply(self);\r\n            addWindowEvents.apply(self);\r\n\r\n            self.sessionTracking = TC.Util.storage.getSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP);\r\n            if (self.sessionTracking) {\r\n                var asked = self._askTracking(function () {\r\n                    _deactivateTrackingBtns.call(self);\r\n                });\r\n\r\n                if (!asked) {\r\n                    self.track.trackRenew.click();\r\n                }\r\n            } else _tracking.call(self);\r\n        } else { _deactivateTrackingBtns.call(self); }\r\n    };\r\n\r\n    ctlProto.deactivateTracking = function () {\r\n        var self = this;\r\n\r\n        var _deactivateTracking = function () {\r\n\r\n            self.getTrackInfoPanel().then(panel => panel.close());\r\n\r\n            fromSessionToStorage.apply(self);\r\n\r\n            self.wrap.setTracking(false);\r\n\r\n\r\n            delete self.geopositionTracking;\r\n\r\n            if (!visibilityTrack) {\r\n                self.div.querySelector(self._classSelector + '-track-render').querySelector('label').click();\r\n            }\r\n\r\n            releaseLock.apply(self);\r\n            removeWindowEvents.apply(self);\r\n\r\n            self.off(self.Const.Event.POSITIONCHANGE);\r\n            self.off(self.Const.Event.STATEUPDATED);\r\n\r\n            _deactivateTrackingBtns.call(self);\r\n\r\n            self.track.trackName.value = '';\r\n            self.track.trackName.disabled = true;\r\n            self.track.trackSave.disabled = true;\r\n\r\n            self.track.trackWPT.value = '';\r\n            self.track.trackWPT.disabled = true;\r\n            self.track.trackAdd.disabled = true;\r\n\r\n            self.clear(self.Const.Layers.TRACKING);\r\n            self.clear(self.Const.Layers.GPS);\r\n\r\n            //TC.Control.prototype.deactivate.call(self);\r\n\r\n            return true;\r\n        };\r\n\r\n        if (self.wrap.hasCoordinates()) {\r\n            self.map.toast(self.getLocaleString(\"geo.trk.deactivate.alert\"), {\r\n                duration: 10000\r\n            });\r\n            //TC.alert(self.getLocaleString(\"geo.trk.deactivate.alert\"));\r\n            return _deactivateTracking();\r\n        } else return _deactivateTracking();\r\n    };\r\n\r\n    /* Obtengo los tracks desde localForage */\r\n    ctlProto.getStoredTracks = function () {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            var tracks = [];\r\n\r\n            const onResolve = function (toResolve) {\r\n                // estamos en la carga inicial\r\n                if (elevationProfileCache.length === 0) {\r\n                    toResolve\r\n                        .filter(elm => { return elm.profile })\r\n                        .forEach((elm) => elevationProfileCache.push({ uid: elm.uid, data: JSON.parse(elm.profile) }));\r\n                }\r\n                resolve(toResolve);\r\n            };\r\n\r\n            localforage.keys()\r\n                .then(function (keys) {\r\n                    keys = keys.filter(function (k) {\r\n                        if (!(k.indexOf(self.Const.LocalStorageKey.TRACKINGTEMP) === 0) && k.indexOf(self.Const.LocalStorageKey.TRACKING) === 0) {\r\n                            return /trk#\\d/i.exec(k);\r\n                        }\r\n                        return false;\r\n                    });\r\n\r\n                    if (keys.length == 0) {\r\n                        self.availableTracks = tracks;\r\n                        onResolve(tracks);\r\n                    }\r\n\r\n                    const promises = new Array(keys.length);\r\n                    keys.forEach(function (key, idx) {\r\n                        promises[idx] = new Promise(function (res, rej) {\r\n                            localforage.getItem(key, function (e, v) {\r\n                                res(v);\r\n                            });\r\n                        });\r\n                    });\r\n\r\n                    Promise.all(promises).then(function (results) {\r\n                        if (results && results.length) {\r\n                            results.forEach(function (r) {\r\n                                var r = JSON.parse(r);\r\n                                if (r instanceof Array) {\r\n                                    tracks = tracks.concat(r);\r\n                                } else {\r\n                                    tracks.push(r);\r\n                                }\r\n                            });\r\n\r\n                            var tracksArray = tracks.length > 1 ? _orderTracks(tracks) : tracks;\r\n                            self.availableTracks = tracksArray;\r\n                            onResolve(tracksArray);\r\n                        }\r\n                    });\r\n                })\r\n                .catch((err) => {\r\n                    console.log('Capturamos error que se produce por configuracin del navegador.');\r\n                    TC.error(self.getLocaleString('couldNotAccessLocalStorage'));\r\n                });\r\n        });\r\n    };\r\n\r\n    /*\r\n     * Recibe una sucesin de tracks y la ordena por nombre.\r\n     */\r\n    var _orderTracks = function (tracks) {\r\n        var tracksArray = [];\r\n\r\n        for (var index in tracks) {\r\n            if (tracks[index] && typeof (tracks[index]) === \"object\") {\r\n                tracksArray.push(tracks[index]);\r\n                tracksArray.sort(function (a, b) {\r\n                    if (typeof (a.name) === \"string\") {\r\n                        return TC.Util.isFunction(a.name.localeCompare) ? a.name.localeCompare(b.name) : 0;\r\n                    } else { return 0; }\r\n                });\r\n            }\r\n        }\r\n\r\n        return tracksArray;\r\n    };\r\n\r\n    /* Almaceno los tracks mediante localForage, actualizo la vble availableTracks y actualizo la lista de tracks */\r\n    ctlProto.setStoredTracks = function (tracks) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            const promises = [];\r\n            tracks.forEach(function (t) {\r\n                promises.push(new Promise(function (res, rej) {\r\n                    localforage.setItem(self.Const.LocalStorageKey.TRACKING + \"#\" + t.uid, JSON.stringify(t), function (e, v) {\r\n                        res(v);\r\n                    });\r\n                }));\r\n            });\r\n\r\n            Promise.all(promises).then(function () {\r\n                self.getStoredTracks().then(function () {\r\n                    self.bindTracks();\r\n                    resolve();\r\n                });\r\n            });\r\n        });\r\n    };\r\n\r\n    /* Obtengo los tracks desde vble local */\r\n    ctlProto.getAvailableTracks = function () {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            if (!self.availableTracks) {\r\n                self.getStoredTracks().then(function (availableTracks) {\r\n                    resolve(availableTracks);\r\n                });\r\n            }\r\n            else {\r\n                resolve(self.availableTracks);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.bindTracks = function () {\r\n        var self = this;\r\n\r\n        const listItems = self.track.trackList.querySelectorAll('li');\r\n        listItems.forEach(function (li) {\r\n            li.style.display = 'none';\r\n        });\r\n\r\n        self.getAvailableTracks().then(function (tracks) {\r\n\r\n            if (_isEmpty(tracks)) {\r\n                self.track.trackList.querySelectorAll('li[class^=\"tc-ctl-geolocation-track-available-empty\"]').forEach(function (li) {\r\n                    li.style.display = '';\r\n                });\r\n                self.track.trackSearch.disabled = true;\r\n            }\r\n            else {\r\n                const currentSelectedTrack = self.getSelectedTrack();\r\n                var currentSelectedTrackId;\r\n                if (currentSelectedTrack) {\r\n                    currentSelectedTrackId = currentSelectedTrack.dataset.uid\r\n                }\r\n                self.track.trackList.querySelectorAll('li[data-id]').forEach(function (li) {\r\n                    self.track.trackList.removeChild(li);\r\n                });\r\n\r\n                for (var i = 0; i < tracks.length; i++) {\r\n                    var t = tracks[i];\r\n                    if (typeof (t) === \"object\") {\r\n                        self.getRenderedHtml(self.CLASS + '-track-node', {\r\n                            id: i, uid: t.uid, name: t.name ? t.name.trim() : ''\r\n                        }, function (html) {\r\n                            const parser = new DOMParser();\r\n                            const newLi = parser.parseFromString(html, 'text/html').body.firstChild;\r\n                            self.track.trackList.appendChild(newLi);\r\n                        });\r\n                    }\r\n                }\r\n\r\n                if (currentSelectedTrackId) {\r\n                    self.setSelectedTrack(self.track.trackList.querySelector('li[data-uid=\"' + currentSelectedTrackId + '\"]'));\r\n                }\r\n\r\n                self.track.trackSearch.disabled = false;\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.chartProgressClear = function () {\r\n        const self = this;\r\n\r\n        self.getElevationControl().then(elevCtl => elevCtl && elevCtl.removeElevationTooltip());\r\n    };\r\n\r\n    ctlProto.chartSetProgress = function (previous, current, distance, doneTime) {\r\n        var self = this;\r\n\r\n        if (self.elevationControl && self.elevationControl.resultsPanel && (!self.elevationControl.resultsPanel.isVisible() || self.elevationControl.resultsPanel.isMinimized())) {\r\n            return;\r\n        }\r\n\r\n        var done = previous.d;\r\n        var locale = self.map.options.locale && self.map.options.locale.replace('_', '-') || undefined;\r\n        var ele = parseInt(current[2].toFixed(0)).toLocaleString(locale);\r\n        var dist;\r\n        var measure;\r\n        if ((done / 1000) < 1) {\r\n            dist = Math.round((done / 1000) * 1000);\r\n            measure = ' m';\r\n        } else {\r\n            dist = Math.round((done / 1000) * 100) / 100;\r\n            measure = ' km';\r\n        }\r\n\r\n        dist = dist.toLocaleString(locale);\r\n\r\n        const hasSecondaryElevationProfileChartData = self.elevationChartData && self.elevationChartData.secondaryElevationProfileChartData &&\r\n            Array.isArray(self.elevationChartData.secondaryElevationProfileChartData) && self.elevationChartData.secondaryElevationProfileChartData.length > 0 &&\r\n            self.elevationChartData.secondaryElevationProfileChartData[0];\r\n\r\n        if (hasSecondaryElevationProfileChartData &&\r\n            self.elevationChartData.secondaryElevationProfileChartData[0].elev &&\r\n            !self.elevationChartData.secondaryElevationProfileChartData[0].elevCoords &&\r\n            !self.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates) {\r\n\r\n            let coords = [...self.elevationChartData.coords];\r\n\r\n            if (Array.isArray(coords) && Array.isArray(coords[0])) {\r\n                coords.forEach((c, i) => {\r\n                    c.splice(2, 1, self.elevationChartData.secondaryElevationProfileChartData[0].ele[i])\r\n                });\r\n\r\n                self.elevationChartData.secondaryElevationProfileChartData[0].elevCoords = self.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates = coords;\r\n            }\r\n        }\r\n\r\n        let ele2;\r\n        if (hasSecondaryElevationProfileChartData &&\r\n            self.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates) {\r\n            ele2 = TC.wrap.Geometry.getNearest(current, self.elevationChartData.secondaryElevationProfileChartData[0].eleCoordinates);\r\n            ele2 = parseInt(ele2[2].toFixed(0)).toLocaleString(locale);\r\n        }\r\n\r\n        if (self.elevationChartData) {\r\n            let iX = 0;\r\n            while (self.elevationChartData.x[iX] <= done) {\r\n                iX++;\r\n            }\r\n\r\n            self.getElevationControl().then(elevCtl => elevCtl &&\r\n                elevCtl.getProfilePanel().then(function (panel) {\r\n                    if (panel) {\r\n                        panel.chart.chart.tooltip.show({ x: self.elevationChartData.x[iX === 0 ? 0 : iX - 1] });\r\n                        panel.wrap.hideElevationMarker();\r\n                    }\r\n                }));\r\n        }\r\n    };\r\n\r\n    ctlProto._getTime = function (timeFrom, timeTo) {\r\n        var diff = timeTo - timeFrom;\r\n        var d = {};\r\n        var daysDifference = Math.floor(diff / 1000 / 60 / 60 / 24);\r\n        diff -= daysDifference * 1000 * 60 * 60 * 24;\r\n\r\n        var hoursDifference = Math.floor(diff / 1000 / 60 / 60);\r\n        diff -= hoursDifference * 1000 * 60 * 60;\r\n\r\n        d.h = hoursDifference + (daysDifference * 24);\r\n\r\n        var minutesDifference = Math.floor(diff / 1000 / 60);\r\n        diff -= minutesDifference * 1000 * 60;\r\n\r\n        d.m = minutesDifference;\r\n\r\n        d.s = Math.floor(diff / 1000);\r\n\r\n        return TC.Util.extend({}, d, { toString: (\"00000\" + d.h).slice(-2) + ':' + (\"00000\" + d.m).slice(-2) + ':' + (\"00000\" + d.s).slice(-2) });\r\n    };\r\n\r\n    ctlProto.simulateTrack = async function (li) {\r\n        var self = this;\r\n\r\n        const elevCtl = await self.getElevationControl();\r\n        elevCtl.removeElevationTooltip();\r\n        self.simulate_speed = 1;\r\n        if (self.getSelectedTrack() === li && // si el usuario a activado la pelcula del track ya seleccionado no repintamos\r\n            elevCtl.resultsPanel && elevCtl.resultsPanel.chart && elevCtl.resultsPanel.chart.chart) {\r\n            if (!self.hasElevation) {\r\n                self.hasElevation = elevCtl.elevationProfileChartData.min === 0 && elevCtl.elevationProfileChartData.max === 0 ? false : true;\r\n            }\r\n            self.wrap.simulateTrack();\r\n        } else {\r\n            self.drawTrack(li, false).then(function () {\r\n                if (self.elevationChartData &&\r\n                    self.elevationChartData.min === 0 &&\r\n                    self.elevationChartData.max === 0) {   // no tenemos elevacin original\r\n                    self.map.toast(self.getLocaleString(\"geo.trk.simulate.empty\"), { duration: 10000 });\r\n                    self.hasElevation = false; // establecemos a false para que no muestra el progreso en el perfil ya que siempre ser elevacin 0\r\n                } else if (!(self.elevationChartData.min === 0 && self.elevationChartData.max === 0)) {\r\n                    self.hasElevation = true;\r\n                }\r\n\r\n                self.wrap.simulateTrack();\r\n            });\r\n        }\r\n    };\r\n\r\n    ctlProto.drawTrack = function (li, activateSnapping) {\r\n        var self = this;\r\n\r\n        self.clear(self.Const.Layers.TRACK);\r\n\r\n        duringTrackingToolsPanel.call(self);\r\n        return new Promise(function (resolve, reject) {\r\n            self.setSelectedTrack(li);\r\n            self.drawTrackingData(li).then(function () {\r\n                self.elevationTrack(li).then(() => {\r\n                    self.activate();\r\n\r\n                    resolve();\r\n                }).catch(reject);\r\n            });\r\n        });\r\n    };\r\n\r\n    const elevationProfileCache = [];\r\n\r\n    const getElevationProfileFromCache = function (uid) {\r\n        return elevationProfileCache.filter(function (elm) {\r\n            return elm.uid.toString() === uid.toString();\r\n        })[0];\r\n    };\r\n\r\n    const cacheElevationProfile = function (feature, data, trackUID) {\r\n        const self = this;\r\n        var result = getElevationProfileFromCache(trackUID);\r\n        if (!result) {\r\n            result = {\r\n                uid: parseFloat(trackUID)\r\n            };\r\n            elevationProfileCache.push(result);\r\n            self.getAvailableTracks().then(function (tracks) {\r\n                if (tracks) {\r\n                    let index = tracks.findIndex((t) => { return t.uid.toString() === trackUID });\r\n                    if (index > -1) {\r\n                        tracks[index].profile = JSON.stringify(data);\r\n                        self.setStoredTracks(tracks);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        result.data = data;\r\n        return result;\r\n    };\r\n\r\n    const elevationFromServiceCache = [];\r\n\r\n    var arr_diff = function (a1, a2) {\r\n\r\n        var a = [], diff = [];\r\n\r\n        for (var i = 0; i < a1.length; i++) {\r\n            a[a1[i]] = true;\r\n        }\r\n\r\n        for (var i = 0; i < a2.length; i++) {\r\n            if (a[a2[i]]) {\r\n                delete a[a2[i]];\r\n            } else {\r\n                a[a2[i]] = true;\r\n            }\r\n        }\r\n\r\n        for (var k in a) {\r\n            diff.push(k);\r\n        }\r\n\r\n        return diff;\r\n    };\r\n\r\n    const getElevationFromServiceOnCache = function (feature) {\r\n        let isOnCache = elevationFromServiceCache.filter(function (elm) {\r\n            return elm.feature === feature;\r\n        })[0];\r\n        if (!isOnCache) {\r\n            return elevationFromServiceCache.filter(function (elm) {\r\n                return arr_diff(elm.feature.geometry, feature.geometry).length === 0;\r\n                //return elm.feature.geometry === feature.geometry; aunque sean iguales da falso ???\r\n            })[0];\r\n        } else {\r\n            return isOnCache;\r\n        }\r\n    };\r\n\r\n    const cacheElevationFromService = function (feature, data) {\r\n        var result = getElevationFromServiceOnCache(feature);\r\n        if (!result) {\r\n            result = {\r\n                feature: feature\r\n            };\r\n            elevationFromServiceCache.push(result);\r\n        }\r\n        result.data = data;\r\n        return result;\r\n    };\r\n    const isLine = function (feat) {\r\n        return TC.feature.Polyline && feat instanceof TC.feature.Polyline;\r\n    };\r\n    const getCurrentPolyline = function () {\r\n        return this.layerTrack.features\r\n            .filter(function (feat) {\r\n                return isLine(feat);\r\n            })[0];\r\n    };\r\n    const getCurrentPoints = function () {\r\n        return this.layerTrack.features\r\n            .filter(function (feat) { // filtrando por Point se cuelan los Marker\r\n                return TC.feature.Marker && !(feat instanceof TC.feature.Marker) &&\r\n                    !isLine(feat);\r\n            });\r\n    };\r\n\r\n    ctlProto.elevationTrack = function (li, resized) {\r\n        var self = this;\r\n\r\n        return new Promise((resolve, reject) => {\r\n            if (resized) {\r\n                self.wrap.simulateTrackEnd(resized);\r\n                self.uiSimulate(false, li);\r\n                return;\r\n            }\r\n            if (!self.onResize) {\r\n                self.onResize = self.elevationTrack.bind(self, li, true);\r\n                window.addEventListener(\"resize\", self.onResize, false);\r\n            }\r\n            self.getElevationControl().then(async function (elevCtl) {\r\n                if (elevCtl) {\r\n                    let cachedProfile = getElevationProfileFromCache(li.dataset.uid);\r\n                    if (!cachedProfile) {\r\n                        const track = await self.getTrackingData(li);\r\n                        if (self.layerTrack && self.layerTrack.features) {\r\n                            let features = self.layerTrack.features.filter((f) => {\r\n                                return isLine(f) &&\r\n                                    ((track.layout === ol.geom.GeometryLayout.XYZM ||\r\n                                        track.layout === ol.geom.GeometryLayout.XYZ) || self.options.displayElevation)\r\n                            });\r\n\r\n                            if (features.length > 0) {\r\n                                let line = features[0];\r\n                                let time = {};\r\n                                // track con tiempo\r\n                                if (track.layout == ol.geom.GeometryLayout.XYZM ||\r\n                                    track.layout == ol.geom.GeometryLayout.XYM) {\r\n                                    let diff = 0;\r\n                                    if (track.layout == ol.geom.GeometryLayout.XYZM) {\r\n                                        diff = line.geometry[line.geometry.length - 1][3] - line.geometry[0][3];\r\n                                    } else {\r\n                                        diff = line.geometry[line.geometry.length - 1][2] - line.geometry[0][2];\r\n                                    }\r\n                                    time = {\r\n                                        s: Math.floor((diff / 1000) % 60),\r\n                                        m: Math.floor(((diff / (1000 * 60)) % 60)),\r\n                                        h: Math.floor(((diff / (1000 * 60 * 60)) % 24))\r\n                                    };\r\n                                }\r\n\r\n                                let options = {\r\n                                    originalElevation: true,\r\n                                    onlyOriginalElevation: !self.options.displayElevation ? true : false,\r\n                                    ignoreCaching: true,\r\n                                    time: time,\r\n                                    callback: function () {\r\n                                        self.elevationChartData = elevCtl.elevationProfileChartData;\r\n                                        self.hasElevation = elevCtl.elevationProfileChartData.min === 0 && elevCtl.elevationProfileChartData.max === 0 ? false : true;\r\n                                        cacheElevationProfile.call(self, getCurrentPolyline.call(self), elevCtl.elevationProfileChartData, li.dataset.uid);\r\n\r\n                                        // 10/02/2020 gestionamos el borrado desde featureTools\r\n                                        onFeatureRemove = onFeatureRemove.bind(self);\r\n                                        self.map.on(TC.Consts.event.FEATUREREMOVE, onFeatureRemove);\r\n\r\n                                        resultsPanelChart.div.addEventListener('mouseover', function (e) {\r\n                                            if (self.layerTrack && self.layerTrack.getVisibility() && self.layerTrack.getOpacity() > 0)\r\n                                                self.wrap.activateSnapping.call(self.wrap);\r\n                                        });\r\n                                        resultsPanelChart.div.addEventListener('mouseout', function (e) {\r\n                                            if (self.layerTrack && (!self.layerTrack.getVisibility() && self.layerTrack.getOpacity() == 0))\r\n                                                self.wrap.deactivateSnapping.call(self.wrap);\r\n                                        });\r\n\r\n                                        self.map\r\n                                            .on(TC.Consts.event.RESULTSPANELMIN, function () { self.chartProgressClear(); })\r\n                                            .on(TC.Consts.event.RESULTSPANELCLOSE, function () { self.chartProgressClear(); });\r\n\r\n                                        // mantenemos el mismo nombre de archivo al descargar desde panel y desde la lista.\r\n                                        elevCtl.getProfilePanel().then(function (resultsPanel) {\r\n                                            let selectedTrack = self.getSelectedTrack();\r\n                                            if (selectedTrack) {\r\n                                                resultsPanel.currentFeature.fileName = getDownloadFileName.call(self, self.getSelectedTrack());\r\n                                            }\r\n                                        });\r\n                                    }\r\n                                };\r\n                                elevCtl.displayElevationProfile(line, options);\r\n                            } else {\r\n                                reject();\r\n                            }\r\n                        } else {\r\n                            reject();\r\n                        }\r\n                    } else {\r\n                        if (!self.options.displayElevation) {\r\n                            delete cachedProfile.data.secondaryElevationProfileChartData[0];\r\n                        }\r\n                        self.elevationChartData = cachedProfile.data;\r\n                        elevCtl.getProfilePanel().then(function (resultsPanel) {\r\n                            resultsPanel.renderPromise().then(function () {\r\n                                resultsPanel.doVisible();\r\n                                elevCtl.renderElevationProfile(self.elevationChartData);\r\n                            });\r\n                            resultsPanel.setCurrentFeature();\r\n                        });\r\n                    }\r\n                    resolve();\r\n                } else {\r\n                    reject();\r\n                }\r\n            }).catch(reject);\r\n        });\r\n    };\r\n\r\n    ctlProto.clear = function (layerType) {\r\n        var self = this;\r\n\r\n        if (self.onResize) {\r\n            window.removeEventListener(\"resize\", self.onResize, false);\r\n            self.onResize = undefined;\r\n        }\r\n\r\n        if (layerType == self.Const.Layers.TRACK) {\r\n\r\n            self.layerTrack.clearFeatures();\r\n\r\n            // grfico perfil de elevacin\r\n            self.getElevationControl().then(elevCtl => elevCtl && elevCtl.closeElevationProfile());\r\n            delete self.elevationChartData;\r\n\r\n            // overlay de la simulacin\r\n            self.wrap.simulateTrackEnd();\r\n\r\n            self.wrap.clear();\r\n\r\n            // eliminamos la seleccin en la lista de tracks\r\n            self.track.trackList.querySelectorAll('li').forEach(function (li) {\r\n                li.classList.remove(self.Const.Classes.SELECTEDTRACK);\r\n            });\r\n\r\n            self.map.trigger(self.Const.Event.CLEARTRACK);\r\n\r\n            self.featuresToShare = [];\r\n\r\n            if (!self.loadingState) {\r\n                delete self.toShare;\r\n            }\r\n\r\n            //TC.Control.prototype.deactivate.call(self);\r\n\r\n        } else {\r\n            self.layerTracking.clearFeatures();\r\n            self.layerGPS.clearFeatures();\r\n        }\r\n    };\r\n\r\n    ctlProto.saveTrack = function (options) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            let message = options.message || self.getLocaleString(\"geo.trk.save.alert\");\r\n\r\n            var _save = function (layer) {\r\n                let wait;\r\n                wait = self.getLoadingIndicator().addWait();\r\n\r\n                let trackName = options.importedFileName || self.track.trackName.value.trim();\r\n\r\n                let tracks = self.availableTracks;\r\n                if (!tracks) {\r\n                    tracks = [];\r\n                }\r\n\r\n                let formatted = self.wrap.formattedToStorage(layer, true, options.notReproject);\r\n\r\n                let clean = function (wait) {\r\n                    self.track.trackName.value = '';\r\n                    self.track.trackName.disabled = true;\r\n                    self.track.trackSave.disabled = true;\r\n\r\n                    self.track.trackWPT.value = '';\r\n                    self.track.trackWPT.disabled = true;\r\n                    self.track.trackAdd.disabled = true;\r\n\r\n                    self.getLoadingIndicator().removeWait(wait);\r\n\r\n                    duringTrackingToolsPanel.call(self);\r\n                };\r\n\r\n                let newTrack = {\r\n                    name: trackName,\r\n                    data: formatted.features,\r\n                    layout: formatted.layout,\r\n                    crs: self.storageCRS\r\n                };\r\n\r\n                const getHashToCompare = function (trackObject) {\r\n                    // reemplazamos los ids contenidos en la geomtra que provocan falsos negativos.\r\n                    let toGetHash = JSON.parse(JSON.stringify(trackObject));\r\n                    const regex = /(\\\"id\\\"\\s?\\:\\s?\\\"[a-z0-9]+\\\")/gi;\n                    toGetHash.data = toGetHash.data.replace(regex, '\"\"');\r\n\r\n                    return hex_md5(JSON.stringify(toGetHash));\r\n                };\r\n\r\n                TC.loadJS(\r\n                    !window.hex_md5,\r\n                    [TC.apiLocation + TC.Consts.url.HASH],\r\n                    function () {\r\n                        let hash = getHashToCompare(newTrack);\r\n\r\n                        let sameTrackUID = tracks.map(function (savedTrack) {\r\n                            let clonedTrack = JSON.parse(JSON.stringify(savedTrack));\r\n                            delete clonedTrack.uid;\r\n                            delete clonedTrack.profile;\r\n\r\n                            if (hash === getHashToCompare(clonedTrack)) {\r\n                                return savedTrack.uid;\r\n                            } else {\r\n                                const jsonFormat = new ol.format.GeoJSON();\r\n                                // validamos si se trata de un track exportado/importado ya que se compacta la geometra\r\n                                let features = jsonFormat.readFeatures(clonedTrack.data);\r\n                                // Aplicamos una precisin un dgito mayor que la del mapa, si no, al compartir algunas parcelas se deforman demasiado\r\n                                let precision = Math.pow(10, TC.Consts.DEGREE_PRECISION + 1);\r\n\r\n                                features.forEach(function (feature) {\r\n                                    let geom = TC.Util.explodeGeometry(TC.Util.compactGeometry(feature.getGeometry().getCoordinates(), precision));\r\n                                    feature.getGeometry().setCoordinates(geom);\r\n                                });\r\n\r\n                                clonedTrack.data = jsonFormat.writeFeatures(features);\r\n\r\n                                if (hash === hex_md5(JSON.stringify(clonedTrack))) {\r\n                                    return savedTrack.uid;\r\n                                } else {\r\n                                    return null;\r\n                                }\r\n                            }\r\n\r\n                        }).filter(function (uid) {\r\n                            return uid !== null\r\n                        });\r\n\r\n                        const getTrackIndex = function (uid) {\r\n                            return self.getStoredTracks().then(function () {\r\n                                self.bindTracks();\r\n\r\n                                let index;\r\n                                for (var i = 0; i < self.availableTracks.length; i++) {\r\n                                    if (self.availableTracks[i].uid === uid) {\r\n                                        index = i;\r\n                                        break;\r\n                                    }\r\n                                }\r\n\r\n                                return index;\r\n                            });\r\n                        };\r\n\r\n                        if (sameTrackUID.length === 0) {\r\n                            newTrack.uid = Date.now() + Math.random();\r\n                            tracks.push(newTrack);\r\n                            tracks = _orderTracks(tracks);\r\n\r\n                            try {\r\n                                self.setStoredTracks(tracks).then(function () {\r\n                                    self.map.toast(message, { duration: 3000 });\r\n\r\n                                    clean(wait);\r\n\r\n                                    getTrackIndex(newTrack.uid).then(function (index) {\r\n                                        resolve(index);\r\n                                    });\r\n                                });\r\n\r\n                            } catch (error) {\r\n                                TC.alert(self.getLocaleString(\"geo.error.savelocalstorage\") + ': ' + error.message);\r\n                                clean(wait);\r\n                                reject(error);\r\n                            }\r\n                        } else {\r\n                            console.log('Ya existe un track con ese mismo hash');\r\n\r\n                            clean(wait);\r\n\r\n                            getTrackIndex(sameTrackUID[0]).then(function (index) {\r\n                                resolve(index);\r\n                            });\r\n                        }\r\n                    });\r\n\r\n            };\r\n\r\n            const createTCFeatures = function (features) {\r\n                return new Promise(function (resolve, reject) {\r\n                    var featurePromises = features.filter(function (feature) {\r\n                        return !feature._wrap;\r\n                    }).forEach(function (elm) {\r\n                        return TC.wrap.Feature.createFeature(elm);\r\n                    });\r\n\r\n                    Promise.all(featurePromises).then(function (tcFeatures) {\r\n                        resolve();\r\n                    });\r\n                });\r\n            };\r\n\r\n            if (self.importedFileName)\r\n                _save(self.layerTrack);\r\n            else if (self.track.trackName.value.trim().length == 0) {\r\n                self.track.trackName.value = new Date().toLocaleString();\r\n                _save(self.layerTracking);\r\n            }\r\n            else {\r\n                _save(self.layerTracking);\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.addWaypoint = function () {\r\n        var self = this;\r\n\r\n        var waypointName = self.track.trackWPT.value.trim();\r\n        if (!waypointName) {\r\n            waypointName = new Date().toLocaleString();\r\n        }\r\n\r\n        var wait = self.getLoadingIndicator().addWait();\r\n\r\n        duringTrackingToolsPanel.call(self);\r\n\r\n        self.wrap.addWaypoint(self.currentPoint.position, {\r\n            name: waypointName,\r\n            ele: self.currentPoint.heading,\r\n            time: new Date().getTime() // GLS: lo quito ya que hemos actualizado la funcin que gestiona la fechas para la exportacin a GPX - espera la fecha en segundos -> / 1000 // para la exportacin a GPX - espera la fecha en segundos\r\n        });\r\n\r\n        self.track.trackWPT.value = '';\r\n        self.track.trackWPT.disabled = true;\r\n        self.track.trackAdd.disabled = true;\r\n\r\n        // cada vez que se aade un waypoint almacenamos en sessionStorage\r\n        TC.Util.storage.setSessionLocalValue(self.Const.LocalStorageKey.TRACKINGTEMP, self.wrap.formattedToStorage(self.layerTracking).features);\r\n\r\n        self.getLoadingIndicator().removeWait(wait);\r\n    };\r\n\r\n    ctlProto.editTrackName = function (trackId, newName) {\r\n        var self = this;\r\n\r\n        self.getAvailableTracks().then(function (tracks) {\r\n            if (tracks) {\r\n                if (tracks[trackId]) {\r\n                    tracks[trackId].name = newName;\r\n\r\n                    self.setStoredTracks(tracks);\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.removeTrack = function (li) {\r\n        var self = this;\r\n\r\n        self.getAvailableTracks().then(function (tracks) {\r\n            if (tracks) {\r\n                var dataId = li.dataset.id;\r\n                if (tracks[dataId]) {\r\n                    var uid = tracks[dataId].uid;\r\n\r\n                    TC.confirm(self.getLocaleString(\"geo.trk.delete.alert\"), function () {\r\n\r\n                        const selectedTrack = self.getSelectedTrack();\r\n                        if (selectedTrack && selectedTrack.dataset.id === dataId) {\r\n                            self.clear(self.Const.Layers.TRACK);\r\n                        }\r\n\r\n                        localforage.removeItem(self.Const.LocalStorageKey.TRACKING + '#' + uid).then(function () {\r\n                            self.getStoredTracks().then(function () {\r\n                                self.bindTracks();\r\n                            });\r\n                        }).catch(function (err) {\r\n                            console.log(err);\r\n                        });\r\n\r\n                    }, function () { });\r\n                }\r\n            }\r\n        });\r\n    };\r\n\r\n    ctlProto.setSelectedTrack = function (li) {\r\n        var self = this;\r\n\r\n        if (!self.isActive) {\r\n            self.activate();\r\n        }\r\n\r\n        self.track.trackList.querySelectorAll('li[data-id] > span').forEach(function (span) {\r\n            span.setAttribute('title', span.textContent);\r\n        });\r\n        self.track.trackList.querySelectorAll('li').forEach(function (li) {\r\n            li.classList.remove(self.Const.Classes.SELECTEDTRACK);\r\n        });\r\n\r\n        li.classList.add(self.Const.Classes.SELECTEDTRACK);\r\n\r\n        li.setAttribute('title', self.getLocaleString(\"tr.lst.clear\") + \" \" + li.querySelector('span').textContent);\r\n        li.querySelector(self.Const.Selector.DRAW).setAttribute('title', li.getAttribute('title'));\r\n\r\n        if (!self.loadingState) {\r\n            delete self.toShare;\r\n        }\r\n    };\r\n\r\n    ctlProto.getSelectedTrack = function () {\r\n        var self = this;\r\n\r\n        return self.track.trackList.querySelector('li.' + self.Const.Classes.SELECTEDTRACK);\r\n    };\r\n\r\n    ctlProto.clearSelectedTrack = function () {\r\n        const self = this;\r\n\r\n        const selected = self.getSelectedTrack();\r\n        if (selected) {\r\n\r\n            if (self.onResize) {\r\n                window.removeEventListener('resize', self.onResize, false);\r\n                self.onResize = undefined;\r\n            }\r\n\r\n            selected.classList.remove(self.Const.Classes.SELECTEDTRACK);\r\n            selected.setAttribute('title', selected.textContent);\r\n            selected.querySelector(self.Const.Selector.DRAW).setAttribute('title', selected.getAttribute('title'));\r\n\r\n            delete self.toShare;\r\n        }\r\n    };\r\n\r\n    ctlProto.clearSelection = function () {\r\n        var self = this;\r\n        self.wrap.deactivateSnapping();\r\n        var selected = self.getSelectedTrack();\r\n        if (selected) {\r\n            self.clearSelectedTrack();\r\n        }\r\n        if (self.resultsPanelChart) {\r\n\r\n            self.resultsPanelChart.div.removeEventListener('mouseover', self.resultsPanelChart.deactivateSnapping);\r\n            self.resultsPanelChart.div.removeEventListener('mouseout', self.resultsPanelChart.activateSnapping);\r\n\r\n            self.resultsPanelChart.close();\r\n        }\r\n\r\n        self.clear(self.Const.Layers.TRACK);\r\n    };\r\n\r\n    ctlProto.drawTrackingData = function (li) {\r\n        const self = this;\r\n\r\n        return new Promise(function (resolve, reject) {\r\n            self.wrap.clear();\r\n\r\n            self.getTrackingData(li).then(function (track) {\r\n                var data = track.data;\r\n                if (track.data)\r\n                    self.wrap.drawTrackingData(track).then(function () {\r\n                        var showFeatures = self.layerTrack.features;\r\n                        if (showFeatures && showFeatures.length > 0) {\r\n\r\n                            var coordinates = showFeatures.filter(function (feature) {\r\n                                feature.showsPopup = false;\r\n                                if (TC.feature.MultiPolyline && feature instanceof TC.feature.MultiPolyline) {\r\n                                    return true;\r\n                                } else if (feature instanceof TC.feature.Polyline) {\r\n                                    return true;\r\n                                }\r\n                                return false;\r\n                            }).map(function (feature) {\r\n                                if (TC.feature.MultiPolyline && feature instanceof TC.feature.MultiPolyline) {\r\n                                    return feature.geometry[0];\r\n                                } else if (feature instanceof TC.feature.Polyline) {\r\n                                    return feature.geometry;\r\n                                }\r\n                            })[0];\r\n\r\n                            if (coordinates) {\r\n                                var first = coordinates[0];\r\n                                var last = coordinates[coordinates.length - 1];\r\n\r\n                                if (first && !(first === last)) {\r\n                                    self.layerTrack.addMarker(first.slice().splice(0, 2), {\r\n                                        showsPopup: false, cssClass: self.CLASS + '-track-marker-icon-end', anchor: [0.5, 1], notExport: true\r\n                                    });\r\n                                }\r\n\r\n                                if (last) {\r\n                                    self.layerTrack.addMarker(last.slice().splice(0, 2), {\r\n                                        showsPopup: false, cssClass: self.CLASS + '-track-marker-icon', anchor: [0.5, 1], notExport: true\r\n                                    });\r\n                                }\r\n                            }\r\n                        }\r\n                        self.layerTrack.setVisibility(true);\r\n                        resolve();\r\n                    });\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.getTrackingData = function (li) {\r\n        const self = this;\r\n        return new Promise(function (resolve, reject) {\r\n            self.getAvailableTracks().then(function (tracks) {\r\n                if (tracks) {\r\n                    const dataId = li.dataset.id;\r\n                    if (tracks[dataId]) {\r\n                        var track = tracks[dataId].data;\r\n\r\n                        // GLS: tengo que transformar de 4326 al crs del mapa en el momento de pintar, porque si lo hacemos al cargar la lista\r\n                        // y despus hay cambio de crs, en el momento de pintar no s desde qu crs debo tranformar\r\n                        track = self.wrap.formattedFromStorage(track);\r\n\r\n                        resolve({ data: track, layout: tracks[dataId].layout });\r\n                    }\r\n                } else {\r\n                    resolve();\r\n                }\r\n            });\r\n        });\r\n    };\r\n\r\n    ctlProto.export = function (li) {\r\n        var self = this;\r\n        return self.wrap.export(li);\r\n    };\r\n\r\n\r\n    ctlProto.clearFileInput = function (fileInput) {\r\n        const form = document.createElement('form');\r\n        const parent = fileInput.parentElement;\r\n        parent.insertBefore(form, fileInput);\r\n        form.appendChild(fileInput);\r\n        form.reset();\r\n        // Desenvolvemos el input del form\r\n        form.insertAdjacentElement('afterend', fileInput);\r\n        parent.removeChild(form);\r\n    };\r\n\r\n    ctlProto.getLoadingIndicator = function () {\r\n        var self = this;\r\n\r\n        if (!self.loading) {\r\n            self.loading = self.map.getControlsByClass(TC.control.LoadingIndicator);\r\n            if (self.loading && self.loading.length > 0)\r\n                self.loading = self.loading[0];\r\n        }\r\n\r\n        return self.loading;\r\n    };\r\n\r\n    ctlProto.onGeolocateError = function (error) {\r\n        var self = this;\r\n\r\n        if (navigator.geolocation) {\r\n            if (self.currentPosition)\r\n                navigator.geolocation.clearWatch(self.currentPosition);\r\n            if (self.currentPositionTrk) {\r\n                self.currentPositionTrk = self.currentPositionTrk instanceof Array ? self.currentPositionTrk : [self.currentPositionTrk];\r\n\r\n                self.currentPositionTrk.forEach(function (watch) {\r\n                    navigator.geolocation.clearWatch(watch);\r\n                });\r\n\r\n                self.currentPositionTrk = [];\r\n            }\r\n        }\r\n\r\n        if (self.currentPositionWaiting)\r\n            self.getLoadingIndicator().removeWait(self.currentPositionWaiting);\r\n\r\n        var errorMsg;\r\n        switch (error.code) {\r\n            case error.PERMISSION_DENIED:\r\n                errorMsg = self.getLocaleString(\"geo.error.permission_denied\");\r\n                break;\r\n            case error.POSITION_UNAVAILABLE:\r\n                errorMsg = self.getLocaleString(\"geo.error.position_unavailable\");\r\n                break;\r\n            case error.TIMEOUT:\r\n                errorMsg = self.getLocaleString(\"geo.error.timeout\");\r\n                break;\r\n            default:\r\n                errorMsg = self.getLocaleString(\"geo.error.default\");\r\n                break;\r\n        }\r\n\r\n        self.map.toast(errorMsg, { type: TC.Consts.msgType.WARNING });\r\n\r\n        if (!self.geopositionTracking && self.track) {\r\n            self.track.activateButton.classList.remove(TC.Consts.classes.HIDDEN);\r\n            self.track.deactivateButton.classList.add(TC.Consts.classes.HIDDEN);\r\n        }\r\n    };\r\n\r\n    var _isEmpty = function (obj) {\r\n        return !obj || obj.length === 0;\r\n    };\r\n\r\n    ctlProto.exportState = function () {\r\n        const self = this;\r\n\r\n        if (self.layerTrack && self.track || self.toShare) {\r\n            let state = {\r\n                id: self.id\r\n            };\r\n            if (!self.toShare || self.toShare && !self.toShare.doZoom) { // caso compartir general                \r\n                self.toShare = { doZoom: false };\r\n                let clonedToShare = Object.assign({}, self.toShare);\r\n                let features = self.layerTrack.features;\r\n\r\n                if (features.length > 0 && self.featuresToShare && self.featuresToShare.length > 0) {\r\n                    clonedToShare.features = self.featuresToShare;\r\n                } else {\r\n                    const layerState = self.layerTrack.exportState({\r\n                        features: features\r\n                    });\r\n\r\n                    clonedToShare.features = layerState.features;\r\n                }\r\n\r\n                const selectedTrack = self.getSelectedTrack();\r\n                if (selectedTrack) {\r\n                    clonedToShare.trackName = selectedTrack.querySelector('span').innerHTML;\r\n                }\r\n                state.trackResult = JSON.stringify(clonedToShare);\r\n            } else { // compartir desde lista de rutas                \r\n                state.trackResult = JSON.stringify(self.toShare);\r\n            }\r\n\r\n            return state;\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    };\r\n\r\n    ctlProto.importState = function (state) {\r\n        const self = this;\r\n        if (self.map) {\r\n            if (state.trackResult && state.trackResult.length) {\r\n                self.enable();\r\n                let sharedTrackResult = JSON.parse(state.trackResult);\r\n\r\n                if (sharedTrackResult.features && sharedTrackResult.features.length > 0) {\r\n                    const promises = new Array(sharedTrackResult.features.length);\r\n                    sharedTrackResult.features.forEach(function (f, idx) {\r\n                        const featureOptions = { data: f.data, id: f.id, showsPopup: f.showsPopup };\r\n                        var addFn;\r\n                        var geom = f.geom; // El redondeo hace que ya no podamos validar con los tracks existentes.\r\n                        switch (f.type) {\r\n                            case TC.Consts.geom.POLYLINE:\r\n                                promises[idx] = new TC.feature.Polyline(geom, featureOptions);\r\n                                break;\r\n                            case TC.Consts.geom.MULTIPOLYLINE:\r\n                                promises[idx] = new TC.feature.MultiPolyline(geom, featureOptions);\r\n                                break;\r\n                            case TC.Consts.geom.MARKER:\r\n                                promises[idx] = new TC.feature.Marker(geom, featureOptions);\r\n                                break;\r\n                            case TC.Consts.geom.POINT:\r\n                                promises[idx] = new TC.feature.Point(geom, featureOptions);\r\n                                break;\r\n                        }\r\n                    });\r\n\r\n                    if (sharedTrackResult.hasOwnProperty(\"doZoom\")) {\r\n                        self.loadingState = true;\r\n                        self.toShare = { doZoom: sharedTrackResult.doZoom };\r\n                    }\r\n\r\n                    Promise.all(promises).then(function (tcFeatures) {\r\n                        var options = { features: tcFeatures, fileName: sharedTrackResult.trackName, notReproject: true, isShared: true };\r\n                        if (!self.availableTracks) {\r\n                            self.getStoredTracks().then(function () {\r\n                                self.importTrack(options);\r\n                            });\r\n                        } else {\r\n                            self.importTrack(options);\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        }\r\n    };\r\n})();"]}