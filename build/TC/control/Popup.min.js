TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js"),TC.Consts.event.POPUP="popup.tc",TC.Consts.event.POPUPHIDE="popuphide.tc",TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag",TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged",TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable",TC.control.Popup=function(){var t=this;TC.Control.apply(t,arguments),t.currentFeature=null,t.wrap=new TC.wrap.control.Popup(t)},TC.inherit(TC.control.Popup,TC.Control),function(){var t=TC.control.Popup.prototype;t.CLASS="tc-ctl-popup",t.render=function(){},t.register=function(t){var e=this;TC.Control.prototype.register.call(e,t),$.when(t.wrap.addPopup(e)).then(function(){t.on(TC.Consts.event.LAYERVISIBILITY,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&!t.layer.getVisibility()&&e.hide()}),t.on(TC.Consts.event.LAYERREMOVE,function(t){e.currentFeature&&e.currentFeature.layer===t.layer&&e.hide()}),t.on(TC.Consts.event.UPDATE,function(){e.currentFeature&&e.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||e.hide()}),t.on(TC.Consts.event.FEATUREREMOVE,function(t){e.currentFeature===t.feature&&e.hide()})})},t.fitToView=function(t){var e=this;t?setTimeout(function(){e.wrap.fitToView()},1e3):e.wrap.fitToView()},t.hide=function(){var t=this;t.map&&(t.map.wrap.hidePopup(t),t.setDragged(!1),t.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:t})))},t.setDragged=function(t){var e=this;e.dragged=t,e.$popupDiv&&e.$popupDiv.toggleClass(TC.Consts.classes.DRAGGED,t),e.wrap.setDragged(t)},t.setDragging=function(t){var e=this;t&&e.setDragged(!0),e.$popupDiv.toggleClass(TC.Consts.classes.DRAG,t)},t.isVisible=function(){var t=this;return t.$popupDiv&&t.$popupDiv.hasClass(TC.Consts.classes.VISIBLE)}}();