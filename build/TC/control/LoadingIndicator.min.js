TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control.js"),TC.control.LoadingIndicator=function(){var t=this;TC.Control.apply(t,arguments),window.addEventListener("error",function(){return t.reset(),!1},!1)},TC.inherit(TC.control.LoadingIndicator,TC.Control),function(){var t=TC.control.LoadingIndicator.prototype;t.CLASS="tc-ctl-load",t.template=TC.isDebug?TC.apiLocation+"TC/templates/LoadingIndicator.html":function(){function o(t,o){return t.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}return dust.register(t.CLASS,o),o.__dustBody=!0,o},t.waits={},t.startWait=function(o){var n=this;void 0===t.waits[o.layer.id]&&(t.waits[o.layer.id]=0),t.waits[o.layer.id]=t.waits[o.layer.id]+1,n.show(),n.map.$events.trigger($.Event(TC.Consts.event.STARTLOADING))},t.stopWait=function(o){var n=this,i=t.waits[o.layer.id];i>0&&(i=t.waits[o.layer.id]=i-1),i||delete t.waits[o.layer.id];var e=0;for(var s in t.waits)e++;e||(n.map?n.map.isLoaded&&n.hide():n.hide(),n.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING)))},t.reset=function(o){var n=this;t.waits={},n.hide(),n.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))},t.register=function(t){var o=this;TC.Control.prototype.register.call(o,t),t.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(t){o.startWait(t)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(t){o.stopWait(t)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(t){o.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO,function(t){o.removeWait(TC.Consts.event.FEATUREINFO)}),TC.isDebug||(window.addEventListener("error",function(t,n,i,e,s){return o.reset(),!1}),$(document).ajaxError(function(t,n,i){o.reset()}))},t.addWait=function(t){var o,n=this,o=t||TC.getUID();return n.startWait({layer:{id:o}}),o},t.removeWait=function(t){this.stopWait({layer:{id:t}})}}();